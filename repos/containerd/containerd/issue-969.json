{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/120601?v=4",
    "events_url": "https://api.github.com/users/stevvooe/events{/privacy}",
    "followers_url": "https://api.github.com/users/stevvooe/followers",
    "following_url": "https://api.github.com/users/stevvooe/following{/other_user}",
    "gists_url": "https://api.github.com/users/stevvooe/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/stevvooe",
    "id": 120601,
    "login": "stevvooe",
    "node_id": "MDQ6VXNlcjEyMDYwMQ==",
    "organizations_url": "https://api.github.com/users/stevvooe/orgs",
    "received_events_url": "https://api.github.com/users/stevvooe/received_events",
    "repos_url": "https://api.github.com/users/stevvooe/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/stevvooe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stevvooe/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/stevvooe"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/120601?v=4",
      "events_url": "https://api.github.com/users/stevvooe/events{/privacy}",
      "followers_url": "https://api.github.com/users/stevvooe/followers",
      "following_url": "https://api.github.com/users/stevvooe/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevvooe/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/stevvooe",
      "id": 120601,
      "login": "stevvooe",
      "node_id": "MDQ6VXNlcjEyMDYwMQ==",
      "organizations_url": "https://api.github.com/users/stevvooe/orgs",
      "received_events_url": "https://api.github.com/users/stevvooe/received_events",
      "repos_url": "https://api.github.com/users/stevvooe/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/stevvooe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevvooe/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/stevvooe"
    }
  ],
  "author_association": "MEMBER",
  "body": "When trying to run two containers with the same id for the container and rootfs, we get a collision for the snapshot.\r\n\r\nHere is the example:\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"fmt\"\r\n\t\"sync\"\r\n\t\"syscall\"\r\n\t\"time\"\r\n\r\n\t\"github.com/Sirupsen/logrus\"\r\n\t\"github.com/containerd/containerd\"\r\n\t\"github.com/containerd/containerd/namespaces\"\r\n)\r\n\r\nconst (\r\n\taddress = \"/run/containerd/containerd.sock\"\r\n\tredis   = \"docker.io/library/redis:alpine\"\r\n)\r\n\r\nfunc main() {\r\n\tvar (\r\n\t\tctx    = context.Background()\r\n\t\tdocker = namespaces.WithNamespace(ctx, \"docker\")\r\n\t\tkube   = namespaces.WithNamespace(ctx, \"kube\")\r\n\t\twg     = &sync.WaitGroup{}\r\n\t)\r\n\r\n\twg.Add(2)\r\n\r\n\tgo func() {\r\n\t\tif err := runRedis(docker, \"redis\", wg); err != nil {\r\n\t\t\tlogrus.Error(err)\r\n\t\t}\r\n\t}()\r\n\tgo func() {\r\n\t\tif err := runRedis(kube, \"redis\", wg); err != nil {\r\n\t\t\tlogrus.Error(err)\r\n\t\t}\r\n\t}()\r\n\r\n\twg.Wait()\r\n}\r\n\r\nfunc runRedis(ctx context.Context, id string, wg *sync.WaitGroup) error {\r\n\tdefer wg.Done()\r\n\tclient, err := containerd.New(address)\r\n\tif err != nil {\r\n\t\treturn err\r\n\t}\r\n\tdefer client.Close()\r\n\timage, err := client.Pull(ctx, redis, containerd.WithPullUnpack)\r\n\tif err != nil {\r\n\t\treturn err\r\n\t}\r\n\tspec, err := containerd.GenerateSpec(containerd.WithImageConfig(ctx, image))\r\n\tif err != nil {\r\n\t\treturn err\r\n\t}\r\n\tcontainer, err := client.NewContainer(ctx, id,\r\n\t\tcontainerd.WithSpec(spec),\r\n\t\tcontainerd.WithNewRootFS(id, image),\r\n\t\tcontainerd.WithImage(image),\r\n\t)\r\n\tif err != nil {\r\n\t\treturn err\r\n\t}\r\n\tdefer container.Delete(ctx)\r\n\ttask, err := container.NewTask(ctx, containerd.Stdio)\r\n\tif err != nil {\r\n\t\treturn err\r\n\t}\r\n\tc := make(chan struct{}, 1)\r\n\tgo func() {\r\n\t\tif _, err := task.Wait(ctx); err != nil {\r\n\t\t\tfmt.Println(err)\r\n\t\t}\r\n\t\tclose(c)\r\n\t}()\r\n\tdefer task.Delete(ctx)\r\n\r\n\tif err := task.Start(ctx); err != nil {\r\n\t\treturn err\r\n\t}\r\n\ttime.Sleep(3 * time.Second)\r\n\tif err := task.Kill(ctx, syscall.SIGTERM); err != nil {\r\n\t\treturn err\r\n\t}\r\n\t<-c\r\n\treturn nil\r\n}\r\n```",
  "closed_at": "2017-06-08T20:37:16Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/749551?v=4",
    "events_url": "https://api.github.com/users/crosbymichael/events{/privacy}",
    "followers_url": "https://api.github.com/users/crosbymichael/followers",
    "following_url": "https://api.github.com/users/crosbymichael/following{/other_user}",
    "gists_url": "https://api.github.com/users/crosbymichael/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/crosbymichael",
    "id": 749551,
    "login": "crosbymichael",
    "node_id": "MDQ6VXNlcjc0OTU1MQ==",
    "organizations_url": "https://api.github.com/users/crosbymichael/orgs",
    "received_events_url": "https://api.github.com/users/crosbymichael/received_events",
    "repos_url": "https://api.github.com/users/crosbymichael/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/crosbymichael/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/crosbymichael/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/crosbymichael"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/969/comments",
  "created_at": "2017-06-07T17:08:55Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/969/events",
  "html_url": "https://github.com/containerd/containerd/issues/969",
  "id": 234279778,
  "labels": [],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/969/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2017-07-13T00:14:32Z",
    "closed_issues": 48,
    "created_at": "2017-02-28T22:59:22Z",
    "creator": {
      "avatar_url": "https://avatars1.githubusercontent.com/u/749551?v=4",
      "events_url": "https://api.github.com/users/crosbymichael/events{/privacy}",
      "followers_url": "https://api.github.com/users/crosbymichael/followers",
      "following_url": "https://api.github.com/users/crosbymichael/following{/other_user}",
      "gists_url": "https://api.github.com/users/crosbymichael/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/crosbymichael",
      "id": 749551,
      "login": "crosbymichael",
      "node_id": "MDQ6VXNlcjc0OTU1MQ==",
      "organizations_url": "https://api.github.com/users/crosbymichael/orgs",
      "received_events_url": "https://api.github.com/users/crosbymichael/received_events",
      "repos_url": "https://api.github.com/users/crosbymichael/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/crosbymichael/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/crosbymichael/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/crosbymichael"
    },
    "description": "The containerd alpha release comes with a stable API for people to start or complete their integrations of containerd into their platforms. \r\n\r\nThe API \"should be\" stable but small changes may be necessary based on feedback from integrations.",
    "due_on": "2017-07-12T07:00:00Z",
    "html_url": "https://github.com/containerd/containerd/milestone/8",
    "id": 2354639,
    "labels_url": "https://api.github.com/repos/containerd/containerd/milestones/8/labels",
    "node_id": "MDk6TWlsZXN0b25lMjM1NDYzOQ==",
    "number": 8,
    "open_issues": 0,
    "state": "closed",
    "title": "containerd alpha",
    "updated_at": "2017-07-13T00:14:32Z",
    "url": "https://api.github.com/repos/containerd/containerd/milestones/8"
  },
  "node_id": "MDU6SXNzdWUyMzQyNzk3Nzg=",
  "number": 969,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "Namespace Snapshots",
  "updated_at": "2017-06-08T20:37:17Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/969",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/749551?v=4",
    "events_url": "https://api.github.com/users/crosbymichael/events{/privacy}",
    "followers_url": "https://api.github.com/users/crosbymichael/followers",
    "following_url": "https://api.github.com/users/crosbymichael/following{/other_user}",
    "gists_url": "https://api.github.com/users/crosbymichael/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/crosbymichael",
    "id": 749551,
    "login": "crosbymichael",
    "node_id": "MDQ6VXNlcjc0OTU1MQ==",
    "organizations_url": "https://api.github.com/users/crosbymichael/orgs",
    "received_events_url": "https://api.github.com/users/crosbymichael/received_events",
    "repos_url": "https://api.github.com/users/crosbymichael/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/crosbymichael/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/crosbymichael/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/crosbymichael"
  }
}