{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!--\r\nIf you are reporting a new issue, make sure that we do not have any duplicates\r\nalready open. You can ensure this by searching the issue list for this\r\nrepository. If there is a duplicate, please close your issue and add a comment\r\nto the existing issue instead.\r\n\r\nIf you suspect your issue is a bug, please edit your issue description to\r\ninclude the BUG REPORT INFORMATION shown below. If you fail to provide this\r\ninformation within 7 days, we cannot debug your issue and will close it. We\r\nwill, however, reopen it if you later provide the information.\r\n\r\n---------------------------------------------------\r\nBUG REPORT INFORMATION\r\n---------------------------------------------------\r\nUse the commands below to provide key information from your environment:\r\nYou do NOT have to include this information if this is a FEATURE REQUEST\r\n-->\r\n\r\nWhen the file path for `address` in `[grpc]` or `[debug]` is longer than 67 characters, containerd fails to start. I discovered this behavior when I was calling dockerd directly with `--exec-root` but I can reproduce with just containerd given the config file dockerd writes out.\r\n\r\n**Steps to reproduce the issue:**\r\n1. Create a config file like:\r\n```root = \"/mnt/hab/svc/builder-worker/data/947098412724445184/dockerd/var/lib/docker/containerd/daemon\"\r\nstate = \"/hab/svc/builder-worker/data/947098412724445184/dockerd/var/run/docker/containerd/daemon\"\r\nno_subreaper = false\r\noom_score = -500\r\n\r\n[grpc]\r\n  address = \"/foo/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/dockerd/var/run/docker/containerd/docker-containerd.sock\"\r\n  uid = 0\r\n  gid = 0\r\n\r\n[debug]\r\n  address = \"/foo/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/dockerd/var/run/docker/containerd/docker-containerd-debug.sock\"\r\n  uid = 0\r\n  gid = 0\r\n  level = \"debug\"\r\n\r\n[metrics]\r\n  address = \"\"\r\n\r\n[cgroup]\r\n  path = \"\"\r\n\r\n[plugins]\r\n  [plugins.linux]\r\n    shim = \"docker-containerd-shim\"\r\n    runtime = \"docker-runc\"\r\n    runtime_root = \"/mnt/hab/svc/builder-worker/data/947098412724445184/dockerd/var/lib/docker/runc\"\r\n    no_shim = false\r\n    shim_debug = true\r\n```\r\n2. launch containerd\r\n```\r\ndocker-containerd -c containerd.toml --log-level=debug\r\n```\r\n\r\nI get the following output:\r\n```\r\nINFO[0000] starting containerd                           module=containerd revision=cfd04396dc68220d1cecbe686a6cc3aa5ce3667c version=v1.0.2\r\nDEBU[0000] changing OOM score to -500                    module=containerd\r\nINFO[0000] loading plugin \"io.containerd.content.v1.content\"...  module=containerd type=io.containerd.content.v1\r\nINFO[0000] loading plugin \"io.containerd.snapshotter.v1.btrfs\"...  module=containerd type=io.containerd.snapshotter.v1\r\nWARN[0000] failed to load plugin io.containerd.snapshotter.v1.btrfs  error=\"path /mnt/hab/svc/builder-worker/data/947098412724445184/dockerd/var/lib/docker/containerd/daemon/io.containerd.snapshotter.v1.btrfs must be a btrfs filesystem to be used with the btrfs snapshotter\" module=containerd\r\nINFO[0000] loading plugin \"io.containerd.snapshotter.v1.overlayfs\"...  module=containerd type=io.containerd.snapshotter.v1\r\nINFO[0000] loading plugin \"io.containerd.metadata.v1.bolt\"...  module=containerd type=io.containerd.metadata.v1\r\nWARN[0000] could not use snapshotter btrfs in metadata plugin  error=\"path /mnt/hab/svc/builder-worker/data/947098412724445184/dockerd/var/lib/docker/containerd/daemon/io.containerd.snapshotter.v1.btrfs must be a btrfs filesystem to be used with the btrfs snapshotter\" module=\"containerd/io.containerd.metadata.v1.bolt\"\r\nINFO[0000] loading plugin \"io.containerd.differ.v1.walking\"...  module=containerd type=io.containerd.differ.v1\r\nINFO[0000] loading plugin \"io.containerd.gc.v1.scheduler\"...  module=containerd type=io.containerd.gc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.containers\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.content\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.diff\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.events\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.healthcheck\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.images\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.leases\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.namespaces\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.snapshots\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.monitor.v1.cgroups\"...  module=containerd type=io.containerd.monitor.v1\r\nINFO[0000] loading plugin \"io.containerd.runtime.v1.linux\"...  module=containerd type=io.containerd.runtime.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.tasks\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.version\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.introspection\"...  module=containerd type=io.containerd.grpc.v1\r\ncontainerd: failed to get listener for debug endpoint: listen unix /foo/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/var/run/docker/containerd/docker-containerd-debug.sock: bind: invalid argument\r\n```\r\n\r\nI expected to get:\r\n\r\n```\r\nINFO[0000] starting containerd                           module=containerd revision=cfd04396dc68220d1cecbe686a6cc3aa5ce3667c version=v1.0.2\r\nDEBU[0000] changing OOM score to -500                    module=containerd\r\nINFO[0000] loading plugin \"io.containerd.content.v1.content\"...  module=containerd type=io.containerd.content.v1\r\nINFO[0000] loading plugin \"io.containerd.snapshotter.v1.btrfs\"...  module=containerd type=io.containerd.snapshotter.v1\r\nWARN[0000] failed to load plugin io.containerd.snapshotter.v1.btrfs  error=\"path /mnt/hab/svc/builder-worker/data/947098412724445184/dockerd/var/lib/docker/containerd/daemon/io.containerd.snapshotter.v1.btrfs must be a btrfs filesystem to be used with the btrfs snapshotter\" module=containerd\r\nINFO[0000] loading plugin \"io.containerd.snapshotter.v1.overlayfs\"...  module=containerd type=io.containerd.snapshotter.v1\r\nINFO[0000] loading plugin \"io.containerd.metadata.v1.bolt\"...  module=containerd type=io.containerd.metadata.v1\r\nWARN[0000] could not use snapshotter btrfs in metadata plugin  error=\"path /mnt/hab/svc/builder-worker/data/947098412724445184/dockerd/var/lib/docker/containerd/daemon/io.containerd.snapshotter.v1.btrfs must be a btrfs filesystem to be used with the btrfs snapshotter\" module=\"containerd/io.containerd.metadata.v1.bolt\"\r\nINFO[0000] loading plugin \"io.containerd.differ.v1.walking\"...  module=containerd type=io.containerd.differ.v1\r\nINFO[0000] loading plugin \"io.containerd.gc.v1.scheduler\"...  module=containerd type=io.containerd.gc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.containers\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.content\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.diff\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.events\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.healthcheck\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.images\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.leases\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.namespaces\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.snapshots\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.monitor.v1.cgroups\"...  module=containerd type=io.containerd.monitor.v1\r\nINFO[0000] loading plugin \"io.containerd.runtime.v1.linux\"...  module=containerd type=io.containerd.runtime.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.tasks\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.version\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] loading plugin \"io.containerd.grpc.v1.introspection\"...  module=containerd type=io.containerd.grpc.v1\r\nINFO[0000] serving...                                    address=\"/bar/a/var/run/docker/containerd/docker-containerd-debug.sock\" module=\"containerd/debug\"\r\nINFO[0000] serving...                                    address=\"/bar/a/var/run/docker/containerd/docker-containerd.sock\" module=\"containerd/grpc\"\r\nINFO[0000] containerd successfully booted in 0.002605s   module=containerd\r\n```\r\n\r\nWhich I can get with the following config file:\r\n\r\n```\r\nroot = \"/mnt/hab/svc/builder-worker/data/947098412724445184/dockerd/var/lib/docker/containerd/daemon\"\r\nstate = \"/hab/svc/builder-worker/data/947098412724445184/dockerd/var/run/docker/containerd/daemon\"\r\nno_subreaper = false\r\noom_score = -500\r\n\r\n[grpc]\r\n  address = \"/bar/a/var/run/docker/containerd/docker-containerd.sock\"\r\n  uid = 0\r\n  gid = 0\r\n\r\n[debug]\r\n  address = \"/bar/a/var/run/docker/containerd/docker-containerd-debug.sock\"\r\n  uid = 0\r\n  gid = 0\r\n  level = \"debug\"\r\n\r\n[metrics]\r\n  address = \"\"\r\n\r\n[cgroup]\r\n  path = \"\"\r\n\r\n[plugins]\r\n  [plugins.linux]\r\n    shim = \"docker-containerd-shim\"\r\n    runtime = \"docker-runc\"\r\n    runtime_root = \"/mnt/hab/svc/builder-worker/data/947098412724445184/dockerd/var/lib/docker/runc\"\r\n    no_shim = false\r\n    shim_debug = true\r\n```\r\n\r\n\r\n```\r\ncontainerd github.com/containerd/containerd v1.0.2 cfd04396dc68220d1cecbe686a6cc3aa5ce3667c\r\n```\r\n\r\nRelated: https://github.com/habitat-sh/builder/pull/356",
  "closed_at": "2018-03-30T17:16:23Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/120601?v=4",
    "events_url": "https://api.github.com/users/stevvooe/events{/privacy}",
    "followers_url": "https://api.github.com/users/stevvooe/followers",
    "following_url": "https://api.github.com/users/stevvooe/following{/other_user}",
    "gists_url": "https://api.github.com/users/stevvooe/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/stevvooe",
    "id": 120601,
    "login": "stevvooe",
    "node_id": "MDQ6VXNlcjEyMDYwMQ==",
    "organizations_url": "https://api.github.com/users/stevvooe/orgs",
    "received_events_url": "https://api.github.com/users/stevvooe/received_events",
    "repos_url": "https://api.github.com/users/stevvooe/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/stevvooe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stevvooe/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/stevvooe"
  },
  "comments": 5,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/2252/comments",
  "created_at": "2018-03-29T21:46:00Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/2252/events",
  "html_url": "https://github.com/containerd/containerd/issues/2252",
  "id": 309914165,
  "labels": [],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/2252/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMDk5MTQxNjU=",
  "number": 2252,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "containerd crashes when address field for gRPC sockets is too long",
  "updated_at": "2018-03-30T17:24:06Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/2252",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1130349?v=4",
    "events_url": "https://api.github.com/users/elliott-davis/events{/privacy}",
    "followers_url": "https://api.github.com/users/elliott-davis/followers",
    "following_url": "https://api.github.com/users/elliott-davis/following{/other_user}",
    "gists_url": "https://api.github.com/users/elliott-davis/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/elliott-davis",
    "id": 1130349,
    "login": "elliott-davis",
    "node_id": "MDQ6VXNlcjExMzAzNDk=",
    "organizations_url": "https://api.github.com/users/elliott-davis/orgs",
    "received_events_url": "https://api.github.com/users/elliott-davis/received_events",
    "repos_url": "https://api.github.com/users/elliott-davis/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/elliott-davis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/elliott-davis/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/elliott-davis"
  }
}