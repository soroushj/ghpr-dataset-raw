{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "_bug report_\r\n\r\n**Description**\r\n\r\non startup, after 'start streaming server' and a few operations, containerd crashloops _almost exactly every minute at same seconds_ and prints the following stacktrace\r\n\r\n```\r\nMay 29 12:19:01 minionpublic1 containerd[9691]: time=\"2019-05-29T12:19:01.096721955Z\" level=warning msg=\"The image sha256:f0fad859c909baef1b038ef8d2f6e76fc252e25a3d9af37\r\nMay 29 12:19:01 minionpublic1 containerd[9691]: time=\"2019-05-29T12:19:01.119703566Z\" level=info msg=\"Start event monitor\"\r\nMay 29 12:19:01 minionpublic1 containerd[9691]: time=\"2019-05-29T12:19:01.119822706Z\" level=info msg=\"Start snapshots syncer\"\r\nMay 29 12:19:01 minionpublic1 containerd[9691]: time=\"2019-05-29T12:19:01.119834583Z\" level=info msg=\"Start streaming server\"\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: time=\"2019-05-29T12:19:08.807256438Z\" level=info msg=\"RemoveContainer for \"1cde6af58b9e9ec2ea4481d7ece8314a701bb0a67ba649\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: time=\"2019-05-29T12:19:08.807491426Z\" level=info msg=\"RemoveContainer for \"1cde6af58b9e9ec2ea4481d7ece8314a701bb0a67ba649\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: panic: runtime error: invalid memory address or nil pointer dereference\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: [signal SIGSEGV: segmentation violation code=0x1 addr=0x38 pc=0x55fe3e32f275]\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: goroutine 85 [running]:\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: github.com/containerd/containerd.WithSnapshotCleanup(0x55fe3f2ab0c0, 0xc00072c3c0, 0xc0003fc0b0, 0xc000208ac0, 0x40, 0xc0\r\nMay 29 12:19:10 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/container_opts.go:144 +0xd5\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: github.com/containerd/containerd.(*container).Delete(0xc0006bcc80, 0x55fe3f2ab0c0, 0xc00072c3c0, 0xc00000e080, 0x1, 0x1,\r\nMay 29 12:19:10 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/container.go:152 +0x1a1\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: github.com/containerd/containerd/vendor/github.com/containerd/cri/pkg/server.(*criService).RemoveContainer(0xc000462480,\r\nMay 29 12:19:10 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/vendor/github.com/containerd/cri/pkg/server/container_re\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: github.com/containerd/containerd/vendor/github.com/containerd/cri/pkg/server.(*instrumentedService).RemoveContainer(0xc00\r\nMay 29 12:19:10 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/vendor/github.com/containerd/cri/pkg/server/instrumented\r\nMay 29 12:19:10 minionpublic1 containerd[9691]: github.com/containerd/containerd/vendor/k8s.io/kubernetes/pkg/kubelet/apis/cri/runtime/v1alpha2._RuntimeService_RemoveCon\r\nMay 29 12:19:10 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/vendor/k8s.io/kubernetes/pkg/kubelet/apis/cri/runtime/v1\r\nMay 29 12:19:08 minionpublic1 systemd[1]: containerd.service: Main process exited, code=exited, status=2/INVALIDARGUMENT\r\nMay 29 12:19:11 minionpublic1 containerd[9691]: github.com/containerd/containerd/vendor/github.com/grpc-ecosystem/go-grpc-prometheus.UnaryServerInterceptor(0x55fe3f2ab0c\r\nMay 29 12:19:11 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/vendor/github.com/grpc-ecosystem/go-grpc-prometheus/serv\r\nMay 29 12:19:11 minionpublic1 containerd[9691]: github.com/containerd/containerd/vendor/k8s.io/kubernetes/pkg/kubelet/apis/cri/runtime/v1alpha2._RuntimeService_RemoveCon\r\nMay 29 12:19:11 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/vendor/k8s.io/kubernetes/pkg/kubelet/apis/cri/runtime/v1\r\nMay 29 12:19:11 minionpublic1 containerd[9691]: github.com/containerd/containerd/vendor/google.golang.org/grpc.(*Server).processUnaryRPC(0xc000134000, 0x55fe3f2b5440, 0x\r\nMay 29 12:19:11 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/vendor/google.golang.org/grpc/server.go:1011 +0x4cf\r\nMay 29 12:19:11 minionpublic1 containerd[9691]: github.com/containerd/containerd/vendor/google.golang.org/grpc.(*Server).handleStream(0xc000134000, 0x55fe3f2b5440, 0xc00\r\nMay 29 12:19:11 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/vendor/google.golang.org/grpc/server.go:1249 +0x1313\r\nMay 29 12:19:11 minionpublic1 containerd[9691]: github.com/containerd/containerd/vendor/google.golang.org/grpc.(*Server).serveStreams.func1.1(0xc0004d45a0, 0xc000134000,\r\nMay 29 12:19:11 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/vendor/google.golang.org/grpc/server.go:680 +0xa1\r\nMay 29 12:19:11 minionpublic1 containerd[9691]: created by github.com/containerd/containerd/vendor/google.golang.org/grpc.(*Server).serveStreams.func1\r\nMay 29 12:19:11 minionpublic1 containerd[9691]:         /home/travis/gopath/src/github.com/containerd/containerd/vendor/google.golang.org/grpc/server.go:678 +0xa3\r\nMay 29 12:19:08 minionpublic1 systemd[1]: containerd.service: Failed with result 'exit-code'.\r\n```\r\n\r\nImportant to notice that when the k8s node comes up, it first starts with containerd `1.2.5` which is the one installed by Docker, lives for about 90 seconds without doing anything (as shown in logs, after successfully starting), then restarts at containerd `1.2.6` which is installed afterwards, then the panic-loop occurs.\r\n\r\nAfter a while of crashlooping, an hour or so, it stops doing so.\r\n\r\n**Steps to reproduce the issue:**\r\n\r\nIt only happens in one node out of many but the node changes, cannot pinpoint any configuration difference or specific node problem.\r\n\r\nThe most relevance is with `v1alpha2._RuntimeService` which I don't know what it exactly is. In slightly different configurations pods fail to start printing a similar error to v1alpha2 runtimeservice etc.\r\n\r\nIn the meantime between crashloops, it prints a lot of these messages:\r\n```\r\n\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 4427 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 4512 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 4560 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 4660 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 4810 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 4912 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 4954 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 5123 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 5246 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 5403 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 5531 (containerd-shim) in control group while starting unit. Ignoring.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: This usually indicates unclean termination of a previous run, or service implementation deficiencies.\r\nMay 29 12:44:40 minionpublic1 systemd[1]: containerd.service: Found left-over process 5634 (containerd-shim) in control group while starting unit. Ignoring.\r\n```\r\nand for other processes such as pods or s6-supervisor and others.\r\n\r\n\r\n*versions*\r\n```\r\ncontainerd github.com/containerd/containerd v1.2.6 894b81a4b802e4eb2a91d1ce216b8817763c29fb\r\n\r\nrunc v1.0.0-rc8\r\n\r\nk8s 1.11.8\r\n```\r\n\r\n*config*\r\n\r\nio.containerd.runc.v1 shim\r\noverlayfs\r\nCNI 0.7.5",
  "closed_at": "2019-06-17T18:05:11Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/5858142?v=4",
    "events_url": "https://api.github.com/users/jterry75/events{/privacy}",
    "followers_url": "https://api.github.com/users/jterry75/followers",
    "following_url": "https://api.github.com/users/jterry75/following{/other_user}",
    "gists_url": "https://api.github.com/users/jterry75/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jterry75",
    "id": 5858142,
    "login": "jterry75",
    "node_id": "MDQ6VXNlcjU4NTgxNDI=",
    "organizations_url": "https://api.github.com/users/jterry75/orgs",
    "received_events_url": "https://api.github.com/users/jterry75/received_events",
    "repos_url": "https://api.github.com/users/jterry75/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jterry75/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jterry75/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jterry75"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/3312/comments",
  "created_at": "2019-05-29T15:27:11Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/3312/events",
  "html_url": "https://github.com/containerd/containerd/issues/3312",
  "id": 449875213,
  "labels": [],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/3312/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NDk4NzUyMTM=",
  "number": 3312,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "panic / v1alpha2._RuntimeService / SIGSEGV code=0x1 addr=0x38 pc=0x55f266891275",
  "updated_at": "2019-06-17T18:05:11Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/3312",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/42466421?v=4",
    "events_url": "https://api.github.com/users/nikopen/events{/privacy}",
    "followers_url": "https://api.github.com/users/nikopen/followers",
    "following_url": "https://api.github.com/users/nikopen/following{/other_user}",
    "gists_url": "https://api.github.com/users/nikopen/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/nikopen",
    "id": 42466421,
    "login": "nikopen",
    "node_id": "MDQ6VXNlcjQyNDY2NDIx",
    "organizations_url": "https://api.github.com/users/nikopen/orgs",
    "received_events_url": "https://api.github.com/users/nikopen/received_events",
    "repos_url": "https://api.github.com/users/nikopen/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/nikopen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nikopen/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/nikopen"
  }
}