{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/16065150?v=4",
    "events_url": "https://api.github.com/users/mlaventure/events{/privacy}",
    "followers_url": "https://api.github.com/users/mlaventure/followers",
    "following_url": "https://api.github.com/users/mlaventure/following{/other_user}",
    "gists_url": "https://api.github.com/users/mlaventure/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mlaventure",
    "id": 16065150,
    "login": "mlaventure",
    "node_id": "MDQ6VXNlcjE2MDY1MTUw",
    "organizations_url": "https://api.github.com/users/mlaventure/orgs",
    "received_events_url": "https://api.github.com/users/mlaventure/received_events",
    "repos_url": "https://api.github.com/users/mlaventure/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mlaventure/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mlaventure/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mlaventure"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/16065150?v=4",
      "events_url": "https://api.github.com/users/mlaventure/events{/privacy}",
      "followers_url": "https://api.github.com/users/mlaventure/followers",
      "following_url": "https://api.github.com/users/mlaventure/following{/other_user}",
      "gists_url": "https://api.github.com/users/mlaventure/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mlaventure",
      "id": 16065150,
      "login": "mlaventure",
      "node_id": "MDQ6VXNlcjE2MDY1MTUw",
      "organizations_url": "https://api.github.com/users/mlaventure/orgs",
      "received_events_url": "https://api.github.com/users/mlaventure/received_events",
      "repos_url": "https://api.github.com/users/mlaventure/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mlaventure/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mlaventure/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mlaventure"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "Since #1007 added `grpc.FailOnNonTempDialError(true)` to the client's dial options I am finding with swarmd's containerd executor that if I glitch containerd (by restarting) it is never reconnecting and is always seeing the same error:\r\n```\r\nrpc error: code = Internal desc = connection error: desc = \"transport: dial unix /run/containerd/containerd.sock: connect: no such file or directory\"\r\n```\r\nThis persists even after containerd is fine again (i.e. a new `ctr` invocation works)\r\n\r\nI patched `ctr event` to make it easier to demonstrate see https://github.com/ijc/containerd/commit/869ec23e1fc0b8960a64f8acb7cddf5d522c44c2 which ports it to the client library and adds some retry loops with some logging. With that I run `containerd` and `ctr events`, if I then bounce the `containerd` process I get:\r\n```\r\nRecv failed: rpc error: code = Internal desc = transport is closing\r\nRetrying\r\nRetry failed: rpc error: code = Internal desc = connection error: desc = \"transport: dial unix /run/containerd/containerd.sock: connect: no such file or directory\"\r\nRetry failed: rpc error: code = Internal desc = connection error: desc = \"transport: dial unix /run/containerd/containerd.sock: connect: no such file or directory\"\r\nRetry failed: rpc error: code = Internal desc = connection error: desc = \"transport: dial unix /run/containerd/containerd.sock: connect: no such file or directory\"\r\nRetry failed: rpc error: code = Internal desc = connection error: desc = \"transport: dial unix /run/containerd/containerd.sock: connect: no such file or directory\"\r\nRetry failed: rpc error: code = Internal desc = connection error: desc = \"transport: dial unix /run/containerd/containerd.sock: connect: no such file or directory\"\r\nRetry failed: rpc error: code = Internal desc = connection error: desc = \"transport: dial unix /run/containerd/containerd.sock: connect: no such file or directory\"\r\n[...forever at 1s intervals...]\r\n```\r\n\r\nNote that \"no such file or directory\" is considered a non-temporary error (by `google.golang.org/grpc/transport.isTemporary`, which relies ultimately on `syscall.Error.Temporary()`, which considers `ENOENT` to be non-temp).\r\n\r\nAFAICT `google.golang.org/grpc/clientconn.go.addrConn.wait` ends up latching the failure in `ac.tearDownErr` and is never reset or retried. I patched `WithTimeout` down to 10s, it does not reconnect after more than 1m even with that setting.\r\n\r\nI'm not entirely sure what #1007 (which came about from #989) was attempting to do, in my usage it seemed like `ctr event` (patched to use the client library) fails immediately if containerd is not running irrespective of the use of `WithBlock`/`WithFailOnNonTempDialError` or `WithTimeout`. The use of `grpc.FailFast(false)` on individual calls seems to make much more difference.\r\n\r\nFor my purposes with the swarmd executor I'm was generally happy with the default behaviour with no-`WithBlock` or `WithFailOnNonTempDialError` and with `FailFast` enabled (the default) for most calls (there are small number where I want to manually retry, but mostly I can rely on the orchestrator to retry things in most cases).\r\n\r\n/cc folks involved with #1007/#989: @dmcgowan @estesp @crosbymichael @stevvooe ",
  "closed_at": "2017-08-11T18:30:06Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1397980?v=4",
    "events_url": "https://api.github.com/users/estesp/events{/privacy}",
    "followers_url": "https://api.github.com/users/estesp/followers",
    "following_url": "https://api.github.com/users/estesp/following{/other_user}",
    "gists_url": "https://api.github.com/users/estesp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/estesp",
    "id": 1397980,
    "login": "estesp",
    "node_id": "MDQ6VXNlcjEzOTc5ODA=",
    "organizations_url": "https://api.github.com/users/estesp/orgs",
    "received_events_url": "https://api.github.com/users/estesp/received_events",
    "repos_url": "https://api.github.com/users/estesp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/estesp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/estesp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/estesp"
  },
  "comments": 5,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/1076/comments",
  "created_at": "2017-06-23T14:57:09Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/1076/events",
  "html_url": "https://github.com/containerd/containerd/issues/1076",
  "id": 238167422,
  "labels": [],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/1076/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2017-09-07T14:06:12Z",
    "closed_issues": 46,
    "created_at": "2017-07-10T20:33:50Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/1397980?v=4",
      "events_url": "https://api.github.com/users/estesp/events{/privacy}",
      "followers_url": "https://api.github.com/users/estesp/followers",
      "following_url": "https://api.github.com/users/estesp/following{/other_user}",
      "gists_url": "https://api.github.com/users/estesp/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/estesp",
      "id": 1397980,
      "login": "estesp",
      "node_id": "MDQ6VXNlcjEzOTc5ODA=",
      "organizations_url": "https://api.github.com/users/estesp/orgs",
      "received_events_url": "https://api.github.com/users/estesp/received_events",
      "repos_url": "https://api.github.com/users/estesp/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/estesp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/estesp/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/estesp"
    },
    "description": "1.0 beta quality release",
    "due_on": "2017-09-06T07:00:00Z",
    "html_url": "https://github.com/containerd/containerd/milestone/9",
    "id": 2632823,
    "labels_url": "https://api.github.com/repos/containerd/containerd/milestones/9/labels",
    "node_id": "MDk6TWlsZXN0b25lMjYzMjgyMw==",
    "number": 9,
    "open_issues": 0,
    "state": "closed",
    "title": "containerd beta",
    "updated_at": "2017-09-07T14:06:12Z",
    "url": "https://api.github.com/repos/containerd/containerd/milestones/9"
  },
  "node_id": "MDU6SXNzdWUyMzgxNjc0MjI=",
  "number": 1076,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "Client library cannot reconnect after a failure.",
  "updated_at": "2017-08-11T18:30:06Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/1076",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/12985729?v=4",
    "events_url": "https://api.github.com/users/ijc/events{/privacy}",
    "followers_url": "https://api.github.com/users/ijc/followers",
    "following_url": "https://api.github.com/users/ijc/following{/other_user}",
    "gists_url": "https://api.github.com/users/ijc/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ijc",
    "id": 12985729,
    "login": "ijc",
    "node_id": "MDQ6VXNlcjEyOTg1NzI5",
    "organizations_url": "https://api.github.com/users/ijc/orgs",
    "received_events_url": "https://api.github.com/users/ijc/received_events",
    "repos_url": "https://api.github.com/users/ijc/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ijc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ijc/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ijc"
  }
}