{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "This has been causing CI errors for several weeks regularly; somehow usually more on master than in PR triggers.\r\n\r\nTurns out it is a publish exit event timing problem, that, when it does fail with the `bind: address already in use` for the abstract socket for this specific test, it is always the 2nd run (the parallel run of `make integration`). This is because the first run has an event publisher hanging on trying to connect to the (now exited) containerd test daemon:\r\n\r\n```\r\n$ sudo go test -v -test.root -run DaemonRuntimeRoot\r\nINFO[0000] running tests against containerd              revision=c28ce39cea8e8dc8d7ff13c0fa0f7ca6217c2dab.m version=v1.2.0-beta.2-76-gc28ce39.m\r\n=== RUN   TestDaemonRuntimeRoot\r\n--- FAIL: TestDaemonRuntimeRoot (1.29s)\r\n        daemon_config_linux_test.go:153: io.containerd.runc.v1: failed to listen to abstract unix socket \"/containerd-shim/testing/TestDaemonRuntimeRoot/shim.sock\": listen\r\nunix /containerd-shim/testing/TestDaemonRuntimeRoot/shim.sock: bind: address already in use\r\n                : exit status 1: unknown\r\nFAIL\r\n\r\n$ ps aux | grep containerd\r\nroot     12951  3.9  1.8 190244 37208 pts/2    Sl   10:53   0:00 /usr/local/bin/containerd --address /tmp/containerd-test-new-daemon-with-config768890017/containerd.sock publish --topic /tasks/exit --namespace testing\r\n```\r\n\r\nThis publisher will continue to try to connect to the (now exited) containerd UNIX socket:\r\n```\r\n[pid  9028] connect(4, {sa_family=AF_LOCAL, sun_path=\"/tmp/containerd-test-new-daemon-with-config577476199/containerd.sock\"}, 71) = -1 ENOENT (No such file or directory)\r\n```\r\n\r\nuntil it reaches some system-level UNIX socket connection timeout and finally exits; but at this point in Travis CI, it could be (and more recently increasingly higher percentage of times) running that same test again in the second \"parallel\" run of `make integration`, hence the failure.\r\n\r\nFrom @crosbymichael:\r\n*that should be a general fix, we can add a context timeout for that*",
  "closed_at": "2018-09-19T17:51:56Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/169601?v=4",
    "events_url": "https://api.github.com/users/dmcgowan/events{/privacy}",
    "followers_url": "https://api.github.com/users/dmcgowan/followers",
    "following_url": "https://api.github.com/users/dmcgowan/following{/other_user}",
    "gists_url": "https://api.github.com/users/dmcgowan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dmcgowan",
    "id": 169601,
    "login": "dmcgowan",
    "node_id": "MDQ6VXNlcjE2OTYwMQ==",
    "organizations_url": "https://api.github.com/users/dmcgowan/orgs",
    "received_events_url": "https://api.github.com/users/dmcgowan/received_events",
    "repos_url": "https://api.github.com/users/dmcgowan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dmcgowan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dmcgowan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dmcgowan"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/2662/comments",
  "created_at": "2018-09-19T15:18:01Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/2662/events",
  "html_url": "https://github.com/containerd/containerd/issues/2662",
  "id": 361799183,
  "labels": [
    {
      "color": "FF8C94",
      "default": false,
      "description": null,
      "id": 347599646,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNDc1OTk2NDY=",
      "url": "https://api.github.com/repos/containerd/containerd/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/2662/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNjE3OTkxODM=",
  "number": 2662,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "Flaky test: TestDaemonRuntimeRoot",
  "updated_at": "2018-09-19T17:51:56Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/2662",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1397980?v=4",
    "events_url": "https://api.github.com/users/estesp/events{/privacy}",
    "followers_url": "https://api.github.com/users/estesp/followers",
    "following_url": "https://api.github.com/users/estesp/following{/other_user}",
    "gists_url": "https://api.github.com/users/estesp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/estesp",
    "id": 1397980,
    "login": "estesp",
    "node_id": "MDQ6VXNlcjEzOTc5ODA=",
    "organizations_url": "https://api.github.com/users/estesp/orgs",
    "received_events_url": "https://api.github.com/users/estesp/received_events",
    "repos_url": "https://api.github.com/users/estesp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/estesp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/estesp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/estesp"
  }
}