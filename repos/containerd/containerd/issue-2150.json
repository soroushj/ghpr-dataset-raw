{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "I hit one case in cri-containerd restart test that:\r\n1) The test stops a container;\r\n2) cri-containerd handles `TaskExit` event and `task.Delete` the task;\r\n3) `task.Delete` closes the task io, which deletes the fifo directory [here](https://github.com/containerd/containerd/blob/master/task.go#L286)\r\n4) containerd/cri-containerd gets restarted before task is actually deleted [here](https://github.com/containerd/containerd/blob/master/task.go#L288).\r\n5) After cri-containerd/containerd is up, we'll never be able to load the task and attaching FIFOs. Because the fifo directory has been removed, even we do `OpenFifo` in `ioAttach` we'll get the error that the directory is not found.\r\n\r\nThere are 2 options:\r\n* Option 1: Do not try to attach io to a stopped task. The problems is that we usually attach io when loading task, but with the current client we can only know the task status after loading the task. It means that to reliably load a task and attach io, we have to 1) load task without IO first -> 2) check status -> 3) load task with IO. This is pretty troublesome.\r\n* Option 2: Ensure fifo directory exists in `loadTask` when `ioAttach` is specified.\r\n* Option 3: https://github.com/containerd/containerd/pull/2151#issuecomment-367784175\r\n\r\nI feel like option 2 seems simpler.\r\n\r\n/cc @dnephin ",
  "closed_at": "2018-02-27T16:10:45Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/749551?v=4",
    "events_url": "https://api.github.com/users/crosbymichael/events{/privacy}",
    "followers_url": "https://api.github.com/users/crosbymichael/followers",
    "following_url": "https://api.github.com/users/crosbymichael/following{/other_user}",
    "gists_url": "https://api.github.com/users/crosbymichael/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/crosbymichael",
    "id": 749551,
    "login": "crosbymichael",
    "node_id": "MDQ6VXNlcjc0OTU1MQ==",
    "organizations_url": "https://api.github.com/users/crosbymichael/orgs",
    "received_events_url": "https://api.github.com/users/crosbymichael/received_events",
    "repos_url": "https://api.github.com/users/crosbymichael/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/crosbymichael/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/crosbymichael/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/crosbymichael"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/2150/comments",
  "created_at": "2018-02-22T08:48:26Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/2150/events",
  "html_url": "https://github.com/containerd/containerd/issues/2150",
  "id": 299265459,
  "labels": [],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/2150/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyOTkyNjU0NTk=",
  "number": 2150,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "Task is left in weird state after containerd is restarted during task deletion.",
  "updated_at": "2018-02-27T16:10:45Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/2150",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/5821883?v=4",
    "events_url": "https://api.github.com/users/Random-Liu/events{/privacy}",
    "followers_url": "https://api.github.com/users/Random-Liu/followers",
    "following_url": "https://api.github.com/users/Random-Liu/following{/other_user}",
    "gists_url": "https://api.github.com/users/Random-Liu/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/Random-Liu",
    "id": 5821883,
    "login": "Random-Liu",
    "node_id": "MDQ6VXNlcjU4MjE4ODM=",
    "organizations_url": "https://api.github.com/users/Random-Liu/orgs",
    "received_events_url": "https://api.github.com/users/Random-Liu/received_events",
    "repos_url": "https://api.github.com/users/Random-Liu/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/Random-Liu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Random-Liu/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/Random-Liu"
  }
}