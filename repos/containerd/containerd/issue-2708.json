{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "When differ creates a blob that already exists it will hit `ErrAlreadyExists` on `Commit` but return from `Compare` without an error. That means that the defer handler that is supposed to close the writer in case of an error is never called, leaving the ref locked forever and all the future accesses to fail.\r\n\r\nDidn't confirm with actual code but there also seems to be at least another very similar deadlock case in the metadata store's `Commit()`. If `ErrAlreadyExists` is returned from the local store but does not exist in the current namespace, metadata `Commit` will return without an error but it seems that the writer from the local store is left locked.",
  "closed_at": "2018-10-16T01:17:46Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/749551?v=4",
    "events_url": "https://api.github.com/users/crosbymichael/events{/privacy}",
    "followers_url": "https://api.github.com/users/crosbymichael/followers",
    "following_url": "https://api.github.com/users/crosbymichael/following{/other_user}",
    "gists_url": "https://api.github.com/users/crosbymichael/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/crosbymichael",
    "id": 749551,
    "login": "crosbymichael",
    "node_id": "MDQ6VXNlcjc0OTU1MQ==",
    "organizations_url": "https://api.github.com/users/crosbymichael/orgs",
    "received_events_url": "https://api.github.com/users/crosbymichael/received_events",
    "repos_url": "https://api.github.com/users/crosbymichael/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/crosbymichael/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/crosbymichael/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/crosbymichael"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/2708/comments",
  "created_at": "2018-10-10T01:22:33Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/2708/events",
  "html_url": "https://github.com/containerd/containerd/issues/2708",
  "id": 368457819,
  "labels": [],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/2708/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-10-26T16:45:53Z",
    "closed_issues": 80,
    "created_at": "2017-12-19T20:28:17Z",
    "creator": {
      "avatar_url": "https://avatars1.githubusercontent.com/u/120601?v=4",
      "events_url": "https://api.github.com/users/stevvooe/events{/privacy}",
      "followers_url": "https://api.github.com/users/stevvooe/followers",
      "following_url": "https://api.github.com/users/stevvooe/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevvooe/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/stevvooe",
      "id": 120601,
      "login": "stevvooe",
      "node_id": "MDQ6VXNlcjEyMDYwMQ==",
      "organizations_url": "https://api.github.com/users/stevvooe/orgs",
      "received_events_url": "https://api.github.com/users/stevvooe/received_events",
      "repos_url": "https://api.github.com/users/stevvooe/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/stevvooe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevvooe/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/stevvooe"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/containerd/containerd/milestone/17",
    "id": 2989685,
    "labels_url": "https://api.github.com/repos/containerd/containerd/milestones/17/labels",
    "node_id": "MDk6TWlsZXN0b25lMjk4OTY4NQ==",
    "number": 17,
    "open_issues": 0,
    "state": "closed",
    "title": "1.2",
    "updated_at": "2019-02-06T04:23:01Z",
    "url": "https://api.github.com/repos/containerd/containerd/milestones/17"
  },
  "node_id": "MDU6SXNzdWUzNjg0NTc4MTk=",
  "number": 2708,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "Deadlock on refs on ErrAlreadyExists",
  "updated_at": "2018-10-16T01:17:46Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/2708",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/585223?v=4",
    "events_url": "https://api.github.com/users/tonistiigi/events{/privacy}",
    "followers_url": "https://api.github.com/users/tonistiigi/followers",
    "following_url": "https://api.github.com/users/tonistiigi/following{/other_user}",
    "gists_url": "https://api.github.com/users/tonistiigi/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tonistiigi",
    "id": 585223,
    "login": "tonistiigi",
    "node_id": "MDQ6VXNlcjU4NTIyMw==",
    "organizations_url": "https://api.github.com/users/tonistiigi/orgs",
    "received_events_url": "https://api.github.com/users/tonistiigi/received_events",
    "repos_url": "https://api.github.com/users/tonistiigi/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tonistiigi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tonistiigi/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tonistiigi"
  }
}