{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "I started seeing this while migrating integration tests on Github actions ([1](https://github.com/mxpv/containerd/runs/559730091?check_suite_focus=true)), but then noticed that it's quite often happens on Travis as well ([1](https://travis-ci.org/github/containerd/containerd/jobs/670725782), [2](https://travis-ci.org/github/containerd/containerd/jobs/670613704), [3](https://travis-ci.org/github/containerd/containerd/jobs/669383271), [4](https://travis-ci.org/github/containerd/containerd/jobs/668938331)).\r\n\r\n```\r\ntime=\"2020-04-03T20:10:14.618255755Z\" level=debug msg=\"(*service).Write started\" ref=c1-commiterror-state\r\n2932time=\"2020-04-03T20:10:14.624627962Z\" level=debug msg=\"(*service).Write started\" ref=c1-commiterror-state\r\n2933time=\"2020-04-03T20:10:15.182502071Z\" level=error msg=\"(*service).Write failed\" error=\"rpc error: code = Unavailable desc = ref ContentClient-n1/1/c1-commiterror-state locked: unavailable\" ref=c1-commiterror-state\r\n2934time=\"2020-04-03T20:10:15.186321757Z\" level=error msg=\"(*service).Write failed\" error=\"rpc error: code = FailedPrecondition desc = unexpected commit digest sha256:af9f4d33a30760b1d8a0297164ac7bcc2d1a8b1bdaf7880e2ce2fdfb96edec65, expected sha256:f7358a28d3925ed49329484588a910278afbfe778319abb24db99b793a671202: failed precondition\" ref=c1-commiterror-state\r\n\r\n...\r\n\r\ntime=\"2020-04-03T15:26:32.535416150Z\" level=debug msg=\"(*service).Write started\" expected=\"sha256:208de85e6cfa2a86b205fd3e1fa66763ad3df81588b5a1b47a0b77e78a67e3cd\" ref=\"manifest-sha256:208de85e6cfa2a86b205fd3e1fa66763ad3df81588b5a1b47a0b77e78a67e3cd\" total=528\r\n2136 time=\"2020-04-03T15:26:32.535612486Z\" level=debug msg=\"(*service).Write started\" expected=\"sha256:05e348797cb2a37dc91ba34fffbfcc64192097c113a1fc49b0b6bf047d96c81f\" ref=\"manifest-sha256:05e348797cb2a37dc91ba34fffbfcc64192097c113a1fc49b0b6bf047d96c81f\" total=527\r\n2137 runtime: nelems=11 nalloc=2 previous allocCount=1 nfreed=65535\r\n2138 fatal error: sweep increased allocation count\r\n2139\r\n2140 runtime stack:\r\n2141 runtime.throw(0x556b83439af9, 0x20)\r\n2142\t/home/travis/.gimme/versions/go1.13.8.linux.amd64/src/runtime/panic.go:774 +0x74\r\n2143 runtime.(*mspan).sweep(0x7fc116738460, 0x7fc116738400, 0x556b823c5f00)\r\n2144\t/home/travis/.gimme/versions/go1.13.8.linux.amd64/src/runtime/mgcsweep.go:328 +0x8cc\r\n2145 runtime.(*mcentral).uncacheSpan(0x556b84b21c38, 0x7fc116738460)\r\n2146\t/home/travis/.gimme/versions/go1.13.8.linux.amd64/src/runtime/mcentral.go:197 +0x7b\r\n2147 runtime.(*mcache).releaseAll(0x7fc11676d008)\r\n...\r\n```\r\n\r\nand lots of errors like:\r\n```\r\n--- FAIL: TestContainerPTY (0.00s)\r\n2009    container_linux_test.go:468: failed to dial \"/run/containerd-test/containerd.sock\": connection error: desc = \"transport: error while dialing: dial unix /run/containerd-test/containerd.sock: connect: connection refused\"\r\n2010--- FAIL: TestContainerAttach (0.00s)\r\n2011    container_linux_test.go:545: failed to dial \"/run/containerd-test/containerd.sock\": connection error: desc = \"transport: error while dialing: dial unix /run/containerd-test/containerd.sock: connect: connection refused\"\r\n2012--- FAIL: TestShimInCgroup (0.00s)\r\n2013    container_linux_test.go:134: failed to dial \"/run/containerd-test/containerd.sock\": connection error: desc = \"transport: error while dialing: dial unix /run/containerd-test/containerd.sock: connect: connection refused\"\r\n2014--- FAIL: TestTaskUpdate (0.00s)\r\n2015    container_linux_test.go:56: failed to dial \"/run/containerd-test/containerd.sock\": connection error: desc = \"transport: error while dialing: dial unix /run/containerd-test/containerd.sock: connect: connection refused\"\r\n...\r\n```\r\n\r\nmight be related to `unexpected commit digest` problems: https://github.com/containerd/containerd/issues/3974 ",
  "closed_at": "2020-04-05T14:33:14Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/17510957?v=4",
    "events_url": "https://api.github.com/users/fuweid/events{/privacy}",
    "followers_url": "https://api.github.com/users/fuweid/followers",
    "following_url": "https://api.github.com/users/fuweid/following{/other_user}",
    "gists_url": "https://api.github.com/users/fuweid/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/fuweid",
    "id": 17510957,
    "login": "fuweid",
    "node_id": "MDQ6VXNlcjE3NTEwOTU3",
    "organizations_url": "https://api.github.com/users/fuweid/orgs",
    "received_events_url": "https://api.github.com/users/fuweid/received_events",
    "repos_url": "https://api.github.com/users/fuweid/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/fuweid/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fuweid/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/fuweid"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/4154/comments",
  "created_at": "2020-04-04T02:52:57Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/4154/events",
  "html_url": "https://github.com/containerd/containerd/issues/4154",
  "id": 593727478,
  "labels": [
    {
      "color": "FF8C94",
      "default": false,
      "description": null,
      "id": 347599646,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNDc1OTk2NDY=",
      "url": "https://api.github.com/repos/containerd/containerd/labels/kind/bug"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": null,
      "id": 347599660,
      "name": "priority/P1",
      "node_id": "MDU6TGFiZWwzNDc1OTk2NjA=",
      "url": "https://api.github.com/repos/containerd/containerd/labels/priority/P1"
    }
  ],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/4154/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1OTM3Mjc0Nzg=",
  "number": 4154,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "Ocasional containerd crashes on CI",
  "updated_at": "2020-04-05T14:33:14Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/4154",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/865334?v=4",
    "events_url": "https://api.github.com/users/mxpv/events{/privacy}",
    "followers_url": "https://api.github.com/users/mxpv/followers",
    "following_url": "https://api.github.com/users/mxpv/following{/other_user}",
    "gists_url": "https://api.github.com/users/mxpv/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mxpv",
    "id": 865334,
    "login": "mxpv",
    "node_id": "MDQ6VXNlcjg2NTMzNA==",
    "organizations_url": "https://api.github.com/users/mxpv/orgs",
    "received_events_url": "https://api.github.com/users/mxpv/received_events",
    "repos_url": "https://api.github.com/users/mxpv/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mxpv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mxpv/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mxpv"
  }
}