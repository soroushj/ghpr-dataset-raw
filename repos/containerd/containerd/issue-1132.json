{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "https://github.com/linuxkit/linuxkit/issues/2131 is an issue with [LinuxKit's `projects/kubernetes`](https://github.com/linuxkit/linuxkit/tree/master/projects/kubernetes) where the `kubelet` container expects to create mount which will be visible in a `docker` container. Both of them have a `/var:/var:rshared,rbind` but the mounts made by `kubelet` are not appearing in the docker container.\r\n\r\nI eventually tracked this down to the shim's [`setupRoot`](https://github.com/containerd/containerd/blob/master/cmd/containerd-shim/shim_linux.go#L37..L39) which unconditionally does `unix.Mount(\"\", \"/\", \"\", unix.MS_SLAVE|unix.MS_REC, \"\")`. Which was added  in ab8586b7c5e7a9a95053d3d6293d671c030bae00 (\"Remove bundles from API\").\r\n\r\nWould it be possible to make this optional by some means? Or maybe it is even possible to remove it since it seems to be redundant with runc's [prepareRoot](https://github.com/opencontainers/runc/blob/master/libcontainer/rootfs_linux.go#L598..L615) which sets up the root mount in a similar way but is configurable via the `rootPropagation` field in `config.json`.\r\n\r\nWRT https://github.com/linuxkit/linuxkit/issues/2131 I have confirmed that either dropping the mount from shim or changing it to `MS_SHARED` unbreaks things. I also confirmed that removing `rootfsPropagation: shared` from the `kubelet` container re-breaks things, so it seems the code in runc is effective.\r\n\r\n@justincormack pointed me at [a document](https://docs.google.com/document/d/1XXKdvFKnbV8MWNchjuLdLLCEs0KdWelpo3tpS6Wr18M/edit#heading=h.2teoykcuxr8g) and in particular https://github.com/kubernetes/community/issues/648 which seem somewhat relevant/related.\r\n\r\n/cc @justincormack @crosbymichael ",
  "closed_at": "2017-07-21T20:18:42Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1397980?v=4",
    "events_url": "https://api.github.com/users/estesp/events{/privacy}",
    "followers_url": "https://api.github.com/users/estesp/followers",
    "following_url": "https://api.github.com/users/estesp/following{/other_user}",
    "gists_url": "https://api.github.com/users/estesp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/estesp",
    "id": 1397980,
    "login": "estesp",
    "node_id": "MDQ6VXNlcjEzOTc5ODA=",
    "organizations_url": "https://api.github.com/users/estesp/orgs",
    "received_events_url": "https://api.github.com/users/estesp/received_events",
    "repos_url": "https://api.github.com/users/estesp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/estesp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/estesp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/estesp"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/1132/comments",
  "created_at": "2017-07-05T08:57:30Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/1132/events",
  "html_url": "https://github.com/containerd/containerd/issues/1132",
  "id": 240582640,
  "labels": [],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/1132/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2017-09-07T14:06:12Z",
    "closed_issues": 46,
    "created_at": "2017-07-10T20:33:50Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/1397980?v=4",
      "events_url": "https://api.github.com/users/estesp/events{/privacy}",
      "followers_url": "https://api.github.com/users/estesp/followers",
      "following_url": "https://api.github.com/users/estesp/following{/other_user}",
      "gists_url": "https://api.github.com/users/estesp/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/estesp",
      "id": 1397980,
      "login": "estesp",
      "node_id": "MDQ6VXNlcjEzOTc5ODA=",
      "organizations_url": "https://api.github.com/users/estesp/orgs",
      "received_events_url": "https://api.github.com/users/estesp/received_events",
      "repos_url": "https://api.github.com/users/estesp/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/estesp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/estesp/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/estesp"
    },
    "description": "1.0 beta quality release",
    "due_on": "2017-09-06T07:00:00Z",
    "html_url": "https://github.com/containerd/containerd/milestone/9",
    "id": 2632823,
    "labels_url": "https://api.github.com/repos/containerd/containerd/milestones/9/labels",
    "node_id": "MDk6TWlsZXN0b25lMjYzMjgyMw==",
    "number": 9,
    "open_issues": 0,
    "state": "closed",
    "title": "containerd beta",
    "updated_at": "2017-09-07T14:06:12Z",
    "url": "https://api.github.com/repos/containerd/containerd/milestones/9"
  },
  "node_id": "MDU6SXNzdWUyNDA1ODI2NDA=",
  "number": 1132,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "Shim unconditionally mounts rootfs as MS_SLAVE",
  "updated_at": "2017-07-21T20:18:42Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/1132",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/12985729?v=4",
    "events_url": "https://api.github.com/users/ijc/events{/privacy}",
    "followers_url": "https://api.github.com/users/ijc/followers",
    "following_url": "https://api.github.com/users/ijc/following{/other_user}",
    "gists_url": "https://api.github.com/users/ijc/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ijc",
    "id": 12985729,
    "login": "ijc",
    "node_id": "MDQ6VXNlcjEyOTg1NzI5",
    "organizations_url": "https://api.github.com/users/ijc/orgs",
    "received_events_url": "https://api.github.com/users/ijc/received_events",
    "repos_url": "https://api.github.com/users/ijc/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ijc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ijc/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ijc"
  }
}