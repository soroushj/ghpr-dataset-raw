{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "- For active snapshot, the `excl` value of L0 QGroup is used, and\r\ncommitted on Commit.\r\n- For view snapshot, always 0 is returned.\r\n- For committed snapshot, the committed value is returned.\r\n\r\nSigned-off-by: Akihiro Suda <suda.akihiro@lab.ntt.co.jp>\r\n\r\nClose #1801 \r\nDepends on containerd/btrfs#14\r\n\r\nResult after `ctr images pull docker.io/library/ubuntu:latest` on btrfs:\r\n```\r\nroot@ws01:~# export CONTAINERD_SNAPSHOTTER=btrfs \r\nroot@ws01:~# ctr snapshot tree                                                                 \r\n\\_ sha256:788ce2310e2fdbbf81fe21cbcc8a44da4cf648b0339b09c221abacb4cd5fd136                     \r\n  \\_ sha256:2eb2bdc452f61ae4703cb67be52a4d595265cecb257f3210647ea1d0bf84a549                   \r\n    \\_ sha256:289566599b45e8e2a7264923d3481c6e0e7460232a4e0ed1512528272fb15c70                 \r\n      \\_ sha256:1f7b04df09e72e9b94e923567a168b438d195c4c610a335ed7320cc6dea93c3f                                                                                                               \r\n        \\_ sha256:928cadf24454047a7a1b8e8d034a539e882ed904d6627b343e2abcd338ae0123                                                                                                             \r\nroot@ws01:~# ctr snapshot usage                                                                                                                                                                \r\nKEY                                                                     SIZE      INODES                                                                                                       \r\nsha256:1f7b04df09e72e9b94e923567a168b438d195c4c610a335ed7320cc6dea93c3f 68.0 KiB  -1                                                                                                           \r\nsha256:289566599b45e8e2a7264923d3481c6e0e7460232a4e0ed1512528272fb15c70 80.0 KiB  -1                                                                                                           \r\nsha256:2eb2bdc452f61ae4703cb67be52a4d595265cecb257f3210647ea1d0bf84a549 208.0 KiB -1                                                                                                           \r\nsha256:788ce2310e2fdbbf81fe21cbcc8a44da4cf648b0339b09c221abacb4cd5fd136 123.7 MiB -1                                                                                                           \r\nsha256:928cadf24454047a7a1b8e8d034a539e882ed904d6627b343e2abcd338ae0123 48.0 KiB  -1  \r\n```\r\n\r\non overlayfs:\r\n```\r\nroot@ws01:~# export CONTAINERD_SNAPSHOTTER=overlayfs\r\nroot@ws01:~# ctr snapshot tree\r\n\\_ sha256:788ce2310e2fdbbf81fe21cbcc8a44da4cf648b0339b09c221abacb4cd5fd136                     \r\n  \\_ sha256:2eb2bdc452f61ae4703cb67be52a4d595265cecb257f3210647ea1d0bf84a549                   \r\n    \\_ sha256:289566599b45e8e2a7264923d3481c6e0e7460232a4e0ed1512528272fb15c70                 \r\n      \\_ sha256:1f7b04df09e72e9b94e923567a168b438d195c4c610a335ed7320cc6dea93c3f               \r\n        \\_ sha256:928cadf24454047a7a1b8e8d034a539e882ed904d6627b343e2abcd338ae0123             \r\nroot@ws01:~# ctr snapshot usage                \r\nKEY                                                                     SIZE      INODES       \r\nsha256:1f7b04df09e72e9b94e923567a168b438d195c4c610a335ed7320cc6dea93c3f 14.7 KiB  4            \r\nsha256:289566599b45e8e2a7264923d3481c6e0e7460232a4e0ed1512528272fb15c70 20.0 KiB  22           \r\nsha256:2eb2bdc452f61ae4703cb67be52a4d595265cecb257f3210647ea1d0bf84a549 48.7 KiB  21           \r\nsha256:788ce2310e2fdbbf81fe21cbcc8a44da4cf648b0339b09c221abacb4cd5fd136 119.8 MiB 5518         \r\nsha256:928cadf24454047a7a1b8e8d034a539e882ed904d6627b343e2abcd338ae0123 12.0 KiB  4\r\n```\r\n\r\nThe results are slightly different but should not hurt.",
  "closed_at": "2017-12-05T01:36:36Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/9248427?v=4",
    "events_url": "https://api.github.com/users/AkihiroSuda/events{/privacy}",
    "followers_url": "https://api.github.com/users/AkihiroSuda/followers",
    "following_url": "https://api.github.com/users/AkihiroSuda/following{/other_user}",
    "gists_url": "https://api.github.com/users/AkihiroSuda/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/AkihiroSuda",
    "id": 9248427,
    "login": "AkihiroSuda",
    "node_id": "MDQ6VXNlcjkyNDg0Mjc=",
    "organizations_url": "https://api.github.com/users/AkihiroSuda/orgs",
    "received_events_url": "https://api.github.com/users/AkihiroSuda/received_events",
    "repos_url": "https://api.github.com/users/AkihiroSuda/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/AkihiroSuda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AkihiroSuda/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/AkihiroSuda"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/1836/comments",
  "created_at": "2017-11-30T07:52:54Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/1836/events",
  "html_url": "https://github.com/containerd/containerd/pull/1836",
  "id": 278027707,
  "labels": [],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/1836/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTU1NTM5ODM3",
  "number": 1836,
  "performed_via_github_app": null,
  "pull_request": {
    "diff_url": "https://github.com/containerd/containerd/pull/1836.diff",
    "html_url": "https://github.com/containerd/containerd/pull/1836",
    "patch_url": "https://github.com/containerd/containerd/pull/1836.patch",
    "url": "https://api.github.com/repos/containerd/containerd/pulls/1836"
  },
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "implement btrfs.Usage",
  "updated_at": "2017-12-05T01:36:36Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/1836",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/9248427?v=4",
    "events_url": "https://api.github.com/users/AkihiroSuda/events{/privacy}",
    "followers_url": "https://api.github.com/users/AkihiroSuda/followers",
    "following_url": "https://api.github.com/users/AkihiroSuda/following{/other_user}",
    "gists_url": "https://api.github.com/users/AkihiroSuda/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/AkihiroSuda",
    "id": 9248427,
    "login": "AkihiroSuda",
    "node_id": "MDQ6VXNlcjkyNDg0Mjc=",
    "organizations_url": "https://api.github.com/users/AkihiroSuda/orgs",
    "received_events_url": "https://api.github.com/users/AkihiroSuda/received_events",
    "repos_url": "https://api.github.com/users/AkihiroSuda/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/AkihiroSuda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AkihiroSuda/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/AkihiroSuda"
  }
}