{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "Twice on PR #2936, I've had a failure with only the `TRAVIS_GOOS=linux TEST_RUNTIME=io.containerd.runtime.v1.linux TRAVIS_CGO_ENABLED=1` variant in Travis:\r\n\r\n```\r\nSummarizing 1 Failure:\r\n[Fail] [k8s.io] Streaming runtime should support streaming interfaces [AfterEach] runtime should support attach [Conformance] \r\n/home/travis/gopath/src/github.com/kubernetes-sigs/cri-tools/pkg/validate/streaming.go:308\r\nRan 66 of 72 Specs in 50.270 seconds\r\nFAIL! -- 65 Passed | 1 Failed | 0 Pending | 6 Skipped\r\n```\r\n\r\nComplete test log from that streaming test:\r\n```\r\nJan 16 19:17:00.148: INFO: Created container \"0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13\"\r\nSTEP: start container\r\nSTEP: Start container for containerID: 0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13\r\nJan 16 19:17:00.624: INFO: Started container \"0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13\"\r\nSTEP: attach container: 0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13\r\nJan 16 19:17:00.667: INFO: Get attach url: http://127.0.0.1:35744/attach/X2VGBvJj\r\nSTEP: check the output of attach\r\nJan 16 19:17:00.702: INFO: Parse url \"http://127.0.0.1:35744/attach/X2VGBvJj\" succeed\r\nJan 16 19:17:00.897: INFO: Unexpected error occurred: Internal error occurred: error attaching to container: failed to load task: no running task found: task 0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13 not found: not found\r\n[AfterEach] runtime should support streaming interfaces\r\n  /home/travis/gopath/src/github.com/kubernetes-sigs/cri-tools/pkg/validate/streaming.go:61\r\nSTEP: stop PodSandbox\r\nSTEP: delete PodSandbox\r\n[AfterEach] [k8s.io] Streaming\r\n  /home/travis/gopath/src/github.com/kubernetes-sigs/cri-tools/pkg/framework/framework.go:51\r\n\u2022 Failure in Spec Teardown (AfterEach) [5.064 seconds]\r\n[k8s.io] Streaming\r\n/home/travis/gopath/src/github.com/kubernetes-sigs/cri-tools/pkg/framework/framework.go:72\r\n  runtime should support streaming interfaces\r\n  /home/travis/gopath/src/github.com/kubernetes-sigs/cri-tools/pkg/validate/streaming.go:57\r\n    runtime should support attach [Conformance] [AfterEach]\r\n    /home/travis/gopath/src/github.com/kubernetes-sigs/cri-tools/pkg/validate/streaming.go:111\r\n    failed to open streamer for \"http://127.0.0.1:35744/attach/X2VGBvJj\"\r\n    Expected error:\r\n        <*errors.errorString | 0xc000335350>: {\r\n            s: \"Internal error occurred: error attaching to container: failed to load task: no running task found: task 0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13 not found: not found\",\r\n        }\r\n        Internal error occurred: error attaching to container: failed to load task: no running task found: task 0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13 not found: not found\r\n    not to have occurred\r\n```\r\n\r\nLog from containerd surrounding the \"task not found\" issue:\r\n```\r\ntime=\"2019-01-16T19:17:00.587854233Z\" level=info msg=\"StartContainer for \\\"0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13\\\" returns successfully\"\r\ntime=\"2019-01-16T19:17:00.604509748Z\" level=debug msg=\"event published\" ns=k8s.io topic=/snapshot/commit type=containerd.events.SnapshotCommit\r\ntime=\"2019-01-16T19:17:00.611665296Z\" level=info msg=\"Kill container \\\"2caeea51c7aa95cf021f5e902f1abe0f9a1a36e59f8d544b924041265f8a2131\\\"\"\r\ntime=\"2019-01-16T19:17:00.611803861Z\" level=debug msg=\"event published\" ns=k8s.io topic=/snapshot/prepare type=containerd.events.SnapshotPrepare\r\ntime=\"2019-01-16T19:17:00.624785933Z\" level=info msg=\"StopPodSandbox for \\\"e40a5b1aee88905e637a6b9be2dfcec88d77b0c1ac12ac0e3e11476ba0dfc168\\\"\"\r\ntime=\"2019-01-16T19:17:00.645141070Z\" level=debug msg=\"event published\" ns=k8s.io topic=/tasks/exit type=containerd.events.TaskExit\r\ntime=\"2019-01-16T19:17:00.645294770Z\" level=debug msg=\"Received containerd event timestamp - 2019-01-16 19:17:00.645130172 +0000 UTC, namespace - \\\"k8s.io\\\", topic - \\\"/tasks/exit\\\"\"\r\ntime=\"2019-01-16T19:17:00.645376657Z\" level=info msg=\"TaskExit event &TaskExit{ContainerID:0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13,ID:0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13,Pid:18052,ExitStatus:0,ExitedAt:2019-01-16 19:17:00.528067275 +0000 UTC,}\"\r\ntime=\"2019-01-16T19:17:00.645678430Z\" level=info msg=\"Attach for \\\"0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13\\\" with tty false and stdin true\"\r\ntime=\"2019-01-16T19:17:00.645770043Z\" level=info msg=\"Attach for \\\"0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13\\\" returns URL \\\"http://127.0.0.1:35744/attach/X2VGBvJj\\\"\"\r\ntime=\"2019-01-16T19:17:00.646060567Z\" level=debug msg=\"fetch response received\" response.headers=\"map[Content-Type:[application/vnd.docker.distribution.manifest.v2+json] Content-Length:[734] Docker-Content-Digest:[sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7] Date:[Wed, 16 Jan 2019 19:17:00 GMT] Server:[Docker Registry] X-Xss-Protection:[1; mode=block] X-Frame-Options:[SAMEORIGIN] Docker-Distribution-Api-Version:[registry/2.0]]\" status=\"200 OK\" url=\"https://gcr.io/v2/cri-tools/test-image-tags/manifests/1\"\r\ntime=\"2019-01-16T19:17:00.646154722Z\" level=debug msg=resolved desc.digest=\"sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7\"\r\ntime=\"2019-01-16T19:17:00.648135273Z\" level=debug msg=resolving\r\ntime=\"2019-01-16T19:17:00.648162805Z\" level=debug msg=\"do request\" request.headers=\"map[Accept:[application/vnd.docker.distribution.manifest.v2+json, application/vnd.docker.distribution.manifest.list.v2+json, application/vnd.oci.image.manifest.v1+json, application/vnd.oci.image.index.v1+json, *] User-Agent:[containerd/v1.2.0-203-g99b47f8]]\" request.method=HEAD url=\"https://gcr.io/v2/cri-tools/test-image-tags/manifests/1\"\r\ntime=\"2019-01-16T19:17:00.667036081Z\" level=info msg=\"Finish piping stdout of container \\\"2caeea51c7aa95cf021f5e902f1abe0f9a1a36e59f8d544b924041265f8a2131\\\"\"\r\ntime=\"2019-01-16T19:17:00.667079891Z\" level=info msg=\"Finish piping stderr of container \\\"2caeea51c7aa95cf021f5e902f1abe0f9a1a36e59f8d544b924041265f8a2131\\\"\"\r\ntime=\"2019-01-16T19:17:00.684968675Z\" level=info msg=\"Kill container \\\"ceec13ec546e0b16fe60d77fb37e219dd9c46c9d13acd7b4fc69999bace74c0a\\\"\"\r\ntime=\"2019-01-16T19:17:00.719114843Z\" level=debug msg=\"fetch response received\" response.headers=\"map[Content-Type:[application/vnd.docker.distribution.manifest.v2+json] Content-Length:[734] Docker-Content-Digest:[sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7] Date:[Wed, 16 Jan 2019 19:17:00 GMT] Server:[Docker Registry] X-Xss-Protection:[1; mode=block] X-Frame-Options:[SAMEORIGIN] Docker-Distribution-Api-Version:[registry/2.0]]\" status=\"200 OK\" url=\"https://gcr.io/v2/cri-tools/test-image-tags/manifests/1\"\r\ntime=\"2019-01-16T19:17:00.719202090Z\" level=debug msg=resolved desc.digest=\"sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7\"\r\ntime=\"2019-01-16T19:17:00.719258842Z\" level=debug msg=fetch digest=\"sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7\" mediatype=application/vnd.docker.distribution.manifest.v2+json size=734\r\ntime=\"2019-01-16T19:17:00.728028567Z\" level=debug msg=\"do request\" base=\"https://gcr.io/v2/cri-tools/test-image-tags\" digest=\"sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7\" mediatype=application/vnd.docker.distribution.manifest.v2+json request.headers=\"map[Accept:[application/vnd.docker.distribution.manifest.v2+json, *]]\" request.method=GET size=734 url=\"https://gcr.io/v2/cri-tools/test-image-tags/manifests/sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7\"\r\ntime=\"2019-01-16T19:17:00.745351768Z\" level=info msg=\"Finish piping stderr of container \\\"ceec13ec546e0b16fe60d77fb37e219dd9c46c9d13acd7b4fc69999bace74c0a\\\"\"\r\ntime=\"2019-01-16T19:17:00.745412038Z\" level=info msg=\"Finish piping stdout of container \\\"ceec13ec546e0b16fe60d77fb37e219dd9c46c9d13acd7b4fc69999bace74c0a\\\"\"\r\ntime=\"2019-01-16T19:17:00.819623059Z\" level=debug msg=\"fetch response received\" base=\"https://gcr.io/v2/cri-tools/test-image-tags\" digest=\"sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7\" mediatype=application/vnd.docker.distribution.manifest.v2+json response.headers=\"map[X-Frame-Options:[SAMEORIGIN] Docker-Distribution-Api-Version:[registry/2.0] Content-Type:[application/vnd.docker.distribution.manifest.v2+json] Docker-Content-Digest:[sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7] Content-Length:[734] Date:[Wed, 16 Jan 2019 19:17:00 GMT] Server:[Docker Registry] X-Xss-Protection:[1; mode=block]]\" size=734 status=\"200 OK\" url=\"https://gcr.io/v2/cri-tools/test-image-tags/manifests/sha256:4d556817d2eee5e9c6d8c4a51fb77ca5e7fab99c8570d52b87950bbd86bdfef7\"\r\ntime=\"2019-01-16T19:17:00.826068743Z\" level=debug msg=fetch digest=\"sha256:658ab7fdfcb5d49f43d25b9d13149520e48eddee602ce693e05f73e05a85abc3\" mediatype=application/vnd.docker.image.rootfs.diff.tar.gzip size=100\r\ntime=\"2019-01-16T19:17:00.840516421Z\" level=debug msg=\"do request\" base=\"https://gcr.io/v2/cri-tools/test-image-tags\" digest=\"sha256:658ab7fdfcb5d49f43d25b9d13149520e48eddee602ce693e05f73e05a85abc3\" mediatype=application/vnd.docker.image.rootfs.diff.tar.gzip request.headers=\"map[Accept:[application/vnd.docker.image.rootfs.diff.tar.gzip, *]]\" request.method=GET size=100 url=\"https://gcr.io/v2/cri-tools/test-image-tags/blobs/sha256:658ab7fdfcb5d49f43d25b9d13149520e48eddee602ce693e05f73e05a85abc3\"\r\ntime=\"2019-01-16T19:17:00.841007518Z\" level=debug msg=\"event published\" ns=k8s.io topic=/tasks/exit type=containerd.events.TaskExit\r\ntime=\"2019-01-16T19:17:00.841120054Z\" level=debug msg=fetch digest=\"sha256:2c31aa28ab3cddfb04944d018e03ee198cbf94773f4bd881e292a6e298b17017\" mediatype=application/vnd.docker.container.image.v1+json size=1808\r\ntime=\"2019-01-16T19:17:00.848740603Z\" level=debug msg=\"do request\" base=\"https://gcr.io/v2/cri-tools/test-image-tags\" digest=\"sha256:2c31aa28ab3cddfb04944d018e03ee198cbf94773f4bd881e292a6e298b17017\" mediatype=application/vnd.docker.container.image.v1+json request.headers=\"map[Accept:[application/vnd.docker.container.image.v1+json, *]]\" request.method=GET size=1808 url=\"https://gcr.io/v2/cri-tools/test-image-tags/blobs/sha256:2c31aa28ab3cddfb04944d018e03ee198cbf94773f4bd881e292a6e298b17017\"\r\ntime=\"2019-01-16T19:17:00.849482430Z\" level=debug msg=fetch digest=\"sha256:65fc92611f38c5c3e31d5c0faec078c60f41103f2ad4a3700fff122c49aab358\" mediatype=application/vnd.docker.image.rootfs.diff.tar.gzip size=699165\r\ntime=\"2019-01-16T19:17:00.861940817Z\" level=debug msg=\"do request\" base=\"https://gcr.io/v2/cri-tools/test-image-tags\" digest=\"sha256:65fc92611f38c5c3e31d5c0faec078c60f41103f2ad4a3700fff122c49aab358\" mediatype=application/vnd.docker.image.rootfs.diff.tar.gzip request.headers=\"map[Accept:[application/vnd.docker.image.rootfs.diff.tar.gzip, *]]\" request.method=GET size=699165 url=\"https://gcr.io/v2/cri-tools/test-image-tags/blobs/sha256:65fc92611f38c5c3e31d5c0faec078c60f41103f2ad4a3700fff122c49aab358\"\r\ntime=\"2019-01-16T19:17:00.896789215Z\" level=debug msg=\"event published\" ns=k8s.io topic=/tasks/exit type=containerd.events.TaskExit\r\nE0116 19:17:00.897321   14236 attach.go:52] error attaching to container: failed to load task: no running task found: task 0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13 not found: not found\r\ntime=\"2019-01-16T19:17:00.927481009Z\" level=debug msg=\"fetch response received\" base=\"https://gcr.io/v2/cri-tools/test-image-tags\" digest=\"sha256:65fc92611f38c5c3e31d5c0faec078c60f41103f2ad4a3700fff122c49aab358\" mediatype=application/vnd.docker.image.rootfs.diff.tar.gzip response.headers=\"map[Last-Modified:[Tue, 20 Feb 2018 18:32:28 GMT] X-Goog-Generation:[1519151548075266] Accept-Ranges:[bytes] Cache-Control:[public, max-age=3600] Expires:[Wed, 16 Jan 2019 20:16:47 GMT] X-Goog-Stored-Content-Encoding:[identity] X-Goog-Hash:[crc32c=tNx56g== md5=SkiuHh28dCSk6qumT6AMbA==] Content-Length:[699165] Age:[13] X-Guploader-Uploadid:[AEnB2Uo9sL4UlfEuRbPdcuPFk7pBT0X2cpeHrnK-73Yj-hRX7Rq30iBL9AKNDbROOxyWD4gWTcPJ1rZ65fPzLc-dZ-9kpWnwfvgFy2-lBy9toJJQ7Ay8YQw] Etag:[\\\"4a48ae1e1dbc7424a4eaaba64fa00c6c\\\"] X-Goog-Stored-Content-Length:[699165] Content-Type:[application/octet-stream] Date:[Wed, 16 Jan 2019 19:16:47 GMT] X-Goog-Metageneration:[1] X-Goog-Storage-Class:[STANDARD] Server:[UploadServer]]\" size=699165 status=\"200 OK\" url=\"https://gcr.io/v2/cri-tools/test-image-tags/blobs/sha256:65fc92611f38c5c3e31d5c0faec078c60f41103f2ad4a3700fff122c49aab358\"\r\ntime=\"2019-01-16T19:17:00.943535942Z\" level=info msg=\"StopPodSandbox for \\\"bf5ce14abe885fcbd2ab7c2fd6deeadbac3862ae0e8c9ac1827acfb82d874b29\\\"\"\r\ntime=\"2019-01-16T19:17:00.960133120Z\" level=info msg=\"shim reaped\" id=0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13\r\ntime=\"2019-01-16T19:17:00.975830557Z\" level=debug msg=\"event published\" ns=k8s.io topic=/tasks/delete type=containerd.events.TaskDelete\r\ntime=\"2019-01-16T19:17:00.979383243Z\" level=debug msg=\"Received containerd event timestamp - 2019-01-16 19:17:00.84100101 +0000 UTC, namespace - \\\"k8s.io\\\", topic - \\\"/tasks/exit\\\"\"\r\ntime=\"2019-01-16T19:17:00.979479460Z\" level=info msg=\"TaskExit event &TaskExit{ContainerID:2caeea51c7aa95cf021f5e902f1abe0f9a1a36e59f8d544b924041265f8a2131,ID:2caeea51c7aa95cf021f5e902f1abe0f9a1a36e59f8d544b924041265f8a2131,Pid:17680,ExitStatus:137,ExitedAt:2019-01-16 19:17:00.652061976 +0000 UTC,}\"\r\n```\r\n\r\nIf I'm reading it properly, then it looks like the container and task immediately exited at **19:17:00.645**?\r\n```\r\ntime=\"2019-01-16T19:17:00.645376657Z\" level=info msg=\"TaskExit event &TaskExit{ContainerID:0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13,ID:0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13,Pid:18052,ExitStatus:0,ExitedAt:2019-01-16 19:17:00.528067275 +0000 UTC,}\"\r\n```\r\nsuch that ~250ms later (@ **19:17:00.897**) when the attach call was executed, there was no task with that ID:\r\n```\r\nE0116 19:17:00.897321   14236 attach.go:52] error attaching to container: failed to load task: no running task found: task 0a37f9c02d36bc65f16d17a089e49c6f4ff0e71d9aaa5948221f7441cbfe3d13 not found: not found\r\n```\r\n\r\n@Random-Liu @mikebrow any ideas?",
  "closed_at": "2019-01-23T18:51:13Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/169601?v=4",
    "events_url": "https://api.github.com/users/dmcgowan/events{/privacy}",
    "followers_url": "https://api.github.com/users/dmcgowan/followers",
    "following_url": "https://api.github.com/users/dmcgowan/following{/other_user}",
    "gists_url": "https://api.github.com/users/dmcgowan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dmcgowan",
    "id": 169601,
    "login": "dmcgowan",
    "node_id": "MDQ6VXNlcjE2OTYwMQ==",
    "organizations_url": "https://api.github.com/users/dmcgowan/orgs",
    "received_events_url": "https://api.github.com/users/dmcgowan/received_events",
    "repos_url": "https://api.github.com/users/dmcgowan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dmcgowan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dmcgowan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dmcgowan"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/containerd/containerd/issues/2937/comments",
  "created_at": "2019-01-16T21:10:19Z",
  "events_url": "https://api.github.com/repos/containerd/containerd/issues/2937/events",
  "html_url": "https://github.com/containerd/containerd/issues/2937",
  "id": 399998424,
  "labels": [],
  "labels_url": "https://api.github.com/repos/containerd/containerd/issues/2937/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzOTk5OTg0MjQ=",
  "number": 2937,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/containerd/containerd",
  "state": "closed",
  "title": "flaky CRI test: [AfterEach] runtime should support attach [Conformance]",
  "updated_at": "2019-01-23T18:51:13Z",
  "url": "https://api.github.com/repos/containerd/containerd/issues/2937",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1397980?v=4",
    "events_url": "https://api.github.com/users/estesp/events{/privacy}",
    "followers_url": "https://api.github.com/users/estesp/followers",
    "following_url": "https://api.github.com/users/estesp/following{/other_user}",
    "gists_url": "https://api.github.com/users/estesp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/estesp",
    "id": 1397980,
    "login": "estesp",
    "node_id": "MDQ6VXNlcjEzOTc5ODA=",
    "organizations_url": "https://api.github.com/users/estesp/orgs",
    "received_events_url": "https://api.github.com/users/estesp/received_events",
    "repos_url": "https://api.github.com/users/estesp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/estesp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/estesp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/estesp"
  }
}