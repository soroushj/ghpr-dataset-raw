{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "Now we use many HashMap in raft Peer, like peer cache,  peer heartbeats and node prs. In most of the case, the hash map is very small (we can guarantee that the size is about the max replica number 3 or a little larger 4). So we can use vector instead, for peer cache, we can move the region peer cache to the peer cache itself, no need to maintain a total peer cache in store. \r\n\r\n```\r\n#[bench]\r\nfn bench_vec_find_1(b: &mut Bencher) {\r\n    let v = vec![(1, 1), (2, 2), (3, 3), (4, 4), (5, 5)];\r\n    b.iter(||v.iter().find(|&x| x.0 == 1).unwrap())\r\n}\r\n\r\n#[bench]\r\nfn bench_vec_find_5(b: &mut Bencher) {\r\n    let v = vec![(1, 1), (2, 2), (3, 3), (4, 4), (5, 5)];\r\n    b.iter(||v.iter().find(|&x| x.0 == 5).unwrap())\r\n}\r\n\r\n#[bench]\r\nfn bench_ordermap_find_1(b :&mut Bencher) {\r\n    let m = ordermap!{1 => 1, 2 => 2, 3 => 3, 4 => 4, 5 => 5};\r\n    b.iter(||m[&1])\r\n}\r\n\r\n#[bench]\r\nfn bench_ordermap_find_5(b :&mut Bencher) {\r\n    let m = ordermap!{1 => 1, 2 => 2, 3 => 3, 4 => 4, 5 => 5};\r\n    b.iter(||m[&5])\r\n}\r\n\r\n#[bench]\r\nfn bench_hashmap_find_1(b :&mut Bencher) {\r\n    let mut m = HashMap::new();\r\n    m.insert(1, 1);\r\n    m.insert(2, 2);\r\n    m.insert(3, 3);\r\n    m.insert(4, 4);\r\n    m.insert(5, 5);    \r\n    b.iter(||m[&1])\r\n}\r\n\r\n#[bench]\r\nfn bench_hashmap_find_5(b :&mut Bencher) {\r\n    let mut m = HashMap::new();\r\n    m.insert(1, 1);\r\n    m.insert(2, 2);\r\n    m.insert(3, 3);\r\n    m.insert(4, 4);\r\n    m.insert(5, 5);    \r\n    b.iter(||m[&5])\r\n}\r\n```\r\n```\r\ntest tests::bench_hashmap_find_1  ... bench:          22 ns/iter (+/- 7)\r\ntest tests::bench_hashmap_find_5  ... bench:          19 ns/iter (+/- 13)\r\ntest tests::bench_ordermap_find_1 ... bench:          25 ns/iter (+/- 11)\r\ntest tests::bench_ordermap_find_5 ... bench:          30 ns/iter (+/- 17)\r\ntest tests::bench_vec_find_1      ... bench:           2 ns/iter (+/- 0)\r\ntest tests::bench_vec_find_5      ... bench:           7 ns/iter (+/- 6)\r\n```\r\n\r\nAs we can see, for small data search, vector is very faster than hash map. ",
  "closed_at": "2018-06-04T11:14:35Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1701473?v=4",
    "events_url": "https://api.github.com/users/BusyJay/events{/privacy}",
    "followers_url": "https://api.github.com/users/BusyJay/followers",
    "following_url": "https://api.github.com/users/BusyJay/following{/other_user}",
    "gists_url": "https://api.github.com/users/BusyJay/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/BusyJay",
    "id": 1701473,
    "login": "BusyJay",
    "node_id": "MDQ6VXNlcjE3MDE0NzM=",
    "organizations_url": "https://api.github.com/users/BusyJay/orgs",
    "received_events_url": "https://api.github.com/users/BusyJay/received_events",
    "repos_url": "https://api.github.com/users/BusyJay/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/BusyJay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/BusyJay/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/BusyJay"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/tikv/tikv/issues/1843/comments",
  "created_at": "2017-05-16T02:16:00Z",
  "events_url": "https://api.github.com/repos/tikv/tikv/issues/1843/events",
  "html_url": "https://github.com/tikv/tikv/issues/1843",
  "id": 228896272,
  "labels": [],
  "labels_url": "https://api.github.com/repos/tikv/tikv/issues/1843/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMjg4OTYyNzI=",
  "number": 1843,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/tikv/tikv",
  "state": "closed",
  "title": "consider using vector instead of hashmap in raft Peer",
  "updated_at": "2018-08-07T00:46:43Z",
  "url": "https://api.github.com/repos/tikv/tikv/issues/1843",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1080370?v=4",
    "events_url": "https://api.github.com/users/siddontang/events{/privacy}",
    "followers_url": "https://api.github.com/users/siddontang/followers",
    "following_url": "https://api.github.com/users/siddontang/following{/other_user}",
    "gists_url": "https://api.github.com/users/siddontang/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/siddontang",
    "id": 1080370,
    "login": "siddontang",
    "node_id": "MDQ6VXNlcjEwODAzNzA=",
    "organizations_url": "https://api.github.com/users/siddontang/orgs",
    "received_events_url": "https://api.github.com/users/siddontang/received_events",
    "repos_url": "https://api.github.com/users/siddontang/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/siddontang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siddontang/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/siddontang"
  }
}