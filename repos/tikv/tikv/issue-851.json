{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "We store lock in separate column family, and we use rocksdb's write_without_wal api to apply raft log. When rocksdb need flush memtable to sstfile, it will choose the column family who's  memtable is bigger than the others, and will only flush this column falimy's memtable to sstfile in this round. This will cause one situation that the default column family's update(data and apply-index info) has flushed to sstfile, but the lock column family's update(lock info) still in memtable, when we shutdown tikv not gracefully, we face the risk of lose lock data.\n",
  "closed_at": "2016-07-20T09:21:36Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/878009?v=4",
    "events_url": "https://api.github.com/users/ngaut/events{/privacy}",
    "followers_url": "https://api.github.com/users/ngaut/followers",
    "following_url": "https://api.github.com/users/ngaut/following{/other_user}",
    "gists_url": "https://api.github.com/users/ngaut/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ngaut",
    "id": 878009,
    "login": "ngaut",
    "node_id": "MDQ6VXNlcjg3ODAwOQ==",
    "organizations_url": "https://api.github.com/users/ngaut/orgs",
    "received_events_url": "https://api.github.com/users/ngaut/received_events",
    "repos_url": "https://api.github.com/users/ngaut/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ngaut/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ngaut/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ngaut"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/tikv/tikv/issues/851/comments",
  "created_at": "2016-07-19T07:16:40Z",
  "events_url": "https://api.github.com/repos/tikv/tikv/issues/851/events",
  "html_url": "https://github.com/tikv/tikv/issues/851",
  "id": 166263677,
  "labels": [],
  "labels_url": "https://api.github.com/repos/tikv/tikv/issues/851/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxNjYyNjM2Nzc=",
  "number": 851,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/tikv/tikv",
  "state": "closed",
  "title": "lose lock info risk",
  "updated_at": "2018-08-07T00:45:57Z",
  "url": "https://api.github.com/repos/tikv/tikv/issues/851",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/19700528?v=4",
    "events_url": "https://api.github.com/users/zhangjinpeng1987/events{/privacy}",
    "followers_url": "https://api.github.com/users/zhangjinpeng1987/followers",
    "following_url": "https://api.github.com/users/zhangjinpeng1987/following{/other_user}",
    "gists_url": "https://api.github.com/users/zhangjinpeng1987/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/zhangjinpeng1987",
    "id": 19700528,
    "login": "zhangjinpeng1987",
    "node_id": "MDQ6VXNlcjE5NzAwNTI4",
    "organizations_url": "https://api.github.com/users/zhangjinpeng1987/orgs",
    "received_events_url": "https://api.github.com/users/zhangjinpeng1987/received_events",
    "repos_url": "https://api.github.com/users/zhangjinpeng1987/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/zhangjinpeng1987/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zhangjinpeng1987/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/zhangjinpeng1987"
  }
}