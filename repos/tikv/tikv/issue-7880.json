{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\n<!-- You can run `tikv-server --version` -->\r\n```\r\n/ # ./tikv-server -V\r\nTiKV \r\nRelease Version:   4.1.0-alpha\r\nEdition:           Community\r\nGit Commit Hash:   c0613a069181a4de0553c214a463a8308fdcdc30\r\nGit Commit Branch: master\r\nUTC Build Time:    2020-05-18 11:05:35\r\nRust Version:      rustc 1.44.0-nightly (b2e36e6c2 2020-04-22)\r\nEnable Features:   jemalloc portable sse protobuf-codec\r\nProfile:           dist_release\r\n```\r\n### What operating system and CPU are you using?\r\n<!-- If you're using Linux, you can run `cat /proc/cpuinfo` -->\r\nrun in container\r\n### Steps to reproduce\r\n<!-- If possible, provide a recipe for reproducing the error. A complete runnable program is good. -->\r\n\r\n- backup stuck in the condition of issue  https://github.com/tikv/tikv/issues/7849\r\n\r\n- delete backup job\r\n\r\n- restart a backup job\r\n\r\n- new backup job will not  begin and the progress is 0 % \r\n\r\n### What did you expect?\r\nnew backup job will complete normally\r\n\r\n### What did happened?\r\nbr log \r\n```\r\nE0519 08:58:25.468473       1 util.go:219] Parse version nightly failure, error: Invalid Semantic Version\r\nI0519 08:58:25.504346       1 backup.go:92] [2020/05/19 08:58:25.504 +00:00] [INFO] [version.go:26] [\"Welcome to Backup & Restore (BR)\"]\r\nI0519 08:58:25.504381       1 backup.go:92] [2020/05/19 08:58:25.504 +00:00] [INFO] [version.go:27] [BR] [release-version=v4.0.0-beta.2-42-g252649b]\r\nI0519 08:58:25.504389       1 backup.go:92] [2020/05/19 08:58:25.504 +00:00] [INFO] [version.go:28] [BR] [git-hash=252649bc51b3c313a235a654f203637fc91f670c]\r\nI0519 08:58:25.504396       1 backup.go:92] [2020/05/19 08:58:25.504 +00:00] [INFO] [version.go:29] [BR] [git-branch=master]\r\nI0519 08:58:25.504402       1 backup.go:92] [2020/05/19 08:58:25.504 +00:00] [INFO] [version.go:30] [BR] [go-version=go1.14.1]\r\nI0519 08:58:25.504409       1 backup.go:92] [2020/05/19 08:58:25.504 +00:00] [INFO] [version.go:31] [BR] [utc-build-time=\"2020-05-19 08:27:39\"]\r\nI0519 08:58:25.504415       1 backup.go:92] [2020/05/19 08:58:25.504 +00:00] [INFO] [version.go:32] [BR] [race-enabled=false]\r\nI0519 08:58:25.504687       1 backup.go:92] [2020/05/19 08:58:25.504 +00:00] [INFO] [common.go:316] [arguments] [ca=/var/lib/cluster-client-tls/ca.crt] [cert=/var/lib/cluster-client-tls/tls.crt] [key=/var/lib/cluster-client-tls/tls.key] [pd=\"[db-pd.tidb1262575324898529280:2379]\"] [send-credentials-to-tikv=true] [storage=gcs://dbaas-hibernate/test1T/]\r\nI0519 08:58:25.505298       1 backup.go:92] [2020/05/19 08:58:25.505 +00:00] [INFO] [client.go:141] [\"[pd] create pd client with endpoints\"] [pd-address=\"[db-pd.tidb1262575324898529280:2379]\"]\r\nI0519 08:58:25.521060       1 backup.go:92] [2020/05/19 08:58:25.520 +00:00] [INFO] [base_client.go:226] [\"[pd] update member urls\"] [old-urls=\"[http://db-pd.tidb1262575324898529280:2379]\"] [new-urls=\"[https://db-pd-0.db-pd-peer.tidb1262575324898529280.svc:2379,https://db-pd-1.db-pd-peer.tidb1262575324898529280.svc:2379,https://db-pd-2.db-pd-peer.tidb1262575324898529280.svc:2379]\"]\r\nI0519 08:58:25.521121       1 backup.go:92] [2020/05/19 08:58:25.520 +00:00] [INFO] [base_client.go:242] [\"[pd] switch leader\"] [new-leader=https://db-pd-1.db-pd-peer.tidb1262575324898529280.svc:2379] [old-leader=]\r\nI0519 08:58:25.521883       1 backup.go:92] [2020/05/19 08:58:25.521 +00:00] [INFO] [base_client.go:92] [\"[pd] init cluster id\"] [cluster-id=6828382606271599848]\r\nI0519 08:58:25.568400       1 backup.go:92] [2020/05/19 08:58:25.568 +00:00] [WARN] [pd.go:109] [\"get timestamp too slow\"] [\"cost time\"=45.096936ms]\r\nI0519 08:58:25.579379       1 backup.go:92] [2020/05/19 08:58:25.579 +00:00] [INFO] [client.go:141] [\"[pd] create pd client with endpoints\"] [pd-address=\"[db-pd.tidb1262575324898529280:2379]\"]\r\nI0519 08:58:25.595324       1 backup.go:92] [2020/05/19 08:58:25.595 +00:00] [INFO] [base_client.go:226] [\"[pd] update member urls\"] [old-urls=\"[http://db-pd.tidb1262575324898529280:2379]\"] [new-urls=\"[https://db-pd-0.db-pd-peer.tidb1262575324898529280.svc:2379,https://db-pd-1.db-pd-peer.tidb1262575324898529280.svc:2379,https://db-pd-2.db-pd-peer.tidb1262575324898529280.svc:2379]\"]\r\nI0519 08:58:25.595479       1 backup.go:92] [2020/05/19 08:58:25.595 +00:00] [INFO] [base_client.go:242] [\"[pd] switch leader\"] [new-leader=https://db-pd-1.db-pd-peer.tidb1262575324898529280.svc:2379] [old-leader=]\r\nI0519 08:58:25.596241       1 backup.go:92] [2020/05/19 08:58:25.596 +00:00] [INFO] [base_client.go:92] [\"[pd] init cluster id\"] [cluster-id=6828382606271599848]\r\nI0519 08:58:25.596682       1 backup.go:92] [2020/05/19 08:58:25.596 +00:00] [INFO] [conn.go:200] [\"new mgr\"] [pdAddrs=db-pd.tidb1262575324898529280:2379]\r\nI0519 08:58:25.611576       1 backup.go:92] [2020/05/19 08:58:25.611 +00:00] [INFO] [tidb.go:71] [\"new domain\"] [store=tikv-6828382606271599848] [\"ddl lease\"=1s] [\"stats lease\"=-1ns]\r\nI0519 08:58:25.615728       1 backup.go:92] [2020/05/19 08:58:25.615 +00:00] [INFO] [ddl.go:317] [\"[ddl] start DDL\"] [ID=e6a1b8e5-35e9-4736-a7f5-fe3665f2f271] [runWorker=false]\r\nI0519 08:58:26.717149       1 backup.go:92] [2020/05/19 08:58:26.717 +00:00] [INFO] [domain.go:144] [\"full load InfoSchema success\"] [usedSchemaVersion=0] [neededSchemaVersion=63] [\"start time\"=17.595722ms]\r\nI0519 08:58:26.723285       1 backup.go:92] [2020/05/19 08:58:26.723 +00:00] [INFO] [domain.go:368] [\"full load and reset schema validator\"]\r\nI0519 08:58:26.723608       1 backup.go:92] [2020/05/19 08:58:26.723 +00:00] [WARN] [domain.go:378] [\"loading schema takes a long time\"] [\"take time\"=1.065246131s]\r\nI0519 08:58:26.724079       1 backup.go:92] [2020/05/19 08:58:26.724 +00:00] [INFO] [client.go:77] [\"new backup client\"]\r\nI0519 08:58:27.361487       1 backup.go:92] [2020/05/19 08:58:27.361 +00:00] [INFO] [client.go:121] [\"backup encode timestamp\"] [BackupTS=416777163848810497]\r\nI0519 08:58:27.375472       1 backup.go:92] [2020/05/19 08:58:27.375 +00:00] [INFO] [domain.go:144] [\"full load InfoSchema success\"] [usedSchemaVersion=0] [neededSchemaVersion=63] [\"start time\"=12.698368ms]\r\nI0519 08:58:27.381107       1 backup.go:92] [2020/05/19 08:58:27.380 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=test] [table=test] [AutoIncID=1]\r\nI0519 08:58:27.383051       1 backup.go:92] [2020/05/19 08:58:27.382 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_stock] [AutoIncID=1]\r\nI0519 08:58:27.385528       1 backup.go:92] [2020/05/19 08:58:27.385 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_config] [AutoIncID=5]\r\nI0519 08:58:27.386882       1 backup.go:92] [2020/05/19 08:58:27.386 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_warehouse] [AutoIncID=1]\r\nI0519 08:58:27.388122       1 backup.go:92] [2020/05/19 08:58:27.387 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_item] [AutoIncID=1]\r\nI0519 08:58:27.390435       1 backup.go:92] [2020/05/19 08:58:27.390 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_district] [AutoIncID=50001]\r\nI0519 08:58:27.392101       1 backup.go:92] [2020/05/19 08:58:27.392 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_new_order] [AutoIncID=169075299]\r\nI0519 08:58:27.394292       1 backup.go:92] [2020/05/19 08:58:27.393 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_history] [AutoIncID=150000002]\r\nI0519 08:58:27.395633       1 backup.go:92] [2020/05/19 08:58:27.395 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_oorder] [AutoIncID=876582358]\r\nI0519 08:58:27.396975       1 backup.go:92] [2020/05/19 08:58:27.396 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_customer] [AutoIncID=4058899655]\r\nI0519 08:58:27.398467       1 backup.go:92] [2020/05/19 08:58:27.398 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_stock1] [AutoIncID=1]\r\nI0519 08:58:27.399779       1 backup.go:92] [2020/05/19 08:58:27.399 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_order_line] [AutoIncID=11305498756]\r\nI0519 08:58:27.401106       1 backup.go:92] [2020/05/19 08:58:27.401 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_stock2] [AutoIncID=1]\r\nI0519 08:58:27.402338       1 backup.go:92] [2020/05/19 08:58:27.402 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_stock3] [AutoIncID=1]\r\nI0519 08:58:27.403606       1 backup.go:92] [2020/05/19 08:58:27.403 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_stock4] [AutoIncID=1]\r\nI0519 08:58:27.405345       1 backup.go:92] [2020/05/19 08:58:27.405 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_stock5] [AutoIncID=1]\r\nI0519 08:58:27.407063       1 backup.go:92] [2020/05/19 08:58:27.406 +00:00] [INFO] [client.go:257] [\"change table AutoIncID\"] [db=tpcc] [table=bmsql_stock6] [AutoIncID=1]\r\nI0519 08:58:27.483514       1 backup.go:92] [2020/05/19 08:58:27.482 +00:00] [INFO] [client.go:392] [\"current backup safePoint job\"] [backupTS=416777163848810497]\r\nI0519 08:58:27.484027       1 backup.go:92] [2020/05/19 08:58:27.483 +00:00] [INFO] [client.go:444] [\"backup started\"] [StartKey=\"dIAAAAAAAAAtX3IAAAAAAAAAAA==\"] [EndKey=\"dIAAAAAAAAAtX3L//////////wA=\"] [RateLimit=0] [Concurrency=4]\r\nI0519 08:58:27.485339       1 backup.go:92] [2020/05/19 08:58:27.485 +00:00] [INFO] [push.go:29] [\"new backup client\"]\r\nI0519 08:58:27.487245       1 backup.go:92] [2020/05/19 08:58:27.486 +00:00] [INFO] [client.go:763] [\"try backup\"] [StartKey=\"dIAAAAAAAAAtX3IAAAAAAAAAAA==\"] [EndKey=\"dIAAAAAAAAAtX3L//////////wA=\"] [storeID=1]\r\nI0519 08:58:27.490872       1 backup.go:92] [2020/05/19 08:58:27.490 +00:00] [INFO] [client.go:763] [\"try backup\"] [StartKey=\"dIAAAAAAAAAtX3IAAAAAAAAAAA==\"] [EndKey=\"dIAAAAAAAAAtX3L//////////wA=\"] [storeID=4]\r\nI0519 08:58:27.494158       1 backup.go:92] [2020/05/19 08:58:27.494 +00:00] [INFO] [client.go:763] [\"try backup\"] [StartKey=\"dIAAAAAAAAAtX3IAAAAAAAAAAA==\"] [EndKey=\"dIAAAAAAAAAtX3L//////////wA=\"] [storeID=66]\r\nI0519 08:58:27.578189       1 backup.go:92] [2020/05/19 08:58:27.578 +00:00] [INFO] [client.go:779] [\"backup streaming finish\"] [StoreID=1]\r\nI0519 08:58:27.593513       1 backup.go:92] [2020/05/19 08:58:27.593 +00:00] [INFO] [client.go:786] [\"range backuped\"] [StartKey=\"dIAAAAAAAAAtX3IAAAAAAAAAAA==\"] [EndKey=\"dIAAAAAAAAAtX3L//////////wA=\"]\r\nI0519 08:58:27.594583       1 backup.go:92] [2020/05/19 08:58:27.594 +00:00] [INFO] [client.go:779] [\"backup streaming finish\"] [StoreID=4]\r\nI0519 08:58:27.683892       1 backup.go:92] [2020/05/19 08:58:27.683 +00:00] [INFO] [progress.go:102] [\"Full backup\"] [progress=0.00%!](MISSING)\r\nI0519 08:58:27.883729       1 backup.go:92] [2020/05/19 08:58:27.883 +00:00] [INFO] [progress.go:102] [\"Full backup\"] [progress=0.00%!](MISSING)\r\nI0519 08:58:28.093507       1 backup.go:92] [2020/05/19 08:58:28.093 +00:00] [INFO] [progress.go:102] [\"Full backup\"] [progress=0.00%!](MISSING)\r\nI0519 08:58:28.283501       1 backup.go:92] [2020/05/19 08:58:28.283 +00:00] [INFO] [progress.go:102] [\"Full backup\"] [progress=0.00%!](MISSING)\r\nI0519 08:58:28.483522       1 backup.go:92] [2020/05/19 08:58:28.483 +00:00] [INFO] [progress.go:102] [\"Full backup\"] [progress=0.00%!](MISSING)\r\nI0519 08:58:28.683431       1 backup.go:92] [2020/05/19 08:58:28.683 +00:00] [INFO] [progress.go:102] [\"Full backup\"] [progress=0.00%!](MISSING)\r\n```\r\ntikv log\r\n```\r\n[2020/05/19 08:49:18.145 +00:00] [INFO] [endpoint.rs:698] [\"run backup task\"] [task=\"BackupTask { start_ts: TimeStamp(0), end_ts: TimeStamp(416777018371997697), start_key: \\\"74800000000000002D5F720000000000000000\\\", end_key: \\\"74800000000000002D5F72FFFFFFFFFFFFFFFF00\\\", is_raw_kv: false, cf: \\\"default\\\" }\"]\r\n[2020/05/19 08:49:18.146 +00:00] [INFO] [endpoint.rs:686] [\"backup finished\"] [summary=\"Statistics { lock: CfStatistics { processed: 0, get: 0, next: 0, prev: 0, seek: 0, seek_for_prev: 0, over_seek_bound: 0, flow_stats: FlowStatistics { read_keys: 0, read_bytes: 0 } }, write: CfStatistics { processed: 0, get: 0, next: 0, prev: 0, seek: 0, seek_for_prev: 0, over_seek_bound: 0, flow_stats: FlowStatistics { read_keys: 0, read_bytes: 0 } }, data: CfStatistics { processed: 0, get: 0, next: 0, prev: 0, seek: 0, seek_for_prev: 0, over_seek_bound: 0, flow_stats: FlowStatistics { read_keys: 0, read_bytes: 0 } } }\"] [take=690.127\u00b5s]\r\n[2020/05/19 08:49:18.146 +00:00] [INFO] [service.rs:79] [\"backup send half closed\"]\r\n[2020/05/19 08:56:22.279 +00:00] [INFO] [endpoint.rs:698] [\"run backup task\"] [task=\"BackupTask { start_ts: TimeStamp(0), end_ts: TimeStamp(416777131015012353), start_key: \\\"74800000000000002D5F720000000000000000\\\", end_key: \\\"74800000000000002D5F72FFFFFFFFFFFFFFFF00\\\", is_raw_kv: false, cf: \\\"default\\\" }\"]\r\n[2020/05/19 08:56:22.279 +00:00] [INFO] [endpoint.rs:686] [\"backup finished\"] [summary=\"Statistics { lock: CfStatistics { processed: 0, get: 0, next: 0, prev: 0, seek: 0, seek_for_prev: 0, over_seek_bound: 0, flow_stats: FlowStatistics { read_keys: 0, read_bytes: 0 } }, write: CfStatistics { processed: 0, get: 0, next: 0, prev: 0, seek: 0, seek_for_prev: 0, over_seek_bound: 0, flow_stats: FlowStatistics { read_keys: 0, read_bytes: 0 } }, data: CfStatistics { processed: 0, get: 0, next: 0, prev: 0, seek: 0, seek_for_prev: 0, over_seek_bound: 0, flow_stats: FlowStatistics { read_keys: 0, read_bytes: 0 } } }\"] [take=240.385\u00b5s]\r\n[2020/05/19 08:56:22.279 +00:00] [INFO] [service.rs:79] [\"backup send half closed\"]\r\n[2020/05/19 08:58:27.577 +00:00] [INFO] [endpoint.rs:698] [\"run backup task\"] [task=\"BackupTask { start_ts: TimeStamp(0), end_ts: TimeStamp(416777163848810497), start_key: \\\"74800000000000002D5F720000000000000000\\\", end_key: \\\"74800000000000002D5F72FFFFFFFFFFFFFFFF00\\\", is_raw_kv: false, cf: \\\"default\\\" }\"]\r\n[2020/05/19 08:58:27.577 +00:00] [INFO] [endpoint.rs:686] [\"backup finished\"] [summary=\"Statistics { lock: CfStatistics { processed: 0, get: 0, next: 0, prev: 0, seek: 0, seek_for_prev: 0, over_seek_bound: 0, flow_stats: FlowStatistics { read_keys: 0, read_bytes: 0 } }, write: CfStatistics { processed: 0, get: 0, next: 0, prev: 0, seek: 0, seek_for_prev: 0, over_seek_bound: 0, flow_stats: FlowStatistics { read_keys: 0, read_bytes: 0 } }, data: CfStatistics { processed: 0, get: 0, next: 0, prev: 0, seek: 0, seek_for_prev: 0, over_seek_bound: 0, flow_stats: FlowStatistics { read_keys: 0, read_bytes: 0 } } }\"] [take=221.168\u00b5s]\r\n[2020/05/19 08:58:27.577 +00:00] [INFO] [service.rs:79] [\"backup send half closed\"]\r\n```",
  "closed_at": "2020-05-29T06:51:37Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/29268173?v=4",
    "events_url": "https://api.github.com/users/sre-bot/events{/privacy}",
    "followers_url": "https://api.github.com/users/sre-bot/followers",
    "following_url": "https://api.github.com/users/sre-bot/following{/other_user}",
    "gists_url": "https://api.github.com/users/sre-bot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sre-bot",
    "id": 29268173,
    "login": "sre-bot",
    "node_id": "MDQ6VXNlcjI5MjY4MTcz",
    "organizations_url": "https://api.github.com/users/sre-bot/orgs",
    "received_events_url": "https://api.github.com/users/sre-bot/received_events",
    "repos_url": "https://api.github.com/users/sre-bot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sre-bot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sre-bot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sre-bot"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/tikv/tikv/issues/7880/comments",
  "created_at": "2020-05-19T09:18:32Z",
  "events_url": "https://api.github.com/repos/tikv/tikv/issues/7880/events",
  "html_url": "https://github.com/tikv/tikv/issues/7880",
  "id": 620817388,
  "labels": [
    {
      "color": "d1fad7",
      "default": false,
      "description": "Component: backup, import, external_storage",
      "id": 1545811086,
      "name": "component/backup-restore",
      "node_id": "MDU6TGFiZWwxNTQ1ODExMDg2",
      "url": "https://api.github.com/repos/tikv/tikv/labels/component/backup-restore"
    }
  ],
  "labels_url": "https://api.github.com/repos/tikv/tikv/issues/7880/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MjA4MTczODg=",
  "number": 7880,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/tikv/tikv",
  "state": "closed",
  "title": "After backup/restore stuck, new backup cannot work until all tikv are deleted",
  "updated_at": "2020-05-29T06:51:37Z",
  "url": "https://api.github.com/repos/tikv/tikv/issues/7880",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/30903849?v=4",
    "events_url": "https://api.github.com/users/shuijing198799/events{/privacy}",
    "followers_url": "https://api.github.com/users/shuijing198799/followers",
    "following_url": "https://api.github.com/users/shuijing198799/following{/other_user}",
    "gists_url": "https://api.github.com/users/shuijing198799/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/shuijing198799",
    "id": 30903849,
    "login": "shuijing198799",
    "node_id": "MDQ6VXNlcjMwOTAzODQ5",
    "organizations_url": "https://api.github.com/users/shuijing198799/orgs",
    "received_events_url": "https://api.github.com/users/shuijing198799/received_events",
    "repos_url": "https://api.github.com/users/shuijing198799/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/shuijing198799/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shuijing198799/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/shuijing198799"
  }
}