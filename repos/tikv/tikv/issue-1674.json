{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What version of Rust are you using (`rustc --version`)?\r\nused pingcap/tikv image\r\n\r\n2. What operating system and processor architecture are you using?\r\ncentos7/amd64\r\n\r\n3. What did you do?\r\nIf possible, provide a recipe for reproducing the error.\r\nA complete runnable program is good.\r\ntikv cluster restart\r\n\r\n4. What did you expect to see?\r\nwith consistent storage etc, tikv cluster shall be able to restart \r\n\r\n5. What did you see instead?\r\nrestart failed for all 3 tikv instance with following error:\r\n\r\n```\r\n2017/03/09 13:30:54.087 mod.rs:375: [INFO] Welcome to TiKV.\r\n2017/03/09 13:30:54.087 mod.rs:376: [INFO] Version:\r\n2017/03/09 13:30:54.087 mod.rs:377: [INFO] Git Commit Hash: a64a0af172b53b9896c3ff7cc3ed5b24a4938b16\r\n2017/03/09 13:30:54.087 mod.rs:378: [INFO] UTC Build Time:  2017-02-27 01:45:21\r\n2017/03/09 13:30:54.087 mod.rs:379: [INFO] Rustc Version:   1.17.0-nightly (ba7cf7cc5 2017-02-11)\r\n2017/03/09 13:30:54.087 tikv-server.rs:160: [INFO] rocksdb.max-open-files use default Some(40960)\r\n2017/03/09 13:30:54.088 tikv-server.rs:251: [WARN] Limit(\"kernel parameters net.core.somaxconn got 128, expect 32768\")\r\n2017/03/09 13:30:54.088 tikv-server.rs:251: [WARN] Limit(\"check_kernel_params failed No such file or directory (os error 2)\")\r\n2017/03/09 13:30:54.088 tikv-server.rs:251: [WARN] Limit(\"kernel parameters vm.swappiness got 60, expect 0\")\r\n2017/03/09 13:30:54.088 tikv-server.rs:97: [INFO] flag A: Some(\"0.0.0.0:20160\")\r\n2017/03/09 13:30:54.088 tikv-server.rs:97: [INFO] flag pd: Some(\"pd-0.tipd:2379,pd-1.tipd:2379,pd-2.tipd:2379\")\r\n2017/03/09 13:30:54.101 tikv-server.rs:176: [INFO] server.notify-capacity keep default 40960\r\n2017/03/09 13:30:54.101 tikv-server.rs:176: [INFO] server.end-point-concurrency keep default 8\r\n2017/03/09 13:30:54.101 tikv-server.rs:176: [INFO] server.messages-per-tick keep default 4096\r\n2017/03/09 13:30:54.101 tikv-server.rs:108: [INFO] flag capacity: None\r\n2017/03/09 13:30:54.101 tikv-server.rs:97: [INFO] flag advertise-addr: Some(\"tikv-1.tikv:20160\")\r\n2017/03/09 13:30:54.101 tikv-server.rs:176: [INFO] server.send-buffer-size keep default 131072\r\n2017/03/09 13:30:54.101 tikv-server.rs:176: [INFO] server.recv-buffer-size keep default 131072\r\n2017/03/09 13:30:54.101 tikv-server.rs:176: [INFO] raftstore.notify-capacity keep default 40960\r\n2017/03/09 13:30:54.101 tikv-server.rs:176: [INFO] raftstore.messages-per-tick keep default 4096\r\n2017/03/09 13:30:54.101 tikv-server.rs:188: [INFO] raftstore.raft-base-tick-interval keep default 1000\r\n2017/03/09 13:30:54.101 tikv-server.rs:176: [INFO] raftstore.raft-heartbeat-ticks keep default 2\r\n2017/03/09 13:30:54.102 tikv-server.rs:176: [INFO] raftstore.raft-election-timeout-ticks keep default 10\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.split-region-check-tick-interval keep default 10000\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.region-split-size keep default 67108864\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.region-max-size keep default 83886080\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.region-split-check-diff keep default 8388608\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.raft-log-gc-tick-interval keep default 10000\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.raft-log-gc-threshold keep default 50\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.raft-log-gc-count-limit keep default 49152\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.raft-log-gc-size-limit keep default 50331648\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.region-compact-check-interval keep default 300000\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.region-compact-delete-keys-count keep default 1000000\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.lock-cf-compact-interval keep default 600000\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.raft-entry-max-size keep default 8388608\r\n2017/03/09 13:30:54.102 tikv-server.rs:198: [INFO] raftstore.max-peer-down-duration keep default Duration { secs: 300, nanos: 0 }\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.pd-heartbeat-tick-interval keep default 60000\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.pd-store-heartbeat-tick-interval keep default 10000\r\n2017/03/09 13:30:54.102 tikv-server.rs:188: [INFO] raftstore.consistency-check-interval keep default 0\r\n2017/03/09 13:30:54.102 tikv-server.rs:176: [INFO] raftstore.accelerate-campaign-reserved-ticks keep default 1\r\n2017/03/09 13:30:54.102 tikv-server.rs:176: [INFO] storage.scheduler-notify-capacity keep default 10240\r\n2017/03/09 13:30:54.102 tikv-server.rs:176: [INFO] storage.scheduler-messages-per-tick keep default 1024\r\n2017/03/09 13:30:54.102 tikv-server.rs:176: [INFO] storage.scheduler-concurrency keep default 102400\r\n2017/03/09 13:30:54.102 tikv-server.rs:176: [INFO] storage.scheduler-worker-pool-size keep default 4\r\n2017/03/09 13:30:54.102 tikv-server.rs:97: [INFO] flag labels: None\r\n2017/03/09 13:30:54.102 tikv-server.rs:131: [INFO] server.labels use default Some(\"\")\r\n2017/03/09 13:30:54.102 tikv-server.rs:136: [INFO] toml value server.labels: \"\"\r\n2017/03/09 13:30:54.102 tikv-server.rs:97: [INFO] flag s: Some(\"/data\")\r\n2017/03/09 13:30:54.103 tikv-server.rs:131: [INFO] server.backup use default Some(\"\")\r\n2017/03/09 13:30:54.103 tikv-server.rs:136: [INFO] toml value server.backup: \"\"\r\n2017/03/09 13:30:54.103 tikv-server.rs:677: [INFO] backup path: /data/backup\r\n2017/03/09 13:30:54.129 mod.rs:193: [INFO] starting working thread: store address resolve worker\r\n2017/03/09 13:31:06.589 panic_hook.rs:85: [ERROR] thread 'main' panicked 'called `Result::unwrap()` on an `Err` value: Error { repr: Os { code: 22, message: \"Invalid argument\" } }' at \"/buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libcore/result.rs:868\"\r\nstack backtrace:\r\n   0:     0x7f1f0ef917ae - backtrace::backtrace::libunwind::trace\r\n                        at /home/jenkins/.cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.2.3/src/backtrace/libunwind.rs:54\r\n                         - backtrace::backtrace::trace<closure>\r\n                        at /home/jenkins/.cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.2.3/src/backtrace/mod.rs:70\r\n   1:     0x7f1f0ef91e53 - backtrace::capture::{{impl}}::new\r\n                        at /home/jenkins/.target/release/build/backtrace-811cded9ab5b8ade/out/capture.rs:79\r\n   2:     0x7f1f0ea3f3a7 - tikv::util::panic_hook::set_exit_hook::{{closure}}\r\n                        at /home/jenkins/workspace/TIKV_POST_COMMIT_FLOW/go/src/github.com/pingcap/tikv/src/util/panic_hook.rs:84\r\n   3:     0x7f1f0f0788e8 - std::panicking::rust_panic_with_hook\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:546\r\n   4:     0x7f1f0f078764 - std::panicking::begin_panic<collections::string::String>\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:507\r\n   5:     0x7f1f0f0786d9 - std::panicking::begin_panic_fmt\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:491\r\n   6:     0x7f1f0f078667 - std::panicking::rust_begin_panic\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:467\r\n   7:     0x7f1f0f0a59dd - core::panicking::panic_fmt\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libcore/panicking.rs:69\r\n   8:     0x7f1f0e948aff - core::result::unwrap_failed<std::io::error::Error>\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libcore/macros.rs:29\r\n   9:     0x7f1f0e9cf74c - core::result::{{impl}}::unwrap<std::fs::File,std::io::error::Error>\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libcore/result.rs:745\r\n                         - tikv_server::run_raft_server\r\n                        at /home/jenkins/workspace/TIKV_POST_COMMIT_FLOW/go/src/github.com/pingcap/tikv/src/bin/tikv-server.rs:719\r\n  10:     0x7f1f0e9d7e40 - tikv_server::main\r\n                        at /home/jenkins/workspace/TIKV_POST_COMMIT_FLOW/go/src/github.com/pingcap/tikv/src/bin/tikv-server.rs:875\r\n  11:     0x7f1f0f07fa7a - panic_unwind::__rust_maybe_catch_panic\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libpanic_unwind/lib.rs:98\r\n  12:     0x7f1f0f079086 - std::panicking::try<(),fn()>\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panicking.rs:429\r\n                         - std::panic::catch_unwind<fn(),()>\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/panic.rs:361\r\n                         - std::rt::lang_start\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libstd/rt.rs:57\r\n  13:     0x7f1f0d9ba874 - __libc_start_main\r\n  14:     0x7f1f0e8e802d - <unknown>\r\n  15:                0x0 - <unknown>\r\n```\r\n",
  "closed_at": "2017-04-06T07:29:34Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/878009?v=4",
    "events_url": "https://api.github.com/users/ngaut/events{/privacy}",
    "followers_url": "https://api.github.com/users/ngaut/followers",
    "following_url": "https://api.github.com/users/ngaut/following{/other_user}",
    "gists_url": "https://api.github.com/users/ngaut/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ngaut",
    "id": 878009,
    "login": "ngaut",
    "node_id": "MDQ6VXNlcjg3ODAwOQ==",
    "organizations_url": "https://api.github.com/users/ngaut/orgs",
    "received_events_url": "https://api.github.com/users/ngaut/received_events",
    "repos_url": "https://api.github.com/users/ngaut/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ngaut/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ngaut/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ngaut"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/tikv/tikv/issues/1674/comments",
  "created_at": "2017-03-09T05:51:25Z",
  "events_url": "https://api.github.com/repos/tikv/tikv/issues/1674/events",
  "html_url": "https://github.com/tikv/tikv/issues/1674",
  "id": 212941740,
  "labels": [
    {
      "color": "1d76db",
      "default": false,
      "description": "Type: Issue - Confirmed a bug",
      "id": 305526945,
      "name": "type/bug",
      "node_id": "MDU6TGFiZWwzMDU1MjY5NDU=",
      "url": "https://api.github.com/repos/tikv/tikv/labels/type/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/tikv/tikv/issues/1674/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMTI5NDE3NDA=",
  "number": 1674,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/tikv/tikv",
  "state": "closed",
  "title": "tikv cluster restart failed with opaque error",
  "updated_at": "2018-08-07T00:46:35Z",
  "url": "https://api.github.com/repos/tikv/tikv/issues/1674",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/694276?v=4",
    "events_url": "https://api.github.com/users/kaiwu/events{/privacy}",
    "followers_url": "https://api.github.com/users/kaiwu/followers",
    "following_url": "https://api.github.com/users/kaiwu/following{/other_user}",
    "gists_url": "https://api.github.com/users/kaiwu/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/kaiwu",
    "id": 694276,
    "login": "kaiwu",
    "node_id": "MDQ6VXNlcjY5NDI3Ng==",
    "organizations_url": "https://api.github.com/users/kaiwu/orgs",
    "received_events_url": "https://api.github.com/users/kaiwu/received_events",
    "repos_url": "https://api.github.com/users/kaiwu/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/kaiwu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kaiwu/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/kaiwu"
  }
}