{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "Hi,\r\n\r\nThis grpc server will improperly schedule `SnapTask::Close()` to Snapshot Receiver in `server` layer, in code \r\n\r\nhttps://github.com/pingcap/tikv/blob/3050fef8565787a655e30de503b49149435fdeab/src/server/grpc_service.rs#L645\r\n\r\nIt should schedule `SnapTask::Discard()` in this case, so that the partly received snapshot could be discarded and deleted.\r\n\r\nBecause the snapshot V1 implementation reply on the completeness of the snapshot transferring stream. It doesn't check the received length when it calls `save()` on the handling of `SnapTask::Close()`. So in a cluster that runs the code in `branch master, tag 3050fef8565787a655e30de503b49149435fdeab`, which use snapshot V1 by default, if the leader crashes when it transferring the snapshot to followers, the followers would receive and apply a truncated snapshot, and then panic on applying a malformed snapshot.",
  "closed_at": "2017-06-10T02:34:43Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/12077877?v=4",
    "events_url": "https://api.github.com/users/disksing/events{/privacy}",
    "followers_url": "https://api.github.com/users/disksing/followers",
    "following_url": "https://api.github.com/users/disksing/following{/other_user}",
    "gists_url": "https://api.github.com/users/disksing/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/disksing",
    "id": 12077877,
    "login": "disksing",
    "node_id": "MDQ6VXNlcjEyMDc3ODc3",
    "organizations_url": "https://api.github.com/users/disksing/orgs",
    "received_events_url": "https://api.github.com/users/disksing/received_events",
    "repos_url": "https://api.github.com/users/disksing/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/disksing/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/disksing/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/disksing"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/tikv/tikv/issues/1907/comments",
  "created_at": "2017-06-08T12:26:01Z",
  "events_url": "https://api.github.com/repos/tikv/tikv/issues/1907/events",
  "html_url": "https://github.com/tikv/tikv/issues/1907",
  "id": 234509969,
  "labels": [
    {
      "color": "1d76db",
      "default": false,
      "description": "Type: Issue - Confirmed a bug",
      "id": 305526945,
      "name": "type/bug",
      "node_id": "MDU6TGFiZWwzMDU1MjY5NDU=",
      "url": "https://api.github.com/repos/tikv/tikv/labels/type/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/tikv/tikv/issues/1907/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMzQ1MDk5Njk=",
  "number": 1907,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/tikv/tikv",
  "state": "closed",
  "title": "Snapshot truncated if leader crashes during snapshot transferring",
  "updated_at": "2018-08-07T00:46:47Z",
  "url": "https://api.github.com/repos/tikv/tikv/issues/1907",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1933824?v=4",
    "events_url": "https://api.github.com/users/hhkbp2/events{/privacy}",
    "followers_url": "https://api.github.com/users/hhkbp2/followers",
    "following_url": "https://api.github.com/users/hhkbp2/following{/other_user}",
    "gists_url": "https://api.github.com/users/hhkbp2/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/hhkbp2",
    "id": 1933824,
    "login": "hhkbp2",
    "node_id": "MDQ6VXNlcjE5MzM4MjQ=",
    "organizations_url": "https://api.github.com/users/hhkbp2/orgs",
    "received_events_url": "https://api.github.com/users/hhkbp2/received_events",
    "repos_url": "https://api.github.com/users/hhkbp2/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/hhkbp2/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hhkbp2/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/hhkbp2"
  }
}