{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1701473?v=4",
    "events_url": "https://api.github.com/users/BusyJay/events{/privacy}",
    "followers_url": "https://api.github.com/users/BusyJay/followers",
    "following_url": "https://api.github.com/users/BusyJay/following{/other_user}",
    "gists_url": "https://api.github.com/users/BusyJay/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/BusyJay",
    "id": 1701473,
    "login": "BusyJay",
    "node_id": "MDQ6VXNlcjE3MDE0NzM=",
    "organizations_url": "https://api.github.com/users/BusyJay/orgs",
    "received_events_url": "https://api.github.com/users/BusyJay/received_events",
    "repos_url": "https://api.github.com/users/BusyJay/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/BusyJay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/BusyJay/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/BusyJay"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/1701473?v=4",
      "events_url": "https://api.github.com/users/BusyJay/events{/privacy}",
      "followers_url": "https://api.github.com/users/BusyJay/followers",
      "following_url": "https://api.github.com/users/BusyJay/following{/other_user}",
      "gists_url": "https://api.github.com/users/BusyJay/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BusyJay",
      "id": 1701473,
      "login": "BusyJay",
      "node_id": "MDQ6VXNlcjE3MDE0NzM=",
      "organizations_url": "https://api.github.com/users/BusyJay/orgs",
      "received_events_url": "https://api.github.com/users/BusyJay/received_events",
      "repos_url": "https://api.github.com/users/BusyJay/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BusyJay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BusyJay/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BusyJay"
    },
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/18193301?v=4",
      "events_url": "https://api.github.com/users/hunterlxt/events{/privacy}",
      "followers_url": "https://api.github.com/users/hunterlxt/followers",
      "following_url": "https://api.github.com/users/hunterlxt/following{/other_user}",
      "gists_url": "https://api.github.com/users/hunterlxt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/hunterlxt",
      "id": 18193301,
      "login": "hunterlxt",
      "node_id": "MDQ6VXNlcjE4MTkzMzAx",
      "organizations_url": "https://api.github.com/users/hunterlxt/orgs",
      "received_events_url": "https://api.github.com/users/hunterlxt/received_events",
      "repos_url": "https://api.github.com/users/hunterlxt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/hunterlxt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hunterlxt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/hunterlxt"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "When adding a new peer, logs shows that it takes at least 6 seconds.\r\n```\r\n[2020/01/06 17:45:41.648 +08:00] [INFO] [pd.rs:680] [\"try to change peer\"] [peer=\"id: 5 store_id: 4 is_learner: true\"] [change_type=AddLearnerNode] [region_id=2\r\n]\r\n[2020/01/06 17:45:41.648 +08:00] [INFO] [peer.rs:2339] [\"propose conf change peer\"] [change_peer=5] [change_type=AddLearnerNode] [peer_id=3] [region_id=2]\r\n[2020/01/06 17:45:41.744 +08:00] [INFO] [apply.rs:1052] [\"execute admin command\"] [command=\"cmd_type: ChangePeer change_peer { change_type: AddLearnerNode peer \r\n{ id: 5 store_id: 4 is_learner: true } }\"] [index=7] [term=6] [peer_id=3] [region_id=2]\r\n[2020/01/06 17:45:41.744 +08:00] [INFO] [apply.rs:1384] [\"exec ConfChange\"] [epoch=\"conf_ver: 1 version: 1\"] [type=AddLearner] [peer_id=3] [region_id=2]\r\n[2020/01/06 17:45:41.744 +08:00] [INFO] [apply.rs:1524] [\"add learner successfully\"] [region=\"id: 2 region_epoch { conf_ver: 1 version: 1 } peers { id: 3 store_\r\nid: 1 }\"] [peer=\"id: 5 store_id: 4 is_learner: true\"] [peer_id=3] [region_id=2]\r\n[2020/01/06 17:45:41.758 +08:00] [INFO] [peer.rs:1504] [\"notify pd with change peer region\"] [region=\"id: 2 region_epoch { conf_ver: 2 version: 1 } peers { id: 3 store_id: 1 } peers { id: 5 store_id: 4 is_learner: true }\"] [peer_id=3] [region_id=2]\r\n[2020/01/06 17:45:43.651 +08:00] [INFO] [transport.rs:144] [\"resolve store address ok\"] [addr=127.0.0.1:4570] [store_id=4]\r\n[2020/01/06 17:45:43.652 +08:00] [INFO] [raft_client.rs:48] [\"server: new connection with tikv endpoint\"] [addr=127.0.0.1:4570]\r\n[2020/01/06 17:45:43.653 +08:00] [INFO] [<unknown>] [\"New connected subchannel at 0x7f5b60da6050 for subchannel 0x7f5b79ce1000\"]\r\n[2020/01/06 17:45:43.656 +08:00] [INFO] [kv.rs:825] [\"batch_raft RPC is called, new gRPC stream established\"]\r\n[2020/01/06 17:45:43.657 +08:00] [INFO] [peer_storage.rs:794] [\"requesting snapshot\"] [request_index=0] [peer_id=3] [region_id=2]\r\n[2020/01/06 17:45:45.654 +08:00] [INFO] [snap.rs:701] [\"scan snapshot of one cf\"] [size=0] [key_count=0] [cf=default] [snapshot=./snap/gen_2_6_7_(default|lock|write).sst] [region_id=2]\r\n[2020/01/06 17:45:45.654 +08:00] [INFO] [snap.rs:701] [\"scan snapshot of one cf\"] [size=0] [key_count=0] [cf=lock] [snapshot=./snap/gen_2_6_7_(default|lock|write).sst] [region_id=2]\r\n[2020/01/06 17:45:45.654 +08:00] [INFO] [snap.rs:701] [\"scan snapshot of one cf\"] [size=0] [key_count=0] [cf=write] [snapshot=./snap/gen_2_6_7_(default|lock|write).sst] [region_id=2]\r\n[2020/01/06 17:45:45.757 +08:00] [INFO] [snap.rs:755] [\"scan snapshot\"] [takes=104.491078ms] [size=0] [key_count=0] [snapshot=./snap/gen_2_6_7_(default|lock|write).sst] [region_id=2]\r\n[2020/01/06 17:45:47.657 +08:00] [INFO] [<unknown>] [\"New connected subchannel at 0x7f5b7e40c0d0 for subchannel 0x7f5b79821600\"]\r\n[2020/01/06 17:45:47.667 +08:00] [INFO] [snap.rs:385] [\"sent snapshot\"] [duration=11.204351ms] [size=0] [snap_key=2_6_7] [region_id=2]\r\n[2020/01/06 17:45:47.667 +08:00] [INFO] [peer.rs:603] [\"report snapshot status\"] [status=Finish] [to=\"id: 5 store_id: 4 is_learner: true\"] [peer_id=3] [region_id=2]\r\n```\r\nIt takes 2 seconds to request snapshot after editing the metadata, and then takes another 2 seconds to actually generating a snapshot, finally another 2 seconds to send out a snapshot.\r\n\r\nRaft will only send a snapshot after a MsgAppend rejection, which is triggered by a heartbeat. That's where the first 2 seconds takes. Generating snapshot task will be sent to apply worker only when there is readiness, another 2 seconds, which is next heartbeat. Generated snapshot will be sent out only after leader finds the follower still needs the snapshot, the third heartbeat, 2 seconds.",
  "closed_at": null,
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/29268173?v=4",
    "events_url": "https://api.github.com/users/sre-bot/events{/privacy}",
    "followers_url": "https://api.github.com/users/sre-bot/followers",
    "following_url": "https://api.github.com/users/sre-bot/following{/other_user}",
    "gists_url": "https://api.github.com/users/sre-bot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sre-bot",
    "id": 29268173,
    "login": "sre-bot",
    "node_id": "MDQ6VXNlcjI5MjY4MTcz",
    "organizations_url": "https://api.github.com/users/sre-bot/orgs",
    "received_events_url": "https://api.github.com/users/sre-bot/received_events",
    "repos_url": "https://api.github.com/users/sre-bot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sre-bot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sre-bot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sre-bot"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/tikv/tikv/issues/6420/comments",
  "created_at": "2020-01-06T09:54:34Z",
  "events_url": "https://api.github.com/repos/tikv/tikv/issues/6420/events",
  "html_url": "https://github.com/tikv/tikv/issues/6420",
  "id": 545638469,
  "labels": [
    {
      "color": "eeee00",
      "default": false,
      "description": "Priority: Low",
      "id": 1353893530,
      "name": "priority/low",
      "node_id": "MDU6TGFiZWwxMzUzODkzNTMw",
      "url": "https://api.github.com/repos/tikv/tikv/labels/priority/low"
    },
    {
      "color": "ededed",
      "default": false,
      "description": null,
      "id": 2265309564,
      "name": "severity/Minor",
      "node_id": "MDU6TGFiZWwyMjY1MzA5NTY0",
      "url": "https://api.github.com/repos/tikv/tikv/labels/severity/Minor"
    },
    {
      "color": "d12e67",
      "default": false,
      "description": "Component: Raft, RaftStore, etc.",
      "id": 429262718,
      "name": "sig/raft",
      "node_id": "MDU6TGFiZWw0MjkyNjI3MTg=",
      "url": "https://api.github.com/repos/tikv/tikv/labels/sig/raft"
    },
    {
      "color": "1d76db",
      "default": false,
      "description": "Type: Issue - Confirmed a bug",
      "id": 305526945,
      "name": "type/bug",
      "node_id": "MDU6TGFiZWwzMDU1MjY5NDU=",
      "url": "https://api.github.com/repos/tikv/tikv/labels/type/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/tikv/tikv/issues/6420/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1NDU2Mzg0Njk=",
  "number": 6420,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/tikv/tikv",
  "state": "open",
  "title": "Conf change is too slow",
  "updated_at": "2020-09-28T08:35:27Z",
  "url": "https://api.github.com/repos/tikv/tikv/issues/6420",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1701473?v=4",
    "events_url": "https://api.github.com/users/BusyJay/events{/privacy}",
    "followers_url": "https://api.github.com/users/BusyJay/followers",
    "following_url": "https://api.github.com/users/BusyJay/following{/other_user}",
    "gists_url": "https://api.github.com/users/BusyJay/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/BusyJay",
    "id": 1701473,
    "login": "BusyJay",
    "node_id": "MDQ6VXNlcjE3MDE0NzM=",
    "organizations_url": "https://api.github.com/users/BusyJay/orgs",
    "received_events_url": "https://api.github.com/users/BusyJay/received_events",
    "repos_url": "https://api.github.com/users/BusyJay/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/BusyJay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/BusyJay/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/BusyJay"
  }
}