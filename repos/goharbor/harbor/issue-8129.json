{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**Expected behavior and actual behavior:**\r\nUnable to install Harbor with Docker SELinux enabled\r\n\r\n**Steps to reproduce the problem:**\r\n\r\n1. Enable Docker SELinux `/usr/bin/dockerd --selinux-enabled=true -H fd:// --containerd=/run/containerd/containerd.sock`\r\n2. Restart docker\r\n3. Run installer\r\n```\r\n[root@harbor1 harbor]# ./install.sh\r\n\r\n[Step 0]: checking installation environment ...\r\n\r\nNote: docker-compose version: 1.24.0\r\n\r\nNote: docker version: 18.09.6\r\n\r\n\r\n[Step 1]: preparing environment ...\r\nprepare base dir is set to /data/harbor-install/harbor\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 62, in <module>\r\n    main()\r\n  File \"/usr/lib/python3.6/site-packages/click/core.py\", line 764, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/usr/lib/python3.6/site-packages/click/core.py\", line 717, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/usr/lib/python3.6/site-packages/click/core.py\", line 956, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/usr/lib/python3.6/site-packages/click/core.py\", line 555, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"main.py\", line 30, in main\r\n    delfile(config_dir)\r\n  File \"/usr/src/app/utils/misc.py\", line 96, in delfile\r\n    for item in os.listdir(src):\r\nPermissionError: [Errno 13] Permission denied: '/config'\r\n```\r\n\r\n**Versions:**\r\nPlease specify the versions of following systems.\r\n- harbor version: 1.8.1\r\n- docker engine version: 18.09.6\r\n- docker-compose version: 1.24.0\r\n\r\n**Additional context:**\r\n\r\nCan be fixed by adding `:z` at the end of each volume mount inside the `prepare` bash script:\r\n\r\n```\r\ndocker run --rm -v $input_dir:/input:z \\\r\n                    -v $harbor_prepare_path:/compose_location:z \\\r\n                    -v $config_dir:/config:z \\\r\n                    -v $secret_dir:/secret:z \\\r\n                    goharbor/prepare:v1.8.1 $@\r\n```\r\n",
  "closed_at": "2019-07-15T05:48:25Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/16573984?v=4",
    "events_url": "https://api.github.com/users/cd1989/events{/privacy}",
    "followers_url": "https://api.github.com/users/cd1989/followers",
    "following_url": "https://api.github.com/users/cd1989/following{/other_user}",
    "gists_url": "https://api.github.com/users/cd1989/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/cd1989",
    "id": 16573984,
    "login": "cd1989",
    "node_id": "MDQ6VXNlcjE2NTczOTg0",
    "organizations_url": "https://api.github.com/users/cd1989/orgs",
    "received_events_url": "https://api.github.com/users/cd1989/received_events",
    "repos_url": "https://api.github.com/users/cd1989/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/cd1989/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cd1989/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/cd1989"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/goharbor/harbor/issues/8129/comments",
  "created_at": "2019-06-24T13:41:30Z",
  "events_url": "https://api.github.com/repos/goharbor/harbor/issues/8129/events",
  "html_url": "https://github.com/goharbor/harbor/issues/8129",
  "id": 459898975,
  "labels": [],
  "labels_url": "https://api.github.com/repos/goharbor/harbor/issues/8129/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NTk4OTg5NzU=",
  "number": 8129,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/goharbor/harbor",
  "state": "closed",
  "title": "Unable to install Harbor with Docker SELinux enabled",
  "updated_at": "2019-07-15T05:48:25Z",
  "url": "https://api.github.com/repos/goharbor/harbor/issues/8129",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/26540376?v=4",
    "events_url": "https://api.github.com/users/rvanbutselaar/events{/privacy}",
    "followers_url": "https://api.github.com/users/rvanbutselaar/followers",
    "following_url": "https://api.github.com/users/rvanbutselaar/following{/other_user}",
    "gists_url": "https://api.github.com/users/rvanbutselaar/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/rvanbutselaar",
    "id": 26540376,
    "login": "rvanbutselaar",
    "node_id": "MDQ6VXNlcjI2NTQwMzc2",
    "organizations_url": "https://api.github.com/users/rvanbutselaar/orgs",
    "received_events_url": "https://api.github.com/users/rvanbutselaar/received_events",
    "repos_url": "https://api.github.com/users/rvanbutselaar/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/rvanbutselaar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rvanbutselaar/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/rvanbutselaar"
  }
}