{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/2696760?v=4",
    "events_url": "https://api.github.com/users/stonezdj/events{/privacy}",
    "followers_url": "https://api.github.com/users/stonezdj/followers",
    "following_url": "https://api.github.com/users/stonezdj/following{/other_user}",
    "gists_url": "https://api.github.com/users/stonezdj/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/stonezdj",
    "id": 2696760,
    "login": "stonezdj",
    "node_id": "MDQ6VXNlcjI2OTY3NjA=",
    "organizations_url": "https://api.github.com/users/stonezdj/orgs",
    "received_events_url": "https://api.github.com/users/stonezdj/received_events",
    "repos_url": "https://api.github.com/users/stonezdj/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/stonezdj/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stonezdj/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/stonezdj"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/2696760?v=4",
      "events_url": "https://api.github.com/users/stonezdj/events{/privacy}",
      "followers_url": "https://api.github.com/users/stonezdj/followers",
      "following_url": "https://api.github.com/users/stonezdj/following{/other_user}",
      "gists_url": "https://api.github.com/users/stonezdj/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/stonezdj",
      "id": 2696760,
      "login": "stonezdj",
      "node_id": "MDQ6VXNlcjI2OTY3NjA=",
      "organizations_url": "https://api.github.com/users/stonezdj/orgs",
      "received_events_url": "https://api.github.com/users/stonezdj/received_events",
      "repos_url": "https://api.github.com/users/stonezdj/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/stonezdj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stonezdj/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/stonezdj"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**Expected behavior and actual behavior:**\r\nWhen a user authenticates against Harbor LDAP backend, one expects Harbor to lookup the associated LDAP groups and create entries for each, based on the filtering and naming configured through:\r\n\r\n-   ldap_group_attribute_name\r\n-   ldap_group_base_dn\r\n-   ldap_group_search_filter\r\n\r\n\r\nWhat actually happens is that Harbor ignores the `ldap_group_base_dn`; the `ldap_group_search_filter` and creates all of the groups associated with the user in the database. It also sets the group names to that of the DN attribute and not what is specified through `ldap_group_attribute_name`.\r\n\r\n**Steps to reproduce the problem:**\r\n\r\n1.  Set LDAP Group configurations to:\r\n```yaml\r\n  \"ldap_group_attribute_name\": \"cn\",\r\n  \"ldap_group_base_dn\": \"OU=Containers,OU=Resources,DC=redacted,DC=com\",\r\n  \"ldap_group_search_filter\": \"(&(objectclass=group)(cn=APR_CONTAINERS*))\",\r\n```\r\n\r\n2. Authenticate a user\r\n\r\n3. Review created group entries.\r\n```shell\r\nregistry=# select * from user_group;\r\n id  |                                      group_name                                       | group_type |                                     ldap_group_dn                                     |       creation_time        |        update_time         \r\n-----+---------------------------------------------------------------------------------------+------------+---------------------------------------------------------------------------------------+----------------------------+----------------------------\r\n 540 | CN=APR_CyberArk_TSHypervisorServices,OU=CyberArk,OU=Resources,DC=redacted,DC=com          |          1 | cn=apr_cyberark_tshypervisorservices,ou=cyberark,ou=resources,dc=redacted,dc=com          | 2020-07-28 19:11:25.723819 | 2020-07-28 19:11:25.723819\r\n 541 | CN=APR_CyberArk_TSHypervisorServicesApproval,OU=CyberArk,OU=Resources,DC=redacted,DC=com  |          1 | cn=apr_cyberark_tshypervisorservicesapproval,ou=cyberark,ou=resources,dc=redacted,dc=com  | 2020-07-28 19:11:25.725605 | 2020-07-28 19:11:25.725605\r\n```\r\n\r\nA. Based on search filter and base DN neither of the above groups should have been created. \r\nB. Had they matched the filter and base DN, they should have been created with the CN value, not the DN value.\r\n\r\n\r\n**Versions:**\r\nPlease specify the versions of following systems.\r\n- harbor version: [2.0.1]",
  "closed_at": "2020-09-09T08:21:02Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/2696760?v=4",
    "events_url": "https://api.github.com/users/stonezdj/events{/privacy}",
    "followers_url": "https://api.github.com/users/stonezdj/followers",
    "following_url": "https://api.github.com/users/stonezdj/following{/other_user}",
    "gists_url": "https://api.github.com/users/stonezdj/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/stonezdj",
    "id": 2696760,
    "login": "stonezdj",
    "node_id": "MDQ6VXNlcjI2OTY3NjA=",
    "organizations_url": "https://api.github.com/users/stonezdj/orgs",
    "received_events_url": "https://api.github.com/users/stonezdj/received_events",
    "repos_url": "https://api.github.com/users/stonezdj/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/stonezdj/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stonezdj/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/stonezdj"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/goharbor/harbor/issues/12613/comments",
  "created_at": "2020-07-28T19:37:28Z",
  "events_url": "https://api.github.com/repos/goharbor/harbor/issues/12613/events",
  "html_url": "https://github.com/goharbor/harbor/issues/12613",
  "id": 667320999,
  "labels": [
    {
      "color": "fc2929",
      "default": false,
      "description": null,
      "id": 318193281,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzMTgxOTMyODE=",
      "url": "https://api.github.com/repos/goharbor/harbor/labels/kind/bug"
    },
    {
      "color": "d93f0b",
      "default": false,
      "description": "",
      "id": 2252244926,
      "name": "target/2.0.3",
      "node_id": "MDU6TGFiZWwyMjUyMjQ0OTI2",
      "url": "https://api.github.com/repos/goharbor/harbor/labels/target/2.0.3"
    },
    {
      "color": "d93f0b",
      "default": false,
      "description": "",
      "id": 1906209670,
      "name": "target/2.1.0",
      "node_id": "MDU6TGFiZWwxOTA2MjA5Njcw",
      "url": "https://api.github.com/repos/goharbor/harbor/labels/target/2.1.0"
    }
  ],
  "labels_url": "https://api.github.com/repos/goharbor/harbor/issues/12613/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2NjczMjA5OTk=",
  "number": 12613,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/goharbor/harbor",
  "state": "closed",
  "title": "LDAP Group Filter and Group Base DN have no affect",
  "updated_at": "2020-09-21T19:11:44Z",
  "url": "https://api.github.com/repos/goharbor/harbor/issues/12613",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/24388819?v=4",
    "events_url": "https://api.github.com/users/MnrGreg/events{/privacy}",
    "followers_url": "https://api.github.com/users/MnrGreg/followers",
    "following_url": "https://api.github.com/users/MnrGreg/following{/other_user}",
    "gists_url": "https://api.github.com/users/MnrGreg/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/MnrGreg",
    "id": 24388819,
    "login": "MnrGreg",
    "node_id": "MDQ6VXNlcjI0Mzg4ODE5",
    "organizations_url": "https://api.github.com/users/MnrGreg/orgs",
    "received_events_url": "https://api.github.com/users/MnrGreg/received_events",
    "repos_url": "https://api.github.com/users/MnrGreg/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/MnrGreg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MnrGreg/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/MnrGreg"
  }
}