{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**Describe the bug**\r\nPresent shutdown sequence calls of collector service is as follows\r\n`servers -> writers -> collector_queue_processors(with drain)\r\n`\r\n\r\nFirst closing storage writers and then draining the collector queue. Which resulting in collector accepting spans until the writers close operation done. \r\nWhile draining collector queue on issue of collector close operation, collector is trying to write spans to storage since the writer is closed first it resulting in panic and leads to span loss.\r\n<img width=\"1440\" alt=\"send on closed channel\" src=\"https://user-images.githubusercontent.com/20114703/89755102-e1e8d380-dafb-11ea-9023-daabaa62c4fc.png\">\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Continuously generate a high volume of traffic to collector service\r\n2. Stop the collector service process by CTRL + C or soft kill the process.\r\n3. We can see a panic with error message Send on closed channel and process exit in collector logs\r\n\r\n**Expected behavior**\r\nIdeal shutdown sequence order should be as follows\r\n`servers -> queue processors (with drain) -> writers\r\n`\r\n\r\n",
  "closed_at": "2020-08-11T08:10:57Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/13387?v=4",
    "events_url": "https://api.github.com/users/jpkrohling/events{/privacy}",
    "followers_url": "https://api.github.com/users/jpkrohling/followers",
    "following_url": "https://api.github.com/users/jpkrohling/following{/other_user}",
    "gists_url": "https://api.github.com/users/jpkrohling/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jpkrohling",
    "id": 13387,
    "login": "jpkrohling",
    "node_id": "MDQ6VXNlcjEzMzg3",
    "organizations_url": "https://api.github.com/users/jpkrohling/orgs",
    "received_events_url": "https://api.github.com/users/jpkrohling/received_events",
    "repos_url": "https://api.github.com/users/jpkrohling/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jpkrohling/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jpkrohling/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jpkrohling"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/jaegertracing/jaeger/issues/2379/comments",
  "created_at": "2020-08-10T05:55:39Z",
  "events_url": "https://api.github.com/repos/jaegertracing/jaeger/issues/2379/events",
  "html_url": "https://github.com/jaegertracing/jaeger/issues/2379",
  "id": 675884072,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 358839838,
      "name": "bug",
      "node_id": "MDU6TGFiZWwzNTg4Mzk4Mzg=",
      "url": "https://api.github.com/repos/jaegertracing/jaeger/labels/bug"
    },
    {
      "color": "ededed",
      "default": false,
      "description": null,
      "id": 1740680315,
      "name": "needs-triage",
      "node_id": "MDU6TGFiZWwxNzQwNjgwMzE1",
      "url": "https://api.github.com/repos/jaegertracing/jaeger/labels/needs-triage"
    }
  ],
  "labels_url": "https://api.github.com/repos/jaegertracing/jaeger/issues/2379/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2NzU4ODQwNzI=",
  "number": 2379,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/jaegertracing/jaeger",
  "state": "closed",
  "title": "Collector: Sequence of shutdown calls resulting in crash due to panic and leads to span loss",
  "updated_at": "2020-08-11T08:10:57Z",
  "url": "https://api.github.com/repos/jaegertracing/jaeger/issues/2379",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/20114703?v=4",
    "events_url": "https://api.github.com/users/Sreevani871/events{/privacy}",
    "followers_url": "https://api.github.com/users/Sreevani871/followers",
    "following_url": "https://api.github.com/users/Sreevani871/following{/other_user}",
    "gists_url": "https://api.github.com/users/Sreevani871/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/Sreevani871",
    "id": 20114703,
    "login": "Sreevani871",
    "node_id": "MDQ6VXNlcjIwMTE0NzAz",
    "organizations_url": "https://api.github.com/users/Sreevani871/orgs",
    "received_events_url": "https://api.github.com/users/Sreevani871/received_events",
    "repos_url": "https://api.github.com/users/Sreevani871/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/Sreevani871/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Sreevani871/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/Sreevani871"
  }
}