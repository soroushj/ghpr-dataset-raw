{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!--\r\nWelcome to the Jaeger project! \ud83d\udc4b\ud83c\udf89\r\n\r\n- Please search for existing issues to avoid creating duplicate bugs/feature requests.\r\n- Please be respectful and considerate of others when commenting on issues.\r\n- Please provide as much information as possible so we all understand the issue.\r\n- If you only have a question, you may get a faster response by asking in\r\n    - our chat room https://gitter.im/jaegertracing/Lobby, or\r\n    - the forum https://groups.google.com/d/forum/jaeger-tracing\r\n    (but please don't double post)\r\n-->\r\n\r\n## Requirement - what kind of business use case are you trying to solve?\r\n\r\nWe limit the number of results returned from Elasticsearch (ES) from user queries to prevent large queries from negatively impacting the ES cluster. With ES as our Jaeger backing store, we also need to ensure jaeger-query -> ES requests abide by these limits, ideally as a configurable parameter.\r\n\r\n## Problem - what in Jaeger blocks you from solving the requirement?\r\n\r\nCurrently, `defaultDocCount` is applied to the ES query's `size` attribute and I was not able to find a means of overriding this value. Examples:\r\n\r\nhttps://github.com/jaegertracing/jaeger/search?q=defaultDocCount&unscoped_q=defaultDocCount\r\n\r\nIn some cases, this value is hard-coded directly instead of using the const:\r\nhttps://github.com/jaegertracing/jaeger/blob/3f6f3a736a8feee40939ba316e7481cb1ba45f04/plugin/storage/es/dependencystore/storage.go#L87\r\n\r\nResulting in the need for less desirable workarounds to ensure requests from jaeger-query to ES set the appropriate result size limit.\r\n\r\n## Proposal - what do you suggest to solve the problem or improve the existing situation?\r\n\r\nIntroduce a new integer flag, perhaps `es.doc-count` (`ES_DOC_COUNT` env var) for consistency, that represents an override to the 10000 `defaultDocCount` const. Open to suggestions on better parameter names as well. \r\n\r\n## Any open questions to address\r\n\r\n- Given 10,000 is applied across [service](https://github.com/jaegertracing/jaeger/blob/5ed586c114152dfdb9f9643b9303fd40d45cc6e5/plugin/storage/es/spanstore/service_operation.go#L106)/[operation](https://github.com/jaegertracing/jaeger/blob/5ed586c114152dfdb9f9643b9303fd40d45cc6e5/plugin/storage/es/spanstore/service_operation.go#L137) aggregations and [dependency store](https://github.com/jaegertracing/jaeger/blob/3f6f3a736a8feee40939ba316e7481cb1ba45f04/plugin/storage/es/dependencystore/storage.go#L87) (and also in OTEL), does it make sense to have the one configurable variable in all these places? Or should we separate, aggregation and dependency store doc counts?\r\n\r\n- The `es.max-num-spans` (used [here](https://github.com/jaegertracing/jaeger/search?q=maxnumspans&unscoped_q=maxnumspans)) also defaults to a value of 10,000. Please let me know if there is any desire to consolidate this flag with the proposed `es.doc-count`.",
  "closed_at": "2020-09-05T13:23:07Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5618424?v=4",
    "events_url": "https://api.github.com/users/pavolloffay/events{/privacy}",
    "followers_url": "https://api.github.com/users/pavolloffay/followers",
    "following_url": "https://api.github.com/users/pavolloffay/following{/other_user}",
    "gists_url": "https://api.github.com/users/pavolloffay/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/pavolloffay",
    "id": 5618424,
    "login": "pavolloffay",
    "node_id": "MDQ6VXNlcjU2MTg0MjQ=",
    "organizations_url": "https://api.github.com/users/pavolloffay/orgs",
    "received_events_url": "https://api.github.com/users/pavolloffay/received_events",
    "repos_url": "https://api.github.com/users/pavolloffay/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/pavolloffay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pavolloffay/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/pavolloffay"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/jaegertracing/jaeger/issues/2437/comments",
  "created_at": "2020-08-31T12:47:50Z",
  "events_url": "https://api.github.com/repos/jaegertracing/jaeger/issues/2437/events",
  "html_url": "https://github.com/jaegertracing/jaeger/issues/2437",
  "id": 689180646,
  "labels": [
    {
      "color": "fbca04",
      "default": false,
      "description": "",
      "id": 1013715498,
      "name": "storage/elasticsearch",
      "node_id": "MDU6TGFiZWwxMDEzNzE1NDk4",
      "url": "https://api.github.com/repos/jaegertracing/jaeger/labels/storage/elasticsearch"
    }
  ],
  "labels_url": "https://api.github.com/repos/jaegertracing/jaeger/issues/2437/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2ODkxODA2NDY=",
  "number": 2437,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/jaegertracing/jaeger",
  "state": "closed",
  "title": "ES: Configurable query result sizes",
  "updated_at": "2020-09-05T13:23:07Z",
  "url": "https://api.github.com/repos/jaegertracing/jaeger/issues/2437",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/26584478?v=4",
    "events_url": "https://api.github.com/users/albertteoh/events{/privacy}",
    "followers_url": "https://api.github.com/users/albertteoh/followers",
    "following_url": "https://api.github.com/users/albertteoh/following{/other_user}",
    "gists_url": "https://api.github.com/users/albertteoh/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/albertteoh",
    "id": 26584478,
    "login": "albertteoh",
    "node_id": "MDQ6VXNlcjI2NTg0NDc4",
    "organizations_url": "https://api.github.com/users/albertteoh/orgs",
    "received_events_url": "https://api.github.com/users/albertteoh/received_events",
    "repos_url": "https://api.github.com/users/albertteoh/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/albertteoh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/albertteoh/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/albertteoh"
  }
}