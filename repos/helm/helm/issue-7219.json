{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "Output of `helm version`:\r\n```\r\n$ helm version\r\nClient: &version.Version{SemVer:\"v2.12.1\", GitCommit:\"02a47c7249b1fc6d8fd3b94e6b4babf9d818144e\", GitTreeState:\"clean\"}\r\nServer: &version.Version{SemVer:\"v2.15.2\", GitCommit:\"8dce272473e5f2a7bf58ce79bb5c3691db54c96b\", GitTreeState:\"dirty\"}\r\n```\r\nOutput of `kubectl version`:\r\n```\r\n$ ./kubectl version\r\nClient Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.1\", GitCommit:\"d647ddbd755faf07169599a625faf302ffc34458\", GitTreeState:\"clean\", BuildDate:\"2019-10-02T17:01:15Z\", GoVersion:\"go1.12.10\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.2\", GitCommit:\"c97fe5036ef3df2967d086711e6c0c405941e14b\", GitTreeState:\"clean\", BuildDate:\"2019-10-15T19:09:08Z\", GoVersion:\"go1.12.10\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\nCloud Provider/Platform (AKS, GKE, Minikube etc.): \r\nminikube\r\n\r\n--------------\r\n\r\nOver the past few months there have been numerous issues opened for this very issue[1] and in the end they were mostly closed as \"working as designed\" / \"this is a k8s problem\". When looking at the k8s issues linked, k8s also seems to be \"working as designed\". \r\n\r\n[1]https://github.com/helm/helm/issues/6583\r\nhttps://github.com/helm/helm/issues/6969\r\n\r\n--------------\r\n\r\nI've been digging through the helm code the past couple days to better understand the problem / try to hack a solution together. My understanding of the problem is (simplified):\r\n\r\n1. Install k8s 1.15\r\n2. helm install a chart w/ deployment @ `apps/v1beta1`\r\n* helm stores these templates in a config map for later operations\r\n3. upgrade k8s to 1.16\r\n* k8s automagically \"upgrades\" the deployment to `apps/v1`\r\n4. Update chart to use `apps/v1`\r\n5. helm upgrade\r\n\r\nThe `helm upgrade` fails as it attempts to create a diff patch from steps 2 to 4. The problem is that helm doesn't know that it's source is no longer valid for the current version of k8s.\r\n\r\nThere have been a number of solutions proposed, but I wonder if there is a k8s API that helm could call to \"upgrade\" the API in the same manner that happens when moving from 1.15 -> 1.16? Perhaps there is a way to do that when calling `BuildUnstructured` ? I'm game for any and all suggestions.\r\n\r\nAnother thought... Perhaps have a new `helm` flag that would force update based off the current template values (put rather than patch). This assume that the new template has a 'valid' api version specified.\r\n\r\nA few other comments:\r\n* Right now I'm talking about deployments, but I'm fairly certain this is a common problem across any number of other apis.\r\n* Destructive operations are a no-go due to use of statefulsets.\r\n* This might be a crappy, but workable workaround[1] ?\r\n\r\n[1] https://github.com/helm/helm/issues/6969#issuecomment-565043434\r\n\r\n\r\n",
  "closed_at": "2020-10-14T21:42:34Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1360539?v=4",
    "events_url": "https://api.github.com/users/bacongobbler/events{/privacy}",
    "followers_url": "https://api.github.com/users/bacongobbler/followers",
    "following_url": "https://api.github.com/users/bacongobbler/following{/other_user}",
    "gists_url": "https://api.github.com/users/bacongobbler/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bacongobbler",
    "id": 1360539,
    "login": "bacongobbler",
    "node_id": "MDQ6VXNlcjEzNjA1Mzk=",
    "organizations_url": "https://api.github.com/users/bacongobbler/orgs",
    "received_events_url": "https://api.github.com/users/bacongobbler/received_events",
    "repos_url": "https://api.github.com/users/bacongobbler/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bacongobbler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bacongobbler/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bacongobbler"
  },
  "comments": 53,
  "comments_url": "https://api.github.com/repos/helm/helm/issues/7219/comments",
  "created_at": "2019-12-12T17:06:44Z",
  "events_url": "https://api.github.com/repos/helm/helm/issues/7219/events",
  "html_url": "https://github.com/helm/helm/issues/7219",
  "id": 537105270,
  "labels": [
    {
      "color": "ededed",
      "default": false,
      "description": null,
      "id": 2290444626,
      "name": "Stale",
      "node_id": "MDU6TGFiZWwyMjkwNDQ0NjI2",
      "url": "https://api.github.com/repos/helm/helm/labels/Stale"
    },
    {
      "color": "e11d21",
      "default": true,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 778135666,
      "name": "bug",
      "node_id": "MDU6TGFiZWw3NzgxMzU2NjY=",
      "url": "https://api.github.com/repos/helm/helm/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/helm/helm/issues/7219/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MzcxMDUyNzA=",
  "number": 7219,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/helm/helm",
  "state": "closed",
  "title": "no matches for kind \"Deployment\" in version \"apps/v1beta1\"",
  "updated_at": "2020-10-14T21:42:34Z",
  "url": "https://api.github.com/repos/helm/helm/issues/7219",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/4132174?v=4",
    "events_url": "https://api.github.com/users/curtisr7/events{/privacy}",
    "followers_url": "https://api.github.com/users/curtisr7/followers",
    "following_url": "https://api.github.com/users/curtisr7/following{/other_user}",
    "gists_url": "https://api.github.com/users/curtisr7/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/curtisr7",
    "id": 4132174,
    "login": "curtisr7",
    "node_id": "MDQ6VXNlcjQxMzIxNzQ=",
    "organizations_url": "https://api.github.com/users/curtisr7/orgs",
    "received_events_url": "https://api.github.com/users/curtisr7/received_events",
    "repos_url": "https://api.github.com/users/curtisr7/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/curtisr7/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/curtisr7/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/curtisr7"
  }
}