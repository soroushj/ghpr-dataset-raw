{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- If you need help or think you have found a bug, please help us with your issue by entering the following information (otherwise you can delete this text): -->\r\n\r\nOutput of `helm version`:\r\n```\r\nClient: &version.Version{SemVer:\"v2.9.0\", GitCommit:\"f6025bb9ee7daf9fee0026541c90a6f557a3e0bc\", GitTreeState:\"clean\"}\r\nServer: &version.Version{SemVer:\"v2.9.0\", GitCommit:\"f6025bb9ee7daf9fee0026541c90a6f557a3e0bc\", GitTreeState:\"clean\"}\r\n```\r\n\r\nOutput of `kubectl version`:\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"10\", GitVersion:\"v1.10.1\", GitCommit:\"d4ab47518836c750f9949b9e0d387f20fb92260b\", GitTreeState:\"clean\", BuildDate:\"2018-04-12T14:26:04Z\", GoVersion:\"go1.9.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"10\", GitVersion:\"v1.10.1\", GitCommit:\"d4ab47518836c750f9949b9e0d387f20fb92260b\", GitTreeState:\"clean\", BuildDate:\"2018-04-12T14:14:26Z\", GoVersion:\"go1.9.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\nCloud Provider/Platform (AKS, GKE, Minikube etc.): bare metal\r\n\r\nInstalling `stable/prometheus` chart is broken on helm `2.9.0`. Works fine in helm `2.8.2`\r\nThe prometheus configMap entry contains broken yaml for the `prometheus.yml` key.\r\n\r\nSpecifically, the `alerting:` section that is added by `templates/server-configmap.yml` is missing a new line and results in the following snippet being generated\r\n\r\n```\r\n      - action: replace\r\n        source_labels:\r\n        - __meta_kubernetes_pod_name\r\n        target_label: kubernetes_pod_namealerting:\r\n      alertmanagers:\r\n      - kubernetes_sd_configs:\r\n```\r\n\r\nwhich should actually be like this\r\n\r\n```\r\n      - action: replace\r\n        source_labels:\r\n        - __meta_kubernetes_pod_name\r\n        target_label: kubernetes_pod_name\r\n    alerting:\r\n      alertmanagers:\r\n      - kubernetes_sd_configs:\r\n```\r\n\r\nPossibly related to #3410 #3470 as referenced in the 2.9.0 release notes\r\n\r\nThis results in the prometheus server pod failing to starts as it complains about malformed yaml as shown below\r\n\r\n```\r\nlevel=error ts=2018-04-27T04:41:05.546416253Z caller=main.go:582 err=\"Error loading config couldn't load configuration (--config.file=/etc/config/prometheus.yml): parsing YAML file /etc/config/prometheus.yml: yaml: line 202: mapping values are not allowed in this context\"\r\nlevel=info ts=2018-04-27T04:41:05.546496152Z caller=main.go:584 msg=\"See you next time!\"\r\n```\r\n",
  "closed_at": "2018-04-30T12:48:11Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1360539?v=4",
    "events_url": "https://api.github.com/users/bacongobbler/events{/privacy}",
    "followers_url": "https://api.github.com/users/bacongobbler/followers",
    "following_url": "https://api.github.com/users/bacongobbler/following{/other_user}",
    "gists_url": "https://api.github.com/users/bacongobbler/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bacongobbler",
    "id": 1360539,
    "login": "bacongobbler",
    "node_id": "MDQ6VXNlcjEzNjA1Mzk=",
    "organizations_url": "https://api.github.com/users/bacongobbler/orgs",
    "received_events_url": "https://api.github.com/users/bacongobbler/received_events",
    "repos_url": "https://api.github.com/users/bacongobbler/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bacongobbler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bacongobbler/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bacongobbler"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/helm/helm/issues/3981/comments",
  "created_at": "2018-04-27T04:45:55Z",
  "events_url": "https://api.github.com/repos/helm/helm/issues/3981/events",
  "html_url": "https://github.com/helm/helm/issues/3981",
  "id": 318276310,
  "labels": [],
  "labels_url": "https://api.github.com/repos/helm/helm/issues/3981/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMTgyNzYzMTA=",
  "number": 3981,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/helm/helm",
  "state": "closed",
  "title": "stable/prometheus broken on helm release 2.9.0",
  "updated_at": "2018-07-18T19:43:50Z",
  "url": "https://api.github.com/repos/helm/helm/issues/3981",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/325982?v=4",
    "events_url": "https://api.github.com/users/georgepapas/events{/privacy}",
    "followers_url": "https://api.github.com/users/georgepapas/followers",
    "following_url": "https://api.github.com/users/georgepapas/following{/other_user}",
    "gists_url": "https://api.github.com/users/georgepapas/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/georgepapas",
    "id": 325982,
    "login": "georgepapas",
    "node_id": "MDQ6VXNlcjMyNTk4Mg==",
    "organizations_url": "https://api.github.com/users/georgepapas/orgs",
    "received_events_url": "https://api.github.com/users/georgepapas/received_events",
    "repos_url": "https://api.github.com/users/georgepapas/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/georgepapas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/georgepapas/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/georgepapas"
  }
}