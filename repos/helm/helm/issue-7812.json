{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/89193?v=4",
    "events_url": "https://api.github.com/users/technosophos/events{/privacy}",
    "followers_url": "https://api.github.com/users/technosophos/followers",
    "following_url": "https://api.github.com/users/technosophos/following{/other_user}",
    "gists_url": "https://api.github.com/users/technosophos/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/technosophos",
    "id": 89193,
    "login": "technosophos",
    "node_id": "MDQ6VXNlcjg5MTkz",
    "organizations_url": "https://api.github.com/users/technosophos/orgs",
    "received_events_url": "https://api.github.com/users/technosophos/received_events",
    "repos_url": "https://api.github.com/users/technosophos/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/technosophos/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/technosophos/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/technosophos"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/89193?v=4",
      "events_url": "https://api.github.com/users/technosophos/events{/privacy}",
      "followers_url": "https://api.github.com/users/technosophos/followers",
      "following_url": "https://api.github.com/users/technosophos/following{/other_user}",
      "gists_url": "https://api.github.com/users/technosophos/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/technosophos",
      "id": 89193,
      "login": "technosophos",
      "node_id": "MDQ6VXNlcjg5MTkz",
      "organizations_url": "https://api.github.com/users/technosophos/orgs",
      "received_events_url": "https://api.github.com/users/technosophos/received_events",
      "repos_url": "https://api.github.com/users/technosophos/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/technosophos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/technosophos/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/technosophos"
    }
  ],
  "author_association": "NONE",
  "body": "Upgrade deployment with Helm 2.16.4 fails:\r\n\r\n```\r\n# helm upgrade fluent-bit clusterrepo/fluent-bit --install --atomic --version 0.4.7 --namespace log -f /etc/kubernetes/helm-values-fluent-bit.yaml \r\nRelease \"fluent-bit\" has been upgraded.\r\nError: transport is closing\r\n```\r\n\r\nThe reason for the closed connection is a segmentation violation in Tiller:\r\n\r\n```\r\n[storage] 2020/03/25 13:14:38 listing all releases with filter\r\n[storage] 2020/03/25 13:14:38 listing all releases with filter\r\n[storage] 2020/03/25 13:14:40 listing all releases with filter\r\n[storage] 2020/03/25 13:14:42 listing all releases with filter\r\n[tiller] 2020/03/25 13:14:44 getting history for release fluent-bit\r\n[storage] 2020/03/25 13:14:44 getting release history for \"fluent-bit\"\r\n[tiller] 2020/03/25 13:14:44 preparing update for fluent-bit\r\n[storage] 2020/03/25 13:14:44 getting deployed releases from \"fluent-bit\" history\r\n[storage] 2020/03/25 13:14:44 getting last revision of \"fluent-bit\"\r\n[storage] 2020/03/25 13:14:44 getting release history for \"fluent-bit\"\r\n[tiller] 2020/03/25 13:14:44 rendering fluent-bit chart using values\r\n2020/03/25 13:14:44 info: manifest \"fluent-bit/templates/psp.yaml\" is empty. Skipping.\r\n[tiller] 2020/03/25 13:14:45 creating updated release for fluent-bit\r\n[storage] 2020/03/25 13:14:45 creating release \"fluent-bit.v12\"\r\n[storage] 2020/03/25 13:14:45 getting release history for \"fluent-bit\"\r\n[storage] 2020/03/25 13:14:45 getting deployed releases from \"fluent-bit\" history\r\n[storage] 2020/03/25 13:14:45 deleting release \"fluent-bit.v2\"\r\n[storage] 2020/03/25 13:14:45 Pruned 1 record(s) from fluent-bit with 0 error(s)\r\n[tiller] 2020/03/25 13:14:45 performing update for fluent-bit\r\n[tiller] 2020/03/25 13:14:45 executing 1 pre-upgrade hooks for fluent-bit\r\n[tiller] 2020/03/25 13:14:45 hooks complete for pre-upgrade fluent-bit\r\n[kube] 2020/03/25 13:14:45 building resources from updated manifest\r\n[kube] 2020/03/25 13:14:45 checking 5 resources for changes\r\n[kube] 2020/03/25 13:14:45 Looks like there are no changes for ConfigMap \"fluent-bit-config\"\r\n[kube] 2020/03/25 13:14:45 Looks like there are no changes for ServiceAccount \"fluent-bit\"\r\n[kube] 2020/03/25 13:14:45 Looks like there are no changes for ClusterRole \"fluent-bit\"\r\n[kube] 2020/03/25 13:14:45 Looks like there are no changes for ClusterRoleBinding \"fluent-bit\"\r\n[kube] 2020/03/25 13:14:45 Looks like there are no changes for DaemonSet \"fluent-bit\"\r\n[kube] 2020/03/25 13:14:45 beginning wait for 5 resources with timeout of 5m0s\r\n[tiller] 2020/03/25 13:14:47 executing 1 post-upgrade hooks for fluent-bit\r\n[tiller] 2020/03/25 13:14:47 hooks complete for post-upgrade fluent-bit\r\n[storage] 2020/03/25 13:14:47 updating release \"fluent-bit.v11\"\r\n[tiller] 2020/03/25 13:14:47 updating status for updated release for fluent-bit\r\n[storage] 2020/03/25 13:14:47 updating release \"fluent-bit.v12\"\r\n[storage] 2020/03/25 13:14:47 getting last revision of \"fluent-bit\"\r\n[storage] 2020/03/25 13:14:47 getting release history for \"fluent-bit\"\r\n[kube] 2020/03/25 13:14:47 Doing get for ConfigMap: \"fluent-bit-config\"\r\n[kube] 2020/03/25 13:14:47 Doing get for ServiceAccount: \"fluent-bit\"\r\n[kube] 2020/03/25 13:14:47 Doing get for ClusterRole: \"fluent-bit\"\r\n[kube] 2020/03/25 13:14:47 Doing get for ClusterRoleBinding: \"fluent-bit\"\r\n[kube] 2020/03/25 13:14:47 Doing get for DaemonSet: \"fluent-bit\"\r\n[kube] 2020/03/25 13:14:47 get relation pod of object: log/ConfigMap/fluent-bit-config\r\n[kube] 2020/03/25 13:14:47 get relation pod of object: log/ServiceAccount/fluent-bit\r\n[kube] 2020/03/25 13:14:47 get relation pod of object: /ClusterRole/fluent-bit\r\n[kube] 2020/03/25 13:14:47 get relation pod of object: /ClusterRoleBinding/fluent-bit\r\n[kube] 2020/03/25 13:14:47 get relation pod of object: log/DaemonSet/fluent-bit\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x14e315f]\r\n\r\ngoroutine 721 [running]:\r\nk8s.io/helm/pkg/kube.getSelectorFromObject(0x1c01c60, 0xc00015b200, 0xc00015b200, 0x0)\r\n        /go/src/k8s.io/helm/pkg/kube/client.go:925 +0x26f\r\nk8s.io/helm/pkg/kube.(*Client).getSelectRelationPod(0xc000442e60, 0xc0004aa9a0, 0xc0008d0f90, 0x14e1368, 0xc000000020, 0x1a666f0)\r\n        /go/src/k8s.io/helm/pkg/kube/client.go:1105 +0x195\r\nk8s.io/helm/pkg/kube.(*Client).Get.func2(0xc0004aa9a0, 0x0, 0x0)\r\n        /go/src/k8s.io/helm/pkg/kube/client.go:367 +0xd1\r\nk8s.io/helm/pkg/kube.batchPerform.func1(0xc000304360, 0xc0007857d0, 0xc000897540, 0xc0004aa9a0)\r\n        /go/src/k8s.io/helm/pkg/kube/client.go:753 +0x30\r\ncreated by k8s.io/helm/pkg/kube.batchPerform\r\n        /go/src/k8s.io/helm/pkg/kube/client.go:752 +0xb8\r\n\r\n```\r\n\r\nThe error persists when forcing the Tiller Pod to another node so it looks like an application issue. After downgrading Helm CLI and Tiller to v2.16.3 the deployment upgrade succeeds without any issues. The error returns after upgrading to v2.16.4 again.  This issue occured on one of two clusters only at the moment and as far as I can tell right now only one deployment is affected (which is enough to let the deployment pipeline fail\u2026).\r\n\r\nThere are no resource limits configured for Tiller and the Linux kernel does not show any OOM.\r\n\r\n<!-- If you need help or think you have found a bug, please help us with your issue by entering the following information (otherwise you can delete this text): -->\r\n\r\nOutput of `helm version`:\r\n```\r\nClient: &version.Version{SemVer:\"v2.16.4\", GitCommit:\"5e135cc465d4231d9bfe2c5a43fd2978ef527e83\", GitTreeState:\"clean\"}\r\nServer: &version.Version{SemVer:\"v2.16.4\", GitCommit:\"5e135cc465d4231d9bfe2c5a43fd2978ef527e83\", GitTreeState:\"clean\"}\r\n```\r\n\r\nOutput of `kubectl version`:\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"15\", GitVersion:\"v1.15.4\", GitCommit:\"67d2fcf276fcd9cf743ad4be9a9ef5828adc082f\", GitTreeState:\"clean\", BuildDate:\"2019-09-18T14:51:13Z\", GoVersion:\"go1.12.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"15\", GitVersion:\"v1.15.4\", GitCommit:\"67d2fcf276fcd9cf743ad4be9a9ef5828adc082f\", GitTreeState:\"clean\", BuildDate:\"2019-09-18T14:41:55Z\", GoVersion:\"go1.12.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\nCloud Provider/Platform (AKS, GKE, Minikube etc.): `kubeadm`\r\n",
  "closed_at": "2020-04-14T19:22:33Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1360539?v=4",
    "events_url": "https://api.github.com/users/bacongobbler/events{/privacy}",
    "followers_url": "https://api.github.com/users/bacongobbler/followers",
    "following_url": "https://api.github.com/users/bacongobbler/following{/other_user}",
    "gists_url": "https://api.github.com/users/bacongobbler/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bacongobbler",
    "id": 1360539,
    "login": "bacongobbler",
    "node_id": "MDQ6VXNlcjEzNjA1Mzk=",
    "organizations_url": "https://api.github.com/users/bacongobbler/orgs",
    "received_events_url": "https://api.github.com/users/bacongobbler/received_events",
    "repos_url": "https://api.github.com/users/bacongobbler/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bacongobbler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bacongobbler/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bacongobbler"
  },
  "comments": 27,
  "comments_url": "https://api.github.com/repos/helm/helm/issues/7812/comments",
  "created_at": "2020-03-25T13:33:10Z",
  "events_url": "https://api.github.com/repos/helm/helm/issues/7812/events",
  "html_url": "https://github.com/helm/helm/issues/7812",
  "id": 587699632,
  "labels": [
    {
      "color": "e11d21",
      "default": true,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 778135666,
      "name": "bug",
      "node_id": "MDU6TGFiZWw3NzgxMzU2NjY=",
      "url": "https://api.github.com/repos/helm/helm/labels/bug"
    },
    {
      "color": "8c49d8",
      "default": false,
      "description": "Issues and Pull Requests related to the major version v2",
      "id": 1580151847,
      "name": "v2.x",
      "node_id": "MDU6TGFiZWwxNTgwMTUxODQ3",
      "url": "https://api.github.com/repos/helm/helm/labels/v2.x"
    }
  ],
  "labels_url": "https://api.github.com/repos/helm/helm/issues/7812/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1ODc2OTk2MzI=",
  "number": 7812,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/helm/helm",
  "state": "closed",
  "title": "Helm v2.16.4: nil pointer in kube.getSelectorFromObject after upgrading from v2.16.3",
  "updated_at": "2020-04-15T15:12:14Z",
  "url": "https://api.github.com/repos/helm/helm/issues/7812",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/3070471?v=4",
    "events_url": "https://api.github.com/users/stephan2012/events{/privacy}",
    "followers_url": "https://api.github.com/users/stephan2012/followers",
    "following_url": "https://api.github.com/users/stephan2012/following{/other_user}",
    "gists_url": "https://api.github.com/users/stephan2012/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/stephan2012",
    "id": 3070471,
    "login": "stephan2012",
    "node_id": "MDQ6VXNlcjMwNzA0NzE=",
    "organizations_url": "https://api.github.com/users/stephan2012/orgs",
    "received_events_url": "https://api.github.com/users/stephan2012/received_events",
    "repos_url": "https://api.github.com/users/stephan2012/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/stephan2012/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stephan2012/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/stephan2012"
  }
}