{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- If you need help or think you have found a bug, please help us with your issue by entering the following information (otherwise you can delete this text): -->\r\n\r\nHelm SDK version: v3.1.3\r\n\r\nkubectl version output:\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"14\", GitVersion:\"v1.14.9\", GitCommit:\"500f5aba80d71253cc01ac6a8622b8377f4a7ef9\", GitTreeState:\"clean\", BuildDate:\"2019-11-13T11:21:43Z\", GoVersion:\"go1.12.12\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"14+\", GitVersion:\"v1.14.9-eks-49202c\", GitCommit:\"49202cb0a6d5e481319ba21f0b068f112a29a4e5\", GitTreeState:\"clean\", BuildDate:\"2020-05-23T20:16:40Z\", GoVersion:\"go1.12.12\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\ngo mod:\r\n```\r\nmodule helm-service-operator\r\n\r\ngo 1.14\r\n\r\nrequire (\r\n\tgithub.com/Masterminds/semver v1.5.0 // indirect\r\n        ......\r\n\tgopkg.in/yaml.v2 v2.2.8\r\n\thelm.sh/helm/v3 v3.1.3\r\n\tk8s.io/api v0.17.4\r\n\tk8s.io/apimachinery v0.17.4\r\n\tk8s.io/cli-runtime v0.17.4\r\n\tk8s.io/client-go v0.17.4\r\n)\r\n```\r\n\r\nCloud Provider/Platform (AKS, GKE, Minikube etc.): AKS\r\n\r\n--------------\r\n\r\nI'm running a helm service operator in a pod. The operator has a reconcile loop to watch for helm chart install/upgrade request, if an installation request come in, the operator will call Helm V3 client to perform an installation.\r\n\r\nI have a script to send install request every 10 seconds, which means the helm chart install operation will be performed every 10 seconds. After my script runs for few days, I can see the memory usage of operator pod is trending up. For every 6 hours, the memory usage increased about 4 MB. And after few days, the operator pod reached OOM status and be killed and re-created by Kubernetes.\r\n\r\nNot sure if I misunderstood something, but I expect the memory usage of my operator pod should be stable rather than slightly trending up.\r\n\r\nHere is my code for perform the chart installation:\r\n```\r\nimport (\r\n        .....\r\n\t\"helm.sh/helm/v3/pkg/chart/loader\"\r\n\t\"helm.sh/helm/v3/pkg/chartutil\"\r\n\thelmV3Release \"helm.sh/helm/v3/pkg/release\"\r\n)\r\n\r\nfunc Install(chartPath, namespace, releaseName string, mergedValues map[string]interface{}) (*helmV3Release.Release, error) {\r\n    chart, err := loader.Load(chartPath)\r\n    if err != nil {\r\n        return nil, err\r\n    }\r\n\r\n    cachedClient, err := GetCachedClient(actionInstall, namespace)\r\n    if err != nil {\r\n        return nil, err\r\n    }\r\n    installCli, ok := cachedClient.(*helmAction.Install)\r\n    if !ok {\r\n        return nil, errors.New(\"type assertion failed for an object in Install Client Cache\")\r\n    }\r\n\r\n    installCli.Namespace = namespace\r\n    installCli.ReleaseName = releaseName\r\n    installCli.DryRun = opts.DryRun\r\n    installCli.Timeout = time.Duration(GetHelmActionsTimeOut()) * time.Second\r\n    installCli.Wait = helmInstallWait\r\n    rel, err := installCli.Run(chart, mergedValues)\r\n    if err != nil {\r\n        return nil, err\r\n    }\r\n    return rel, nil\r\n}\r\n```\r\n\r\nI also have a sync map as cache for storing install client for each of namespace, because I don't want to create a install client for each of installation request. The key of sync map is namespace, value is installation client object. The `GetCachedClient()` function is the helper function to fetch the cached clients.\r\n",
  "closed_at": "2020-07-24T15:14:45Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1360539?v=4",
    "events_url": "https://api.github.com/users/bacongobbler/events{/privacy}",
    "followers_url": "https://api.github.com/users/bacongobbler/followers",
    "following_url": "https://api.github.com/users/bacongobbler/following{/other_user}",
    "gists_url": "https://api.github.com/users/bacongobbler/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bacongobbler",
    "id": 1360539,
    "login": "bacongobbler",
    "node_id": "MDQ6VXNlcjEzNjA1Mzk=",
    "organizations_url": "https://api.github.com/users/bacongobbler/orgs",
    "received_events_url": "https://api.github.com/users/bacongobbler/received_events",
    "repos_url": "https://api.github.com/users/bacongobbler/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bacongobbler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bacongobbler/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bacongobbler"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/helm/helm/issues/8504/comments",
  "created_at": "2020-07-22T23:11:51Z",
  "events_url": "https://api.github.com/repos/helm/helm/issues/8504/events",
  "html_url": "https://github.com/helm/helm/issues/8504",
  "id": 664103831,
  "labels": [
    {
      "color": "e11d21",
      "default": true,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 778135666,
      "name": "bug",
      "node_id": "MDU6TGFiZWw3NzgxMzU2NjY=",
      "url": "https://api.github.com/repos/helm/helm/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/helm/helm/issues/8504/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2NjQxMDM4MzE=",
  "number": 8504,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/helm/helm",
  "state": "closed",
  "title": "Possiblly memory leak when installing chart with Helm v3 SDK",
  "updated_at": "2020-07-24T15:14:45Z",
  "url": "https://api.github.com/repos/helm/helm/issues/8504",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/637797?v=4",
    "events_url": "https://api.github.com/users/feicun/events{/privacy}",
    "followers_url": "https://api.github.com/users/feicun/followers",
    "following_url": "https://api.github.com/users/feicun/following{/other_user}",
    "gists_url": "https://api.github.com/users/feicun/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/feicun",
    "id": 637797,
    "login": "feicun",
    "node_id": "MDQ6VXNlcjYzNzc5Nw==",
    "organizations_url": "https://api.github.com/users/feicun/orgs",
    "received_events_url": "https://api.github.com/users/feicun/received_events",
    "repos_url": "https://api.github.com/users/feicun/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/feicun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/feicun/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/feicun"
  }
}