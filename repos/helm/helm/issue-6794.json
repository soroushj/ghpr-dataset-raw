{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "### Overview\r\n`Helm2` provided support for the Release namespace `{{ .Release.Namespace }}` via `--namespace` option if the release namespace did not exist. This functionality was considered rudimentary, and there were several requests from the community captured in #3503\r\n\r\n`Helm3` took a more opinionated approach on how to handle `--namespace` option w/non-existing namespaces by removing support for the release namespace creation. Irrespective of the `--namespace` option, the `{{ .Release.Namespace }}` is expected to exist before installing/upgrading any `helm` chart that utilizes `--namespace` option.\r\n\r\nBy dropping support for the Release Namespace creation via `--namespace` option in `Helm3,` we also dropped any possibility to install a Helm chart with non-existent namespace! As a result, the chart authors and chart users must rely on additional, external to Helm3 tools like `kubectl` to\r\nprepare (create) Release Namespace before Helm chart installation.\r\n\r\nIt is understood that `--namespace` option to create namespace was sub-optimal in `Helm2`, which prompted requests from the helm user community similar to #3503.\r\n\r\n### Proposed Change\r\nRather than to remove support for the Release Namespace creation altogether, we can provide accommodations for helm chart authors to create the release namespace inline during the helm chart install by allow to define release namespace Inside as a `template` resource. Moreover, the helm chart authors will also be able to tailor the release namespace to the needs of the applications by including all necessary labels, annotations.\r\n\r\nConsider following template for the Release Namespace manifest.\r\n\r\n```yaml\r\n{{- if and .Release.Namespace (.Values.createReleaseNamespace | default false) -}}\r\napiVersion: v1\r\nkind: Namespace\r\nmetadata:\r\n  name: {{ .Release.Namespace }}\r\n  annotations:\r\n    my-annoation: {{ .Values.MyAnnotation }}\r\n  labels:\r\n    release: {{ .Release.Name }}\r\n    my-other-label: other-label\r\n{{- end -}}\r\n```\r\n\r\nIn the example above, we chose to emulate current Helm3 chart functionality, i.e., do not create the release namespace by default.\r\n\r\nThe chart authors can decide whether or not allow multiple instances of their application to target the same namespace. For example, removing `{{- if ...  end -}}` lines, effectively ensure that a given chart can only be installed into a newly created namespace and no two chart instances for this application can share the same namespace.\r\n\r\n#### Processing and Assumptions\r\nWhile the Release Namespace resource resembles other Helm `template` resources very closely, the processing of this resource is different.\r\n\r\nHelm3 can perform a \"special\" pre-installation check to see if the Release Namespace is defined in the `templates` section. If it is - Helm3 will attempt to create the release namespace before recording release history, which utilizes the release namespace.\r\n\r\nThe \"special\" handling of the Release Namespace hs following assumptions/implications:\r\n\r\n- The release namespace creation will be considered as a \"special\" functionality, i.e., since it is processed separately from the rest of the template resources (similar to crds)\r\n- The release namespace artifact will be defined in the `templates` section, thus will be fully rendered just like any other `templates` resource (unlike crds)\r\n- The release namespace resource will be \"immutable,\" i.e., Helm3 will support only \"Create\" and \"Delete\" life-cycle events, and will not support \"Update.\"\r\n- Installing two charts that result in the resource namespace collision will be handled just like any other collision in `templates` resources.\r\n\r\n#### Input Result Matrix (Helm3 Current)\r\nNote: here and below, `Namespace` is synonymous to `Release Namespace.`\r\n\r\nNote: in this example for simplicity we assume that all Helm chart artifacts are installed into the Release Namespace\r\n\r\n| # | Namespace Precondition | Namespace Option | Result | Explanation |\r\n| --- | --- | --- | --- | --- |\r\n| 1 | Does not exist | None | Success: the helm chart is successfully installed into `default` namespace | The Release Namespace is neither existed, provided nor used |\r\n| 2 | Does exist | None | Success: the helm chart is successfully installed into `default` namespace | The Release Namespace exists, however, neither provided nor used |\r\n| 3 | Does not exist | Provided | Failure: the helm chart installation failed with \"namespace not found\" | The Release Namespace does not exist, and Helm3 will fail to perform all operations against this namespace |\r\n| 4 | Does exist | Provided | Success: the helm chart is successfully installed into `Provided` release namespace | As expected |\r\n\r\n#### Input Result Matrix (Proposed)\r\nSame use cases as above, but this time with proposed changed and with Helm chart that includes template definition for the Release Namespace.\r\n\r\n| # | Namespace | Namespace Option | Create Namespace Value | Result | Explanation |\r\n| --- | --- | --- | --- | --- | --- |\r\n| 1 | Does not exist | None | False | Success: the helm chart is successfully installed into `default` namespace | Same as current behavior: since the Release Namespace is provided yet it neither created nor used. |\r\n| 2 | Does exits | None | False | Success: the helm chart is successfully installed into `default` namespace | Same as current behavior |\r\n| 3.0 | Does not exist | Provided | False | Failure: the helm chart installation failed with \"namespace not found\" | Same as current behavior, since `CreateNamespaceValue is set to `false` |\r\n| 3.1 | Does not exist | Provided | True | Success: the helm chart is installed into newly created release namespace | This is the new/proposed behavior |\r\n| 4.0 | Does exist | Provided | False | Success: the helm chart is successfully installed into `Provided` release namespace | Same as current behavior |\r\n| 4.1 | Does exist | Provided | True | Failure: namespace collision | Not \"really a new\" behavior since in this case the release namespace collision is no different than any Helm2/3 existing artifacts collision errors |\r\n\r\n### Summary\r\nThe goal of this proposal is to entertain a possibility to provide Helm chart authors with functionality to define and provide support in terms of the properties when it comes down to the Release Namespace artifact.\r\n\r\nWith this proposal: Helm chart authors can allow users to:\r\n- Install helm chart into an existing namespace (as currently supported)\r\n- Install helm chart into a non-existing namespace (currently not supported)\r\n\r\nwhile maintaining all the current Helm3 chart behaviors when it comes to storing Helm release information.\r\n\r\n",
  "closed_at": "2020-02-24T19:20:19Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1360539?v=4",
    "events_url": "https://api.github.com/users/bacongobbler/events{/privacy}",
    "followers_url": "https://api.github.com/users/bacongobbler/followers",
    "following_url": "https://api.github.com/users/bacongobbler/following{/other_user}",
    "gists_url": "https://api.github.com/users/bacongobbler/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bacongobbler",
    "id": 1360539,
    "login": "bacongobbler",
    "node_id": "MDQ6VXNlcjEzNjA1Mzk=",
    "organizations_url": "https://api.github.com/users/bacongobbler/orgs",
    "received_events_url": "https://api.github.com/users/bacongobbler/received_events",
    "repos_url": "https://api.github.com/users/bacongobbler/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bacongobbler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bacongobbler/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bacongobbler"
  },
  "comments": 47,
  "comments_url": "https://api.github.com/repos/helm/helm/issues/6794/comments",
  "created_at": "2019-10-25T22:41:29Z",
  "events_url": "https://api.github.com/repos/helm/helm/issues/6794/events",
  "html_url": "https://github.com/helm/helm/issues/6794",
  "id": 512747885,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 335802899,
      "name": "proposal",
      "node_id": "MDU6TGFiZWwzMzU4MDI4OTk=",
      "url": "https://api.github.com/repos/helm/helm/labels/proposal"
    },
    {
      "color": "e82969",
      "default": false,
      "description": "Issues and Pull Requests related to the major version v3",
      "id": 926755770,
      "name": "v3.x",
      "node_id": "MDU6TGFiZWw5MjY3NTU3NzA=",
      "url": "https://api.github.com/repos/helm/helm/labels/v3.x"
    }
  ],
  "labels_url": "https://api.github.com/repos/helm/helm/issues/6794/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2020-04-22T23:21:59Z",
    "closed_issues": 55,
    "created_at": "2020-01-30T17:45:10Z",
    "creator": {
      "avatar_url": "https://avatars2.githubusercontent.com/u/62991?v=4",
      "events_url": "https://api.github.com/users/mattfarina/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattfarina/followers",
      "following_url": "https://api.github.com/users/mattfarina/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattfarina/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattfarina",
      "id": 62991,
      "login": "mattfarina",
      "node_id": "MDQ6VXNlcjYyOTkx",
      "organizations_url": "https://api.github.com/users/mattfarina/orgs",
      "received_events_url": "https://api.github.com/users/mattfarina/received_events",
      "repos_url": "https://api.github.com/users/mattfarina/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattfarina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattfarina/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattfarina"
    },
    "description": "This is the next stable feature release of Helm 3. Non-breaking feature additions are allowed, as are bug fixes.",
    "due_on": null,
    "html_url": "https://github.com/helm/helm/milestone/83",
    "id": 5057936,
    "labels_url": "https://api.github.com/repos/helm/helm/milestones/83/labels",
    "node_id": "MDk6TWlsZXN0b25lNTA1NzkzNg==",
    "number": 83,
    "open_issues": 0,
    "state": "closed",
    "title": "3.2.0",
    "updated_at": "2020-04-22T23:21:59Z",
    "url": "https://api.github.com/repos/helm/helm/milestones/83"
  },
  "node_id": "MDU6SXNzdWU1MTI3NDc4ODU=",
  "number": 6794,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/helm/helm",
  "state": "closed",
  "title": "Enable Release Namespace Creation in Helm3",
  "updated_at": "2020-02-24T19:20:19Z",
  "url": "https://api.github.com/repos/helm/helm/issues/6794",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/324803?v=4",
    "events_url": "https://api.github.com/users/ichekrygin/events{/privacy}",
    "followers_url": "https://api.github.com/users/ichekrygin/followers",
    "following_url": "https://api.github.com/users/ichekrygin/following{/other_user}",
    "gists_url": "https://api.github.com/users/ichekrygin/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ichekrygin",
    "id": 324803,
    "login": "ichekrygin",
    "node_id": "MDQ6VXNlcjMyNDgwMw==",
    "organizations_url": "https://api.github.com/users/ichekrygin/orgs",
    "received_events_url": "https://api.github.com/users/ichekrygin/received_events",
    "repos_url": "https://api.github.com/users/ichekrygin/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ichekrygin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ichekrygin/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ichekrygin"
  }
}