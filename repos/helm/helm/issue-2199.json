{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "Per [discussion in the \"helm\" channel in the \"Kubernetes\" Slack team](https://kubernetes.slack.com/archives/C0NH30761/p1490797052062993), when using a Helm chart to install RBAC-related objects of kinds\r\n- _ClusterRole_\r\n- _ClusterRoleBinding_\r\n- _Role_\r\n- _RoleBinding_\r\n\r\nthe chart may fail to install properly due to creation ordering. Namely, [RBAC enforces the following referential integrity constraints to preclude privilege escalation](https://kubernetes.slack.com/archives/C0EN96KUY/p1490803161900126):\r\n- A _Role_ referred to by a _RoleBinding_ must exist before creating the _RoleBinding_.\r\n- A _ClusterRole_ referred to by a _RoleBinding_ must exist before creating the _RoleBinding_.\r\n- A _ClusterRole_ referred to by a _ClusterRoleBinding_ must exist before creating the _ClusterRoleBinding_.\r\n\r\nIn my chart, I have one template file that defines a _ClusterRole_, and a separate template file that defines a _ClusterRoleBinding_, referring to the aforementioned _ClusterRole_. Installing the chart sometimes succeeds and sometimes fails, depending on the order in which Helm submits those two manifests. The order is effectively random, per Go's map traversal policy and lack of control exerted by [Helm's `tiller.SortOrder` vector](https://github.com/kubernetes/helm/blob/c1e6683233537c24c99b3228cb690c18c6d0f9c7/pkg/tiller/kind_sorter.go#L27).\r\n\r\nOne way to fix this is to impose the following weak partial order on these kinds:\r\n> (_ClusterRole_ \u2264 _Role_) < (_ClusterRoleBinding_ \u2264 _RoleBinding_)\r\n\r\nAs for where this group of kinds belongs within the `tiller.SortOrder` vector, they should come after _ServiceAccount_, since a _ClusterRoleBinding_ and _RoleBinding_ may refer to a _ServiceAccount_ by name, though I don't think those account references are checked at time of creation.",
  "closed_at": "2017-03-30T03:00:02Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/4294228?v=4",
    "events_url": "https://api.github.com/users/thomastaylor312/events{/privacy}",
    "followers_url": "https://api.github.com/users/thomastaylor312/followers",
    "following_url": "https://api.github.com/users/thomastaylor312/following{/other_user}",
    "gists_url": "https://api.github.com/users/thomastaylor312/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/thomastaylor312",
    "id": 4294228,
    "login": "thomastaylor312",
    "node_id": "MDQ6VXNlcjQyOTQyMjg=",
    "organizations_url": "https://api.github.com/users/thomastaylor312/orgs",
    "received_events_url": "https://api.github.com/users/thomastaylor312/received_events",
    "repos_url": "https://api.github.com/users/thomastaylor312/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/thomastaylor312/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thomastaylor312/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/thomastaylor312"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/helm/helm/issues/2199/comments",
  "created_at": "2017-03-29T17:46:41Z",
  "events_url": "https://api.github.com/repos/helm/helm/issues/2199/events",
  "html_url": "https://github.com/helm/helm/issues/2199",
  "id": 217955018,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 562687520,
      "name": "feature",
      "node_id": "MDU6TGFiZWw1NjI2ODc1MjA=",
      "url": "https://api.github.com/repos/helm/helm/labels/feature"
    }
  ],
  "labels_url": "https://api.github.com/repos/helm/helm/issues/2199/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMTc5NTUwMTg=",
  "number": 2199,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/helm/helm",
  "state": "closed",
  "title": "Manifest sorting order needs to respect RBAC referential integrity constraints",
  "updated_at": "2018-07-18T19:42:16Z",
  "url": "https://api.github.com/repos/helm/helm/issues/2199",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/175841?v=4",
    "events_url": "https://api.github.com/users/seh/events{/privacy}",
    "followers_url": "https://api.github.com/users/seh/followers",
    "following_url": "https://api.github.com/users/seh/following{/other_user}",
    "gists_url": "https://api.github.com/users/seh/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/seh",
    "id": 175841,
    "login": "seh",
    "node_id": "MDQ6VXNlcjE3NTg0MQ==",
    "organizations_url": "https://api.github.com/users/seh/orgs",
    "received_events_url": "https://api.github.com/users/seh/received_events",
    "repos_url": "https://api.github.com/users/seh/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/seh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/seh/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/seh"
  }
}