{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "The [cobra project](https://github.com/spf13/cobra) provides ways for Helm to perform custom auto-completions (e.g., `helm status <TAB>` or `helm status --namespace <TAB>`) (see Cobra's [bash_completions.md](https://github.com/spf13/cobra/blob/master/bash_completions.md) for details).\r\n\r\nThe problem is that these methods require Helm to inject shell scripts into the global auto-completion script.  So Helm developers have to code these completions in bash instead of in Go.  Furthermore, debugging these completions is **very** tedious.  Maintaining them is also complex. There are currently over 250 lines of bash script injected by Helm.  See the code starting at https://github.com/helm/helm/blob/6c604a400ec2c31cbc5d2069a34685c938a37ab9/cmd/helm/root.go#L33\r\n\r\nThis proposal aims for shell auto-completion code to be written in Go instead of bash.\r\n In summary, Helm would support a new hidden command `helm __complete`, which the Cobra auto-completion script would call to obtain the auto-completion choices.\r\n\r\nThe current completion flow looks as follows.\r\n*Please open on GitHub to see diagram properly*\r\n\r\n```\r\n                     bash completion script\r\n               ____________________________________  helm list -aqm 1000  ______\r\n ______       |  ___________        _____________  |    ----------->     |      |\r\n|      |      | | generated |      |    helm     | |                     |      |\r\n| User | ---> | |    by     |      |   custom    | |   helm repo list    | helm |\r\n|      |      | |   Cobra   | ---> | completions | |    ----------->     | bin  |\r\n ------       | |   (bash)  |      |   (bash)    | |                     | (Go) |\r\n              |  -----------        -------------  |  helm plugin list   |      |\r\n               ------------------------------------     ----------->      ------\r\nhelm status <TAB>                         ^                                 |\r\nhelm repo remove <TAB>                    |                                 |\r\nhelm plugin update <TAB>                   ---------------------------------\r\n        etc                                 output must be parsed by script\r\n                                                       (bash)\r\n```\r\n\r\nThe new prosed completion flow would look like this:\r\n```\r\n                bash completion script\r\n              __________________________     helm __complete status      _____________\r\n ______      | ___________ ____________ |       --------------->        |   helm bin  |\r\n|      |     || generated |  generic   ||                               | __complete  |\r\n| User | --> ||    by     | use of cmd ||  helm __complete repo remove  |   cmd and   |\r\n|      |     ||   Cobra   | __complete ||       --------------->        |  completion |\r\n ------      ||   (bash)  |   (bash)   ||                               |   routines  |\r\n             | ----------- ------------ | helm __complete plugin update |     (Go)    |\r\n              --------------------------        --------------->         -------------\r\nhelm status <TAB>                                      ^^^\r\nhelm repo remove <TAB>                      generic request for helm           \r\nhelm plugin update <TAB>                   to complete the command-line\r\n        etc\r\n```\r\n\r\nAdvantages of this approach:\r\n- Custom completions written in Go instead of bash\r\n- Access to full Helm code base to perform completions instead of having to rely on calling helm externally.  For example, calling `helm search repo` is more limited than coding the logic directly in helm in Go.\r\n- Debugging and development **much** easier because helm developers can directly call e.g., `helm __complete status j<ENTER>` to test the corresponding completion code\r\n- The Go debugger can even be used\r\n- Go tests can be written for the custom completion code\r\n- Flag parsing done automatically by Cobra (instead of having to be coded in bash by helm)\r\n- Global flags handled automatically instead of being coded explicitly in bash (see changes required by #7230)\r\n- No need to make sure the custom completion code works for both bash and zsh\r\n- No more issues with the use of shell tools (e.g., `echo`, `cat`, `tail`) that work differently on different OSes (e.g., #7304)\r\n- Use of `client-go` library instead of `kubectl`\r\n\r\n\r\n\r\n",
  "closed_at": "2020-01-17T18:12:36Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/414402?v=4",
    "events_url": "https://api.github.com/users/marckhouzam/events{/privacy}",
    "followers_url": "https://api.github.com/users/marckhouzam/followers",
    "following_url": "https://api.github.com/users/marckhouzam/following{/other_user}",
    "gists_url": "https://api.github.com/users/marckhouzam/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/marckhouzam",
    "id": 414402,
    "login": "marckhouzam",
    "node_id": "MDQ6VXNlcjQxNDQwMg==",
    "organizations_url": "https://api.github.com/users/marckhouzam/orgs",
    "received_events_url": "https://api.github.com/users/marckhouzam/received_events",
    "repos_url": "https://api.github.com/users/marckhouzam/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/marckhouzam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marckhouzam/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/marckhouzam"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/helm/helm/issues/7321/comments",
  "created_at": "2020-01-01T22:28:10Z",
  "events_url": "https://api.github.com/repos/helm/helm/issues/7321/events",
  "html_url": "https://github.com/helm/helm/issues/7321",
  "id": 544405633,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 335802899,
      "name": "proposal",
      "node_id": "MDU6TGFiZWwzMzU4MDI4OTk=",
      "url": "https://api.github.com/repos/helm/helm/labels/proposal"
    }
  ],
  "labels_url": "https://api.github.com/repos/helm/helm/issues/7321/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1NDQ0MDU2MzM=",
  "number": 7321,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/helm/helm",
  "state": "closed",
  "title": "Proposal: Auto-completion in Go instead of bash",
  "updated_at": "2020-01-17T18:12:36Z",
  "url": "https://api.github.com/repos/helm/helm/issues/7321",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/414402?v=4",
    "events_url": "https://api.github.com/users/marckhouzam/events{/privacy}",
    "followers_url": "https://api.github.com/users/marckhouzam/followers",
    "following_url": "https://api.github.com/users/marckhouzam/following{/other_user}",
    "gists_url": "https://api.github.com/users/marckhouzam/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/marckhouzam",
    "id": 414402,
    "login": "marckhouzam",
    "node_id": "MDQ6VXNlcjQxNDQwMg==",
    "organizations_url": "https://api.github.com/users/marckhouzam/orgs",
    "received_events_url": "https://api.github.com/users/marckhouzam/received_events",
    "repos_url": "https://api.github.com/users/marckhouzam/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/marckhouzam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marckhouzam/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/marckhouzam"
  }
}