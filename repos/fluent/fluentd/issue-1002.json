{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "I tested in_monitor_agent with following configuration and got wrong result.\n\n``` aconf\n<source>\n  @type monitor_agent\n</source>\n<source>\n  @type forward\n</source>\n<match dummy>\n  @type forward\n  @id forward\n  buffer_chunk_limit 30\n  buffer_type file\n  buffer_path /Users/repeatedly/tmp/fluentd/buffer/test\n  <server>\n    host 127.0.0.1\n  </server>\n</match>\n```\n## v0.12.24\n\nv0.12 returns correct result. buffer_queue_length is 1.\n\n```\n% ls buffer\ntest.dummy.b533f7cd1cef487ab.log  test.dummy.q533f7cd1ceaa1597.log\n```\n\n``` js\n% curl http://localhost:24220/api/plugins.json\n{\"plugins\":[{\"plugin_id\":\"object:3fefc9d5d72c\",\"plugin_category\":\"input\",\"type\":\"monitor_agent\",\"config\":{\"@type\":\"monitor_agent\"},\"output_plugin\":false,\"retry_count\":null},{\"plugin_id\":\"object:3fefc9d58150\",\"plugin_category\":\"input\",\"type\":\"forward\",\"config\":{\"@type\":\"forward\"},\"output_plugin\":false,\"retry_count\":null},{\"plugin_id\":\"forward\",\"plugin_category\":\"output\",\"type\":\"forward\",\"config\":{\"@type\":\"forward\",\"@id\":\"forward\",\"flush_interval\":\"10s\",\"buffer_chunk_limit\":\"30\",\"phi_failure_detector\":\"false\",\"heartbeat_type\":\"none\",\"buffer_type\":\"file\",\"buffer_path\":\"/Users/repeatedly/tmp/fluentd/buffer/test\",\"flush_at_shutdown\":\"true\"},\"output_plugin\":true,\"buffer_queue_length\":1,\"buffer_total_queued_size\":40,\"retry_count\":0}]}\n```\n## v0.14.0.rc.3\n\nOn the other hand, v0.14 retruns buffer_queue_length is 20 and there is no `buffer_total_queued_size` field. We should keep same result because many companies use `in_monitor_agent` to check buffer status.\n\n``` sh\n% ls buffer/test/                             \nbuffer.b533f7d9364192049ec84fd70687246ca.log       buffer.q533f7d9363d704d4d13382bd5c03ae4a.log\nbuffer.b533f7d9364192049ec84fd70687246ca.log.meta  buffer.q533f7d9363d704d4d13382bd5c03ae4a.log.meta\n```\n\n``` js\n% curl http://localhost:24220/api/plugins.json\n{\"plugins\":[{\"plugin_id\":\"object:3fd3c181f234\",\"plugin_category\":\"input\",\"type\":\"monitor_agent\",\"config\":{\"@type\":\"monitor_agent\"},\"output_plugin\":false,\"retry_count\":null},{\"plugin_id\":\"object:3fd3c056cd1c\",\"plugin_category\":\"input\",\"type\":\"forward\",\"config\":{\"@type\":\"forward\"},\"output_plugin\":false,\"retry_count\":null},{\"plugin_id\":\"forward\",\"plugin_category\":\"unknown\",\"type\":\"forward\",\"config\":{\"@type\":\"forward\",\"@id\":\"forward\",\"flush_interval\":\"10s\",\"buffer_chunk_limit\":\"30\",\"phi_failure_detector\":\"false\",\"heartbeat_type\":\"none\",\"buffer_type\":\"file\",\"buffer_path\":\"/Users/repeatedly/tmp/fluentd/buffer/test\",\"flush_at_shutdown\":\"true\"},\"output_plugin\":false,\"buffer_queue_length\":20,\"retry_count\":0}]}\n```\n",
  "closed_at": "2016-05-30T08:58:45Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/16928?v=4",
    "events_url": "https://api.github.com/users/repeatedly/events{/privacy}",
    "followers_url": "https://api.github.com/users/repeatedly/followers",
    "following_url": "https://api.github.com/users/repeatedly/following{/other_user}",
    "gists_url": "https://api.github.com/users/repeatedly/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/repeatedly",
    "id": 16928,
    "login": "repeatedly",
    "node_id": "MDQ6VXNlcjE2OTI4",
    "organizations_url": "https://api.github.com/users/repeatedly/orgs",
    "received_events_url": "https://api.github.com/users/repeatedly/received_events",
    "repos_url": "https://api.github.com/users/repeatedly/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/repeatedly/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/repeatedly/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/repeatedly"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/fluent/fluentd/issues/1002/comments",
  "created_at": "2016-05-29T09:39:51Z",
  "events_url": "https://api.github.com/repos/fluent/fluentd/issues/1002/events",
  "html_url": "https://github.com/fluent/fluentd/issues/1002",
  "id": 157378018,
  "labels": [
    {
      "color": "e11d21",
      "default": true,
      "description": null,
      "id": 94152935,
      "name": "bug",
      "node_id": "MDU6TGFiZWw5NDE1MjkzNQ==",
      "url": "https://api.github.com/repos/fluent/fluentd/labels/bug"
    },
    {
      "color": "009800",
      "default": false,
      "description": null,
      "id": 146493149,
      "name": "v0.14",
      "node_id": "MDU6TGFiZWwxNDY0OTMxNDk=",
      "url": "https://api.github.com/repos/fluent/fluentd/labels/v0.14"
    }
  ],
  "labels_url": "https://api.github.com/repos/fluent/fluentd/issues/1002/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxNTczNzgwMTg=",
  "number": 1002,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/fluent/fluentd",
  "state": "closed",
  "title": "in_monitor_agent returns wrong result",
  "updated_at": "2016-05-30T08:58:45Z",
  "url": "https://api.github.com/repos/fluent/fluentd/issues/1002",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/16928?v=4",
    "events_url": "https://api.github.com/users/repeatedly/events{/privacy}",
    "followers_url": "https://api.github.com/users/repeatedly/followers",
    "following_url": "https://api.github.com/users/repeatedly/following{/other_user}",
    "gists_url": "https://api.github.com/users/repeatedly/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/repeatedly",
    "id": 16928,
    "login": "repeatedly",
    "node_id": "MDQ6VXNlcjE2OTI4",
    "organizations_url": "https://api.github.com/users/repeatedly/orgs",
    "received_events_url": "https://api.github.com/users/repeatedly/received_events",
    "repos_url": "https://api.github.com/users/repeatedly/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/repeatedly/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/repeatedly/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/repeatedly"
  }
}