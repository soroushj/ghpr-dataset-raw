{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/700876?v=4",
    "events_url": "https://api.github.com/users/cosmo0920/events{/privacy}",
    "followers_url": "https://api.github.com/users/cosmo0920/followers",
    "following_url": "https://api.github.com/users/cosmo0920/following{/other_user}",
    "gists_url": "https://api.github.com/users/cosmo0920/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/cosmo0920",
    "id": 700876,
    "login": "cosmo0920",
    "node_id": "MDQ6VXNlcjcwMDg3Ng==",
    "organizations_url": "https://api.github.com/users/cosmo0920/orgs",
    "received_events_url": "https://api.github.com/users/cosmo0920/received_events",
    "repos_url": "https://api.github.com/users/cosmo0920/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/cosmo0920/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cosmo0920/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/cosmo0920"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/700876?v=4",
      "events_url": "https://api.github.com/users/cosmo0920/events{/privacy}",
      "followers_url": "https://api.github.com/users/cosmo0920/followers",
      "following_url": "https://api.github.com/users/cosmo0920/following{/other_user}",
      "gists_url": "https://api.github.com/users/cosmo0920/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/cosmo0920",
      "id": 700876,
      "login": "cosmo0920",
      "node_id": "MDQ6VXNlcjcwMDg3Ng==",
      "organizations_url": "https://api.github.com/users/cosmo0920/orgs",
      "received_events_url": "https://api.github.com/users/cosmo0920/received_events",
      "repos_url": "https://api.github.com/users/cosmo0920/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/cosmo0920/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cosmo0920/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/cosmo0920"
    }
  ],
  "author_association": "NONE",
  "body": "We are trying to use fluentd on Windows for logs collection, but it seems that buffer section's `chunk_limit_size` is not working on windows.\r\nEven though `chunk_limit_size` value is defined as high as 64 MB, fluentd creates a lot of small small chunk files of size 0-1 KB with just 1 log line in each.\r\nBecause of this the Windows file descriptors limit(for a process) is reached and then fluentd fails with Error Logs saying not able to write new chunk file and failed to flush the buffer.\r\n\r\n**Steps to reproduce the behavior:**\r\n[Windows] Create a sample log file with significant amount of log lines (say 100k)\r\nBelow is a sample from IIS Access Log file used for testing\r\n```\r\n#Software: Microsoft Internet Information Services 10.0\r\n#Version: 1.0\r\n#Date: 2019-11-19 00:08:21\r\n#Fields: date time s-sitename s-ip cs-method cs-uri-stem cs-uri-query s-port cs-username c-ip cs(User-Agent) cs(Referer) sc-status sc-substatus sc-win32-status sc-bytes cs-bytes time-taken\r\n2019-11-19 00:08:21 W3SVC50001 127.0.0.1 GET /XXXXX/health.html - 50001 - 127.0.0.1 ELB-HealthChecker/2.0 - 200 0 0 311 153 608\r\n2019-11-19 00:08:21 W3SVC50001 ::1 GET /XXXXX/health.html - 50001 - ::1 ELB-HealthChecker/2.0 - 200 0 0 311 153 666\r\n...\r\naround 100k lines\r\n\r\n```\r\nInstall td-agent(td-agent-3.5.1-0-x64.msi), configure it using below config file and then start fluentd Service.\r\n\r\n**Expected behavior:**\r\nFluentd should not create a lot of small small chunk files of size 0-1KB, rather respect the `chunk_size_limit` value of defined 64MB.\r\n\r\n**Testing environment:**\r\n\r\n- td-agent package version: td-agent-3.5.1-0-x64.msi\r\n- Operating system: Windows 10 Pro (same behaviour on Windows Server 2016 also)\r\n\r\n**Test config:**\r\n\r\n```\r\n<source>\r\n  @type tail\r\n  path \"E:/IntraWeb/logs/IISAccessLog/W3SVC/*.log\"\r\n  pos_file \"C:\\\\opt\\\\td-agent\\\\pos\\\\td-agent-iis.pos\"\r\n  format /^(?<timestamp>\\d+-\\d+-\\d+\\s\\d+:\\d+:\\d+)\\s(?<s_sitename>[^\\s]*)\\s(?<s_ip>[^\\s]*)\\s(?<cs_method>[^\\s]*)\\s(?<cs_uri_stem>[^\\s]*)\\s(?<cs_uri_query>[^\\s]*)\\s(?<s_port>[^\\s]*)\\s(?<cs_username>[^\\s]*)\\s(?<c_ip>[^\\s]*)\\s(?<cs_user_agent>[^\\s]*)\\s(?<cs_referer>[^\\s]*)\\s(?<sc_status>[^\\s]*)\\s(?<sc_substatus>[^\\s]*)\\s(?<sc_win32_status>[^\\s]*)\\s(?<sc_bytes>[^\\s]*)\\s(?<cs_bytes>[^\\s]*)\\s(?<time_taken>[^\\s]*)?$/\r\n  keep_time_key true\r\n  time_key timestamp\r\n  time_format %Y-%m-%d %H:%M:%S  \r\n  read_from_head true\r\n  limit_recently_modified 3d\r\n  tag xxxx\r\n</source>\r\n\r\n<match xxxx>\r\n  @type s3\r\n\r\n  aws_key_id xxxx\r\n  aws_sec_key xxxx\r\n  s3_bucket xxxx\r\n  s3_region xxxx\r\n\r\n  path xxxx\r\n  s3_object_key_format %{path}%{time_slice}/%{index}.%{file_extension}\r\n  time_slice_format %Y-%m-%d/%H  #%Y%m%d%H\r\n  time_format %Y-%m-%dT%H:%M:%S.%L%z\r\n  format json\r\n  time_key time\r\n  include_time_key true\r\n\r\n  <buffer tag,time>\r\n    @type file\r\n    path C:\\opt\\td-agent\\buffer\r\n    timekey 3600 # 1 hour partition\r\n    chunk_limit_size 64MB\r\n    flush_mode interval\r\n    flush_interval 30s\r\n    flush_thread_count 4\r\n    flush_at_shutdown true\r\n  </buffer>\r\n\r\n</match>\r\n```\r\n\r\n**Error Log:**\r\nWithin 1-2 sec of starting Fluentd Service, the buffer folder suddenly explodes with 2040 files (buffer.xx.log and buffer.xx.log.meta file combos).\r\nEach of the buffer.xx.log contains only 1 log line event and td-agent log starts showing warn logs stating Can't create new buffer file.\r\n\r\n```\r\n2019-12-04 11:16:35 +0800 [info]: parsing config file is succeeded path=\"C:/opt/td-agent/etc/td-agent/td-agent.conf\"\r\n2019-12-04 11:16:37 +0800 [info]: using configuration file: <ROOT>\r\n  <source>\r\n    @type tail\r\n    path \"E:/IntraWeb/logs/IISAccessLog/W3SVC/*.log\"\r\n    pos_file \"C:\\\\opt\\\\td-agent\\\\pos\\\\td-agent-iis.pos\"\r\n    format /^(?<timestamp>\\d+-\\d+-\\d+\\s\\d+:\\d+:\\d+)\\s(?<s_sitename>[^\\s]*)\\s(?<s_ip>[^\\s]*)\\s(?<cs_method>[^\\s]*)\\s(?<cs_uri_stem>[^\\s]*)\\s(?<cs_uri_query>[^\\s]*)\\s(?<s_port>[^\\s]*)\\s(?<cs_username>[^\\s]*)\\s(?<c_ip>[^\\s]*)\\s(?<cs_user_agent>[^\\s]*)\\s(?<cs_referer>[^\\s]*)\\s(?<sc_status>[^\\s]*)\\s(?<sc_substatus>[^\\s]*)\\s(?<sc_win32_status>[^\\s]*)\\s(?<sc_bytes>[^\\s]*)\\s(?<cs_bytes>[^\\s]*)\\s(?<time_taken>[^\\s]*)?$/\r\n    keep_time_key true\r\n    time_key timestamp\r\n    time_format %Y-%m-%d %H:%M:%S\r\n    read_from_head true\r\n    limit_recently_modified 3d\r\n    tag \"xxxx\"\r\n    <parse>\r\n      time_key timestamp\r\n      time_format %Y-%m-%d %H:%M:%S\r\n      keep_time_key true\r\n      @type regexp\r\n      expression ^(?<timestamp>\\d+-\\d+-\\d+\\s\\d+:\\d+:\\d+)\\s(?<s_sitename>[^\\s]*)\\s(?<s_ip>[^\\s]*)\\s(?<cs_method>[^\\s]*)\\s(?<cs_uri_stem>[^\\s]*)\\s(?<cs_uri_query>[^\\s]*)\\s(?<s_port>[^\\s]*)\\s(?<cs_username>[^\\s]*)\\s(?<c_ip>[^\\s]*)\\s(?<cs_user_agent>[^\\s]*)\\s(?<cs_referer>[^\\s]*)\\s(?<sc_status>[^\\s]*)\\s(?<sc_substatus>[^\\s]*)\\s(?<sc_win32_status>[^\\s]*)\\s(?<sc_bytes>[^\\s]*)\\s(?<cs_bytes>[^\\s]*)\\s(?<time_taken>[^\\s]*)?$\r\n    </parse>\r\n  </source>\r\n  <filter xxxx>\r\n    @type record_modifier\r\n    <record>\r\n      xxxxxx xxxxxx\r\n      xxxxxx xxxxxx\r\n      time ${record['timestamp']}\r\n    </record>\r\n  </filter>\r\n  <match xxxx>\r\n    @type s3\r\n    aws_key_id xxxxxx\r\n    aws_sec_key xxxxxx\r\n    s3_bucket xxxxxx\r\n    s3_region xxxxxx\r\n    path \"xxxxxx/\"\r\n    s3_object_key_format \"%{path}%{time_slice}/xxxxxx/%{index}.%{file_extension}\"\r\n    time_slice_format %Y-%m-%d/%H\r\n    time_format %Y-%m-%dT%H:%M:%S.%L%z\r\n    format json\r\n    time_key time\r\n    include_time_key true\r\n    <buffer tag,time>\r\n      @type \"file\"\r\n      path \"C:\\\\opt\\\\td-agent\\\\buffer\"\r\n      timekey 3600\r\n      chunk_limit_size 64MB\r\n      flush_mode interval\r\n      flush_interval 30s\r\n      flush_thread_count 4\r\n      flush_at_shutdown true\r\n    </buffer>\r\n    <format>\r\n      @type json\r\n    </format>\r\n    <inject>\r\n      time_key time\r\n      time_format %Y-%m-%dT%H:%M:%S.%L%z\r\n      time_type string\r\n    </inject>\r\n  </match>\r\n</ROOT>\r\n2019-12-04 11:16:37 +0800 [info]: starting fluentd-1.7.4 pid=5376 ruby=\"2.4.9\"\r\n2019-12-04 11:16:37 +0800 [info]: spawn command to main:  cmdline=[\"C:/opt/td-agent/embedded/bin/ruby.exe\", \"-Eascii-8bit:ascii-8bit\", \"C:/opt/td-agent/embedded/bin/fluentd\", \"-c\", \"C:/opt/td-agent/etc/td-agent/td-agent.conf\", \"-o\", \"C:/opt/td-agent/td-agent.log\", \"-x\", \"fluentdwinsvc\", \"--under-supervisor\"]\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-elasticsearch' version '3.5.5'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-kafka' version '0.12.1'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-parser-winevt_xml' version '0.2.0'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-prometheus' version '1.7.0'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-record-modifier' version '2.0.1'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-rewrite-tag-filter' version '2.2.0'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-s3' version '1.2.0'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-td' version '1.0.0'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-td-monitoring' version '0.2.4'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-webhdfs' version '1.2.4'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluent-plugin-windows-eventlog' version '0.4.3'\r\n2019-12-04 11:16:38 +0800 [info]: gem 'fluentd' version '1.7.4'\r\n2019-12-04 11:16:38 +0800 [info]: adding filter pattern=\"xxxx\" type=\"record_modifier\"\r\n2019-12-04 11:16:38 +0800 [info]: adding match pattern=\"xxxx\" type=\"s3\"\r\n2019-12-04 11:16:39 +0800 [info]: adding source type=\"tail\"\r\n2019-12-04 11:16:39 +0800 [info]: #0 starting fluentd worker pid=9320 ppid=5376 worker=0\r\n2019-12-04 11:16:41 +0800 [info]: #0 following tail of E:/IntraWeb/logs/IISAccessLog/W3SVC/u_ex191128.log\r\n2019-12-04 11:16:41 +0800 [warn]: #0 pattern not matched: \"#Software: Microsoft Internet Information Services 10.0\"\r\n2019-12-04 11:16:41 +0800 [warn]: #0 pattern not matched: \"#Version: 1.0\"\r\n2019-12-04 11:16:41 +0800 [warn]: #0 pattern not matched: \"#Date: 2019-11-28 01:30:42\"\r\n2019-12-04 11:16:41 +0800 [warn]: #0 pattern not matched: \"#Fields: date time s-sitename s-ip cs-method cs-uri-stem cs-uri-query s-port cs-username c-ip cs(User-Agent) cs(Referer) sc-status sc-substatus sc-win32-status sc-bytes cs-bytes time-taken\"\r\n2019-12-04 11:16:41 +0800 [warn]: #0 pattern not matched: \"#Software: Microsoft Internet Information Services 10.0\"\r\n2019-12-04 11:16:41 +0800 [warn]: #0 pattern not matched: \"#Version: 1.0\"\r\n2019-12-04 11:16:41 +0800 [warn]: #0 pattern not matched: \"#Date: 2019-11-28 01:47:12\"\r\n2019-12-04 11:16:41 +0800 [warn]: #0 pattern not matched: \"#Fields: date time s-sitename s-ip cs-method cs-uri-stem cs-uri-query s-port cs-username c-ip cs(User-Agent) cs(Referer) sc-status sc-substatus sc-win32-status sc-bytes cs-bytes time-taken\"\r\n2019-12-04 11:16:42 +0800 [warn]: #0 failed to write data into buffer by buffer overflow action=:throw_exception\r\n2019-12-04 11:16:42 +0800 [warn]: #0 emit transaction failed: error_class=Fluent::Plugin::Buffer::BufferOverflowError error=\"can't create buffer file for C:\\\\opt\\\\td-agent\\\\buffer/buffer.*.log. Stop creating buffer files: error = Too many open files @ rb_sysopen - C:\\\\opt\\\\td-agent\\\\buffer/buffer.b598d83de671a4b73ff303f141c3bfc6f.log\" location=\"C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer/file_chunk.rb:291:in `rescue in create_new_chunk'\" tag=\"xxxx\"\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer/file_chunk.rb:291:in `rescue in create_new_chunk'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer/file_chunk.rb:283:in `create_new_chunk'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer/file_chunk.rb:54:in `initialize'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buf_file.rb:173:in `new'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buf_file.rb:173:in `generate_chunk'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:555:in `block in write_once'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/2.4.0/monitor.rb:214:in `mon_synchronize'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:555:in `write_once'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:278:in `block in write'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:276:in `each'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:276:in `write'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:954:in `block in handle_stream_with_custom_format'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:880:in `write_guard'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:953:in `handle_stream_with_custom_format'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:872:in `execute_chunking'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:800:in `emit_buffered'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/event_router.rb:160:in `emit_events'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/event_router.rb:97:in `emit_stream'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:410:in `receive_lines'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:528:in `wrap_receive_lines'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:762:in `block in handle_notify'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:806:in `with_io'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:742:in `handle_notify'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:738:in `block in on_notify'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:738:in `synchronize'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:738:in `on_notify'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:558:in `on_notify'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:532:in `attach'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:281:in `setup_watcher'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:312:in `block in start_watchers'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:298:in `each'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:298:in `start_watchers'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:275:in `refresh_watchers'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:203:in `start'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/root_agent.rb:203:in `block in start'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/root_agent.rb:192:in `block (2 levels) in lifecycle'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/root_agent.rb:191:in `each'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/root_agent.rb:191:in `block in lifecycle'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/root_agent.rb:178:in `each'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/root_agent.rb:178:in `lifecycle'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/root_agent.rb:202:in `start'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/engine.rb:274:in `start'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/engine.rb:219:in `run'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/supervisor.rb:816:in `run_engine'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/supervisor.rb:559:in `block in run_worker'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/supervisor.rb:741:in `main_process'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/supervisor.rb:554:in `run_worker'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/command/fluentd.rb:330:in `<top (required)>'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/site_ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/site_ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/bin/fluentd:8:in `<top (required)>'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/bin/fluentd:23:in `load'\r\n  2019-12-04 11:16:42 +0800 [warn]: #0 C:/opt/td-agent/embedded/bin/fluentd:23:in `<main>'\r\n2019-12-04 11:16:42 +0800 [info]: #0 fluentd worker is now running worker=0\r\n2019-12-04 11:16:43 +0800 [warn]: #0 failed to write data into buffer by buffer overflow action=:throw_exception\r\n2019-12-04 11:16:43 +0800 [warn]: #0 emit transaction failed: error_class=Fluent::Plugin::Buffer::BufferOverflowError error=\"can't create buffer file for C:\\\\opt\\\\td-agent\\\\buffer/buffer.*.log. Stop creating buffer files: error = Too many open files @ rb_sysopen - C:\\\\opt\\\\td-agent\\\\buffer/buffer.b598d83df69790119ca6cba13d84aab66.log\" location=\"C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer/file_chunk.rb:291:in `rescue in create_new_chunk'\" tag=\"xxxx\"\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer/file_chunk.rb:291:in `rescue in create_new_chunk'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer/file_chunk.rb:283:in `create_new_chunk'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer/file_chunk.rb:54:in `initialize'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buf_file.rb:173:in `new'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buf_file.rb:173:in `generate_chunk'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:555:in `block in write_once'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/2.4.0/monitor.rb:214:in `mon_synchronize'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:555:in `write_once'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:278:in `block in write'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:276:in `each'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/buffer.rb:276:in `write'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:954:in `block in handle_stream_with_custom_format'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:880:in `write_guard'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:953:in `handle_stream_with_custom_format'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:872:in `execute_chunking'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/output.rb:800:in `emit_buffered'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/event_router.rb:160:in `emit_events'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/event_router.rb:97:in `emit_stream'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:410:in `receive_lines'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:528:in `wrap_receive_lines'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:762:in `block in handle_notify'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:806:in `with_io'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:742:in `handle_notify'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:738:in `block in on_notify'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:738:in `synchronize'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:738:in `on_notify'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:558:in `on_notify'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin/in_tail.rb:644:in `on_timer'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/cool.io-1.5.4/lib/cool.io/loop.rb:88:in `run_once'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/cool.io-1.5.4/lib/cool.io/loop.rb:88:in `run'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin_helper/event_loop.rb:93:in `block in start'\r\n  2019-12-04 11:16:43 +0800 [warn]: #0 C:/opt/td-agent/embedded/lib/ruby/gems/2.4.0/gems/fluentd-1.7.4/lib/fluent/plugin_helper/thread.rb:78:in `block in thread_create'\r\n2019-12-04 11:16:44 +0800 [warn]: #0 failed to flush the buffer. retry_time=0 next_retry_seconds=2019-12-04 11:16:45 +0800 chunk=\"598d83dd34653b8762cfb31e650b22df\" error_class=Errno::EMFILE error=\"Failed to open TCP connection to ac-conversion-log-bucket.s3.ap-northeast-1.amazonaws.com:443 (Too many open files - socket(2) for \\\"ac-conversion-log-bucket.s3.ap-northeast-1.amazonaws.com\\\" port 443)\"\r\n  ...\r\n  retry log continues from flush buffer\r\n```\r\n\r\n**Additional context:**\r\nUsing same config inside a fluent Debian container fluent/fluentd:v1.7-debian-1 works fine on both Linux and Windows 10 Pro(with linux container support).\r\n\r\nProblem happens only while running fluentd directly as a service on Windows or using same config inside a fluent Windows container Windows Server 2016(can't run linux container).\r\n\r\nSo I suspect there is something wrong specifically with fluent packaging on Windows. Please help!\r\n",
  "closed_at": "2020-01-17T02:51:49Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/700876?v=4",
    "events_url": "https://api.github.com/users/cosmo0920/events{/privacy}",
    "followers_url": "https://api.github.com/users/cosmo0920/followers",
    "following_url": "https://api.github.com/users/cosmo0920/following{/other_user}",
    "gists_url": "https://api.github.com/users/cosmo0920/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/cosmo0920",
    "id": 700876,
    "login": "cosmo0920",
    "node_id": "MDQ6VXNlcjcwMDg3Ng==",
    "organizations_url": "https://api.github.com/users/cosmo0920/orgs",
    "received_events_url": "https://api.github.com/users/cosmo0920/received_events",
    "repos_url": "https://api.github.com/users/cosmo0920/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/cosmo0920/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cosmo0920/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/cosmo0920"
  },
  "comments": 5,
  "comments_url": "https://api.github.com/repos/fluent/fluentd/issues/2713/comments",
  "created_at": "2019-12-04T04:53:04Z",
  "events_url": "https://api.github.com/repos/fluent/fluentd/issues/2713/events",
  "html_url": "https://github.com/fluent/fluentd/issues/2713",
  "id": 532449347,
  "labels": [],
  "labels_url": "https://api.github.com/repos/fluent/fluentd/issues/2713/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MzI0NDkzNDc=",
  "number": 2713,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/fluent/fluentd",
  "state": "closed",
  "title": "Buffer's `chunk_limit_size` not working as expected on Windows platform",
  "updated_at": "2020-01-17T02:51:49Z",
  "url": "https://api.github.com/repos/fluent/fluentd/issues/2713",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/32257827?v=4",
    "events_url": "https://api.github.com/users/mandyjohar23/events{/privacy}",
    "followers_url": "https://api.github.com/users/mandyjohar23/followers",
    "following_url": "https://api.github.com/users/mandyjohar23/following{/other_user}",
    "gists_url": "https://api.github.com/users/mandyjohar23/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mandyjohar23",
    "id": 32257827,
    "login": "mandyjohar23",
    "node_id": "MDQ6VXNlcjMyMjU3ODI3",
    "organizations_url": "https://api.github.com/users/mandyjohar23/orgs",
    "received_events_url": "https://api.github.com/users/mandyjohar23/received_events",
    "repos_url": "https://api.github.com/users/mandyjohar23/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mandyjohar23/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mandyjohar23/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mandyjohar23"
  }
}