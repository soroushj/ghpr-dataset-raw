{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "## Environment\n- fluentd 0.14.2\n- \\- \n- Ubuntu 16.04\n## Configuration\n\n```\n# In v1 configuration, type and id are @ prefix parameters.\n# @type and @id are recommended. type and id are still available for backward compatibility\n\n## built-in TCP input\n## $ echo <json> | fluent-cat <tag>\n<source>\n  @type forward\n  @id forward_input\n</source>\n\n# Listen HTTP for monitoring\n# http://localhost:24220/api/plugins\n# http://localhost:24220/api/plugins?type=TYPE\n# http://localhost:24220/api/plugins?tag=MYTAG\n<source>\n  @type monitor_agent\n  @id monitor_agent_input\n\n  port 24220\n</source>\n\n# Listen DRb for debug\n<source>\n  @type debug_agent\n  @id debug_agent_input\n\n  bind 127.0.0.1\n  port 24230\n</source>\n\n## match tag=debug.** and dump to console\n<match debug.**>\n  @type stdout\n  @id stdout_output\n</match>\n#<source>\n#  @type http\n#  @id collectd_input\n#\n#  port 12225\n#  format json\n#  tag mon.collectd\n#</source>\n\n<source>\n    @type unix\n    @id collectd_input\n\n    path /var/run/collectd-fluentd.sock\n    format json\n    tag collectd\n</source>\n\n<match collectd>\n  @type collectd_unroll\n\n  add_tag_prefix mon\n</match>\n\n<match mon.*>\n  buffer_type file\n  buffer_path /var/log/fluent/smc.*.buffer\n</match>\n\n<match mon.*>\n  @type forward\n  send_timeout 60s\n  recover_wait 10s\n  heartbeat_interval 1s\n  phi_threshold 16\n  hard_timeout 60s\n\n  <server>\n    name fluentd_server\n    host fluentd.service\n    port 24224\n    weight 60\n  </server>\n\n  <secondary>\n    @type file\n    path /var/log/fluent/forward-failed\n  </secondary>\n</match>\n```\n\nNote specifically the presence of the following buffer section, copied almost verbatim from http://docs.fluentd.org/articles/buffer-plugin-overview\n\n```\n<match mon.*>\n  buffer_type file\n  buffer_path /var/log/fluent/smc.*.buffer\n</match>\n```\n## Error\n\nWhen the buffer match is present a NIL reference occurs. If I remove the buffer section, the error disappears.\n\nThe error trace:\n\n```\n$ fluentd --dry-run -vv\n2016-09-01 13:32:48 +0000 [info]: fluent/supervisor.rb:583:read_config: reading config file path=\"/etc/fluent/fluent.conf\"\n2016-09-01 13:32:48 +0000 [info]: fluent/supervisor.rb:423:dry_run: starting fluentd-0.14.2 as dry run mode\n2016-09-01 13:32:48 +0000 [info]: fluent/engine.rb:116:block in configure: gem 'fluent-plugin-collectd-unroll' version '0.1.1'\n2016-09-01 13:32:48 +0000 [info]: fluent/engine.rb:116:block in configure: gem 'fluentd' version '0.14.2'\n2016-09-01 13:32:48 +0000 [info]: fluent/engine.rb:116:block in configure: gem 'fluentd' version '0.10.61'\n2016-09-01 13:32:48 +0000 [info]: fluent/agent.rb:131:add_match: adding match pattern=\"debug.**\" type=\"stdout\"\n2016-09-01 13:32:48 +0000 [trace]: fluent/plugin.rb:140:register_impl: registered output plugin 'stdout'\n2016-09-01 13:32:48 +0000 [trace]: fluent/plugin.rb:140:register_impl: registered formatter plugin 'json'\n2016-09-01 13:32:48 +0000 [info]: fluent/agent.rb:131:add_match: adding match pattern=\"collectd\" type=\"collectd_unroll\"\n2016-09-01 13:32:48 +0000 [trace]: fluent/plugin.rb:140:register_impl: registered output plugin 'collectd_unroll'\n2016-09-01 13:32:48 +0000 [info]: fluent/agent.rb:131:add_match: adding match pattern=\"mon.*\" type=nil\n2016-09-01 13:32:48 +0000 [error]: fluent/supervisor.rb:429:rescue in dry_run: dry run failed: undefined method `to_sym' for nil:NilClass\n```\n\nI've no familiarity with Ruby so can only surmise that the error is caused by the NIL type. If I add a type though (buffer as the guess), then it complains that the type is not recognised. It may of course have nothing to do with the type, but I'm at the limit of my knowledge on how to track this down further.\n",
  "closed_at": "2016-09-02T04:46:37Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/230654?v=4",
    "events_url": "https://api.github.com/users/tagomoris/events{/privacy}",
    "followers_url": "https://api.github.com/users/tagomoris/followers",
    "following_url": "https://api.github.com/users/tagomoris/following{/other_user}",
    "gists_url": "https://api.github.com/users/tagomoris/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tagomoris",
    "id": 230654,
    "login": "tagomoris",
    "node_id": "MDQ6VXNlcjIzMDY1NA==",
    "organizations_url": "https://api.github.com/users/tagomoris/orgs",
    "received_events_url": "https://api.github.com/users/tagomoris/received_events",
    "repos_url": "https://api.github.com/users/tagomoris/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tagomoris/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tagomoris/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tagomoris"
  },
  "comments": 11,
  "comments_url": "https://api.github.com/repos/fluent/fluentd/issues/1201/comments",
  "created_at": "2016-09-01T13:36:00Z",
  "events_url": "https://api.github.com/repos/fluent/fluentd/issues/1201/events",
  "html_url": "https://github.com/fluent/fluentd/issues/1201",
  "id": 174525247,
  "labels": [],
  "labels_url": "https://api.github.com/repos/fluent/fluentd/issues/1201/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxNzQ1MjUyNDc=",
  "number": 1201,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/fluent/fluentd",
  "state": "closed",
  "title": "Buffer match without type declaration fails with NIL reference ",
  "updated_at": "2016-09-06T16:39:14Z",
  "url": "https://api.github.com/repos/fluent/fluentd/issues/1201",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/2118872?v=4",
    "events_url": "https://api.github.com/users/builtbybrayne/events{/privacy}",
    "followers_url": "https://api.github.com/users/builtbybrayne/followers",
    "following_url": "https://api.github.com/users/builtbybrayne/following{/other_user}",
    "gists_url": "https://api.github.com/users/builtbybrayne/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/builtbybrayne",
    "id": 2118872,
    "login": "builtbybrayne",
    "node_id": "MDQ6VXNlcjIxMTg4NzI=",
    "organizations_url": "https://api.github.com/users/builtbybrayne/orgs",
    "received_events_url": "https://api.github.com/users/builtbybrayne/received_events",
    "repos_url": "https://api.github.com/users/builtbybrayne/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/builtbybrayne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/builtbybrayne/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/builtbybrayne"
  }
}