{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5616899?v=4",
    "events_url": "https://api.github.com/users/ganmacs/events{/privacy}",
    "followers_url": "https://api.github.com/users/ganmacs/followers",
    "following_url": "https://api.github.com/users/ganmacs/following{/other_user}",
    "gists_url": "https://api.github.com/users/ganmacs/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ganmacs",
    "id": 5616899,
    "login": "ganmacs",
    "node_id": "MDQ6VXNlcjU2MTY4OTk=",
    "organizations_url": "https://api.github.com/users/ganmacs/orgs",
    "received_events_url": "https://api.github.com/users/ganmacs/received_events",
    "repos_url": "https://api.github.com/users/ganmacs/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ganmacs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ganmacs/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ganmacs"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/5616899?v=4",
      "events_url": "https://api.github.com/users/ganmacs/events{/privacy}",
      "followers_url": "https://api.github.com/users/ganmacs/followers",
      "following_url": "https://api.github.com/users/ganmacs/following{/other_user}",
      "gists_url": "https://api.github.com/users/ganmacs/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/ganmacs",
      "id": 5616899,
      "login": "ganmacs",
      "node_id": "MDQ6VXNlcjU2MTY4OTk=",
      "organizations_url": "https://api.github.com/users/ganmacs/orgs",
      "received_events_url": "https://api.github.com/users/ganmacs/received_events",
      "repos_url": "https://api.github.com/users/ganmacs/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/ganmacs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ganmacs/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/ganmacs"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**Describe the bug**\r\nWhen I use sd_srv plugin, it always reports warnings saying \"thread doesn't exit correctly (killed or other reason)\".\r\n\r\n**To Reproduce**\r\nStart fluentd using sd_srv plugin.\r\n\r\n```\r\n% bundle exec fluentd -c forward.conf\r\n2020-04-28 20:00:21 +0900 [info]: parsing config file is succeeded path=\"forward.conf\"\r\n2020-04-28 20:00:21 +0900 [info]: gem 'fluentd' version '1.10.2'\r\n2020-04-28 20:00:21 +0900 [info]: adding forwarding server 'lvh.me' host=\"127.0.0.1\" port=25224 weight=100 plugin_id=\"object:2ad749de0238\"\r\n2020-04-28 20:00:21 +0900 [info]: using configuration file: <ROOT>\r\n  <match test>\r\n    @type forward\r\n    <service_discovery>\r\n      @type \"srv\"\r\n      service \"fluentd\"\r\n      proto \"tcp\"\r\n      hostname \"wanko.cc\"\r\n    </service_discovery>\r\n  </match>\r\n</ROOT>\r\n2020-04-28 20:00:21 +0900 [info]: starting fluentd-1.10.2 pid=709764 ruby=\"2.6.5\"\r\n2020-04-28 20:00:21 +0900 [info]: spawn command to main:  cmdline=[\"/home/eagletmt/.clg/github.com/rbenv/rbenv/versions/2.6.5/bin/ruby\", \"-r/home/eagletmt/.clg/github.com/rbenv/rbenv/versions/2.6.5/lib/ruby/gems/2.6.0/gems/bundler-2.1.4/lib/bundler/setup\", \"-Eascii-8bit:ascii-8bit\", \"/home/eagletmt/gems/ruby/2.6.0/bin/fluentd\", \"-c\", \"forward.conf\", \"--under-supervisor\"]\r\n2020-04-28 20:00:22 +0900 [info]: adding match pattern=\"test\" type=\"forward\"\r\n2020-04-28 20:00:22 +0900 [info]: #0 adding forwarding server 'lvh.me' host=\"127.0.0.1\" port=25224 weight=100 plugin_id=\"object:2b26e23de5bc\"\r\n2020-04-28 20:00:22 +0900 [info]: #0 starting fluentd worker pid=709802 ppid=709764 worker=0\r\n2020-04-28 20:00:22 +0900 [info]: #0 fluentd worker is now running worker=0\r\n```\r\n\r\nThen send SIGTERM to the process (`kill -TERM 709764`).\r\n\r\n**Expected behavior**\r\nThe fluentd process exits without any warnings.\r\n\r\n**Your Environment**\r\n\r\n- Fluentd or td-agent version: `fluentd --version` or `td-agent --version`\r\n    - fluentd 1.10.2\r\n- Operating system: `cat /etc/os-release`\r\n\r\n```\r\nNAME=\"Arch Linux\"\r\nPRETTY_NAME=\"Arch Linux\"\r\nID=arch\r\nBUILD_ID=rolling\r\nANSI_COLOR=\"0;36\"\r\nHOME_URL=\"https://www.archlinux.org/\"\r\nDOCUMENTATION_URL=\"https://wiki.archlinux.org/\"\r\nSUPPORT_URL=\"https://bbs.archlinux.org/\"\r\nBUG_REPORT_URL=\"https://bugs.archlinux.org/\"\r\nLOGO=archlinux\r\n```\r\n\r\n- Kernel version: `uname -r`\r\n    - 5.6.2-arch1-2\r\n\r\nIf you hit the problem with older fluentd version, try latest version first.\r\n\r\n**Your Configuration**\r\n\r\n```\r\n<match test>\r\n  @type forward\r\n  <service_discovery>\r\n    @type srv\r\n    service fluentd\r\n    proto tcp\r\n    hostname wanko.cc\r\n  </service_discovery>\r\n</match>\r\n```\r\n\r\n**Your Error Log**\r\n\r\n```\r\n2020-04-28 20:00:50 +0900 [info]: Received graceful stop\r\n2020-04-28 20:00:51 +0900 [info]: #0 fluentd worker is now stopping worker=0\r\n2020-04-28 20:00:51 +0900 [info]: #0 shutting down fluentd worker worker=0\r\n2020-04-28 20:00:51 +0900 [info]: #0 shutting down output plugin type=:forward plugin_id=\"object:2b26e23de5bc\"\r\n2020-04-28 20:00:51 +0900 [warn]: #0 thread doesn't exit correctly (killed or other reason) plugin=Fluent::Plugin::SrvServiceDiscovery title=:event_loop thread=#<Thread:0x0000564dc4cb40e0@event_loop@/home/eagletmt/gems/ruby/2.6.0/gems/fluentd-1.10.2/lib/fluent/plugin_helper/thread.rb:70 aborting> error=nil\r\n2020-04-28 20:00:51 +0900 [info]: Worker 0 finished with status 0\r\n```\r\n\r\n**Additional context**\r\n\r\n<!-- Add any other context about the problem here. -->\r\n",
  "closed_at": "2020-04-30T06:52:09Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5616899?v=4",
    "events_url": "https://api.github.com/users/ganmacs/events{/privacy}",
    "followers_url": "https://api.github.com/users/ganmacs/followers",
    "following_url": "https://api.github.com/users/ganmacs/following{/other_user}",
    "gists_url": "https://api.github.com/users/ganmacs/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ganmacs",
    "id": 5616899,
    "login": "ganmacs",
    "node_id": "MDQ6VXNlcjU2MTY4OTk=",
    "organizations_url": "https://api.github.com/users/ganmacs/orgs",
    "received_events_url": "https://api.github.com/users/ganmacs/received_events",
    "repos_url": "https://api.github.com/users/ganmacs/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ganmacs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ganmacs/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ganmacs"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/fluent/fluentd/issues/2972/comments",
  "created_at": "2020-04-28T11:07:19Z",
  "events_url": "https://api.github.com/repos/fluent/fluentd/issues/2972/events",
  "html_url": "https://github.com/fluent/fluentd/issues/2972",
  "id": 608229936,
  "labels": [
    {
      "color": "e11d21",
      "default": true,
      "description": null,
      "id": 94152935,
      "name": "bug",
      "node_id": "MDU6TGFiZWw5NDE1MjkzNQ==",
      "url": "https://api.github.com/repos/fluent/fluentd/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/fluent/fluentd/issues/2972/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MDgyMjk5MzY=",
  "number": 2972,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/fluent/fluentd",
  "state": "closed",
  "title": "sd_srv plugin always reports warnings while exiting",
  "updated_at": "2020-04-30T06:52:27Z",
  "url": "https://api.github.com/repos/fluent/fluentd/issues/2972",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/69755?v=4",
    "events_url": "https://api.github.com/users/eagletmt/events{/privacy}",
    "followers_url": "https://api.github.com/users/eagletmt/followers",
    "following_url": "https://api.github.com/users/eagletmt/following{/other_user}",
    "gists_url": "https://api.github.com/users/eagletmt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/eagletmt",
    "id": 69755,
    "login": "eagletmt",
    "node_id": "MDQ6VXNlcjY5NzU1",
    "organizations_url": "https://api.github.com/users/eagletmt/orgs",
    "received_events_url": "https://api.github.com/users/eagletmt/received_events",
    "repos_url": "https://api.github.com/users/eagletmt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/eagletmt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/eagletmt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/eagletmt"
  }
}