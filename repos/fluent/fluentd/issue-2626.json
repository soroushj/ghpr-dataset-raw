{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5616899?v=4",
    "events_url": "https://api.github.com/users/ganmacs/events{/privacy}",
    "followers_url": "https://api.github.com/users/ganmacs/followers",
    "following_url": "https://api.github.com/users/ganmacs/following{/other_user}",
    "gists_url": "https://api.github.com/users/ganmacs/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ganmacs",
    "id": 5616899,
    "login": "ganmacs",
    "node_id": "MDQ6VXNlcjU2MTY4OTk=",
    "organizations_url": "https://api.github.com/users/ganmacs/orgs",
    "received_events_url": "https://api.github.com/users/ganmacs/received_events",
    "repos_url": "https://api.github.com/users/ganmacs/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ganmacs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ganmacs/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ganmacs"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/5616899?v=4",
      "events_url": "https://api.github.com/users/ganmacs/events{/privacy}",
      "followers_url": "https://api.github.com/users/ganmacs/followers",
      "following_url": "https://api.github.com/users/ganmacs/following{/other_user}",
      "gists_url": "https://api.github.com/users/ganmacs/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/ganmacs",
      "id": 5616899,
      "login": "ganmacs",
      "node_id": "MDQ6VXNlcjU2MTY4OTk=",
      "organizations_url": "https://api.github.com/users/ganmacs/orgs",
      "received_events_url": "https://api.github.com/users/ganmacs/received_events",
      "repos_url": "https://api.github.com/users/ganmacs/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/ganmacs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ganmacs/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/ganmacs"
    }
  ],
  "author_association": "NONE",
  "body": "**Describe the bug**\r\nAfter upgrading to 1.7.1 from 1.6.3 most of our forwarders throw an out_forward unrecoverable error and never recovers. 1.6.3 does throw a similar error but recovers.\r\n\r\n**To Reproduce**\r\nUpgrade to 1.7.1 from 1.6.3\r\n\r\n**Expected behavior**\r\nout_forward server health checking should recover\r\n\r\n**Your Environment**\r\n\r\n- Fluentd or td-agent version: 1.6.3 -> 1.7.1\r\n- Operating system: debian buster\r\n- Kernel version: 4.14.119+\r\n\r\nIf you hit the problem with older fluentd version, try latest version first.\r\n\r\n**Your Configuration**\r\n\r\n```\r\n  <source>\r\n    @type monitor_agent\r\n    bind \"0.0.0.0\"\r\n    port 24220\r\n  </source>\r\n  <source>\r\n    @type prometheus\r\n  </source>\r\n  <source>\r\n    @type prometheus_output_monitor\r\n  </source>\r\n  <system>\r\n    log_level info\r\n  </system>\r\n  <match fluent.**>\r\n    @type null\r\n  </match>\r\n  <source>\r\n    @type tail\r\n    format syslog\r\n    path \"/var/log/startupscript.log\"\r\n    pos_file \"/var/log/fluentd/startupscript.log.pos\"\r\n    tag \"system.startupscript\"\r\n    <parse>\r\n      @type syslog\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format /^time=\"(?<time>[^)]*)\" level=(?<severity>[^ ]*) msg=\"(?<message>[^\"]*)\"( err=\"(?<error>[^\"]*)\")?( statusCode=($<status_code>\\d+))?/\r\n    path \"/var/log/docker.log\"\r\n    pos_file \"/var/log/fluentd/docker.log.pos\"\r\n    tag \"system.docker\"\r\n    <parse>\r\n      @type regexp\r\n      expression ^time=\"(?<time>[^)]*)\" level=(?<severity>[^ ]*) msg=\"(?<message>[^\"]*)\"( err=\"(?<error>[^\"]*)\")?( statusCode=($<status_code>\\d+))?\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format none\r\n    path \"/var/log/etcd.log\"\r\n    pos_file \"/var/log/fluentd/etcd.log.pos\"\r\n    tag \"system.etcd\"\r\n    <parse>\r\n      @type none\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format multiline\r\n    multiline_flush_interval 5s\r\n    format_firstline /^\\w\\d{4}/\r\n    format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    time_format %m%d %H:%M:%S.%N\r\n    path \"/var/log/kubelet.log\"\r\n    pos_file \"/var/log/fluentd/kubelet.log.pos\"\r\n    tag \"system.kubelet\"\r\n    <parse>\r\n      time_format %m%d %H:%M:%S.%N\r\n      format_firstline /^\\w\\d{4}/\r\n      @type multiline\r\n      format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format multiline\r\n    multiline_flush_interval 5s\r\n    format_firstline /^\\w\\d{4}/\r\n    format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    time_format %m%d %H:%M:%S.%N\r\n    path \"/var/log/kube-proxy.log\"\r\n    pos_file \"/var/log/fluentd/kube-proxy.log.pos\"\r\n    tag \"system.kube-proxy\"\r\n    <parse>\r\n      time_format %m%d %H:%M:%S.%N\r\n      format_firstline /^\\w\\d{4}/\r\n      @type multiline\r\n      format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format multiline\r\n    multiline_flush_interval 5s\r\n    format_firstline /^\\w\\d{4}/\r\n    format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    time_format %m%d %H:%M:%S.%N\r\n    path \"/var/log/kube-apiserver.log\"\r\n    pos_file \"/var/log/fluentd/kube-apiserver.log.pos\"\r\n    tag \"system.kube-apiserver\"\r\n    <parse>\r\n      time_format %m%d %H:%M:%S.%N\r\n      format_firstline /^\\w\\d{4}/\r\n      @type multiline\r\n      format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format multiline\r\n    multiline_flush_interval 5s\r\n    format_firstline /^\\w\\d{4}/\r\n    format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    time_format %m%d %H:%M:%S.%N\r\n    path \"/var/log/kube-controller-manager.log\"\r\n    pos_file \"/var/log/fluentd/kube-controller-manager.log.pos\"\r\n    tag \"system.kube-controller-manager\"\r\n    <parse>\r\n      time_format %m%d %H:%M:%S.%N\r\n      format_firstline /^\\w\\d{4}/\r\n      @type multiline\r\n      format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format multiline\r\n    multiline_flush_interval 5s\r\n    format_firstline /^\\w\\d{4}/\r\n    format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    time_format %m%d %H:%M:%S.%N\r\n    path \"/var/log/kube-scheduler.log\"\r\n    pos_file \"/var/log/fluentd/kube-scheduler.log.pos\"\r\n    tag \"system.kube-scheduler\"\r\n    <parse>\r\n      time_format %m%d %H:%M:%S.%N\r\n      format_firstline /^\\w\\d{4}/\r\n      @type multiline\r\n      format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format multiline\r\n    multiline_flush_interval 5s\r\n    format_firstline /^\\w\\d{4}/\r\n    format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    time_format %m%d %H:%M:%S.%N\r\n    path \"/var/log/rescheduler.log\"\r\n    pos_file \"/var/log/fluentd/rescheduler.log.pos\"\r\n    tag \"system.rescheduler\"\r\n    <parse>\r\n      time_format %m%d %H:%M:%S.%N\r\n      format_firstline /^\\w\\d{4}/\r\n      @type multiline\r\n      format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format multiline\r\n    multiline_flush_interval 5s\r\n    format_firstline /^\\w\\d{4}/\r\n    format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    time_format %m%d %H:%M:%S.%N\r\n    path \"/var/log/glbc.log\"\r\n    pos_file \"/var/log/fluentd/glbc.log.pos\"\r\n    tag \"system.glbc\"\r\n    <parse>\r\n      time_format %m%d %H:%M:%S.%N\r\n      format_firstline /^\\w\\d{4}/\r\n      @type multiline\r\n      format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @type tail\r\n    format multiline\r\n    multiline_flush_interval 5s\r\n    format_firstline /^\\w\\d{4}/\r\n    format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    time_format %m%d %H:%M:%S.%N\r\n    path \"/var/log/cluster-autoscaler.log\"\r\n    pos_file \"/var/log/fluentd/cluster-autoscaler.log.pos\"\r\n    tag \"system.cluster-autoscaler\"\r\n    <parse>\r\n      time_format %m%d %H:%M:%S.%N\r\n      format_firstline /^\\w\\d{4}/\r\n      @type multiline\r\n      format1 /^(?<severity>\\w)(?<time>\\d{4} [^\\s]*)\\s+(?<pid>\\d+)\\s+(?<source>[^ \\]]+)\\] (?<message>.*)/\r\n    </parse>\r\n  </source>\r\n  <source>\r\n    @id systemd-cri\r\n    @type systemd\r\n    matches [{\"_SYSTEMD_UNIT\":\"docker.service\"}]\r\n    read_from_head true\r\n    tag \"system.container-runtime\"\r\n    <storage>\r\n      @type \"local\"\r\n      persistent false\r\n      path \"/var/log/fluentd/journald-container-runtime.pos\"\r\n    </storage>\r\n    <entry>\r\n      fields_lowercase true\r\n      fields_strip_underscores true\r\n    </entry>\r\n  </source>\r\n  <source>\r\n    @id systemd-kubelet\r\n    @type systemd\r\n    matches [{\"_SYSTEMD_UNIT\":\"kubelet.service\"}]\r\n    read_from_head true\r\n    tag \"system.kubelet\"\r\n    <storage>\r\n      @type \"local\"\r\n      persistent false\r\n      path \"/var/log/fluentd/journald-kubelet.pos\"\r\n    </storage>\r\n    <entry>\r\n      fields_lowercase true\r\n      fields_strip_underscores true\r\n    </entry>\r\n  </source>\r\n  <source>\r\n    @id systemd-npd\r\n    @type systemd\r\n    matches [{\"_SYSTEMD_UNIT\":\"node-problem-detector.service\"}]\r\n    read_from_head true\r\n    tag \"system.node-problem-detector\"\r\n    <storage>\r\n      @type \"local\"\r\n      persistent false\r\n      path \"/var/log/fluentd/journald-node-problem-detector.pos\"\r\n    </storage>\r\n    <entry>\r\n      fields_lowercase true\r\n      fields_strip_underscores true\r\n    </entry>\r\n  </source>\r\n  <filter **>\r\n    @type record_modifier\r\n    char_encoding \"utf-8\"\r\n  </filter>\r\n  <filter system.**>\r\n    @type record_modifier\r\n    remove_keys \"cmdline,hostname,boot_id,machine_id,systemd_invocation_id\"\r\n    <record>\r\n      kube_cluster tier2\r\n      host gke-tier2-us-east1-cluster-default-1-2d973341-gvhb\r\n      location gcp-us-east1\r\n      source ${tag_parts[1]}\r\n      sourcetype fluentd\r\n    </record>\r\n  </filter>\r\n  <match system.**>\r\n    @type forward\r\n    @id forward\r\n    compress gzip\r\n    ignore_network_errors_at_startup true\r\n    keepalive true\r\n    keepalive_timeout 60s\r\n    heartbeat_type udp\r\n    <server>\r\n      host \"fluentd-aggregator\"\r\n      port 24224\r\n    </server>\r\n    <server>\r\n      host \"fluentd-failover-publisher\"\r\n      port 24224\r\n      standby\r\n    </server>\r\n    <buffer>\r\n      @type \"file\"\r\n      path \"/var/log/fluentd/fluentd/kubernetes.system-forwarder.buffer\"\r\n      chunk_limit_size 1M\r\n      total_limit_size 10240M\r\n      flush_interval 5s\r\n      retry_max_interval 30\r\n      retry_forever true\r\n      flush_thread_count 4\r\n      overflow_action block\r\n      compress gzip\r\n    </buffer>\r\n  </match>\r\n</ROOT>\r\n```\r\n\r\n**Your Error Log**\r\n\r\n```\r\n2019-09-20 15:09:12 +0000 [warn]: #0 [forward] detached forwarding server '' host=\"fluentd-failover-publisher\" port=24224 phi=16.049416432170446 phi_threshold=16\r\n2019-09-20 15:10:48 +0000 [warn]: #0 [forward] got unrecoverable error in primary and no secondary error_class=NoMethodError error=\"undefined method `empty?' for nil:NilClass\"\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/socket_cache.rb:116:in `pick_socket'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/socket_cache.rb:35:in `block in checkout_or'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/socket_cache.rb:34:in `synchronize'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/socket_cache.rb:34:in `checkout_or'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/connection_manager.rb:85:in `connect_keepalive'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/connection_manager.rb:42:in `connect'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:732:in `connect'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:606:in `send_data'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:336:in `block in write'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:46:in `block in select_healthy_node'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:37:in `times'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:37:in `select_healthy_node'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:336:in `write'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1125:in `try_flush'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1431:in `flush_thread_run'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:461:in `block (2 levels) in start'\r\n  2019-09-20 15:10:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin_helper/thread.rb:78:in `block in thread_create'\r\n2019-09-20 15:10:48 +0000 [warn]: #0 [forward] bad chunk is moved to /tmp/fluent/backup/worker0/forward/592fd795b36962a1f96a893d2330a0e7.log\r\n2019-09-20 15:10:58 +0000 [warn]: #0 [forward] got unrecoverable error in primary and no secondary error_class=NoMethodError error=\"undefined method `empty?' for nil:NilClass\"\r\n  2019-09-20 15:10:58 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:10:58 +0000 [warn]: #0 [forward] bad chunk is moved to /tmp/fluent/backup/worker0/forward/592fd79f3cebb05a54d945f8b57b26cc.log\r\n2019-09-20 15:11:08 +0000 [warn]: #0 [forward] got unrecoverable error in primary and no secondary error_class=NoMethodError error=\"undefined method `empty?' for nil:NilClass\"\r\n  2019-09-20 15:11:08 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:11:08 +0000 [warn]: #0 [forward] bad chunk is moved to /tmp/fluent/backup/worker0/forward/592fd7a8c651134b99d70995594bd46e.log\r\n2019-09-20 15:11:18 +0000 [warn]: #0 [forward] got unrecoverable error in primary and no secondary error_class=NoMethodError error=\"undefined method `empty?' for nil:NilClass\"\r\n  2019-09-20 15:11:18 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:11:18 +0000 [warn]: #0 [forward] bad chunk is moved to /tmp/fluent/backup/worker0/forward/592fd7b24fdc2878850e8b9b96e67862.log\r\n2019-09-20 15:11:28 +0000 [warn]: #0 [forward] got unrecoverable error in primary and no secondary error_class=NoMethodError error=\"undefined method `empty?' for nil:NilClass\"\r\n  2019-09-20 15:11:28 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:11:28 +0000 [warn]: #0 [forward] bad chunk is moved to /tmp/fluent/backup/worker0/forward/592fd7bbd92ec73541629192d82eaa2e.log\r\n2019-09-20 15:11:38 +0000 [warn]: #0 [forward] got unrecoverable error in primary and no secondary error_class=NoMethodError error=\"undefined method `empty?' for nil:NilClass\"\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/socket_cache.rb:116:in `pick_socket'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/socket_cache.rb:35:in `block in checkout_or'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/socket_cache.rb:34:in `synchronize'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/socket_cache.rb:34:in `checkout_or'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/connection_manager.rb:85:in `connect_keepalive'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/connection_manager.rb:42:in `connect'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:732:in `connect'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:606:in `send_data'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:336:in `block in write'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:46:in `block in select_healthy_node'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:37:in `times'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:37:in `select_healthy_node'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:336:in `write'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1125:in `try_flush'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1431:in `flush_thread_run'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:461:in `block (2 levels) in start'\r\n  2019-09-20 15:11:38 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin_helper/thread.rb:78:in `block in thread_create'\r\n2019-09-20 15:11:38 +0000 [warn]: #0 [forward] bad chunk is moved to /tmp/fluent/backup/worker0/forward/592fd7c563d25ac2a0c56a7971cb5d30.log\r\n2019-09-20 15:11:39 +0000 [warn]: #0 [forward] detached forwarding server '' host=\"fluentd-aggregator\" port=24224 hard_timeout=true\r\n2019-09-20 15:11:48 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=0 next_retry_seconds=2019-09-20 15:11:49 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:11:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:55:in `select_healthy_node'\r\n  2019-09-20 15:11:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:336:in `write'\r\n  2019-09-20 15:11:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1125:in `try_flush'\r\n  2019-09-20 15:11:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1431:in `flush_thread_run'\r\n  2019-09-20 15:11:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:461:in `block (2 levels) in start'\r\n  2019-09-20 15:11:48 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin_helper/thread.rb:78:in `block in thread_create'\r\n2019-09-20 15:11:49 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=1 next_retry_seconds=2019-09-20 15:11:51 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:11:49 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:55:in `select_healthy_node'\r\n  2019-09-20 15:11:49 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:336:in `write'\r\n  2019-09-20 15:11:49 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1125:in `try_flush'\r\n  2019-09-20 15:11:49 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1431:in `flush_thread_run'\r\n  2019-09-20 15:11:49 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:461:in `block (2 levels) in start'\r\n  2019-09-20 15:11:49 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin_helper/thread.rb:78:in `block in thread_create'\r\n2019-09-20 15:11:51 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=2 next_retry_seconds=2019-09-20 15:11:52 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:11:51 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:11:52 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=3 next_retry_seconds=2019-09-20 15:11:56 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:11:52 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:55:in `select_healthy_node'\r\n  2019-09-20 15:11:52 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:336:in `write'\r\n  2019-09-20 15:11:52 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1125:in `try_flush'\r\n  2019-09-20 15:11:52 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1431:in `flush_thread_run'\r\n  2019-09-20 15:11:52 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:461:in `block (2 levels) in start'\r\n  2019-09-20 15:11:52 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin_helper/thread.rb:78:in `block in thread_create'\r\n2019-09-20 15:11:56 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=4 next_retry_seconds=2019-09-20 15:12:03 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:11:56 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:12:03 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=5 next_retry_seconds=2019-09-20 15:12:19 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:12:03 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward/load_balancer.rb:55:in `select_healthy_node'\r\n  2019-09-20 15:12:03 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/out_forward.rb:336:in `write'\r\n  2019-09-20 15:12:03 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1125:in `try_flush'\r\n  2019-09-20 15:12:03 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:1431:in `flush_thread_run'\r\n  2019-09-20 15:12:03 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin/output.rb:461:in `block (2 levels) in start'\r\n  2019-09-20 15:12:03 +0000 [warn]: #0 /app/vendor/bundle/ruby/2.6.0/bundler/gems/fluentd-dc20204dc9fc/lib/fluent/plugin_helper/thread.rb:78:in `block in thread_create'\r\n2019-09-20 15:12:19 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=6 next_retry_seconds=2019-09-20 15:12:51 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:12:19 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:12:51 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=7 next_retry_seconds=2019-09-20 15:13:19 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:12:51 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:13:19 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=8 next_retry_seconds=2019-09-20 15:13:52 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:13:19 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:13:52 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=9 next_retry_seconds=2019-09-20 15:14:21 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n  2019-09-20 15:13:52 +0000 [warn]: #0 suppressed same stacktrace\r\n2019-09-20 15:14:21 +0000 [warn]: #0 [forward] failed to flush the buffer. retry_time=10 next_retry_seconds=2019-09-20 15:14:51 +0000 chunk=\"592fd7ceebe490e9e802ef0b16909e38\" error_class=Fluent::Plugin::ForwardOutput::NoNodesAvailable error=\"no nodes are available\"\r\n```\r\n\r\n**Additional context**\r\n\r\n1.7.1 will continue to fail and retry with error=\"no nodes are available\".\r\n\r\n1.6.3 pod logs - throws similar error but recovers and forwards logs [fluentd-system-forwarder-wk46w.log](https://github.com/fluent/fluentd/files/3636885/fluentd-system-forwarder-wk46w.log)\r\n1.7.1 pod logs - never recovers \r\n[fluentd-system-forwarder-xh5tp.log](https://github.com/fluent/fluentd/files/3636888/fluentd-system-forwarder-xh5tp.log)\r\n\r\n\r\n",
  "closed_at": "2019-09-30T08:25:06Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5616899?v=4",
    "events_url": "https://api.github.com/users/ganmacs/events{/privacy}",
    "followers_url": "https://api.github.com/users/ganmacs/followers",
    "following_url": "https://api.github.com/users/ganmacs/following{/other_user}",
    "gists_url": "https://api.github.com/users/ganmacs/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ganmacs",
    "id": 5616899,
    "login": "ganmacs",
    "node_id": "MDQ6VXNlcjU2MTY4OTk=",
    "organizations_url": "https://api.github.com/users/ganmacs/orgs",
    "received_events_url": "https://api.github.com/users/ganmacs/received_events",
    "repos_url": "https://api.github.com/users/ganmacs/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ganmacs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ganmacs/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ganmacs"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/fluent/fluentd/issues/2626/comments",
  "created_at": "2019-09-20T16:32:21Z",
  "events_url": "https://api.github.com/repos/fluent/fluentd/issues/2626/events",
  "html_url": "https://github.com/fluent/fluentd/issues/2626",
  "id": 496444324,
  "labels": [
    {
      "color": "e11d21",
      "default": true,
      "description": null,
      "id": 94152935,
      "name": "bug",
      "node_id": "MDU6TGFiZWw5NDE1MjkzNQ==",
      "url": "https://api.github.com/repos/fluent/fluentd/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/fluent/fluentd/issues/2626/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0OTY0NDQzMjQ=",
  "number": 2626,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/fluent/fluentd",
  "state": "closed",
  "title": "out_forward unrecoverable error when upgrading from 1.6.3 to 1.7.1",
  "updated_at": "2019-09-30T08:25:06Z",
  "url": "https://api.github.com/repos/fluent/fluentd/issues/2626",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1230015?v=4",
    "events_url": "https://api.github.com/users/stonith/events{/privacy}",
    "followers_url": "https://api.github.com/users/stonith/followers",
    "following_url": "https://api.github.com/users/stonith/following{/other_user}",
    "gists_url": "https://api.github.com/users/stonith/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/stonith",
    "id": 1230015,
    "login": "stonith",
    "node_id": "MDQ6VXNlcjEyMzAwMTU=",
    "organizations_url": "https://api.github.com/users/stonith/orgs",
    "received_events_url": "https://api.github.com/users/stonith/received_events",
    "repos_url": "https://api.github.com/users/stonith/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/stonith/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stonith/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/stonith"
  }
}