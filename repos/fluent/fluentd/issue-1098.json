{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/230654?v=4",
    "events_url": "https://api.github.com/users/tagomoris/events{/privacy}",
    "followers_url": "https://api.github.com/users/tagomoris/followers",
    "following_url": "https://api.github.com/users/tagomoris/following{/other_user}",
    "gists_url": "https://api.github.com/users/tagomoris/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tagomoris",
    "id": 230654,
    "login": "tagomoris",
    "node_id": "MDQ6VXNlcjIzMDY1NA==",
    "organizations_url": "https://api.github.com/users/tagomoris/orgs",
    "received_events_url": "https://api.github.com/users/tagomoris/received_events",
    "repos_url": "https://api.github.com/users/tagomoris/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tagomoris/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tagomoris/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tagomoris"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/230654?v=4",
      "events_url": "https://api.github.com/users/tagomoris/events{/privacy}",
      "followers_url": "https://api.github.com/users/tagomoris/followers",
      "following_url": "https://api.github.com/users/tagomoris/following{/other_user}",
      "gists_url": "https://api.github.com/users/tagomoris/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/tagomoris",
      "id": 230654,
      "login": "tagomoris",
      "node_id": "MDQ6VXNlcjIzMDY1NA==",
      "organizations_url": "https://api.github.com/users/tagomoris/orgs",
      "received_events_url": "https://api.github.com/users/tagomoris/received_events",
      "repos_url": "https://api.github.com/users/tagomoris/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/tagomoris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tagomoris/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/tagomoris"
    }
  ],
  "author_association": "NONE",
  "body": "Running fluentd 0.14.1, installed with `gem`, on Arch Linux. I setup a simple `fluent.conf` demo like this:\n\n```\n<source>\n  @type forward\n  port 24224\n</source>\n\n<filter demo.temperature>\n  @type record_transformer\n  enable_ruby true\n  <record>\n    cpu_temp ${record[\"cpu_temp\"] + 273.1}\n  </record>\n</filter>\n\n<match demo.temperature>\n  @type file\n  path temperature\n  flush_interval 1s\n  append true\n</match>\n\n<match **>\n  @type stdout\n</match>\n```\n\nAnd I fed it data with a python script as follows:\n\n``` python\n#!/usr/bin/env python\nimport threading\nfrom random import random\nfrom fluent import event, sender\n\n\ndef set_interval(func, sec):\n    def func_wrapper():\n        set_interval(func, sec)\n        func()\n    t = threading.Timer(sec, func_wrapper)\n    t.start()\n    return t\n\n\ndef send_event():\n    temp = 70 + random() * (120 - 70)  # 70 to 100\n    e = {\"hostname\": \"somehost\", \"cpu_temp\": temp}\n    event.Event(\"temperature\", e)\n\n    print(e)\n\n\nif __name__ == \"__main__\":\n    sender.setup('demo', host='localhost', port=24224)\n    set_interval(send_event, 1)\n```\n\nHowever, fluentd goes crazy after a short while. The directory with the fluentd configuration file gets filled with buffer files:\n\n``` bash\ndemo.py\nfluentd.conf\nrequirements.txt\ntemperature.20160713.log\ntemperature.b5377a1127d7372b0cce743309564537e.log\ntemperature.b5377a1127d7372b0cce743309564537e.log.meta\ntemperature.q5377a0ef3166873b918670336db4363b.log\ntemperature.q5377a0ef3166873b918670336db4363b.log.meta\ntemperature.q5377a0f0259024f31fbd332a6b46d5d0.log\ntemperature.q5377a0f0259024f31fbd332a6b46d5d0.log.meta\ntemperature.q5377a0f119b896c8c47a246b8c5beb3e.log\ntemperature.q5377a0f119b896c8c47a246b8c5beb3e.log.meta\ntemperature.q5377a0f20df0d19d406ccd7bfce1b7ac.log\ntemperature.q5377a0f20df0d19d406ccd7bfce1b7ac.log.meta\ntemperature.q5377a0f3023b750a28abbe69ad70814a.log\ntemperature.q5377a0f3023b750a28abbe69ad70814a.log.meta\ntemperature.q5377a0f3f65fa1859ba3e9d757e6c354.log\ntemperature.q5377a0f3f65fa1859ba3e9d757e6c354.log.meta\ntemperature.q5377a0f4ea975c703d1a09a1851b4941.log\ntemperature.q5377a0f4ea975c703d1a09a1851b4941.log.meta\ntemperature.q5377a0f5ded4e986152edef1f0ac5a25.log\ntemperature.q5377a0f5ded4e986152edef1f0ac5a25.log.meta\ntemperature.q5377a0f6d30d0540bc30e18159e6ba58.log\ntemperature.q5377a0f6d30d0540bc30e18159e6ba58.log.meta\ntemperature.q5377a0f7c7429d5f36b185742e212109.log\ntemperature.q5377a0f7c7429d5f36b185742e212109.log.meta\ntemperature.q5377a0f8bb79791d30682c34af3c1427.log\ntemperature.q5377a0f8bb79791d30682c34af3c1427.log.meta\ntemperature.q5377a0f9afbe277a9716c4c9d0665545.log\ntemperature.q5377a0f9afbe277a9716c4c9d0665545.log.meta\ntemperature.q5377a0faa422051a5e377990842dc252.log\ntemperature.q5377a0faa422051a5e377990842dc252.log.meta\ntemperature.q5377a0fb983431366edd54cb8ce22488.log\ntemperature.q5377a0fb983431366edd54cb8ce22488.log.meta\ntemperature.q5377a0fc8c6b774ffe008bf0c5f57037.log\ntemperature.q5377a0fc8c6b774ffe008bf0c5f57037.log.meta\ntemperature.q5377a0fd80a63a9cf2747d50ee657932.log\ntemperature.q5377a0fd80a63a9cf2747d50ee657932.log.meta\ntemperature.q5377a0fe74dc694dd158ad01cd33660e.log\ntemperature.q5377a0fe74dc694dd158ad01cd33660e.log.meta\ntemperature.q5377a0ff691f91a3e90fc0249bc90f73.log\ntemperature.q5377a0ff691f91a3e90fc0249bc90f73.log.meta\ntemperature.q5377a1005d45b5e1839042e134b95a4b.log\ntemperature.q5377a1005d45b5e1839042e134b95a4b.log.meta\ntemperature.q5377a101518dba28a4d1fa385cb81e67.log\n# and many more like this\n```\n\nTrying to close fluentd with SIGINT or SIGTERM fails, so I killed it with SIGKILL:\n\n```\n2016-07-13 10:10:59 +0900 [info]: plugin/in_forward.rb:99:listen: listening fluent socket on 0.0.0.0:24224\n2016-07-13 10:10:59 +0900 [trace]: plugin/in_forward.rb:246:initialize: accepted fluent socket from '127.0.0.1:49676': object_id=12974500\n2016-07-13 10:10:59 +0900 fluent.trace: {\"message\":\"accepted fluent socket from '127.0.0.1:49676': object_id=12974500\"}\n^C2016-07-13 10:11:36 +0900 [debug]: fluent/supervisor.rb:489:block in install_main_process_signal_handlers: fluentd main process get SIGINT\n2016-07-13 10:11:36 +0900 [info]: serverengine/server.rb:43:stop: Received graceful stop\n2016-07-13 10:11:36 +0900 fluent.debug: {\"message\":\"fluentd main process get SIGINT\"}\n2016-07-13 10:11:37 +0900 [debug]: fluent/supervisor.rb:493:block in install_main_process_signal_handlers: fluentd main process get SIGTERM\n2016-07-13 10:11:37 +0900 [debug]: fluent/supervisor.rb:496:block in install_main_process_signal_handlers: getting start to shutdown main process\n2016-07-13 10:11:37 +0900 [info]: fluent/engine.rb:190:run: shutting down fluentd\n2016-07-13 10:11:37 +0900 [debug]: fluent/root_agent.rb:170:block (2 levels) in shutdown: calling stop on input plugin type=:forward plugin_id=\"object:cb5700\"\n2016-07-13 10:11:37 +0900 [debug]: fluent/root_agent.rb:170:block (2 levels) in shutdown: calling stop on output plugin type=:file plugin_id=\"object:a9b154\"\n2016-07-13 10:11:37 +0900 [debug]: fluent/root_agent.rb:170:block (2 levels) in shutdown: calling stop on filter plugin type=:record_transformer plugin_id=\"object:edecac\"\n2016-07-13 10:11:37 +0900 [debug]: fluent/root_agent.rb:170:block (2 levels) in shutdown: calling stop on output plugin type=:stdout plugin_id=\"object:f683e4\"\n2016-07-13 10:11:37 +0900 fluent.debug: {\"message\":\"fluentd main process get SIGTERM\"}\n2016-07-13 10:11:37 +0900 fluent.debug: {\"message\":\"getting start to shutdown main process\"}\n2016-07-13 10:11:37 +0900 fluent.info: {\"message\":\"shutting down fluentd\"}\n2016-07-13 10:11:37 +0900 fluent.debug: {\"type\":\"forward\",\"plugin_id\":\"object:cb5700\",\"message\":\"calling stop on input plugin type=:forward plugin_id=\\\"object:cb5700\\\"\"}\n2016-07-13 10:11:37 +0900 fluent.debug: {\"type\":\"file\",\"plugin_id\":\"object:a9b154\",\"message\":\"calling stop on output plugin type=:file plugin_id=\\\"object:a9b154\\\"\"}\n2016-07-13 10:11:37 +0900 [info]: fluent/root_agent.rb:196:block (3 levels) in shutdown: preparing shutdown input plugin type=:forward plugin_id=\"object:cb5700\"\n2016-07-13 10:11:37 +0900 [info]: fluent/root_agent.rb:196:block (3 levels) in shutdown: preparing shutdown output plugin type=:file plugin_id=\"object:a9b154\"\n2016-07-13 10:11:37 +0900 fluent.debug: {\"type\":\"record_transformer\",\"plugin_id\":\"object:edecac\",\"message\":\"calling stop on filter plugin type=:record_transformer plugin_id=\\\"object:edecac\\\"\"}\n2016-07-13 10:11:37 +0900 [info]: fluent/root_agent.rb:196:block (3 levels) in shutdown: preparing shutdown filter plugin type=:record_transformer plugin_id=\"object:edecac\"\n2016-07-13 10:11:37 +0900 fluent.debug: {\"type\":\"stdout\",\"plugin_id\":\"object:f683e4\",\"message\":\"calling stop on output plugin type=:stdout plugin_id=\\\"object:f683e4\\\"\"}\n2016-07-13 10:11:37 +0900 [info]: fluent/root_agent.rb:196:block (3 levels) in shutdown: preparing shutdown output plugin type=:stdout plugin_id=\"object:f683e4\"\n2016-07-13 10:11:37 +0900 [info]: fluent/root_agent.rb:196:block (3 levels) in shutdown: shutting down input plugin type=:forward plugin_id=\"object:cb5700\"\n2016-07-13 10:11:37 +0900 fluent.info: {\"type\":\"forward\",\"plugin_id\":\"object:cb5700\",\"message\":\"preparing shutdown input plugin type=:forward plugin_id=\\\"object:cb5700\\\"\"}\n2016-07-13 10:11:37 +0900 fluent.info: {\"type\":\"file\",\"plugin_id\":\"object:a9b154\",\"message\":\"preparing shutdown output plugin type=:file plugin_id=\\\"object:a9b154\\\"\"}\n2016-07-13 10:11:37 +0900 fluent.info: {\"type\":\"record_transformer\",\"plugin_id\":\"object:edecac\",\"message\":\"preparing shutdown filter plugin type=:record_transformer plugin_id=\\\"object:edecac\\\"\"}\n2016-07-13 10:11:37 +0900 fluent.info: {\"type\":\"stdout\",\"plugin_id\":\"object:f683e4\",\"message\":\"preparing shutdown output plugin type=:stdout plugin_id=\\\"object:f683e4\\\"\"}\n2016-07-13 10:11:37 +0900 fluent.info: {\"type\":\"forward\",\"plugin_id\":\"object:cb5700\",\"message\":\"shutting down input plugin type=:forward plugin_id=\\\"object:cb5700\\\"\"}\n2016-07-13 10:11:37 +0900 [info]: fluent/root_agent.rb:196:block (3 levels) in shutdown: shutting down output plugin type=:file plugin_id=\"object:a9b154\"\n2016-07-13 10:11:37 +0900 [info]: fluent/root_agent.rb:196:block (3 levels) in shutdown: shutting down filter plugin type=:record_transformer plugin_id=\"object:edecac\"\n2016-07-13 10:11:37 +0900 [info]: fluent/root_agent.rb:196:block (3 levels) in shutdown: shutting down output plugin type=:stdout plugin_id=\"object:f683e4\"\n2016-07-13 10:11:37 +0900 [debug]: fluent/root_agent.rb:170:block (2 levels) in shutdown: calling after_shutdown on input plugin type=:forward plugin_id=\"object:cb5700\"\n2016-07-13 10:11:37 +0900 [debug]: fluent/root_agent.rb:170:block (2 levels) in shutdown: calling after_shutdown on output plugin type=:file plugin_id=\"object:a9b154\"\n2016-07-13 10:11:37 +0900 fluent.info: {\"type\":\"file\",\"plugin_id\":\"object:a9b154\",\"message\":\"shutting down output plugin type=:file plugin_id=\\\"object:a9b154\\\"\"}\n2016-07-13 10:11:37 +0900 fluent.info: {\"type\":\"record_transformer\",\"plugin_id\":\"object:edecac\",\"message\":\"shutting down filter plugin type=:record_transformer plugin_id=\\\"object:edecac\\\"\"}\n2016-07-13 10:11:37 +0900 fluent.info: {\"type\":\"stdout\",\"plugin_id\":\"object:f683e4\",\"message\":\"shutting down output plugin type=:stdout plugin_id=\\\"object:f683e4\\\"\"}\n2016-07-13 10:11:37 +0900 fluent.debug: {\"type\":\"forward\",\"plugin_id\":\"object:cb5700\",\"message\":\"calling after_shutdown on input plugin type=:forward plugin_id=\\\"object:cb5700\\\"\"}\n2016-07-13 10:11:37 +0900 fluent.debug: {\"type\":\"file\",\"plugin_id\":\"object:a9b154\",\"message\":\"calling after_shutdown on output plugin type=:file plugin_id=\\\"object:a9b154\\\"\"}\n[1]    26900 killed     fluentd -c ./fluentd.conf -vv\n```\n\nIf I let it keep running it crashes my computer.\nThanks!\n",
  "closed_at": "2016-07-28T02:51:40Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/16928?v=4",
    "events_url": "https://api.github.com/users/repeatedly/events{/privacy}",
    "followers_url": "https://api.github.com/users/repeatedly/followers",
    "following_url": "https://api.github.com/users/repeatedly/following{/other_user}",
    "gists_url": "https://api.github.com/users/repeatedly/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/repeatedly",
    "id": 16928,
    "login": "repeatedly",
    "node_id": "MDQ6VXNlcjE2OTI4",
    "organizations_url": "https://api.github.com/users/repeatedly/orgs",
    "received_events_url": "https://api.github.com/users/repeatedly/received_events",
    "repos_url": "https://api.github.com/users/repeatedly/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/repeatedly/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/repeatedly/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/repeatedly"
  },
  "comments": 18,
  "comments_url": "https://api.github.com/repos/fluent/fluentd/issues/1098/comments",
  "created_at": "2016-07-13T01:22:49Z",
  "events_url": "https://api.github.com/repos/fluent/fluentd/issues/1098/events",
  "html_url": "https://github.com/fluent/fluentd/issues/1098",
  "id": 165216801,
  "labels": [
    {
      "color": "009800",
      "default": false,
      "description": null,
      "id": 146493149,
      "name": "v0.14",
      "node_id": "MDU6TGFiZWwxNDY0OTMxNDk=",
      "url": "https://api.github.com/repos/fluent/fluentd/labels/v0.14"
    }
  ],
  "labels_url": "https://api.github.com/repos/fluent/fluentd/issues/1098/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxNjUyMTY4MDE=",
  "number": 1098,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/fluent/fluentd",
  "state": "closed",
  "title": "Fluentd crashes",
  "updated_at": "2017-11-05T01:01:32Z",
  "url": "https://api.github.com/repos/fluent/fluentd/issues/1098",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5774716?v=4",
    "events_url": "https://api.github.com/users/perrin4869/events{/privacy}",
    "followers_url": "https://api.github.com/users/perrin4869/followers",
    "following_url": "https://api.github.com/users/perrin4869/following{/other_user}",
    "gists_url": "https://api.github.com/users/perrin4869/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/perrin4869",
    "id": 5774716,
    "login": "perrin4869",
    "node_id": "MDQ6VXNlcjU3NzQ3MTY=",
    "organizations_url": "https://api.github.com/users/perrin4869/orgs",
    "received_events_url": "https://api.github.com/users/perrin4869/received_events",
    "repos_url": "https://api.github.com/users/perrin4869/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/perrin4869/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/perrin4869/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/perrin4869"
  }
}