{
  "_links": {
    "comments": {
      "href": "https://api.github.com/repos/vitessio/vitess/issues/4491/comments"
    },
    "commits": {
      "href": "https://api.github.com/repos/vitessio/vitess/pulls/4491/commits"
    },
    "html": {
      "href": "https://github.com/vitessio/vitess/pull/4491"
    },
    "issue": {
      "href": "https://api.github.com/repos/vitessio/vitess/issues/4491"
    },
    "review_comment": {
      "href": "https://api.github.com/repos/vitessio/vitess/pulls/comments{/number}"
    },
    "review_comments": {
      "href": "https://api.github.com/repos/vitessio/vitess/pulls/4491/comments"
    },
    "self": {
      "href": "https://api.github.com/repos/vitessio/vitess/pulls/4491"
    },
    "statuses": {
      "href": "https://api.github.com/repos/vitessio/vitess/statuses/0e37f1f019e1a7238218f907ed6097e4d7bd50d9"
    }
  },
  "active_lock_reason": null,
  "additions": 3876,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "base": {
    "label": "vitessio:master",
    "ref": "master",
    "repo": {
      "archive_url": "https://api.github.com/repos/vitessio/vitess/{archive_format}{/ref}",
      "archived": false,
      "assignees_url": "https://api.github.com/repos/vitessio/vitess/assignees{/user}",
      "blobs_url": "https://api.github.com/repos/vitessio/vitess/git/blobs{/sha}",
      "branches_url": "https://api.github.com/repos/vitessio/vitess/branches{/branch}",
      "clone_url": "https://github.com/vitessio/vitess.git",
      "collaborators_url": "https://api.github.com/repos/vitessio/vitess/collaborators{/collaborator}",
      "comments_url": "https://api.github.com/repos/vitessio/vitess/comments{/number}",
      "commits_url": "https://api.github.com/repos/vitessio/vitess/commits{/sha}",
      "compare_url": "https://api.github.com/repos/vitessio/vitess/compare/{base}...{head}",
      "contents_url": "https://api.github.com/repos/vitessio/vitess/contents/{+path}",
      "contributors_url": "https://api.github.com/repos/vitessio/vitess/contributors",
      "created_at": "2013-06-27T21:20:28Z",
      "default_branch": "master",
      "deployments_url": "https://api.github.com/repos/vitessio/vitess/deployments",
      "description": "Vitess is a database clustering system for horizontal scaling of MySQL.",
      "disabled": false,
      "downloads_url": "https://api.github.com/repos/vitessio/vitess/downloads",
      "events_url": "https://api.github.com/repos/vitessio/vitess/events",
      "fork": false,
      "forks": 1389,
      "forks_count": 1389,
      "forks_url": "https://api.github.com/repos/vitessio/vitess/forks",
      "full_name": "vitessio/vitess",
      "git_commits_url": "https://api.github.com/repos/vitessio/vitess/git/commits{/sha}",
      "git_refs_url": "https://api.github.com/repos/vitessio/vitess/git/refs{/sha}",
      "git_tags_url": "https://api.github.com/repos/vitessio/vitess/git/tags{/sha}",
      "git_url": "git://github.com/vitessio/vitess.git",
      "has_downloads": true,
      "has_issues": true,
      "has_pages": false,
      "has_projects": true,
      "has_wiki": false,
      "homepage": "http://vitess.io",
      "hooks_url": "https://api.github.com/repos/vitessio/vitess/hooks",
      "html_url": "https://github.com/vitessio/vitess",
      "id": 11008207,
      "issue_comment_url": "https://api.github.com/repos/vitessio/vitess/issues/comments{/number}",
      "issue_events_url": "https://api.github.com/repos/vitessio/vitess/issues/events{/number}",
      "issues_url": "https://api.github.com/repos/vitessio/vitess/issues{/number}",
      "keys_url": "https://api.github.com/repos/vitessio/vitess/keys{/key_id}",
      "labels_url": "https://api.github.com/repos/vitessio/vitess/labels{/name}",
      "language": "Go",
      "languages_url": "https://api.github.com/repos/vitessio/vitess/languages",
      "license": {
        "key": "apache-2.0",
        "name": "Apache License 2.0",
        "node_id": "MDc6TGljZW5zZTI=",
        "spdx_id": "Apache-2.0",
        "url": "https://api.github.com/licenses/apache-2.0"
      },
      "merges_url": "https://api.github.com/repos/vitessio/vitess/merges",
      "milestones_url": "https://api.github.com/repos/vitessio/vitess/milestones{/number}",
      "mirror_url": null,
      "name": "vitess",
      "node_id": "MDEwOlJlcG9zaXRvcnkxMTAwODIwNw==",
      "notifications_url": "https://api.github.com/repos/vitessio/vitess/notifications{?since,all,participating}",
      "open_issues": 564,
      "open_issues_count": 564,
      "owner": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/33043890?v=4",
        "events_url": "https://api.github.com/users/vitessio/events{/privacy}",
        "followers_url": "https://api.github.com/users/vitessio/followers",
        "following_url": "https://api.github.com/users/vitessio/following{/other_user}",
        "gists_url": "https://api.github.com/users/vitessio/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/vitessio",
        "id": 33043890,
        "login": "vitessio",
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMzMDQzODkw",
        "organizations_url": "https://api.github.com/users/vitessio/orgs",
        "received_events_url": "https://api.github.com/users/vitessio/received_events",
        "repos_url": "https://api.github.com/users/vitessio/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/vitessio/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vitessio/subscriptions",
        "type": "Organization",
        "url": "https://api.github.com/users/vitessio"
      },
      "private": false,
      "pulls_url": "https://api.github.com/repos/vitessio/vitess/pulls{/number}",
      "pushed_at": "2020-10-28T06:21:01Z",
      "releases_url": "https://api.github.com/repos/vitessio/vitess/releases{/id}",
      "size": 137946,
      "ssh_url": "git@github.com:vitessio/vitess.git",
      "stargazers_count": 10800,
      "stargazers_url": "https://api.github.com/repos/vitessio/vitess/stargazers",
      "statuses_url": "https://api.github.com/repos/vitessio/vitess/statuses/{sha}",
      "subscribers_url": "https://api.github.com/repos/vitessio/vitess/subscribers",
      "subscription_url": "https://api.github.com/repos/vitessio/vitess/subscription",
      "svn_url": "https://github.com/vitessio/vitess",
      "tags_url": "https://api.github.com/repos/vitessio/vitess/tags",
      "teams_url": "https://api.github.com/repos/vitessio/vitess/teams",
      "trees_url": "https://api.github.com/repos/vitessio/vitess/git/trees{/sha}",
      "updated_at": "2020-10-28T06:21:07Z",
      "url": "https://api.github.com/repos/vitessio/vitess",
      "watchers": 10800,
      "watchers_count": 10800
    },
    "sha": "6cf46db00d35072b69e7dcbec207d99836da0419",
    "user": {
      "avatar_url": "https://avatars1.githubusercontent.com/u/33043890?v=4",
      "events_url": "https://api.github.com/users/vitessio/events{/privacy}",
      "followers_url": "https://api.github.com/users/vitessio/followers",
      "following_url": "https://api.github.com/users/vitessio/following{/other_user}",
      "gists_url": "https://api.github.com/users/vitessio/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vitessio",
      "id": 33043890,
      "login": "vitessio",
      "node_id": "MDEyOk9yZ2FuaXphdGlvbjMzMDQzODkw",
      "organizations_url": "https://api.github.com/users/vitessio/orgs",
      "received_events_url": "https://api.github.com/users/vitessio/received_events",
      "repos_url": "https://api.github.com/users/vitessio/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vitessio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vitessio/subscriptions",
      "type": "Organization",
      "url": "https://api.github.com/users/vitessio"
    }
  },
  "body": "## VStreamer\r\n\r\nThis is the first part of VReplication. CFP is #4375.\r\n\r\nThe new VStreamer differs from the older binlog_streamer design in the following ways:\r\n* Only supports RBR. This is because we can't support smart filtering with SBR.\r\n* Deprecates Update Stream. We'll build a more powerful version on top of the new VStreamer.\r\n* Handles a unified `Filter` request that is more flexible than the previous table or keyrange based format. It allows for table, keyrange, custom expressions and filters that can be expressed as `select` statements.\r\n* Response is a stream of events instead of transactions. This addresses the max packet size problem.\r\n* Response also contains row image changes (rather than statements). Statement generation will be handled by the VReplication player on the other end. This gives better flexibility because the player can perform intelligent merge operations based on existing data, which cannot be done from the server side.\r\n* Can update itself to VSchema changes. This is necessary if new tables get introduced during VReplication.\r\n* Can react to DDL changes. Only create table and add column for now.\r\n* Buffering based on a recommended packet size.\r\n\r\nThe above differences make this different enough that the old binlog_streamer was not reusable.\r\n\r\n### New desing\r\n\r\nThe new design follows the new 'TabletServer' service pattern:\r\n* vstreamer is a separate package under the `tabletserver/` directory.\r\n* It has an `Engine` with InitDBConfig, Open and Close functions. Open and Close are idempotent.\r\n* Close does not return until all streams have been stopped.\r\n\r\nIn terms of life-cycle, VStreamer does not depend on serving state. It's started as soon as VTTablet can connect to MySQL. It's stopped only on full shutdown. This is because VStreamer has to serve during migration of served types where the sources might have stopped serving.\r\n\r\nVStreamer depends on the schema engine, and opens it on startup (if closed). This serendipitously fixes #4011.\r\n\r\nVStreamer uses a cancelable context to track closure, and a waitgroup to ensure all ongoing streams are ended before Close can return.\r\n\r\nThe Stream function is strucutally similar to the binlog_streamer's Stream, but has been reworked to accommodate the changes: sending individual events, row images, and buffering.\r\n\r\nThere is a separate planbuilder module to analyze the filter rules and build plans for each table that matches a rule.\r\n\r\nThe service is additionally exported by TabletServer. This will eventually become part of the QueryService API, because it will end up replacing the UpdateStream call.\r\n\r\nThe new VStreamer has extensive tests. In particular, all tests run with a real MySQL instance underneath, and test out actual events coming from the underlying MySQL.",
  "changed_files": 12,
  "closed_at": "2019-01-14T16:44:26Z",
  "comments": 1,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/4491/comments",
  "commits": 14,
  "commits_url": "https://api.github.com/repos/vitessio/vitess/pulls/4491/commits",
  "created_at": "2018-12-29T06:56:12Z",
  "deletions": 100,
  "diff_url": "https://github.com/vitessio/vitess/pull/4491.diff",
  "draft": false,
  "head": {
    "label": "planetscale:ss-vrepl",
    "ref": "ss-vrepl",
    "repo": {
      "archive_url": "https://api.github.com/repos/planetscale/vitess/{archive_format}{/ref}",
      "archived": false,
      "assignees_url": "https://api.github.com/repos/planetscale/vitess/assignees{/user}",
      "blobs_url": "https://api.github.com/repos/planetscale/vitess/git/blobs{/sha}",
      "branches_url": "https://api.github.com/repos/planetscale/vitess/branches{/branch}",
      "clone_url": "https://github.com/planetscale/vitess.git",
      "collaborators_url": "https://api.github.com/repos/planetscale/vitess/collaborators{/collaborator}",
      "comments_url": "https://api.github.com/repos/planetscale/vitess/comments{/number}",
      "commits_url": "https://api.github.com/repos/planetscale/vitess/commits{/sha}",
      "compare_url": "https://api.github.com/repos/planetscale/vitess/compare/{base}...{head}",
      "contents_url": "https://api.github.com/repos/planetscale/vitess/contents/{+path}",
      "contributors_url": "https://api.github.com/repos/planetscale/vitess/contributors",
      "created_at": "2018-05-13T21:17:34Z",
      "default_branch": "master",
      "deployments_url": "https://api.github.com/repos/planetscale/vitess/deployments",
      "description": "Vitess is a database clustering system for horizontal scaling of MySQL.",
      "disabled": false,
      "downloads_url": "https://api.github.com/repos/planetscale/vitess/downloads",
      "events_url": "https://api.github.com/repos/planetscale/vitess/events",
      "fork": true,
      "forks": 3,
      "forks_count": 3,
      "forks_url": "https://api.github.com/repos/planetscale/vitess/forks",
      "full_name": "planetscale/vitess",
      "git_commits_url": "https://api.github.com/repos/planetscale/vitess/git/commits{/sha}",
      "git_refs_url": "https://api.github.com/repos/planetscale/vitess/git/refs{/sha}",
      "git_tags_url": "https://api.github.com/repos/planetscale/vitess/git/tags{/sha}",
      "git_url": "git://github.com/planetscale/vitess.git",
      "has_downloads": true,
      "has_issues": false,
      "has_pages": false,
      "has_projects": true,
      "has_wiki": false,
      "homepage": "http://vitess.io",
      "hooks_url": "https://api.github.com/repos/planetscale/vitess/hooks",
      "html_url": "https://github.com/planetscale/vitess",
      "id": 133275023,
      "issue_comment_url": "https://api.github.com/repos/planetscale/vitess/issues/comments{/number}",
      "issue_events_url": "https://api.github.com/repos/planetscale/vitess/issues/events{/number}",
      "issues_url": "https://api.github.com/repos/planetscale/vitess/issues{/number}",
      "keys_url": "https://api.github.com/repos/planetscale/vitess/keys{/key_id}",
      "labels_url": "https://api.github.com/repos/planetscale/vitess/labels{/name}",
      "language": "Go",
      "languages_url": "https://api.github.com/repos/planetscale/vitess/languages",
      "license": {
        "key": "apache-2.0",
        "name": "Apache License 2.0",
        "node_id": "MDc6TGljZW5zZTI=",
        "spdx_id": "Apache-2.0",
        "url": "https://api.github.com/licenses/apache-2.0"
      },
      "merges_url": "https://api.github.com/repos/planetscale/vitess/merges",
      "milestones_url": "https://api.github.com/repos/planetscale/vitess/milestones{/number}",
      "mirror_url": null,
      "name": "vitess",
      "node_id": "MDEwOlJlcG9zaXRvcnkxMzMyNzUwMjM=",
      "notifications_url": "https://api.github.com/repos/planetscale/vitess/notifications{?since,all,participating}",
      "open_issues": 1,
      "open_issues_count": 1,
      "owner": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/35612527?v=4",
        "events_url": "https://api.github.com/users/planetscale/events{/privacy}",
        "followers_url": "https://api.github.com/users/planetscale/followers",
        "following_url": "https://api.github.com/users/planetscale/following{/other_user}",
        "gists_url": "https://api.github.com/users/planetscale/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/planetscale",
        "id": 35612527,
        "login": "planetscale",
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjM1NjEyNTI3",
        "organizations_url": "https://api.github.com/users/planetscale/orgs",
        "received_events_url": "https://api.github.com/users/planetscale/received_events",
        "repos_url": "https://api.github.com/users/planetscale/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/planetscale/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/planetscale/subscriptions",
        "type": "Organization",
        "url": "https://api.github.com/users/planetscale"
      },
      "private": false,
      "pulls_url": "https://api.github.com/repos/planetscale/vitess/pulls{/number}",
      "pushed_at": "2020-10-28T07:04:25Z",
      "releases_url": "https://api.github.com/repos/planetscale/vitess/releases{/id}",
      "size": 139294,
      "ssh_url": "git@github.com:planetscale/vitess.git",
      "stargazers_count": 16,
      "stargazers_url": "https://api.github.com/repos/planetscale/vitess/stargazers",
      "statuses_url": "https://api.github.com/repos/planetscale/vitess/statuses/{sha}",
      "subscribers_url": "https://api.github.com/repos/planetscale/vitess/subscribers",
      "subscription_url": "https://api.github.com/repos/planetscale/vitess/subscription",
      "svn_url": "https://github.com/planetscale/vitess",
      "tags_url": "https://api.github.com/repos/planetscale/vitess/tags",
      "teams_url": "https://api.github.com/repos/planetscale/vitess/teams",
      "trees_url": "https://api.github.com/repos/planetscale/vitess/git/trees{/sha}",
      "updated_at": "2020-10-27T19:21:11Z",
      "url": "https://api.github.com/repos/planetscale/vitess",
      "watchers": 16,
      "watchers_count": 16
    },
    "sha": "0e37f1f019e1a7238218f907ed6097e4d7bd50d9",
    "user": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/35612527?v=4",
      "events_url": "https://api.github.com/users/planetscale/events{/privacy}",
      "followers_url": "https://api.github.com/users/planetscale/followers",
      "following_url": "https://api.github.com/users/planetscale/following{/other_user}",
      "gists_url": "https://api.github.com/users/planetscale/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/planetscale",
      "id": 35612527,
      "login": "planetscale",
      "node_id": "MDEyOk9yZ2FuaXphdGlvbjM1NjEyNTI3",
      "organizations_url": "https://api.github.com/users/planetscale/orgs",
      "received_events_url": "https://api.github.com/users/planetscale/received_events",
      "repos_url": "https://api.github.com/users/planetscale/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/planetscale/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/planetscale/subscriptions",
      "type": "Organization",
      "url": "https://api.github.com/users/planetscale"
    }
  },
  "html_url": "https://github.com/vitessio/vitess/pull/4491",
  "id": 241428606,
  "issue_url": "https://api.github.com/repos/vitessio/vitess/issues/4491",
  "labels": [],
  "linked_issue_numbers": [
    4011
  ],
  "locked": false,
  "maintainer_can_modify": false,
  "merge_commit_sha": "e9e91635d742106d99145a209b02747e6443ab13",
  "mergeable": null,
  "mergeable_state": "unknown",
  "merged": true,
  "merged_at": "2019-01-14T16:44:25Z",
  "merged_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/589370?v=4",
    "events_url": "https://api.github.com/users/sougou/events{/privacy}",
    "followers_url": "https://api.github.com/users/sougou/followers",
    "following_url": "https://api.github.com/users/sougou/following{/other_user}",
    "gists_url": "https://api.github.com/users/sougou/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sougou",
    "id": 589370,
    "login": "sougou",
    "node_id": "MDQ6VXNlcjU4OTM3MA==",
    "organizations_url": "https://api.github.com/users/sougou/orgs",
    "received_events_url": "https://api.github.com/users/sougou/received_events",
    "repos_url": "https://api.github.com/users/sougou/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sougou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sougou/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sougou"
  },
  "milestone": null,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MjQxNDI4NjA2",
  "number": 4491,
  "patch_url": "https://github.com/vitessio/vitess/pull/4491.patch",
  "rebaseable": null,
  "requested_reviewers": [],
  "requested_teams": [],
  "review_comment_url": "https://api.github.com/repos/vitessio/vitess/pulls/comments{/number}",
  "review_comments": 7,
  "review_comments_url": "https://api.github.com/repos/vitessio/vitess/pulls/4491/comments",
  "state": "closed",
  "statuses_url": "https://api.github.com/repos/vitessio/vitess/statuses/0e37f1f019e1a7238218f907ed6097e4d7bd50d9",
  "title": "VReplication: VStreamer",
  "updated_at": "2019-01-14T16:44:26Z",
  "url": "https://api.github.com/repos/vitessio/vitess/pulls/4491",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/589370?v=4",
    "events_url": "https://api.github.com/users/sougou/events{/privacy}",
    "followers_url": "https://api.github.com/users/sougou/followers",
    "following_url": "https://api.github.com/users/sougou/following{/other_user}",
    "gists_url": "https://api.github.com/users/sougou/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sougou",
    "id": 589370,
    "login": "sougou",
    "node_id": "MDQ6VXNlcjU4OTM3MA==",
    "organizations_url": "https://api.github.com/users/sougou/orgs",
    "received_events_url": "https://api.github.com/users/sougou/received_events",
    "repos_url": "https://api.github.com/users/sougou/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sougou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sougou/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sougou"
  }
}