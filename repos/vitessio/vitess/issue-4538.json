{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "I have a shard where the backup fails about 50% of the time. The shard in question has 225 GB of data. Once it fails, it never recovers until I delete the k8s pod and it restarts.\r\n\r\nWhile the error itself is different, the outcome sounds the same as what @rnavarro reported in #2238.\r\n\r\n\r\n### vttablet logs\r\n```\r\nI0121 13:35:09.379272       1 mysqld.go:329] Mysqld.Shutdown\r\nI0121 13:35:09.379276       1 mysqld.go:333] executing Mysqld.Shutdown() remotely via mysqlctld server: /vtdataroot/mysqlctl.sock\r\nI0121 13:35:14.420687       1 backup.go:413] found 132 files to backup\r\nE0121 13:58:54.605921       1 engine.go:185] periodic schema reload failed: could not get table list for reload: net.Dial(/vtdataroot/tabletdata/mysql.sock) to local server failed: dial unix /vtdataroot/tabletdata/mysql.sock: connect: no such file or directory (errno 2002) (sqlstate HY000)\r\nI0121 13:58:54.606008       1 tabletserver.go:320] TabletServer state: NOT_SERVING (Not Serving) -> NOT_SERVING (Transitioning)\r\nI0121 13:58:54.606070       1 tabletserver.go:320] TabletServer state: NOT_SERVING (Transitioning) -> NOT_SERVING (Not Serving)\r\nI0121 13:58:54.606086       1 tabletserver.go:682] Check MySQL failed. Shutting down query service\r\nI0121 13:58:54.606105       1 tabletserver.go:320] TabletServer state: NOT_SERVING (Not Serving) -> SHUTTING_DOWN (Shutting Down)\r\nI0121 13:58:54.606119       1 tabletserver.go:583] Executing complete shutdown.\r\nI0121 13:58:54.606385       1 tabletserver.go:590] Shutdown complete.\r\nI0121 13:58:54.606409       1 tabletserver.go:320] TabletServer state: SHUTTING_DOWN (Shutting Down) -> NOT_SERVING (Not Connected)\r\nE0121 14:35:09.220352       1 backup.go:496] failed to close file [20 context deadline exceeded]: %!v(MISSING)\r\nI0121 14:35:09.220485       1 mysqld.go:177] executing Mysqld.Start() remotely via mysqlctld server: /vtdataroot/mysqlctl.sock\r\nE0121 14:35:09.220545       1 backup.go:287] backup is not usable, aborting it: [can't restart mysqld: context deadline exceeded: <nil>]\r\nE0121 14:35:09.220819       1 backup.go:295] failed to finish backup: [context deadline exceeded]: %!v(MISSING)\r\nE0121 14:35:09.220935       1 rpc_backup.go:85] mysql backup command returned error: can't restart mysqld: context deadline exceeded: <nil>\r\nI0121 14:35:09.220982       1 state_change.go:130] Executing post-action state refresh: after backup\r\nW0121 14:35:09.221009       1 state_change.go:141] Failed rereading tablet after after backup - services may be inconsistent: deadline exceeded: tablets/aks-1588972600/Tablet\r\nW0121 14:35:09.221070       1 rpc_server.go:91] TabletManager.Backup(concurrency:4 )(on aks-1588972600 from ) error: refreshTablet failed rereading tablet after after backup: deadline exceeded: tablets/aks-1588972600/Tablet\r\n```\r\n\r\n### mysqlctld logs\r\n```\r\nI0121 13:35:09.393314       1 mysqld.go:329] Mysqld.Shutdown\r\nI0121 13:35:09.394243       1 mysqld.go:367] No mysqld_shutdown hook, running mysqladmin directly\r\nI0121 13:35:09.394887       1 mysqld.go:433] execCmd: /usr/bin/mysqladmin /usr/bin/mysqladmin [--defaults-extra-file=/tmp/example225411938 --shutdown-timeout=300 --connect-timeout=30 --wait=10 shutdown]\r\nI0121 13:35:14.023813       1 mysqld.go:260] Mysqld.Start(1548059306) exit: <nil>\r\nI0121 13:35:14.417685       1 mysqld.go:447] execCmd: /usr/bin/mysqladmin output: \r\nI0121 13:35:14.417728       1 mysqld.go:408] Mysqld.Shutdown: waiting for socket file (/vtdataroot/tabletdata/mysql.sock) and pid file (/vtdataroot/tabletdata/mysql.pid) to disappear\r\n```",
  "closed_at": "2019-04-16T16:28:10Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/589370?v=4",
    "events_url": "https://api.github.com/users/sougou/events{/privacy}",
    "followers_url": "https://api.github.com/users/sougou/followers",
    "following_url": "https://api.github.com/users/sougou/following{/other_user}",
    "gists_url": "https://api.github.com/users/sougou/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sougou",
    "id": 589370,
    "login": "sougou",
    "node_id": "MDQ6VXNlcjU4OTM3MA==",
    "organizations_url": "https://api.github.com/users/sougou/orgs",
    "received_events_url": "https://api.github.com/users/sougou/received_events",
    "repos_url": "https://api.github.com/users/sougou/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sougou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sougou/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sougou"
  },
  "comments": 20,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/4538/comments",
  "created_at": "2019-01-21T14:51:32Z",
  "events_url": "https://api.github.com/repos/vitessio/vitess/issues/4538/events",
  "html_url": "https://github.com/vitessio/vitess/issues/4538",
  "id": 401386865,
  "labels": [
    {
      "color": "fbca04",
      "default": false,
      "description": null,
      "id": 760787448,
      "name": "P1",
      "node_id": "MDU6TGFiZWw3NjA3ODc0NDg=",
      "url": "https://api.github.com/repos/vitessio/vitess/labels/P1"
    },
    {
      "color": "d11f28",
      "default": false,
      "description": "",
      "id": 760789208,
      "name": "Type: Bug",
      "node_id": "MDU6TGFiZWw3NjA3ODkyMDg=",
      "url": "https://api.github.com/repos/vitessio/vitess/labels/Type:%20Bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/vitessio/vitess/issues/4538/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MDEzODY4NjU=",
  "number": 4538,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/vitessio/vitess",
  "state": "closed",
  "title": "Failed backup puts tablet into unhealthy state",
  "updated_at": "2019-04-16T16:28:10Z",
  "url": "https://api.github.com/repos/vitessio/vitess/issues/4538",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/3588778?v=4",
    "events_url": "https://api.github.com/users/derekperkins/events{/privacy}",
    "followers_url": "https://api.github.com/users/derekperkins/followers",
    "following_url": "https://api.github.com/users/derekperkins/following{/other_user}",
    "gists_url": "https://api.github.com/users/derekperkins/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/derekperkins",
    "id": 3588778,
    "login": "derekperkins",
    "node_id": "MDQ6VXNlcjM1ODg3Nzg=",
    "organizations_url": "https://api.github.com/users/derekperkins/orgs",
    "received_events_url": "https://api.github.com/users/derekperkins/received_events",
    "repos_url": "https://api.github.com/users/derekperkins/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/derekperkins/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/derekperkins/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/derekperkins"
  }
}