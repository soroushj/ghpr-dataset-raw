{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "In this use case, MySQL is externally managed, like RDS, which does not support fast failovers. In this case, one can use a second vttablet of type REPLICA pointed at the master. During software rollout, one can use a \"failover\" mechanism to update the vttablets without incurring downtime.\r\n\r\nIn the above situation, if there is a network partition, two vttablets can end up thinking that they are masters. If so, they can race on generating sequences and step over each other.\r\n\r\nThis bug can also be trigerred by someone directly updating next_id. It's also possible that someone could update next_id to a lower value that can mess things up even further.\r\n\r\nThe current implementation assumes that next_id cannot change underneath. So,  vttablet continues to iterate from current NextVal. Instead, all we have to do is validate the current LastVal against next_id, and correct the system accordingly.",
  "closed_at": "2020-01-21T13:23:41Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/589370?v=4",
    "events_url": "https://api.github.com/users/sougou/events{/privacy}",
    "followers_url": "https://api.github.com/users/sougou/followers",
    "following_url": "https://api.github.com/users/sougou/following{/other_user}",
    "gists_url": "https://api.github.com/users/sougou/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sougou",
    "id": 589370,
    "login": "sougou",
    "node_id": "MDQ6VXNlcjU4OTM3MA==",
    "organizations_url": "https://api.github.com/users/sougou/orgs",
    "received_events_url": "https://api.github.com/users/sougou/received_events",
    "repos_url": "https://api.github.com/users/sougou/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sougou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sougou/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sougou"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/5590/comments",
  "created_at": "2019-12-18T18:12:08Z",
  "events_url": "https://api.github.com/repos/vitessio/vitess/issues/5590/events",
  "html_url": "https://github.com/vitessio/vitess/issues/5590",
  "id": 539838065,
  "labels": [],
  "labels_url": "https://api.github.com/repos/vitessio/vitess/issues/5590/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1Mzk4MzgwNjU=",
  "number": 5590,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/vitessio/vitess",
  "state": "closed",
  "title": "vttablet sequence: next N values can return overlapping values under certain circumstances",
  "updated_at": "2020-01-21T13:23:41Z",
  "url": "https://api.github.com/repos/vitessio/vitess/issues/5590",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/589370?v=4",
    "events_url": "https://api.github.com/users/sougou/events{/privacy}",
    "followers_url": "https://api.github.com/users/sougou/followers",
    "following_url": "https://api.github.com/users/sougou/following{/other_user}",
    "gists_url": "https://api.github.com/users/sougou/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sougou",
    "id": 589370,
    "login": "sougou",
    "node_id": "MDQ6VXNlcjU4OTM3MA==",
    "organizations_url": "https://api.github.com/users/sougou/orgs",
    "received_events_url": "https://api.github.com/users/sougou/received_events",
    "repos_url": "https://api.github.com/users/sougou/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sougou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sougou/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sougou"
  }
}