{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "COLLABORATOR",
  "body": "Works in 5.7:\r\n\r\n```\r\n$ docker run -it vitess/base:percona57 bash -c 'go test -timeout 30s vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication -run \"^(TestPlayerCopyTableContinuation)$\"'\r\nok  \tvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication\t9.170s\r\n```\r\n\r\nFails in 5.6:\r\n\r\n```\r\n$ docker run -it vitess/base:percona bash -c 'go test -timeout 30s vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication -run \"^(TestPlayerCopyTableContinuation)$\"'\r\nERROR: logging before flag.Parse: E0501 20:17:23.702005    1144 syslogger.go:122] can't connect to syslog\r\nE0501 20:17:23.712169    1144 syslogger.go:84] no connection, dropping syslog event: &events.KeyspaceChange{KeyspaceName:\"vttest\", Keyspace:(*topodata.Keyspace)(0xc0000ad950), Status:\"created\"}\r\nE0501 20:17:23.713566    1144 syslogger.go:84] no connection, dropping syslog event: &events.ShardChange{KeyspaceName:\"vttest\", ShardName:\"0\", Shard:(*topodata.Shard)(0xc0001ba480), Status:\"created\"}\r\nE0501 20:17:33.658970    1144 syslogger.go:84] no connection, dropping syslog event: &events.TabletChange{Tablet:topodata.Tablet{Alias:(*topodata.TabletAlias)(0xc0001d0c40), Hostname:\"\", PortMap:map[string]int32{\"test\":100}, Keyspace:\"vttest\", Shard:\"0\", KeyRange:(*topodata.KeyRange)(nil), Type:2, DbNameOverride:\"\", Tags:map[string]string{\"serving\":\"serving\", \"healthy\":\"healthy\"}, MysqlHostname:\"\", MysqlPort:0, XXX_NoUnkeyedLiteral:struct {}{}, XXX_unrecognized:[]uint8(nil), XXX_sizecache:74}, Status:\"created\"}\r\nE0501 20:17:33.785504    1144 controller.go:134] stream 1: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'where (1,1) <= (6,6)' at line 1 (errno 1064) (sqlstate 42000) during query: insert into dst1(id,val) select 1, 'insert in' where (1,1) <= (6,6), retrying after 5s\r\npanic: test timed out after 30s\r\n\r\ngoroutine 8144 [running]:\r\ntesting.(*M).startAlarm.func1()\r\n\t/usr/local/go/src/testing/testing.go:1296 +0xfd\r\ncreated by time.goFunc\r\n\t/usr/local/go/src/time/sleep.go:172 +0x44\r\n\r\ngoroutine 1 [chan receive]:\r\ntesting.(*T).Run(0xc00013b200, 0xcc2230, 0x1f, 0xcf1d60, 0x48e601)\r\n\t/usr/local/go/src/testing/testing.go:879 +0x383\r\ntesting.runTests.func1(0xc00013b100)\r\n\t/usr/local/go/src/testing/testing.go:1119 +0x78\r\ntesting.tRunner(0xc00013b100, 0xc0001cfca0)\r\n\t/usr/local/go/src/testing/testing.go:827 +0xbf\r\ntesting.runTests(0xc0002d2520, 0x14cdb20, 0x29, 0x29, 0xc0002ca750)\r\n\t/usr/local/go/src/testing/testing.go:1117 +0x2aa\r\ntesting.(*M).Run(0xc0001ba300, 0x0)\r\n\t/usr/local/go/src/testing/testing.go:1034 +0x165\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.TestMain.func1(0xc0001ba300, 0x0)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/framework_test.go:116 +0x887\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.TestMain(0xc0001ba300)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/framework_test.go:117 +0x30\r\nmain.main()\r\n\t_testmain.go:120 +0x13d\r\n\r\ngoroutine 5 [chan receive]:\r\nvitess.io/vitess/vendor/github.com/golang/glog.(*loggingT).flushDaemon(0x14dba20)\r\n\t/vt/src/vitess.io/vitess/vendor/github.com/golang/glog/glog.go:882 +0x8b\r\ncreated by vitess.io/vitess/vendor/github.com/golang/glog.init.0\r\n\t/vt/src/vitess.io/vitess/vendor/github.com/golang/glog/glog.go:410 +0x203\r\n\r\ngoroutine 7 [syscall]:\r\nos/signal.signal_recv(0x0)\r\n\t/usr/local/go/src/runtime/sigqueue.go:139 +0x9c\r\nos/signal.loop()\r\n\t/usr/local/go/src/os/signal/signal_unix.go:23 +0x22\r\ncreated by os/signal.init.0\r\n\t/usr/local/go/src/os/signal/signal_unix.go:29 +0x41\r\n\r\ngoroutine 80 [chan send]:\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*realDBClient).ExecuteFetch(0xc000381250, 0xcad622, 0x8, 0x2710, 0x42d541, 0xcf1c10, 0xc0003b9a00)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/framework_test.go:358 +0x10e\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*realDBClient).Rollback(0xc000381250, 0xc0003552c0, 0xc0003b9a00)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/framework_test.go:343 +0x49\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*vdbClient).Rollback(0xc0003bc640, 0xa, 0xc0000bf540)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/vdbclient.go:67 +0x33\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*vcopier).copyTable(0xc0000bca50, 0xd9f2e0, 0xc0003c5200, 0xc0000738f1, 0x4, 0xc00045c1b0, 0x0, 0x0)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/vcopier.go:274 +0x8ef\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*vcopier).copyNext(0xc0000bca50, 0xd9f260, 0xc0001d12c0, 0xda2d60, 0xc00045c150, 0x0, 0x0, 0x7fffffffffffffff, 0x7fffffffffffffff, 0xc0000738dc, ...)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/vcopier.go:114 +0x329\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*vreplicator).Replicate(0xc0003a07c0, 0xd9f260, 0xc0001d12c0, 0x2710, 0xc0003bc5f0)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/vreplicator.go:98 +0x39b\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*controller).runBlp(0xc0001dd5e0, 0xd9f260, 0xc0001d12c0, 0x0, 0x0)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/controller.go:198 +0x355\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*controller).run(0xc0001dd5e0, 0xd9f260, 0xc0001d12c0)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/controller.go:124 +0x87\r\ncreated by vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.newController\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/controller.go:111 +0x43a\r\n\r\ngoroutine 79 [select]:\r\nvitess.io/vitess/go/vt/discovery.(*TopologyWatcher).watch(0xc0002ec580)\r\n\t/vt/src/vitess.io/vitess/go/vt/discovery/topology_watcher.go:165 +0x13f\r\ncreated by vitess.io/vitess/go/vt/discovery.NewTopologyWatcher\r\n\t/vt/src/vitess.io/vitess/go/vt/discovery/topology_watcher.go:154 +0x1b6\r\n\r\ngoroutine 26 [chan receive]:\r\nvitess.io/vitess/go/vt/dbconfigs.init.0.func1(0xc00017a8a0)\r\n\t/vt/src/vitess.io/vitess/go/vt/dbconfigs/credentials.go:136 +0x41\r\ncreated by vitess.io/vitess/go/vt/dbconfigs.init.0\r\n\t/vt/src/vitess.io/vitess/go/vt/dbconfigs/credentials.go:135 +0x11b\r\n\r\ngoroutine 74 [chan receive]:\r\nvitess.io/vitess/go/stats.(*Rates).track(0xc000300180)\r\n\t/vt/src/vitess.io/vitess/go/stats/rates.go:99 +0x54\r\ncreated by vitess.io/vitess/go/stats.NewRates\r\n\t/vt/src/vitess.io/vitess/go/stats/rates.go:91 +0x1f2\r\n\r\ngoroutine 29 [chan receive]:\r\nvitess.io/vitess/go/stats.(*Rates).track(0xc00017b5c0)\r\n\t/vt/src/vitess.io/vitess/go/stats/rates.go:99 +0x54\r\ncreated by vitess.io/vitess/go/stats.NewRates\r\n\t/vt/src/vitess.io/vitess/go/stats/rates.go:91 +0x1f2\r\n\r\ngoroutine 35 [select]:\r\nvitess.io/vitess/go/timer.(*Timer).run(0xc00016ba60, 0xc000171fb0)\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:98 +0xc3\r\ncreated by vitess.io/vitess/go/timer.(*Timer).Start\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:86 +0xa9\r\n\r\ngoroutine 50 [chan receive]:\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*controller).Stop(0xc0001dd5e0)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/controller.go:205 +0x4c\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.(*Engine).Exec(0xc0001bae00, 0xc0003ba420, 0x29, 0x0, 0x0, 0x0)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/engine.go:286 +0x8f4\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.TestPlayerCopyTableContinuation.func3(0x1, 0xc00013b200)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/vcopier_test.go:219 +0xb3\r\nruntime.Goexit()\r\n\t/usr/local/go/src/runtime/panic.go:397 +0xef\r\ntesting.(*common).FailNow(0xc00013b200)\r\n\t/usr/local/go/src/testing/testing.go:590 +0x39\r\ntesting.(*common).Fatalf(0xc00013b200, 0xcc75ff, 0x23, 0xc0001cb988, 0x2, 0x2)\r\n\t/usr/local/go/src/testing/testing.go:634 +0x83\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.expectData(0xc00013b200, 0xca8ce5, 0x4, 0xc00035eb60, 0x9, 0x9)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/framework_test.go:465 +0x74f\r\nvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication.TestPlayerCopyTableContinuation(0xc00013b200)\r\n\t/vt/src/vitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication/vcopier_test.go:263 +0x12a4\r\ntesting.tRunner(0xc00013b200, 0xcf1d60)\r\n\t/usr/local/go/src/testing/testing.go:827 +0xbf\r\ncreated by testing.(*T).Run\r\n\t/usr/local/go/src/testing/testing.go:878 +0x35c\r\n\r\ngoroutine 36 [select]:\r\nvitess.io/vitess/go/timer.(*Timer).run(0xc00016bcc0, 0xc0002ca180)\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:98 +0xc3\r\ncreated by vitess.io/vitess/go/timer.(*Timer).Start\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:86 +0xa9\r\n\r\ngoroutine 83 [select]:\r\nvitess.io/vitess/go/vt/discovery.(*HealthCheckImpl).checkConn(0xc000300660, 0xc0001595e0, 0xc0002c7f60, 0x10)\r\n\t/vt/src/vitess.io/vitess/go/vt/discovery/healthcheck.go:571 +0x380\r\ncreated by vitess.io/vitess/go/vt/discovery.(*HealthCheckImpl).AddTablet\r\n\t/vt/src/vitess.io/vitess/go/vt/discovery/healthcheck.go:749 +0x44c\r\n\r\ngoroutine 108 [chan receive]:\r\nvitess.io/vitess/go/vt/srvtopo.(*ResilientServer).WatchSrvVSchema.func1(0xc0000adb80, 0xd9f2a0, 0xc000038078, 0xca9870, 0x5, 0xc000380330, 0xc000325950)\r\n\t/vt/src/vitess.io/vitess/go/vt/srvtopo/resilient_server.go:536 +0x260\r\ncreated by vitess.io/vitess/go/vt/srvtopo.(*ResilientServer).WatchSrvVSchema\r\n\t/vt/src/vitess.io/vitess/go/vt/srvtopo/resilient_server.go:520 +0xb1\r\n\r\ngoroutine 109 [chan receive]:\r\nvitess.io/vitess/go/vt/topo.(*Server).WatchSrvVSchema.func1(0xc000384540, 0xc000384420, 0xc00036e840)\r\n\t/vt/src/vitess.io/vitess/go/vt/topo/srv_vschema.go:68 +0xae\r\ncreated by vitess.io/vitess/go/vt/topo.(*Server).WatchSrvVSchema\r\n\t/vt/src/vitess.io/vitess/go/vt/topo/srv_vschema.go:65 +0x359\r\n\r\ngoroutine 110 [select]:\r\nvitess.io/vitess/go/timer.(*Timer).run(0xc000365080, 0xc000380850)\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:98 +0xc3\r\ncreated by vitess.io/vitess/go/timer.(*Timer).Start\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:86 +0xa9\r\n\r\ngoroutine 111 [select]:\r\nvitess.io/vitess/go/timer.(*Timer).run(0xc0003650a0, 0xc000380870)\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:98 +0xc3\r\ncreated by vitess.io/vitess/go/timer.(*Timer).Start\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:86 +0xa9\r\n\r\ngoroutine 118 [select]:\r\nvitess.io/vitess/go/timer.(*Timer).run(0xc00016bce0, 0xc000365420)\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:98 +0xc3\r\ncreated by vitess.io/vitess/go/timer.(*Timer).Start\r\n\t/vt/src/vitess.io/vitess/go/timer/timer.go:86 +0xa9\r\nFAIL\tvitess.io/vitess/go/vt/vttablet/tabletmanager/vreplication\t39.977s\r\n```",
  "closed_at": "2019-05-01T22:37:04Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/100598?v=4",
    "events_url": "https://api.github.com/users/dweitzman/events{/privacy}",
    "followers_url": "https://api.github.com/users/dweitzman/followers",
    "following_url": "https://api.github.com/users/dweitzman/following{/other_user}",
    "gists_url": "https://api.github.com/users/dweitzman/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dweitzman",
    "id": 100598,
    "login": "dweitzman",
    "node_id": "MDQ6VXNlcjEwMDU5OA==",
    "organizations_url": "https://api.github.com/users/dweitzman/orgs",
    "received_events_url": "https://api.github.com/users/dweitzman/received_events",
    "repos_url": "https://api.github.com/users/dweitzman/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dweitzman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dweitzman/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dweitzman"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/4852/comments",
  "created_at": "2019-05-01T20:18:23Z",
  "events_url": "https://api.github.com/repos/vitessio/vitess/issues/4852/events",
  "html_url": "https://github.com/vitessio/vitess/issues/4852",
  "id": 439307423,
  "labels": [],
  "labels_url": "https://api.github.com/repos/vitessio/vitess/issues/4852/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MzkzMDc0MjM=",
  "number": 4852,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/vitessio/vitess",
  "state": "closed",
  "title": "vcopier unit test failing in percona 5.6",
  "updated_at": "2019-05-01T22:37:04Z",
  "url": "https://api.github.com/repos/vitessio/vitess/issues/4852",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/100598?v=4",
    "events_url": "https://api.github.com/users/dweitzman/events{/privacy}",
    "followers_url": "https://api.github.com/users/dweitzman/followers",
    "following_url": "https://api.github.com/users/dweitzman/following{/other_user}",
    "gists_url": "https://api.github.com/users/dweitzman/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dweitzman",
    "id": 100598,
    "login": "dweitzman",
    "node_id": "MDQ6VXNlcjEwMDU5OA==",
    "organizations_url": "https://api.github.com/users/dweitzman/orgs",
    "received_events_url": "https://api.github.com/users/dweitzman/received_events",
    "repos_url": "https://api.github.com/users/dweitzman/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dweitzman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dweitzman/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dweitzman"
  }
}