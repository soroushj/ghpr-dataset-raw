{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "## Overview\r\nExtend the `-tablet_filters` feature to filter keyspaces from the SrvVschema before passing to the executor.\r\n\r\n## Details\r\nTo isolate different workloads, we want to configure vtgates to only access certain keyspaces. The existing `-tablet_filters` feature works for this at the discovery / query routing layer but all the keyspace definitions are still present in the SrvVschema.\r\n\r\nThis presents a problem for the current handling of `dual` table query routing since it is pinned to route to the first keyspace in the list alphabetically, but that one may not be visible to the given vtgate.\r\n\r\nFurthermore, the various introspection commands like `show databases` erroneously show keyspaces that should be hidden from the vtgate consumers.\r\n\r\nTo address this we should update the VschemaManager to pay attention to keyspace filters configured and to remove the filtered keyspaces from the list before passing the Vschema to the Executor.\r\n\r\nThis should solve both of these issues.\r\n",
  "closed_at": "2018-12-14T21:40:31Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/3308504?v=4",
    "events_url": "https://api.github.com/users/demmer/events{/privacy}",
    "followers_url": "https://api.github.com/users/demmer/followers",
    "following_url": "https://api.github.com/users/demmer/following{/other_user}",
    "gists_url": "https://api.github.com/users/demmer/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/demmer",
    "id": 3308504,
    "login": "demmer",
    "node_id": "MDQ6VXNlcjMzMDg1MDQ=",
    "organizations_url": "https://api.github.com/users/demmer/orgs",
    "received_events_url": "https://api.github.com/users/demmer/received_events",
    "repos_url": "https://api.github.com/users/demmer/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/demmer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/demmer/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/demmer"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/4378/comments",
  "created_at": "2018-11-20T20:37:10Z",
  "events_url": "https://api.github.com/repos/vitessio/vitess/issues/4378/events",
  "html_url": "https://github.com/vitessio/vitess/issues/4378",
  "id": 382838691,
  "labels": [],
  "labels_url": "https://api.github.com/repos/vitessio/vitess/issues/4378/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzODI4Mzg2OTE=",
  "number": 4378,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/vitessio/vitess",
  "state": "closed",
  "title": "vtgate keyspace filtering using -tablet_filters should apply to the vschema as well",
  "updated_at": "2018-12-14T21:40:31Z",
  "url": "https://api.github.com/repos/vitessio/vitess/issues/4378",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/3308504?v=4",
    "events_url": "https://api.github.com/users/demmer/events{/privacy}",
    "followers_url": "https://api.github.com/users/demmer/followers",
    "following_url": "https://api.github.com/users/demmer/following{/other_user}",
    "gists_url": "https://api.github.com/users/demmer/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/demmer",
    "id": 3308504,
    "login": "demmer",
    "node_id": "MDQ6VXNlcjMzMDg1MDQ=",
    "organizations_url": "https://api.github.com/users/demmer/orgs",
    "received_events_url": "https://api.github.com/users/demmer/received_events",
    "repos_url": "https://api.github.com/users/demmer/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/demmer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/demmer/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/demmer"
  }
}