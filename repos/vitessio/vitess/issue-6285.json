{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/402248?v=4",
    "events_url": "https://api.github.com/users/systay/events{/privacy}",
    "followers_url": "https://api.github.com/users/systay/followers",
    "following_url": "https://api.github.com/users/systay/following{/other_user}",
    "gists_url": "https://api.github.com/users/systay/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/systay",
    "id": 402248,
    "login": "systay",
    "node_id": "MDQ6VXNlcjQwMjI0OA==",
    "organizations_url": "https://api.github.com/users/systay/orgs",
    "received_events_url": "https://api.github.com/users/systay/received_events",
    "repos_url": "https://api.github.com/users/systay/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/systay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/systay/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/systay"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/402248?v=4",
      "events_url": "https://api.github.com/users/systay/events{/privacy}",
      "followers_url": "https://api.github.com/users/systay/followers",
      "following_url": "https://api.github.com/users/systay/following{/other_user}",
      "gists_url": "https://api.github.com/users/systay/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/systay",
      "id": 402248,
      "login": "systay",
      "node_id": "MDQ6VXNlcjQwMjI0OA==",
      "organizations_url": "https://api.github.com/users/systay/orgs",
      "received_events_url": "https://api.github.com/users/systay/received_events",
      "repos_url": "https://api.github.com/users/systay/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/systay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/systay/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/systay"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "This seems to be just another form of #6264 , but happens with default settings.\r\n\r\nThis occurs in current master (b9bb5d09e662defd6d6812407cd88b63d50d56b1), but has been reported against 6.0 as well.\r\n\r\nScenario:\r\n  * Setup by using `examples/local/101_initial_cluster.sh`\r\n  * Connect to vtgate, and run through the following testcase.\r\n  * Create table with unique key and insert a value:\r\n```\r\n$ mysql -A -u root -P 15306 -h 127.0.0.1 commerce\r\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\r\nYour MySQL connection id is 5\r\nServer version: 5.7.9-Vitess MySQL Community Server - GPL\r\n.\r\n.\r\nmysql> create table t1 (c1 bigint primary key, c2 bigint, unique key (c2));\r\nQuery OK, 0 rows affected (0.12 sec)\r\n\r\nmysql> insert into t1 (c1, c2) values (1, 1);\r\nQuery OK, 1 row affected (0.03 sec)\r\n\r\nmysql> select * from t1;\r\n+----+------+\r\n| c1 | c2   |\r\n+----+------+\r\n|  1 |    1 |\r\n+----+------+\r\n1 row in set (0.01 sec)\r\n```\r\n  * Verify autocommit is on (by default):\r\n```\r\nmysql> show variables like 'autocommit';\r\n+---------------+-------+\r\n| Variable_name | Value |\r\n+---------------+-------+\r\n| autocommit    | ON    |\r\n+---------------+-------+\r\n1 row in set (0.01 sec)\r\n```\r\n  * Insert a value with duplicate unique key:\r\n```\r\nmysql> insert into t1 (c1, c2) values (2, 1);\r\nERROR 1062 (23000): vtgate: http://localhost:15001/: execInsertUnsharded: target: commerce.0.master, used tablet: zone1-100 (localhost): vttablet: rpc error: code = AlreadyExists desc = Duplicate entry '1' for key 't1.c2' (errno 1062) (sqlstate 23000) (CallerID: userData1): Sql: \"insert into t1(c1, c2) values (:vtg1, :vtg2)\", BindVars: {vtg1: \"type:INT64 value:\\\"2\\\" \"vtg2: \"type:INT64 value:\\\"1\\\" \"}\r\n```\r\n  * Verify table is unchanged:\r\n``` \r\nmysql> select * from t1;\r\n+----+------+\r\n| c1 | c2   |\r\n+----+------+\r\n|  1 |    1 |\r\n+----+------+\r\n1 row in set (0.00 sec)\r\n```\r\n  * Update existing row, verifying it has changed:\r\n```\r\nmysql> update t1 set c2 = 2 where c1 = 1;\r\nQuery OK, 1 row affected (0.01 sec)\r\n\r\nmysql> select * from t1;\r\n+----+------+\r\n| c1 | c2   |\r\n+----+------+\r\n|  1 |    2 |\r\n+----+------+\r\n1 row in set (0.00 sec)\r\n```\r\n  * Now, wait 30 seconds, and check table again:\r\n```\r\nmysql> select sleep(30);\r\n+-----------+\r\n| sleep(30) |\r\n+-----------+\r\n|         0 |\r\n+-----------+\r\n1 row in set (30.00 sec)\r\nmysql> select * from t1;\r\nERROR 1317 (HY000): vtgate: http://localhost:15001/: target: commerce.0.master, used tablet: zone1-100 (localhost): vttablet: rpc error: code = Aborted desc = transaction 1591663223087763322: ended at 2020-06-08 17:47:59.896 PDT (exceeded timeout: 30s) (CallerID: userData1)\r\n```\r\n  * That didn't work, check again:\r\n```\r\nmysql> select * from t1;\r\n+----+------+\r\n| c1 | c2   |\r\n+----+------+\r\n|  1 |    1 |\r\n+----+------+\r\n1 row in set (0.01 sec)\r\n```\r\n   Table **has reverted to previous state**.",
  "closed_at": "2020-06-10T20:51:37Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/388311?v=4",
    "events_url": "https://api.github.com/users/deepthi/events{/privacy}",
    "followers_url": "https://api.github.com/users/deepthi/followers",
    "following_url": "https://api.github.com/users/deepthi/following{/other_user}",
    "gists_url": "https://api.github.com/users/deepthi/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/deepthi",
    "id": 388311,
    "login": "deepthi",
    "node_id": "MDQ6VXNlcjM4ODMxMQ==",
    "organizations_url": "https://api.github.com/users/deepthi/orgs",
    "received_events_url": "https://api.github.com/users/deepthi/received_events",
    "repos_url": "https://api.github.com/users/deepthi/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/deepthi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deepthi/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/deepthi"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/6285/comments",
  "created_at": "2020-06-09T00:57:08Z",
  "events_url": "https://api.github.com/repos/vitessio/vitess/issues/6285/events",
  "html_url": "https://github.com/vitessio/vitess/issues/6285",
  "id": 635029400,
  "labels": [],
  "labels_url": "https://api.github.com/repos/vitessio/vitess/issues/6285/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2020-07-29T13:14:02Z",
    "closed_issues": 235,
    "created_at": "2020-05-28T15:27:29Z",
    "creator": {
      "avatar_url": "https://avatars2.githubusercontent.com/u/57982?v=4",
      "events_url": "https://api.github.com/users/morgo/events{/privacy}",
      "followers_url": "https://api.github.com/users/morgo/followers",
      "following_url": "https://api.github.com/users/morgo/following{/other_user}",
      "gists_url": "https://api.github.com/users/morgo/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/morgo",
      "id": 57982,
      "login": "morgo",
      "node_id": "MDQ6VXNlcjU3OTgy",
      "organizations_url": "https://api.github.com/users/morgo/orgs",
      "received_events_url": "https://api.github.com/users/morgo/received_events",
      "repos_url": "https://api.github.com/users/morgo/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/morgo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/morgo/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/morgo"
    },
    "description": "7.0 Release GA",
    "due_on": "2020-07-28T07:00:00Z",
    "html_url": "https://github.com/vitessio/vitess/milestone/8",
    "id": 5474182,
    "labels_url": "https://api.github.com/repos/vitessio/vitess/milestones/8/labels",
    "node_id": "MDk6TWlsZXN0b25lNTQ3NDE4Mg==",
    "number": 8,
    "open_issues": 1,
    "state": "closed",
    "title": "v7.0",
    "updated_at": "2020-10-06T19:53:21Z",
    "url": "https://api.github.com/repos/vitessio/vitess/milestones/8"
  },
  "node_id": "MDU6SXNzdWU2MzUwMjk0MDA=",
  "number": 6285,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/vitessio/vitess",
  "state": "closed",
  "title": "Rollback after error can clobber updates",
  "updated_at": "2020-06-15T19:07:22Z",
  "url": "https://api.github.com/repos/vitessio/vitess/issues/6285",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/772642?v=4",
    "events_url": "https://api.github.com/users/aquarapid/events{/privacy}",
    "followers_url": "https://api.github.com/users/aquarapid/followers",
    "following_url": "https://api.github.com/users/aquarapid/following{/other_user}",
    "gists_url": "https://api.github.com/users/aquarapid/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/aquarapid",
    "id": 772642,
    "login": "aquarapid",
    "node_id": "MDQ6VXNlcjc3MjY0Mg==",
    "organizations_url": "https://api.github.com/users/aquarapid/orgs",
    "received_events_url": "https://api.github.com/users/aquarapid/received_events",
    "repos_url": "https://api.github.com/users/aquarapid/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/aquarapid/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aquarapid/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/aquarapid"
  }
}