{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "When filing a bug, please include the following headings if\r\npossible. Any example text in this template can be deleted.\r\n\r\n#### Overview of the Issue\r\ndetele when assigning conditions on primary key does not works\r\n\r\n#### Reproduction Steps\r\n\r\nSteps to reproduce this issue, example:\r\n\r\n1. set up a cluster using scripts in example/local\r\n```shell\r\n./zk-up.sh\r\n./vtctld-up.sh\r\n./sharded-vttablet-up.sh\r\n./lvtctl.sh InitShardMaster -force test_keyspace/-80 test-200\r\n./lvtctl.sh InitShardMaster -force test_keyspace/80- test-300\r\n./vtgate-up.sh\r\n```\r\n\r\n2. apply the following `vschema`:\r\n```javascript\r\n{\r\n  \"sharded\": true,\r\n  \"vindexes\": {\r\n    \"hash\": {\r\n      \"type\": \"hash\"\r\n    },\r\n    \"md5\": {\r\n      \"type\": \"unicode_loose_md5\"\r\n    }\r\n  },\r\n  \"tables\": {\r\n    \"messages\": {\r\n      \"column_vindexes\": [\r\n        {\r\n          \"column\": \"page\",\r\n          \"name\": \"md5\"\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n3. connecting to vtgate using mysql client\r\n```shell\r\nmysql --version\r\nmysql  Ver 15.1 Distrib 10.3.4-MariaDB, for Linux (x86_64) using readline 5.1\r\n\r\nmysql -P15306 -umysql_user -pmysql_password\r\n```\r\n\r\n4. execute following sql sequence\r\n```sql\r\nuse test_keyspace\r\ncreate table messages (page varchar(30) primary key, col1 int);\r\ninsert into messages(page,col1) values('aaa389', 389),('slfo',293),('aaa209', 209);\r\nselect * from messages;\r\n+--------+------+\r\n| page   | col1 |\r\n+--------+------+\r\n| aaa389 |  389 |\r\n| slfo   |  293 |\r\n| aaa209 |  209 |\r\n+--------+------+\r\n3 rows in set (0.003 sec)\r\ndelete from messages where page like \"aaa%\";\r\nQuery OK, 0 rows affected (0.040 sec)\r\nselect * from messages;\r\n+--------+------+\r\n| page   | col1 |\r\n+--------+------+\r\n| aaa389 |  389 |\r\n| slfo   |  293 |\r\n| aaa209 |  209 |\r\n+--------+------+\r\n3 rows in set (0.003 sec)\r\n```\r\n#### Binary version\r\n\r\n```sh\r\nvtgate --version\r\nVersion: 1b7879cb9 (Git branch 'master') built on Thu Jun  7 11:03:49 CST 2018 by lfs@t450 using go1.10.1 linux/amd64\r\n```\r\n\r\n#### Operating system and Environment details\r\n```sh\r\n ~ \ue0b0 uname -a\r\nLinux t450 4.15.0-22-generic #24-Ubuntu SMP Wed May 16 12:15:17 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n#### Log Fragments\r\nThis bug can be easily reproduced\r\n\r\n#### Notice\r\nbecause of using mariadb db\uff0ci do some changes to config/mycnf/default.cnf as follows:\r\n```sh\r\n ~/go/src/vitess.io/vitess \ue0b0 \ue0a0 master \u25cf \ue0b0 git diff config/mycnf/default.cnf\r\ndiff --git a/config/mycnf/default.cnf b/config/mycnf/default.cnf\r\nindex dec456f30..2cb07a879 100644\r\n--- a/config/mycnf/default.cnf\r\n+++ b/config/mycnf/default.cnf\r\n@@ -22,7 +22,7 @@ innodb_log_file_size = 64M\r\n innodb_log_files_in_group = 2\r\n innodb_log_group_home_dir = {{.InnodbLogGroupHomeDir}}\r\n innodb_max_dirty_pages_pct = 75\r\n-innodb_support_xa = 0\r\n+# innodb_support_xa = 0\r\n innodb_thread_concurrency = 20\r\n key_buffer_size = 32M\r\n log-error = {{.ErrorLogPath}}\r\n@@ -64,12 +64,12 @@ transaction-isolation = REPEATABLE-READ\r\n # If the -enable_semi_sync flag is used, VTTablet will enable semi-sync\r\n # at the proper time when replication is set up, or when masters are\r\n # promoted or demoted.\r\n-plugin-load = rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so\r\n+# plugin-load = rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.soi\r\n \r\n # When semi-sync is enabled, don't allow fallback to async\r\n # if you get no ack, or have no slaves. This is necessary to\r\n # prevent alternate futures when doing a failover in response to\r\n # a master that becomes unresponsive.\r\n-rpl_semi_sync_master_timeout = 1000000000000000000\r\n-rpl_semi_sync_master_wait_no_slave = 1\r\n+#rpl_semi_sync_master_timeout = 1000000000000000000\r\n+#rpl_semi_sync_master_wait_no_slave = 1\r\n```\r\nand comment the line enable enable_semi_sync\r\n```sh\r\n ~/go/src/vitess.io/vitess \ue0b0 \ue0a0 master \u25cf \ue0b0 git diff examples/local/vttablet-up.sh\r\ndiff --git a/examples/local/vttablet-up.sh b/examples/local/vttablet-up.sh\r\nindex 9ff3f4228..209746d5a 100755\r\n--- a/examples/local/vttablet-up.sh\r\n+++ b/examples/local/vttablet-up.sh\r\n@@ -1,13 +1,13 @@\r\n #!/bin/bash\r\n \r\n # Copyright 2017 Google Inc.\r\n-# \r\n+#\r\n # Licensed under the Apache License, Version 2.0 (the \"License\");\r\n # you may not use this file except in compliance with the License.\r\n # You may obtain a copy of the License at\r\n-# \r\n+#\r\n #     http://www.apache.org/licenses/LICENSE-2.0\r\n-# \r\n+#\r\n # Unless required by applicable law or agreed to in writing, software\r\n # distributed under the License is distributed on an \"AS IS\" BASIS,\r\n # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n@@ -131,7 +131,6 @@ for uid_index in $uids; do\r\n     -init_shard $shard \\\r\n     -init_tablet_type $tablet_type \\\r\n     -health_check_interval 5s \\\r\n-    -enable_semi_sync \\\r\n     -enable_replication_reporter \\\r\n     -backup_storage_implementation file \\\r\n     -file_backup_storage_root $VTDATAROOT/backups \\\r\n```\r\n",
  "closed_at": "2018-06-07T20:29:56Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/589370?v=4",
    "events_url": "https://api.github.com/users/sougou/events{/privacy}",
    "followers_url": "https://api.github.com/users/sougou/followers",
    "following_url": "https://api.github.com/users/sougou/following{/other_user}",
    "gists_url": "https://api.github.com/users/sougou/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sougou",
    "id": 589370,
    "login": "sougou",
    "node_id": "MDQ6VXNlcjU4OTM3MA==",
    "organizations_url": "https://api.github.com/users/sougou/orgs",
    "received_events_url": "https://api.github.com/users/sougou/received_events",
    "repos_url": "https://api.github.com/users/sougou/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sougou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sougou/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sougou"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/4007/comments",
  "created_at": "2018-06-07T03:41:25Z",
  "events_url": "https://api.github.com/repos/vitessio/vitess/issues/4007/events",
  "html_url": "https://github.com/vitessio/vitess/issues/4007",
  "id": 330105775,
  "labels": [],
  "labels_url": "https://api.github.com/repos/vitessio/vitess/issues/4007/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMzAxMDU3NzU=",
  "number": 4007,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/vitessio/vitess",
  "state": "closed",
  "title": "delete from table where PK_column like \"pattern%\"  does not works ",
  "updated_at": "2018-06-07T20:29:56Z",
  "url": "https://api.github.com/repos/vitessio/vitess/issues/4007",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/29708651?v=4",
    "events_url": "https://api.github.com/users/longf0720/events{/privacy}",
    "followers_url": "https://api.github.com/users/longf0720/followers",
    "following_url": "https://api.github.com/users/longf0720/following{/other_user}",
    "gists_url": "https://api.github.com/users/longf0720/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/longf0720",
    "id": 29708651,
    "login": "longf0720",
    "node_id": "MDQ6VXNlcjI5NzA4NjUx",
    "organizations_url": "https://api.github.com/users/longf0720/orgs",
    "received_events_url": "https://api.github.com/users/longf0720/received_events",
    "repos_url": "https://api.github.com/users/longf0720/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/longf0720/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/longf0720/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/longf0720"
  }
}