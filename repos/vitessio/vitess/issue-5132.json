{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "COLLABORATOR",
  "body": "If you connect to mysql using the JDBC MySQL driver with a dbname in connection params then USE statements take no effect.\r\n\r\nThis doesn't affect the mysql CLI because it sends the `COM_INIT_DB` packet. The JDBC driver doesn't send the `COM_INIT_DB`, it uses the USE statement. As seen here:\r\nhttps://github.com/mysql/mysql-connector-j/blob/36534fa273b4d7824a8668ca685465cf8eaeadd9/src/main/user-impl/java/com/mysql/cj/jdbc/ConnectionImpl.java#L2139\r\n\r\nThe issue is this:\r\nhttps://github.com/vitessio/vitess/blob/60b4643725017fa809e11c0d00a81e5cc5498586/go/vt/vtgate/plugin_mysql_server.go#L149-L151\r\n\r\nYou can see that `c.SchemaName` overwrites `session.TargetString` for every call and that the mysql protocol ignores any `USE` statements.\r\n\r\nI think the fix is to assign the value of `session.TargetString` to `c.SchemaName` but I'm not sure what the wider repercussions are...\r\n",
  "closed_at": "2019-08-27T04:36:50Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/11489?v=4",
    "events_url": "https://api.github.com/users/tirsen/events{/privacy}",
    "followers_url": "https://api.github.com/users/tirsen/followers",
    "following_url": "https://api.github.com/users/tirsen/following{/other_user}",
    "gists_url": "https://api.github.com/users/tirsen/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tirsen",
    "id": 11489,
    "login": "tirsen",
    "node_id": "MDQ6VXNlcjExNDg5",
    "organizations_url": "https://api.github.com/users/tirsen/orgs",
    "received_events_url": "https://api.github.com/users/tirsen/received_events",
    "repos_url": "https://api.github.com/users/tirsen/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tirsen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tirsen/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tirsen"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/5132/comments",
  "created_at": "2019-08-26T00:41:53Z",
  "events_url": "https://api.github.com/repos/vitessio/vitess/issues/5132/events",
  "html_url": "https://github.com/vitessio/vitess/issues/5132",
  "id": 484996459,
  "labels": [],
  "labels_url": "https://api.github.com/repos/vitessio/vitess/issues/5132/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0ODQ5OTY0NTk=",
  "number": 5132,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/vitessio/vitess",
  "state": "closed",
  "title": "USE statement not respected with JDBC MySQL driver and dbname in connection params",
  "updated_at": "2019-08-27T04:36:50Z",
  "url": "https://api.github.com/repos/vitessio/vitess/issues/5132",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/11489?v=4",
    "events_url": "https://api.github.com/users/tirsen/events{/privacy}",
    "followers_url": "https://api.github.com/users/tirsen/followers",
    "following_url": "https://api.github.com/users/tirsen/following{/other_user}",
    "gists_url": "https://api.github.com/users/tirsen/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tirsen",
    "id": 11489,
    "login": "tirsen",
    "node_id": "MDQ6VXNlcjExNDg5",
    "organizations_url": "https://api.github.com/users/tirsen/orgs",
    "received_events_url": "https://api.github.com/users/tirsen/received_events",
    "repos_url": "https://api.github.com/users/tirsen/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tirsen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tirsen/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tirsen"
  }
}