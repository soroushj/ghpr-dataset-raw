{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "COLLABORATOR",
  "body": "We had several vtgates in a test environment fail to notice that some tablets were healthy. The gates all recognized the tablet as healthy a few hours later.\r\n\r\nI don't know if this is a cause, but I do notice that TabletServer.BroadcastHealth() writes to a channel of 10 size for each vtgate connection to the tablet but doesn't write anything or block if the channel is full.\r\n\r\nIt seems like it would be better to close the channel in that case and also modify `StreamHealth` so that the vtgate will be forcibly disconnected from streaming health and given the chance to reconnect and get an up-to-date value. Alternatively, probably a better approach would be to avoid buffering out-of-date health information if vtgates are slow and store/return more recent health information instead using the limited-size buffer.\r\n\r\nI don't know if this was the cause of the issue we saw so it might not be related, but we were seeing \"no connection for key\" in the UNAVAILABLE errors for queries to the sad vtgates that incorrectly believed tablets were unavailable when the tablets themselves were healthy.",
  "closed_at": "2020-10-19T17:00:07Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/388311?v=4",
    "events_url": "https://api.github.com/users/deepthi/events{/privacy}",
    "followers_url": "https://api.github.com/users/deepthi/followers",
    "following_url": "https://api.github.com/users/deepthi/following{/other_user}",
    "gists_url": "https://api.github.com/users/deepthi/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/deepthi",
    "id": 388311,
    "login": "deepthi",
    "node_id": "MDQ6VXNlcjM4ODMxMQ==",
    "organizations_url": "https://api.github.com/users/deepthi/orgs",
    "received_events_url": "https://api.github.com/users/deepthi/received_events",
    "repos_url": "https://api.github.com/users/deepthi/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/deepthi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deepthi/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/deepthi"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/5445/comments",
  "created_at": "2019-11-19T20:00:36Z",
  "events_url": "https://api.github.com/repos/vitessio/vitess/issues/5445/events",
  "html_url": "https://github.com/vitessio/vitess/issues/5445",
  "id": 525233394,
  "labels": [
    {
      "color": "d11f28",
      "default": false,
      "description": "",
      "id": 760789208,
      "name": "Type: Bug",
      "node_id": "MDU6TGFiZWw3NjA3ODkyMDg=",
      "url": "https://api.github.com/repos/vitessio/vitess/labels/Type:%20Bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/vitessio/vitess/issues/5445/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MjUyMzMzOTQ=",
  "number": 5445,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/vitessio/vitess",
  "state": "closed",
  "title": "Tablet streaming health can lose current state",
  "updated_at": "2020-10-19T17:00:07Z",
  "url": "https://api.github.com/repos/vitessio/vitess/issues/5445",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/100598?v=4",
    "events_url": "https://api.github.com/users/dweitzman/events{/privacy}",
    "followers_url": "https://api.github.com/users/dweitzman/followers",
    "following_url": "https://api.github.com/users/dweitzman/following{/other_user}",
    "gists_url": "https://api.github.com/users/dweitzman/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dweitzman",
    "id": 100598,
    "login": "dweitzman",
    "node_id": "MDQ6VXNlcjEwMDU5OA==",
    "organizations_url": "https://api.github.com/users/dweitzman/orgs",
    "received_events_url": "https://api.github.com/users/dweitzman/received_events",
    "repos_url": "https://api.github.com/users/dweitzman/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dweitzman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dweitzman/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dweitzman"
  }
}