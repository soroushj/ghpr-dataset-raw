{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "For a table defined as\r\n```\r\nCREATE TABLE `my_table` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `col2` bigint(20) unsigned DEFAULT NULL,\r\n  `col3` bigint(20) unsigned DEFAULT NULL,\r\n  `type` enum(\u2026,'enum_value',\u2026) NOT NULL DEFAULT '...',\r\n  PRIMARY KEY (`id`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=9999 DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC\r\n```\r\n\r\nI connect to a keyspace explicitly and see the following:\r\n```\r\nvt_app@localhost keyspace@master> insert into my_table (col2,col3,type) values (10000000000,10000000000,'enum_value');\r\nQuery OK, 1 row affected (0.01 sec)\r\nvt_app@localhost keyspace@master> select last_insert_id();\r\n+------------------+\r\n| last_insert_id() |\r\n+------------------+\r\n|                0 |\r\n+------------------+\r\n(id=2353 is the row inserted)\r\n```\r\n\r\nI expect to get back from `LAST_INSERT_ID()` the value 2353 but don't get it.\r\n\r\nExplanation is:\r\n* using autocommit\r\n* this means that the insert connection for statment 1 and the select statement for statement 2 are not necessarily using the same mysql connection.\r\n\r\nCurrent workaround:\r\n* wrap in `BEGIN; .....; COMMIT;` to use the same connection\r\n\r\nImprovement in behaviour (suggested by @sougou) is to record the value in the client session\r\nand in subsequent statements replace `LAST_INSERT_ID()` by the value that was previously recorded.\r\n\r\nThis issue to to record this problem and a mention a possible solution suggested by @sougou.",
  "closed_at": "2020-01-07T23:11:27Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/589370?v=4",
    "events_url": "https://api.github.com/users/sougou/events{/privacy}",
    "followers_url": "https://api.github.com/users/sougou/followers",
    "following_url": "https://api.github.com/users/sougou/following{/other_user}",
    "gists_url": "https://api.github.com/users/sougou/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sougou",
    "id": 589370,
    "login": "sougou",
    "node_id": "MDQ6VXNlcjU4OTM3MA==",
    "organizations_url": "https://api.github.com/users/sougou/orgs",
    "received_events_url": "https://api.github.com/users/sougou/received_events",
    "repos_url": "https://api.github.com/users/sougou/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sougou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sougou/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sougou"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/vitessio/vitess/issues/3668/comments",
  "created_at": "2018-02-21T16:37:52Z",
  "events_url": "https://api.github.com/repos/vitessio/vitess/issues/3668/events",
  "html_url": "https://github.com/vitessio/vitess/issues/3668",
  "id": 299041572,
  "labels": [
    {
      "color": "c2e0c6",
      "default": false,
      "description": null,
      "id": 760788586,
      "name": "P3",
      "node_id": "MDU6TGFiZWw3NjA3ODg1ODY=",
      "url": "https://api.github.com/repos/vitessio/vitess/labels/P3"
    },
    {
      "color": "84b6eb",
      "default": false,
      "description": null,
      "id": 45388297,
      "name": "Type: Feature Request",
      "node_id": "MDU6TGFiZWw0NTM4ODI5Nw==",
      "url": "https://api.github.com/repos/vitessio/vitess/labels/Type:%20Feature%20Request"
    }
  ],
  "labels_url": "https://api.github.com/repos/vitessio/vitess/issues/3668/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyOTkwNDE1NzI=",
  "number": 3668,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/vitessio/vitess",
  "state": "closed",
  "title": "Improve treatment of LAST_INSERT_ID() in Vitess",
  "updated_at": "2020-01-07T23:11:27Z",
  "url": "https://api.github.com/repos/vitessio/vitess/issues/3668",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/116250?v=4",
    "events_url": "https://api.github.com/users/sjmudd/events{/privacy}",
    "followers_url": "https://api.github.com/users/sjmudd/followers",
    "following_url": "https://api.github.com/users/sjmudd/following{/other_user}",
    "gists_url": "https://api.github.com/users/sjmudd/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sjmudd",
    "id": 116250,
    "login": "sjmudd",
    "node_id": "MDQ6VXNlcjExNjI1MA==",
    "organizations_url": "https://api.github.com/users/sjmudd/orgs",
    "received_events_url": "https://api.github.com/users/sjmudd/received_events",
    "repos_url": "https://api.github.com/users/sjmudd/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sjmudd/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sjmudd/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sjmudd"
  }
}