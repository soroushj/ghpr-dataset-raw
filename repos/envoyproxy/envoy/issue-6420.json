{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "This is following up on previously closed Issue (https://github.com/envoyproxy/envoy/issues/5347).\r\nThis one specifically targets to address just the stale Endpoints issue. \r\n\r\n---------------\r\n\r\n*Title*: *Add support for specifying how long endpoints should be used*\r\n\r\n*Description*:\r\nWhen disconnected from the Management Server, envoy would end up using last known information from the Mgmt server. This is probably good for a lot of usecases/deployment, but there are situations where this might actually be harmful for overall system.\r\n\r\n*Stale Endpoints:\r\nFor a deployment where Management Server does load balancing and sends the endpoints with weights to the envoys. If a envoy is disconnected from the management server for significant period, it will continue to use the stale weights and endpoints. Although the envoy will route the traffic to endpoints, we might end have \r\n   - Some servers move to different ip:port causing less number of endpoints being usable. Which eventually results in server overload.\r\n   - Servers getting overloaded as the weights assigned are stale.\r\n\r\n**Proposal**:\r\n---------------\r\nAs we are specifically looking to identify stale information having this lease associated per Endpoints is an overkill.\r\nThere are two levels where this control signal can be added.\r\n\r\n**Envoy level (Config)**\r\nAs part of the CDS response. This is applied to all the resources returned in CDS response, and only changes when there is new CDS response.\r\ne.g.\r\n\r\n```\r\nmessage OutlierDetection { \r\n.   .   .\r\n  // The max time for which an endpoint can be used after it was received as part of EDS/CDS\r\n  // Defaults to 0 which means never.\r\n  google.protobuf.Duration  endpoint_stale_after = 12 [(validate.rules).duration.gt.seconds = 0];\r\n}\r\n ```\r\n**Cluster level (EDS resources)**\r\nAssociate per ClusterLoadAssignment, and is associated per assignment (every EDS response).  \r\n```\r\nmessage ClusterLoadAssignment {\r\n   // The max time for which an endpoint of this cluster can be used after this assignment was received.\r\n   // Defaults to 0 which means never.\r\n  google.protobuf.Duration  endpoint_stale_after = 5 [(validate.rules).duration.gt.seconds = 0];\r\n}\r\n```\r\n\r\nEither of the above approach extends easily to Incremental xDS as what we are really tracking is how long has it been since the Mgmt Server sent us endpoints.",
  "closed_at": "2019-04-17T19:53:02Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/10914751?v=4",
    "events_url": "https://api.github.com/users/htuch/events{/privacy}",
    "followers_url": "https://api.github.com/users/htuch/followers",
    "following_url": "https://api.github.com/users/htuch/following{/other_user}",
    "gists_url": "https://api.github.com/users/htuch/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/htuch",
    "id": 10914751,
    "login": "htuch",
    "node_id": "MDQ6VXNlcjEwOTE0NzUx",
    "organizations_url": "https://api.github.com/users/htuch/orgs",
    "received_events_url": "https://api.github.com/users/htuch/received_events",
    "repos_url": "https://api.github.com/users/htuch/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/htuch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/htuch/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/htuch"
  },
  "comments": 14,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6420/comments",
  "created_at": "2019-03-28T22:45:18Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6420/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/6420",
  "id": 426739395,
  "labels": [
    {
      "color": "c5def5",
      "default": false,
      "description": "Needs design doc/proposal before implementation",
      "id": 620444894,
      "name": "design proposal",
      "node_id": "MDU6TGFiZWw2MjA0NDQ4OTQ=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/design%20proposal"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6420/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MjY3MzkzOTU=",
  "number": 6420,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Support for endpoint lease ( How long endpoints should be used)",
  "updated_at": "2019-04-17T19:53:02Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/6420",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/3991732?v=4",
    "events_url": "https://api.github.com/users/vishalpowar/events{/privacy}",
    "followers_url": "https://api.github.com/users/vishalpowar/followers",
    "following_url": "https://api.github.com/users/vishalpowar/following{/other_user}",
    "gists_url": "https://api.github.com/users/vishalpowar/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/vishalpowar",
    "id": 3991732,
    "login": "vishalpowar",
    "node_id": "MDQ6VXNlcjM5OTE3MzI=",
    "organizations_url": "https://api.github.com/users/vishalpowar/orgs",
    "received_events_url": "https://api.github.com/users/vishalpowar/received_events",
    "repos_url": "https://api.github.com/users/vishalpowar/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/vishalpowar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vishalpowar/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/vishalpowar"
  }
}