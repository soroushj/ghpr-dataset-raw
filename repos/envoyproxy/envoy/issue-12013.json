{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "Seems like it's possible to hit a pure virtual call when calling `Envoy::Secret::SecretManagerImpl::findOrCreateGenericSecretProvider` during filter construction with a file-based SDS secret:\r\n\r\n```\r\n#4  0x0000000004546e31 in std::terminate() ()\r\n#5  0x000000000454785f in __cxa_pure_virtual ()\r\n#6  0x000000000287b0d9 in Envoy::Secret::SdsApi::onConfigUpdate (this=0x515e610, resources=..., version_info=...) at source/common/secret/sds_api.cc:56\r\n#7  0x000000000314e5f0 in Envoy::Config::FilesystemSubscriptionImpl::refresh (this=0x5836d20) at source/common/config/filesystem_subscription_impl.cc:59\r\n#8  0x000000000314e3d0 in Envoy::Config::FilesystemSubscriptionImpl::start (this=0x5836d20) at source/common/config/filesystem_subscription_impl.cc:33\r\n#9  0x000000000287bc5e in Envoy::Secret::SdsApi::initialize (this=0x515e610) at source/common/secret/sds_api.cc:115\r\n#10 0x000000000287c668 in Envoy::Secret::SdsApi::SdsApi(envoy::config::core::v3::ConfigSource, absl::string_view, Envoy::Config::SubscriptionFactory&, Envoy::TimeSource&, Envoy::ProtobufMessage::ValidationVisitor&, Envoy::Stats::Store&, Envoy::Init::Manager&, std::function<void ()>, Envoy::Event::Dispatcher&, Envoy::Api::Api&)::$_0::operator()() const (this=0x5851a78) at source/common/secret/sds_api.cc:24\r\n```\r\n\r\nSeems like the SdsApi is initialized and triggers the `init_manager_` callback immediately since we're past the startup sequence, which triggers start -> refresh on the file subscription inline. This results in `onConfigUpdate` being called, which invokes virtual functions that have not yet been initialized.",
  "closed_at": "2020-08-27T17:43:54Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/2023366?v=4",
    "events_url": "https://api.github.com/users/snowp/events{/privacy}",
    "followers_url": "https://api.github.com/users/snowp/followers",
    "following_url": "https://api.github.com/users/snowp/following{/other_user}",
    "gists_url": "https://api.github.com/users/snowp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/snowp",
    "id": 2023366,
    "login": "snowp",
    "node_id": "MDQ6VXNlcjIwMjMzNjY=",
    "organizations_url": "https://api.github.com/users/snowp/orgs",
    "received_events_url": "https://api.github.com/users/snowp/received_events",
    "repos_url": "https://api.github.com/users/snowp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/snowp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/snowp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/snowp"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/12013/comments",
  "created_at": "2020-07-09T22:13:08Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/12013/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/12013",
  "id": 654379818,
  "labels": [
    {
      "color": "bcdbf4",
      "default": false,
      "description": "SDS related",
      "id": 2054167604,
      "name": "area/sds",
      "node_id": "MDU6TGFiZWwyMDU0MTY3NjA0",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/area/sds"
    },
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/12013/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2NTQzNzk4MTg=",
  "number": 12013,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Pure virtual call in SdsApi",
  "updated_at": "2020-08-27T17:43:54Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/12013",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/2023366?v=4",
    "events_url": "https://api.github.com/users/snowp/events{/privacy}",
    "followers_url": "https://api.github.com/users/snowp/followers",
    "following_url": "https://api.github.com/users/snowp/following{/other_user}",
    "gists_url": "https://api.github.com/users/snowp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/snowp",
    "id": 2023366,
    "login": "snowp",
    "node_id": "MDQ6VXNlcjIwMjMzNjY=",
    "organizations_url": "https://api.github.com/users/snowp/orgs",
    "received_events_url": "https://api.github.com/users/snowp/received_events",
    "repos_url": "https://api.github.com/users/snowp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/snowp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/snowp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/snowp"
  }
}