{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/164562?v=4",
    "events_url": "https://api.github.com/users/objectiser/events{/privacy}",
    "followers_url": "https://api.github.com/users/objectiser/followers",
    "following_url": "https://api.github.com/users/objectiser/following{/other_user}",
    "gists_url": "https://api.github.com/users/objectiser/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/objectiser",
    "id": 164562,
    "login": "objectiser",
    "node_id": "MDQ6VXNlcjE2NDU2Mg==",
    "organizations_url": "https://api.github.com/users/objectiser/orgs",
    "received_events_url": "https://api.github.com/users/objectiser/received_events",
    "repos_url": "https://api.github.com/users/objectiser/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/objectiser/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/objectiser/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/objectiser"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/164562?v=4",
      "events_url": "https://api.github.com/users/objectiser/events{/privacy}",
      "followers_url": "https://api.github.com/users/objectiser/followers",
      "following_url": "https://api.github.com/users/objectiser/following{/other_user}",
      "gists_url": "https://api.github.com/users/objectiser/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/objectiser",
      "id": 164562,
      "login": "objectiser",
      "node_id": "MDQ6VXNlcjE2NDU2Mg==",
      "organizations_url": "https://api.github.com/users/objectiser/orgs",
      "received_events_url": "https://api.github.com/users/objectiser/received_events",
      "repos_url": "https://api.github.com/users/objectiser/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/objectiser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/objectiser/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/objectiser"
    }
  ],
  "author_association": "MEMBER",
  "body": "*Description*:\r\n\r\nWhen the health check filter is used, any invocation that matches the health check path causes the root span to not be sampled, but the sampled flag is not be propagated to subsequent services. The subsequent services (or child spans) should also not be sampled.\r\n\r\n*Repro steps*:\r\n\r\n* Change to the `examples/jaeger-tracing` folder\r\n* Edit the `front-envoy-jaeger.yaml` to update the `http_filter` to be:\r\n```\r\n          http_filters:\r\n          - name: envoy.health_check\r\n            config:\r\n              endpoint: \"/trace/1\"\r\n              pass_through_mode: true\r\n          - name: envoy.router\r\n            config:\r\n               start_child_span: true\r\n```\r\n* Start the example using `docker-compose up --build -d`\r\n* Send a request using `curl -v localhost:8000/trace/1`\r\n* Access the Jaeger UI at endpoint `http://localhost:16686`\r\nYou should see a single trace, which when selected will show something like:\r\n![envoy-hc-traced](https://user-images.githubusercontent.com/164562/41096269-013c5a04-6a4c-11e8-9bda-d37b9d9afc17.png)\r\n\r\nThe root span has not been reported due to the classification as a health check, but the sampled status has not been passed to the child span created in the proxy, or on to the subsequent `service1`, etc.\r\n\r\nThe same applies if the `start_child_span` is false, the spans for `service1` and `service2` are created - this time with `service1` as the root span - so indicates that the root span in the ingress is being created but not reported, but the sampled flag is not being propagated to the child span or subsequent services.\r\n\r\nAlso the other strange thing is that if the `X-B3-Sampled` header is supplied (whether with 0 or 1 value), it does not cause a trace to be created.\r\n",
  "closed_at": "2018-06-15T23:15:54Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/3569/comments",
  "created_at": "2018-06-07T11:23:11Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/3569/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/3569",
  "id": 330229350,
  "labels": [
    {
      "color": "84b6eb",
      "default": true,
      "description": "Feature requests. Not bugs or questions.",
      "id": 421403909,
      "name": "enhancement",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDk=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/enhancement"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/3569/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMzAyMjkzNTA=",
  "number": 3569,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "tracing: Health check filter only prevents sampling of root span",
  "updated_at": "2018-06-15T23:15:54Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/3569",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/164562?v=4",
    "events_url": "https://api.github.com/users/objectiser/events{/privacy}",
    "followers_url": "https://api.github.com/users/objectiser/followers",
    "following_url": "https://api.github.com/users/objectiser/following{/other_user}",
    "gists_url": "https://api.github.com/users/objectiser/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/objectiser",
    "id": 164562,
    "login": "objectiser",
    "node_id": "MDQ6VXNlcjE2NDU2Mg==",
    "organizations_url": "https://api.github.com/users/objectiser/orgs",
    "received_events_url": "https://api.github.com/users/objectiser/received_events",
    "repos_url": "https://api.github.com/users/objectiser/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/objectiser/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/objectiser/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/objectiser"
  }
}