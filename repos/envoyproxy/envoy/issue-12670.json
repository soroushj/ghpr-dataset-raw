{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "This is related issue of https://github.com/envoyproxy/envoy/issues/11120.\r\nI think that the startup behavior of clusters which are triggered by `addOrUpdate()` is strange. \r\nFacing problem is that dynamically inserted cluster which depends on SDS is always `active` even though depending TLS certificate is not initialized because some of issue occurred, like there is no cert info on DiscoveryResponse. \r\nI think that this problem is caused by current behavior of ClusterManager. In current implementation, clusters inserted dynamically before all of init clusters haven't initialized will be marked immediately `active`. As a result, there is no indicator that inserted cluster is active or warming. \r\nIn this situation, dynamically inserted cluster (calls `cluster_1`) should walk state change like,\r\n\r\n1. Stats is indicating that `cluster_1` is `warming` when `addOrUpdate()` is called before all of init clusters are not initialized.\r\n2. While there is no TLS certificate, SDS subscription belongs to `cluster_1`'s transport socket factory is send DiscoveryRequest repeatedly until it reaches to `initial_fetch_timeout`, and stats is indicating `warming`. When it retrieved TLS certificate, the state of `cluster_1` should change from `warming` to `active`.\r\n3. After it reaches to `initial_fetch_timeout` and there is no certificate, stats should indicate `cluster_1` is `warming` eternally.\r\n\r\nIt may be wrong understanding about cluster manager. But I think that we need to consider the initializing cluster's state change to resolve this problem.\r\n\r\ncc. @howardjohn ",
  "closed_at": "2020-10-16T01:11:53Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/12670/comments",
  "created_at": "2020-08-16T07:50:21Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/12670/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/12670",
  "id": 679709480,
  "labels": [
    {
      "color": "e5c120",
      "default": false,
      "description": "",
      "id": 2280270504,
      "name": "area/cluster_manager",
      "node_id": "MDU6TGFiZWwyMjgwMjcwNTA0",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/area/cluster_manager"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/12670/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2Nzk3MDk0ODA=",
  "number": 12670,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "cluster manager: dynamically inserted clusters should be warming at first",
  "updated_at": "2020-10-16T01:11:53Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/12670",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/17607122?v=4",
    "events_url": "https://api.github.com/users/Shikugawa/events{/privacy}",
    "followers_url": "https://api.github.com/users/Shikugawa/followers",
    "following_url": "https://api.github.com/users/Shikugawa/following{/other_user}",
    "gists_url": "https://api.github.com/users/Shikugawa/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/Shikugawa",
    "id": 17607122,
    "login": "Shikugawa",
    "node_id": "MDQ6VXNlcjE3NjA3MTIy",
    "organizations_url": "https://api.github.com/users/Shikugawa/orgs",
    "received_events_url": "https://api.github.com/users/Shikugawa/received_events",
    "repos_url": "https://api.github.com/users/Shikugawa/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/Shikugawa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Shikugawa/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/Shikugawa"
  }
}