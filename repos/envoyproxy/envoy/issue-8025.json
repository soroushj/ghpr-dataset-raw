{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "*Title*: *Envoy crashes when ext_authz is reconfigured while under load*\r\n\r\n*Description*:\r\n>When a steady load of approximately > 10 requests per second is sent through Envoy, a reload of the `ext_authz` filter will cause envoy to appropriately return a 403 but then unexpectedly crash.\r\n\r\nThis has been tested on master as well as the v1.11.1 release.\r\n\r\n*Repro steps*:\r\n1. Stand up envoy with the `ext_authz` using a controller (in this case Ambassador)\r\n2. Send a stream of requests through envoy\r\n3. Reconfigure ext_authz\r\n4. See envoy crash\r\n\r\n*Config*:\r\n```\r\n{\r\n    \"@type\": \"/envoy.config.bootstrap.v2.Bootstrap\",\r\n    \"static_resources\": {\r\n        \"clusters\": [\r\n            {\r\n                \"connect_timeout\": \"3.000s\",\r\n                \"dns_lookup_family\": \"V4_ONLY\",\r\n                \"lb_policy\": \"ROUND_ROBIN\",\r\n                \"load_assignment\": {\r\n                    \"cluster_name\": \"cluster_127_0_0_1_8877\",\r\n                    \"endpoints\": [\r\n                        {\r\n                            \"lb_endpoints\": [\r\n                                {\r\n                                    \"endpoint\": {\r\n                                        \"address\": {\r\n                                            \"socket_address\": {\r\n                                                \"address\": \"127.0.0.1\",\r\n                                                \"port_value\": 8877,\r\n                                                \"protocol\": \"TCP\"\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            ]\r\n                        }\r\n                    ]\r\n                },\r\n                \"name\": \"cluster_127_0_0_1_8877\",\r\n                \"type\": \"STRICT_DNS\"\r\n            },\r\n            {\r\n                \"connect_timeout\": \"3.000s\",\r\n                \"dns_lookup_family\": \"V4_ONLY\",\r\n                \"lb_policy\": \"ROUND_ROBIN\",\r\n                \"load_assignment\": {\r\n                    \"cluster_name\": \"cluster_extauth_example_auth2_3000\",\r\n                    \"endpoints\": [\r\n                        {\r\n                            \"lb_endpoints\": [\r\n                                {\r\n                                    \"endpoint\": {\r\n                                        \"address\": {\r\n                                            \"socket_address\": {\r\n                                                \"address\": \"example-auth2\",\r\n                                                \"port_value\": 3000,\r\n                                                \"protocol\": \"TCP\"\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            ]\r\n                        }\r\n                    ]\r\n                },\r\n                \"name\": \"cluster_extauth_example_auth2_3000\",\r\n                \"type\": \"STRICT_DNS\"\r\n            },\r\n            {\r\n                \"connect_timeout\": \"3.000s\",\r\n                \"dns_lookup_family\": \"V4_ONLY\",\r\n                \"lb_policy\": \"ROUND_ROBIN\",\r\n                \"load_assignment\": {\r\n                    \"cluster_name\": \"cluster_tour_8080\",\r\n                    \"endpoints\": [\r\n                        {\r\n                            \"lb_endpoints\": [\r\n                                {\r\n                                    \"endpoint\": {\r\n                                        \"address\": {\r\n                                            \"socket_address\": {\r\n                                                \"address\": \"tour\",\r\n                                                \"port_value\": 8080,\r\n                                                \"protocol\": \"TCP\"\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            ]\r\n                        }\r\n                    ]\r\n                },\r\n                \"name\": \"cluster_tour_8080\",\r\n                \"type\": \"STRICT_DNS\"\r\n            }\r\n        ],\r\n        \"listeners\": [\r\n            {\r\n                \"address\": {\r\n                    \"socket_address\": {\r\n                        \"address\": \"0.0.0.0\",\r\n                        \"port_value\": 8080,\r\n                        \"protocol\": \"TCP\"\r\n                    }\r\n                },\r\n                \"filter_chains\": [\r\n                    {\r\n                        \"filters\": [\r\n                            {\r\n                                \"config\": {\r\n                                    \"access_log\": [\r\n                                        {\r\n                                            \"config\": {\r\n                                                \"format\": \"ACCESS [%START_TIME%] \\\"%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\\" %RESPONSE_CODE% %RESPONSE_FLAGS% %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\\"%REQ(X-FORWARDED-FOR)%\\\" \\\"%REQ(USER-AGENT)%\\\" \\\"%REQ(X-REQUEST-ID)%\\\" \\\"%REQ(:AUTHORITY)%\\\" \\\"%UPSTREAM_HOST%\\\"\\n\",\r\n                                                \"path\": \"/dev/fd/1\"\r\n                                            },\r\n                                            \"name\": \"envoy.file_access_log\"\r\n                                        }\r\n                                    ],\r\n                                    \"http_filters\": [\r\n                                        {\r\n                                            \"config\": {\r\n                                                \"http_service\": {\r\n                                                    \"authorization_request\": {\r\n                                                        \"allowed_headers\": {\r\n                                                            \"patterns\": [\r\n                                                                {\r\n                                                                    \"exact\": \"x-qotm-session\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"authorization\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"cookie\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"x-forwarded-for\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"from\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"x-forwarded-host\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"x-forwarded-proto\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"user-agent\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"proxy-authorization\"\r\n                                                                }\r\n                                                            ]\r\n                                                        },\r\n                                                        \"headers_to_add\": []\r\n                                                    },\r\n                                                    \"authorization_response\": {\r\n                                                        \"allowed_client_headers\": {\r\n                                                            \"patterns\": [\r\n                                                                {\r\n                                                                    \"exact\": \"x-qotm-session\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"set-cookie\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"location\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"www-authenticate\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"authorization\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"proxy-authenticate\"\r\n                                                                }\r\n                                                            ]\r\n                                                        },\r\n                                                        \"allowed_upstream_headers\": {\r\n                                                            \"patterns\": [\r\n                                                                {\r\n                                                                    \"exact\": \"x-qotm-session\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"set-cookie\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"location\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"www-authenticate\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"authorization\"\r\n                                                                },\r\n                                                                {\r\n                                                                    \"exact\": \"proxy-authenticate\"\r\n                                                                }\r\n                                                            ]\r\n                                                        }\r\n                                                    },\r\n                                                    \"path_prefix\": \"/extauth\",\r\n                                                    \"server_uri\": {\r\n                                                        \"cluster\": \"cluster_extauth_example_auth2_3000\",\r\n                                                        \"timeout\": \"5.000s\",\r\n                                                        \"uri\": \"http://extauth\"\r\n                                                    }\r\n                                                }\r\n                                            },\r\n                                            \"name\": \"envoy.ext_authz\"\r\n                                        },\r\n                                        {\r\n                                            \"name\": \"envoy.cors\"\r\n                                        },\r\n                                        {\r\n                                            \"name\": \"envoy.router\"\r\n                                        }\r\n                                    ],\r\n                                    \"http_protocol_options\": {\r\n                                        \"accept_http_10\": false\r\n                                    },\r\n                                    \"normalize_path\": true,\r\n                                    \"route_config\": {\r\n                                        \"virtual_hosts\": [\r\n                                            {\r\n                                                \"domains\": [\r\n                                                    \"*\"\r\n                                                ],\r\n                                                \"name\": \"backend\",\r\n                                                \"routes\": [\r\n                                                    {\r\n                                                        \"match\": {\r\n                                                            \"case_sensitive\": true,\r\n                                                            \"prefix\": \"/ambassador/v0/check_ready\",\r\n                                                            \"runtime_fraction\": {\r\n                                                                \"default_value\": {\r\n                                                                    \"denominator\": \"HUNDRED\",\r\n                                                                    \"numerator\": 100\r\n                                                                },\r\n                                                                \"runtime_key\": \"routing.traffic_shift.cluster_127_0_0_1_8877\"\r\n                                                            }\r\n                                                        },\r\n                                                        \"route\": {\r\n                                                            \"cluster\": \"cluster_127_0_0_1_8877\",\r\n                                                            \"prefix_rewrite\": \"/ambassador/v0/check_ready\",\r\n                                                            \"priority\": null,\r\n                                                            \"timeout\": \"10.000s\"\r\n                                                        }\r\n                                                    },\r\n                                                    {\r\n                                                        \"match\": {\r\n                                                            \"case_sensitive\": true,\r\n                                                            \"prefix\": \"/ambassador/v0/check_alive\",\r\n                                                            \"runtime_fraction\": {\r\n                                                                \"default_value\": {\r\n                                                                    \"denominator\": \"HUNDRED\",\r\n                                                                    \"numerator\": 100\r\n                                                                },\r\n                                                                \"runtime_key\": \"routing.traffic_shift.cluster_127_0_0_1_8877\"\r\n                                                            }\r\n                                                        },\r\n                                                        \"route\": {\r\n                                                            \"cluster\": \"cluster_127_0_0_1_8877\",\r\n                                                            \"prefix_rewrite\": \"/ambassador/v0/check_alive\",\r\n                                                            \"priority\": null,\r\n                                                            \"timeout\": \"10.000s\"\r\n                                                        }\r\n                                                    },\r\n                                                    {\r\n                                                        \"match\": {\r\n                                                            \"case_sensitive\": true,\r\n                                                            \"prefix\": \"/ambassador/v0/\",\r\n                                                            \"runtime_fraction\": {\r\n                                                                \"default_value\": {\r\n                                                                    \"denominator\": \"HUNDRED\",\r\n                                                                    \"numerator\": 100\r\n                                                                },\r\n                                                                \"runtime_key\": \"routing.traffic_shift.cluster_127_0_0_1_8877\"\r\n                                                            }\r\n                                                        },\r\n                                                        \"route\": {\r\n                                                            \"cluster\": \"cluster_127_0_0_1_8877\",\r\n                                                            \"prefix_rewrite\": \"/ambassador/v0/\",\r\n                                                            \"priority\": null,\r\n                                                            \"timeout\": \"10.000s\"\r\n                                                        }\r\n                                                    },\r\n                                                    {\r\n                                                        \"match\": {\r\n                                                            \"case_sensitive\": true,\r\n                                                            \"prefix\": \"/backend/\",\r\n                                                            \"runtime_fraction\": {\r\n                                                                \"default_value\": {\r\n                                                                    \"denominator\": \"HUNDRED\",\r\n                                                                    \"numerator\": 100\r\n                                                                },\r\n                                                                \"runtime_key\": \"routing.traffic_shift.cluster_tour_8080\"\r\n                                                            }\r\n                                                        },\r\n                                                        \"route\": {\r\n                                                            \"cluster\": \"cluster_tour_8080\",\r\n                                                            \"prefix_rewrite\": \"/\",\r\n                                                            \"priority\": null,\r\n                                                            \"timeout\": \"3.000s\"\r\n                                                        }\r\n                                                    }\r\n                                                ]\r\n                                            }\r\n                                        ]\r\n                                    },\r\n                                    \"server_name\": \"envoy\",\r\n                                    \"stat_prefix\": \"ingress_http\",\r\n                                    \"use_remote_address\": true,\r\n                                    \"xff_num_trusted_hops\": 0\r\n                                },\r\n                                \"name\": \"envoy.http_connection_manager\"\r\n                            }\r\n                        ],\r\n                        \"use_proxy_proto\": false\r\n                    }\r\n                ],\r\n                \"name\": \"ambassador-listener-8080\"\r\n            }\r\n        ]\r\n    }\r\n}\r\n```\r\n\r\n*Logs*:\r\n```\r\n[2019-08-23 14:04:48.715][198][trace][connection] [source/common/network/connection_impl.cc:394] [C1136] writing 178 bytes, end_stream false\r\n[2019-08-23 14:04:48.715][195][debug][client] [source/common/http/codec_client.cc:82] [C885] disconnect. resetting 0 pending requests\r\n[2019-08-23 14:04:48.715][195][debug][pool] [source/common/http/http1/conn_pool.cc:130] [C885] client disconnected, failure reason: \r\n[2019-08-23 14:04:48.715][195][trace][main] [source/common/event/dispatcher_impl.cc:158] item added to deferred deletion list (size=9)\r\n[2019-08-23 14:04:48.715][195][debug][connection] [source/common/network/connection_impl.cc:101] [C272] closing data_to_write=0 type=1\r\n[2019-08-23 14:04:48.715][195][debug][connection] [source/common/network/connection_impl.cc:190] [C272] closing socket: 1\r\n[2019-08-23 14:04:48.715][195][debug][client] [source/common/http/codec_client.cc:82] [C272] disconnect. resetting 0 pending requests\r\n[2019-08-23 14:04:48.715][195][debug][pool] [source/common/http/http1/conn_pool.cc:130] [C272] client disconnected, failure reason: \r\n[2019-08-23 14:04:48.715][195][trace][main] [source/common/event/dispatcher_impl.cc:158] item added to deferred deletion list (size=10)\r\n[2019-08-23 14:04:48.715][195][debug][connection] [source/common/network/connection_impl.cc:101] [C274] closing data_to_write=0 type=1\r\n[2019-08-23 14:04:48.715][195][debug][connection] [source/common/network/connection_impl.cc:190] [C274] closing socket: 1\r\n[2019-08-23 14:04:48.715][195][debug][client] [source/common/http/codec_client.cc:82] [C274] disconnect. resetting 0 pending requests\r\n[2019-08-23 14:04:48.715][195][debug][pool] [source/common/http/http1/conn_pool.cc:130] [C274] client disconnected, failure reason: \r\n[2019-08-23 14:04:48.715][195][trace][main] [source/common/event/dispatcher_impl.cc:158] item added to deferred deletion list (size=11)\r\n[2019-08-23 14:04:48.715][195][debug][connection] [source/common/network/connection_impl.cc:101] [C863] closing data_to_write=0 type=1\r\n[2019-08-23 14:04:48.715][195][debug][connection] [source/common/network/connection_impl.cc:190] [C863] closing socket: 1\r\n[2019-08-23 14:04:48.715][195][debug][client] [source/common/http/codec_client.cc:82] [C863] disconnect. resetting 0 pending requests\r\n[2019-08-23 14:04:48.715][195][debug][pool] [source/common/http/http1/conn_pool.cc:130] [C863] client disconnected, failure reason: \r\n[2019-08-23 14:04:48.715][195][trace][main] [source/common/event/dispatcher_impl.cc:158] item added to deferred deletion list (size=12)\r\n[2019-08-23 14:04:48.715][195][trace][main] [source/common/event/dispatcher_impl.cc:158] item added to deferred deletion list (size=13)\r\n[2019-08-23 14:04:48.715][195][trace][main] [source/common/event/dispatcher_impl.cc:76] clearing deferred deletion list (size=13)\r\n[2019-08-23 14:04:48.715][195][trace][connection] [source/common/network/connection_impl.cc:458] [C1134] socket event: 3\r\n[2019-08-23 14:04:48.715][195][trace][connection] [source/common/network/connection_impl.cc:543] [C1134] write ready\r\n[2019-08-23 14:04:48.715][195][trace][connection] [source/common/network/connection_impl.cc:496] [C1134] read ready\r\n[2019-08-23 14:04:48.715][195][trace][connection] [source/common/network/raw_buffer_socket.cc:23] [C1134] read returns: 284\r\n[2019-08-23 14:04:48.715][195][trace][connection] [source/common/network/raw_buffer_socket.cc:37] [C1134] read error: Resource temporarily unavailable\r\n[2019-08-23 14:04:48.715][195][trace][http] [source/common/http/http1/codec_impl.cc:375] [C1134] parsing 284 bytes\r\n[2019-08-23 14:04:48.715][195][trace][http] [source/common/http/http1/codec_impl.cc:498] [C1134] message begin\r\n[2019-08-23 14:04:48.715][195][trace][http] [source/common/http/http1/codec_impl.cc:343] [C1134] completed header: key=Content-Type value=application/json\r\n[2019-08-23 14:04:48.715][198][trace][http] [source/common/http/conn_manager_impl.cc:1569] [C1136][S2563810555345383804] encode data called: filter=0x2dae0a0 status=0\r\n[2019-08-23 14:04:48.715][191][debug][connection] [source/common/network/connection_impl.cc:101] [C1143] closing data_to_write=326 type=2\r\n[2019-08-23 14:04:48.715][191][debug][connection] [source/common/network/connection_impl.cc:653] [C1143] setting delayed close timer with timeout 1000 ms\r\n[2019-08-23 14:04:48.715][198][trace][http] [source/common/http/conn_manager_impl.cc:1582] [C1136][S2563810555345383804] encoding data via codec (size=144 end_stream=false)\r\n[2019-08-23 14:04:48.715][195][trace][http] [source/common/http/http1/codec_impl.cc:343] [C1134] completed header: key=Date value=Fri, 23 Aug 2019 14:04:48 GMT\r\n[2019-08-23 14:04:48.715][194][trace][connection] [source/common/network/raw_buffer_socket.cc:66] [C1144] write returns: 351\r\n[2019-08-23 14:04:48.715][194][debug][connection] [source/common/network/connection_impl.cc:582] [C1144] write flush complete\r\n[2019-08-23 14:04:48.715][194][trace][connection] [source/common/network/connection_impl.cc:458] [C1144] socket event: 6\r\n[2019-08-23 14:04:48.715][194][debug][connection] [source/common/network/connection_impl.cc:479] [C1144] remote early close\r\n[2019-08-23 14:04:48.716][194][debug][connection] [source/common/network/connection_impl.cc:190] [C1144] closing socket: 0\r\n[2019-08-23 14:04:48.716][194][debug][main] [source/server/connection_handler_impl.cc:80] [C1144] adding to cleanup list\r\n[2019-08-23 14:04:48.716][194][trace][main] [source/common/event/dispatcher_impl.cc:158] item added to deferred deletion list (size=1)\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:458] [C379] socket event: 3\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:543] [C379] write ready\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:496] [C379] read ready\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/raw_buffer_socket.cc:23] [C379] read returns: 285\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/raw_buffer_socket.cc:37] [C379] read error: Resource temporarily unavailable\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:375] [C379] parsing 285 bytes\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:498] [C379] message begin\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:343] [C379] completed header: key=Content-Type value=application/json\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:343] [C379] completed header: key=Date value=Fri, 23 Aug 2019 14:04:48 GMT\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:464] [C379] headers complete\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:343] [C379] completed header: key=Content-Length value=176\r\n[2019-08-23 14:04:48.716][194][debug][router] [source/common/router/router.cc:1002] [C1145][S1885932356023518673] upstream headers complete: end_stream=false\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/conn_manager_impl.cc:1329] [C1145][S1885932356023518673] encode headers called: filter=0x2c66e10 status=0\r\n[2019-08-23 14:04:48.716][194][debug][http] [source/common/http/conn_manager_impl.cc:1373] [C1145][S1885932356023518673] closing connection due to connection close header\r\n[2019-08-23 14:04:48.716][194][debug][http] [source/common/http/conn_manager_impl.cc:1435] [C1145][S1885932356023518673] encoding headers via codec (end_stream=false):\r\n':status', '200'\r\n'content-type', 'application/json'\r\n'date', 'Fri, 23 Aug 2019 14:04:48 GMT'\r\n'content-length', '176'\r\n'x-envoy-upstream-service-time', '1'\r\n'server', 'envoy'\r\n'connection', 'close'\r\n\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:394] [C1145] writing 177 bytes, end_stream false\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/conn_manager_impl.cc:1569] [C1145][S1885932356023518673] encode data called: filter=0x2c66e10 status=0\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/conn_manager_impl.cc:1582] [C1145][S1885932356023518673] encoding data via codec (size=176 end_stream=false)\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:394] [C1145] writing 176 bytes, end_stream false\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:485] [C379] message complete\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:760] [C379] message complete\r\n[2019-08-23 14:04:48.716][194][debug][client] [source/common/http/codec_client.cc:95] [C379] response complete\r\n[2019-08-23 14:04:48.716][194][trace][main] [source/common/event/dispatcher_impl.cc:158] item added to deferred deletion list (size=2)\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/conn_manager_impl.cc:1569] [C1145][S1885932356023518673] encode data called: filter=0x2c66e10 status=0\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/conn_manager_impl.cc:1582] [C1145][S1885932356023518673] encoding data via codec (size=0 end_stream=true)\r\n[2019-08-23 14:04:48.716][194][trace][main] [source/common/event/dispatcher_impl.cc:158] item added to deferred deletion list (size=3)\r\n[2019-08-23 14:04:48.716][194][debug][connection] [source/common/network/connection_impl.cc:101] [C1145] closing data_to_write=353 type=2\r\n[2019-08-23 14:04:48.716][194][debug][connection] [source/common/network/connection_impl.cc:653] [C1145] setting delayed close timer with timeout 1000 ms\r\n[2019-08-23 14:04:48.716][194][debug][pool] [source/common/http/http1/conn_pool.cc:199] [C379] response complete\r\n[2019-08-23 14:04:48.716][194][debug][pool] [source/common/http/http1/conn_pool.cc:237] [C379] moving to ready\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:396] [C379] parsed 285 bytes\r\n[2019-08-23 14:04:48.716][194][trace][main] [source/common/event/dispatcher_impl.cc:76] clearing deferred deletion list (size=3)\r\n[2019-08-23 14:04:48.716][194][debug][main] [source/server/connection_handler_impl.cc:287] [C1164] new connection\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:458] [C1145] socket event: 2\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:543] [C1145] write ready\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/raw_buffer_socket.cc:66] [C1145] write returns: 353\r\n[2019-08-23 14:04:48.716][194][debug][connection] [source/common/network/connection_impl.cc:582] [C1145] write flush complete\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:458] [C1164] socket event: 3\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:543] [C1164] write ready\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/connection_impl.cc:496] [C1164] read ready\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/raw_buffer_socket.cc:23] [C1164] read returns: 238\r\n[2019-08-23 14:04:48.716][194][trace][connection] [source/common/network/raw_buffer_socket.cc:37] [C1164] read error: Resource temporarily unavailable\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:375] [C1164] parsing 238 bytes\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:498] [C1164] message begin\r\n[2019-08-23 14:04:48.716][194][debug][http] [source/common/http/conn_manager_impl.cc:247] [C1164] new stream\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:343] [C1164] completed header: key=Host value=192.168.39.204:30116\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:343] [C1164] completed header: key=Accept value=*/*\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:343] [C1164] completed header: key=Accept-Encoding value=gzip, deflate\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:343] [C1164] completed header: key=User-Agent value=Mozilla/5.0 (redhat-x86_64-linux-gnu) Siege/4.0.4\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:343] [C1164] completed header: key=Authorization value=Basic dXNlcm5hbWU6cGFzc3dvcmQ=\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:464] [C1164] headers complete\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:343] [C1164] completed header: key=Connection value=close\r\n[2019-08-23 14:04:48.716][194][trace][http] [source/common/http/http1/codec_impl.cc:485] [C1164] message complete\r\n[2019-08-23 14:04:48.716][194][debug][http] [source/common/http/conn_manager_impl.cc:620] [C1164][S697422797895800214] request headers complete (end_stream=true):\r\n':authority', '192.168.39.204:30116'\r\n':path', '/backend/get-quote/'\r\n':method', 'GET'\r\n'accept', '*/*'\r\n'accept-encoding', 'gzip, deflate'\r\n'user-agent', 'Mozilla/5.0 (redhat-x86_64-linux-gnu) Siege/4.0.4'\r\n'authorization', 'Basic dXNlcm5hbWU6cGFzc3dvcmQ='\r\n'connection', 'close'\r\n\r\n[2019-08-23 14:04:48.716][194][debug][http] [source/common/http/conn_manager_impl.cc:1167] [C1164][S697422797895800214] request end stream\r\n[2019-08-23 14:04:48.716][194][trace][filter] [source/extensions/filters/http/ext_authz/ext_authz.cc:83] [C1164][S697422797895800214] ext_authz filter calling authorization server\r\n[2019-08-23 14:04:48.716][194][critical][main] [source/exe/terminate_handler.cc:13] std::terminate called! (possible uncaught exception, see trace)\r\n[2019-08-23 14:04:48.716][194][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:69] Backtrace (use tools/stack_decode.py to get line numbers):\r\n[2019-08-23 14:04:48.716][194][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:75] #0: [0x12d45c8]\r\n[2019-08-23 14:04:48.716][194][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:75] #1: [0x12d44d9]\r\n[2019-08-23 14:04:48.716][194][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:75] #2: [0x14974c6]\r\n[2019-08-23 14:04:48.716][194][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:81] Caught Aborted, suspect faulting address 0x22b8000000b5\r\n[2019-08-23 14:04:48.716][194][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:69] Backtrace (use tools/stack_decode.py to get line numbers):\r\n[2019-08-23 14:04:48.716][194][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:75] #0: [0x7f60606d64b0]\r\n[2019-08-23 14:04:48.717][194][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:75] #1: [0x12d44d9]\r\n[2019-08-23 14:04:48.717][194][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:75] #2: [0x14974c6]\r\nActiveStream 0x2d62880, stream_id_: 697422797895800214, has_continue_headers_: 0, is_head_request_: 0, decoding_headers_only_: 0, encoding_headers_only_: 0\r\nrequest_headers_: \r\n  ':authority', '192.168.39.204:30116'\r\n  ':path', '/backend/get-quote/'\r\n  ':method', 'GET'\r\n  'accept', '*/*'\r\n  'accept-encoding', 'pt-encoding4:04:48.717][181][debug][config] [source/extensions/filters/network/http_connection_manager/config.cc:351]       name: envoy.ext_authz\r\n', 'gzip, deflate'\r\n  'user-agent', 'Mozilla/5.0 (redhat-x86_64-linux-gnu) Siege/4.0.4'\r\n  'authorization', 'Basic dXNlcm5hbWU6cGFzc3dvcmQ='\r\n  'x-forwarded-for', '192.168.39.1'\r\n  'x-forwarded-proto', 'http'\r\n  'x-envoy-internal', 'true'\r\n  'x-request-id', 'd984b0dc-92d6-4e5f-a00e-bcfe3f885f00'\r\nrequest_trailers_: null\r\nresponse_headers_: null\r\nresponse_trailers_: null\r\n&stream_info_: \r\n  StreamInfoImpl 0x2d629b8, protocol_: 1, response_code_: null, response_code_details_: null, health_check_request_: 0, route_name_: \r\n./entrypoint.sh: line 22: warning: run_pending_traps: bad value in trap_list[17]: 0x55f053dd8dd3\r\n./entrypoint.sh: line 19: warning: run_pending_traps: bad value in trap_list[17]: 0x55f053dd8dd3\r\n2019-08-23 14:04:48 AMBASSADOR INFO envoy exited with status 134\r\n./entrypoint.sh: line 19: warning: run_pending_traps: bad value in trap_list[17]: 0x55f053dd8dd3\r\n2019-08-23 14:04:48 AMBASSADOR INFO killing extant processes\r\nkill: can't kill pid 181: No such process\r\n./entrypoint.sh: line 192: warning: run_pending_traps: bad value in trap_list[17]: 0x55f053dd8dd3\r\n[2019-08-23 14:04:48 +0000] [125] [INFO] Handling signal: term\r\ntime=\"2019-08-23T14:04:48Z\" level=info msg=Done\r\n./entrypoint.sh: line 19: warning: run_pending_traps: bad value in trap_list[17]: 0x55f053dd8dd3\r\n2019-08-23 14:04:48 AMBASSADOR INFO shutting down (1)\r\n```",
  "closed_at": "2019-09-10T00:15:29Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/8025/comments",
  "created_at": "2019-08-23T15:01:36Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/8025/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/8025",
  "id": 484576314,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/8025/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0ODQ1NzYzMTQ=",
  "number": 8025,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Envoy crashes when ext_authz is reconfigured while under load",
  "updated_at": "2019-09-10T00:15:29Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/8025",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/28152786?v=4",
    "events_url": "https://api.github.com/users/nbkrause/events{/privacy}",
    "followers_url": "https://api.github.com/users/nbkrause/followers",
    "following_url": "https://api.github.com/users/nbkrause/following{/other_user}",
    "gists_url": "https://api.github.com/users/nbkrause/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/nbkrause",
    "id": 28152786,
    "login": "nbkrause",
    "node_id": "MDQ6VXNlcjI4MTUyNzg2",
    "organizations_url": "https://api.github.com/users/nbkrause/orgs",
    "received_events_url": "https://api.github.com/users/nbkrause/received_events",
    "repos_url": "https://api.github.com/users/nbkrause/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/nbkrause/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nbkrause/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/nbkrause"
  }
}