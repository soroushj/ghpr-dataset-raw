{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/587468?v=4",
    "events_url": "https://api.github.com/users/gsagula/events{/privacy}",
    "followers_url": "https://api.github.com/users/gsagula/followers",
    "following_url": "https://api.github.com/users/gsagula/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsagula/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/gsagula",
    "id": 587468,
    "login": "gsagula",
    "node_id": "MDQ6VXNlcjU4NzQ2OA==",
    "organizations_url": "https://api.github.com/users/gsagula/orgs",
    "received_events_url": "https://api.github.com/users/gsagula/received_events",
    "repos_url": "https://api.github.com/users/gsagula/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/gsagula/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsagula/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/gsagula"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/587468?v=4",
      "events_url": "https://api.github.com/users/gsagula/events{/privacy}",
      "followers_url": "https://api.github.com/users/gsagula/followers",
      "following_url": "https://api.github.com/users/gsagula/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsagula/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/gsagula",
      "id": 587468,
      "login": "gsagula",
      "node_id": "MDQ6VXNlcjU4NzQ2OA==",
      "organizations_url": "https://api.github.com/users/gsagula/orgs",
      "received_events_url": "https://api.github.com/users/gsagula/received_events",
      "repos_url": "https://api.github.com/users/gsagula/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/gsagula/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsagula/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/gsagula"
    }
  ],
  "author_association": "NONE",
  "body": "**Title**: GZip filter doesn't work on some http clients\r\n\r\n**Description**:\r\nUsing Gzip filter doens't work some http client (apache http client).\r\n\r\n**Repro steps**:\r\n\r\n1. Using curl , netcat and gunzip\r\n- Enable GZip Filter:\r\n\r\n```\r\nstatic_resources:\r\n  listeners:\r\n  - address: #http-address\r\n      socket_address:\r\n        address: 0.0.0.0\r\n        port_value: 80\r\n    filter_chains:\r\n    - filters:\r\n      - name: envoy.http_connection_manager\r\n        config:\r\n          codec_type: AUTO\r\n          stat_prefix: ingress_http\r\n          http_filters:\r\n          - name: envoy.gzip\r\n            config:\r\n              memory_level: 9\r\n              compression_level: BEST\r\n          - name: envoy.router\r\n          route_config:\r\n            virtual_hosts: #http-hosts\r\n            - name: local-test-server\r\n              domains:\r\n              - test-server.com\r\n              routes:\r\n              - match:\r\n                  prefix: \"\"\r\n                route:\r\n                  cluster: local-test-server\r\n  clusters:\r\n  - name: local-test-server\r\n    type: STRICT_DNS\r\n    connect_timeout:\r\n      seconds: 60\r\n      nanos: 0\r\n    lb_policy: ROUND_ROBIN\r\n    hosts:\r\n    - socket_address:\r\n        address: 127.0.0.1\r\n        port_value: 1234\r\nadmin:\r\n  access_log_path: /dev/null\r\n  address:\r\n    socket_address:\r\n      address: 0.0.0.0\r\n      port_value: 8001\r\n```\r\n\r\n- Run a netcat server -> ./test-server\r\n```\r\n#!/bin/bash\r\n\r\necho -n -e \"HTTP/1.1 200 OK\\r\\nContent-Type: text/plain; charset=UTF-8\\r\\nContent-Length: 64\\r\\n\\naaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\" | nc -l -p 1234\r\n```\r\n\r\n- Curl and try to decompress using gunzip:\r\n\r\n```\r\ncurl -XPOST http://127.0.0.1:80 -H 'Host: test-server.com' -H 'Accept-Encoding: gzip' | gunzip -\r\naaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\r\ngzip: stdin: unexpected end of file\r\n```\r\n\r\n```\r\ncurl -XGET http://127.0.0.1:80 -H 'Host: test-server.com' -H 'Accept-Encoding: gzip' | gunzip -\r\naaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\r\ngzip: stdin: unexpected end of file\r\n```\r\n\r\n2. Using apache http client:\r\n\r\n- Create a simple http client-server\r\n- Do Request to a server returning payload >30 bytes to trigger gzip compression\r\n- the http client raises exception\r\n\r\nStacktrace of the http-client:\r\n\r\n> com.xxx.cham.http.DefaultHttpClient [DEFAULT_HTTP_CLIENT] An error occurred when trying to perform HTTP request. Request: HttpRequest{uri='http://test-api.example.com', headers={}, params={}, method=POST, body='{\"example\":\"tetst\"}', contentType=JSON, options=HttpRequestOptions{proxy='null', requestTimeout=-1, ignoreSocketTimeout=false}}::java.io.EOFException: Unexpected end of ZLIB input stream \tat java.util.zip.InflaterInputStream.fill(InflaterInputStream.java:240) \tat java.util.zip.InflaterInputStream.read(InflaterInputStream.java:158) \tat java.util.zip.GZIPInputStream.read(GZIPInputStream.java:117) \tat org.apache.http.client.entity.LazyDecompressingInputStream.read(LazyDecompressingInputStream.java:70) \tat sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284) \tat sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326) \tat sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178) \tat java.io.InputStreamReader.read(InputStreamReader.java:184) \tat java.io.BufferedReader.fill(BufferedReader.java:161) \tat java.io.BufferedReader.readLine(BufferedReader.java:324) \tat java.io.BufferedReader.readLine(BufferedReader.java:389) \tat com.airy.cham.http.DefaultHttpClient$HttpSendRunnable.processHttpResponse(DefaultHttpClient.java:90) \tat com.airy.cham.http.DefaultHttpClient$HttpSendRunnable.doPostRequest(DefaultHttpClient.java:154) \tat com.airy.cham.http.DefaultHttpClient$HttpSendRunnable.run(DefaultHttpClient.java:187) \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) \tat java.util.concurrent.FutureTask.run(FutureTask.java:266) \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) \tat java.lang.Thread.run(Thread.java:748)\r\n> --\r\n\r\nThe GZIP filter's test cases also doesn't seem to include HTTP POST requests\r\n\r\n\r\n",
  "closed_at": "2018-04-20T15:41:57Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 5,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2909/comments",
  "created_at": "2018-03-27T14:44:39Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2909/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/2909",
  "id": 309001046,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2909/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-06-23T16:17:31Z",
    "closed_issues": 70,
    "created_at": "2018-03-05T22:43:00Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/6",
    "id": 3163642,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/6/labels",
    "node_id": "MDk6TWlsZXN0b25lMzE2MzY0Mg==",
    "number": 6,
    "open_issues": 0,
    "state": "closed",
    "title": "1.7.0",
    "updated_at": "2018-06-23T16:17:31Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/6"
  },
  "node_id": "MDU6SXNzdWUzMDkwMDEwNDY=",
  "number": 2909,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "GZip Filter doesn't work on some clients",
  "updated_at": "2018-04-20T15:41:57Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/2909",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/11147376?v=4",
    "events_url": "https://api.github.com/users/phanama/events{/privacy}",
    "followers_url": "https://api.github.com/users/phanama/followers",
    "following_url": "https://api.github.com/users/phanama/following{/other_user}",
    "gists_url": "https://api.github.com/users/phanama/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/phanama",
    "id": 11147376,
    "login": "phanama",
    "node_id": "MDQ6VXNlcjExMTQ3Mzc2",
    "organizations_url": "https://api.github.com/users/phanama/orgs",
    "received_events_url": "https://api.github.com/users/phanama/received_events",
    "repos_url": "https://api.github.com/users/phanama/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/phanama/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/phanama/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/phanama"
  }
}