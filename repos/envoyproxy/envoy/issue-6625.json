{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/4725921?v=4",
    "events_url": "https://api.github.com/users/lita/events{/privacy}",
    "followers_url": "https://api.github.com/users/lita/followers",
    "following_url": "https://api.github.com/users/lita/following{/other_user}",
    "gists_url": "https://api.github.com/users/lita/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/lita",
    "id": 4725921,
    "login": "lita",
    "node_id": "MDQ6VXNlcjQ3MjU5MjE=",
    "organizations_url": "https://api.github.com/users/lita/orgs",
    "received_events_url": "https://api.github.com/users/lita/received_events",
    "repos_url": "https://api.github.com/users/lita/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/lita/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lita/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/lita"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/4725921?v=4",
      "events_url": "https://api.github.com/users/lita/events{/privacy}",
      "followers_url": "https://api.github.com/users/lita/followers",
      "following_url": "https://api.github.com/users/lita/following{/other_user}",
      "gists_url": "https://api.github.com/users/lita/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/lita",
      "id": 4725921,
      "login": "lita",
      "node_id": "MDQ6VXNlcjQ3MjU5MjE=",
      "organizations_url": "https://api.github.com/users/lita/orgs",
      "received_events_url": "https://api.github.com/users/lita/received_events",
      "repos_url": "https://api.github.com/users/lita/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/lita/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lita/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/lita"
    }
  ],
  "author_association": "NONE",
  "body": "*Title*:  cluster membership race when streaming eds data and active health checking \r\n\r\n*Description*:\r\nNow that Lyft has rolled out streaming xDS data to all the envoys, we are seeing a race condition with service discovery.\r\n\r\nDuring shut down, the host fails health check and then deregisters with discovery. We are running into a problem where the downstream envoys get the updated EDS data first before it gets the failed health check. This causes cluster membership to go out of sync until a membership change happens (which could be a long time).\r\n\r\nThis was not a problem before, as the sidecar envoys were polling the discovery data every 30 seconds. But now that we moved to the [xDS protocal](https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md), we are seeing this race.\r\n\r\nThis is a bigger issue with Kubernetes services, as the k8s api server streams service discovery data very quickly (and sometimes infrequently) to our control plane, potentially entering into panic routing mode.\r\n\r\nAfter talking with Matt, the proposed solution is to not just reconcile host membership on when envoy recieves EDS data, but also when envoy recieves a failed health check from an upstream host.\r\n\r\nWould love to get consensus from the community, particulary @snowp, on the best path forward. We would like host membership to reconile very quickly if possible.",
  "closed_at": "2019-05-01T22:00:00Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6625/comments",
  "created_at": "2019-04-17T18:04:54Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6625/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/6625",
  "id": 434415281,
  "labels": [
    {
      "color": "84b6eb",
      "default": true,
      "description": "Feature requests. Not bugs or questions.",
      "id": 421403909,
      "name": "enhancement",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDk=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/enhancement"
    },
    {
      "color": "e2ce8a",
      "default": false,
      "description": "Disables stalebot from closing an issue",
      "id": 988830710,
      "name": "no stalebot",
      "node_id": "MDU6TGFiZWw5ODg4MzA3MTA=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/no%20stalebot"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6625/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-07-11T18:22:23Z",
    "closed_issues": 70,
    "created_at": "2019-03-01T23:01:48Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/10",
    "id": 4101146,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/10/labels",
    "node_id": "MDk6TWlsZXN0b25lNDEwMTE0Ng==",
    "number": 10,
    "open_issues": 0,
    "state": "closed",
    "title": "1.11.0",
    "updated_at": "2020-04-17T15:48:02Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/10"
  },
  "node_id": "MDU6SXNzdWU0MzQ0MTUyODE=",
  "number": 6625,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "cluster membership race when streaming eds data and active health checking ",
  "updated_at": "2019-05-01T22:00:00Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/6625",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/4725921?v=4",
    "events_url": "https://api.github.com/users/lita/events{/privacy}",
    "followers_url": "https://api.github.com/users/lita/followers",
    "following_url": "https://api.github.com/users/lita/following{/other_user}",
    "gists_url": "https://api.github.com/users/lita/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/lita",
    "id": 4725921,
    "login": "lita",
    "node_id": "MDQ6VXNlcjQ3MjU5MjE=",
    "organizations_url": "https://api.github.com/users/lita/orgs",
    "received_events_url": "https://api.github.com/users/lita/received_events",
    "repos_url": "https://api.github.com/users/lita/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/lita/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lita/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/lita"
  }
}