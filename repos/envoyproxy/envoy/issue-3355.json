{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/325621?v=4",
    "events_url": "https://api.github.com/users/yuval-k/events{/privacy}",
    "followers_url": "https://api.github.com/users/yuval-k/followers",
    "following_url": "https://api.github.com/users/yuval-k/following{/other_user}",
    "gists_url": "https://api.github.com/users/yuval-k/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/yuval-k",
    "id": 325621,
    "login": "yuval-k",
    "node_id": "MDQ6VXNlcjMyNTYyMQ==",
    "organizations_url": "https://api.github.com/users/yuval-k/orgs",
    "received_events_url": "https://api.github.com/users/yuval-k/received_events",
    "repos_url": "https://api.github.com/users/yuval-k/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/yuval-k/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yuval-k/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/yuval-k"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/325621?v=4",
      "events_url": "https://api.github.com/users/yuval-k/events{/privacy}",
      "followers_url": "https://api.github.com/users/yuval-k/followers",
      "following_url": "https://api.github.com/users/yuval-k/following{/other_user}",
      "gists_url": "https://api.github.com/users/yuval-k/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/yuval-k",
      "id": 325621,
      "login": "yuval-k",
      "node_id": "MDQ6VXNlcjMyNTYyMQ==",
      "organizations_url": "https://api.github.com/users/yuval-k/orgs",
      "received_events_url": "https://api.github.com/users/yuval-k/received_events",
      "repos_url": "https://api.github.com/users/yuval-k/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/yuval-k/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yuval-k/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/yuval-k"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "When running gloo's integration tests, we noticed an issues that seems to be ADS related. (i was able to reduce it to a consistently failing e2e test,  here https://github.com/solo-io/gloo/blob/per-role-config/test/local_e2e/eds.go#L119)\r\n\r\nIt seems that an ADS Request is ignored. I believe that this is the scenario that causes it:\r\n1. Cluster with EDS is added (envoy is synced with Cluster and ClusterLoadAssignment)\r\n2. Cluster with EDS is removed\r\n3. At this point:\r\n3.1 go-control-plane sends a DiscoverResponse with the new ClusterLoadAssignment that has an empty list. \r\n3.2 in Envoy (probably because the cluster is removed already) there are no watchers for this response and it is ignored.\r\n3.3 Envoy does *not* update the nonce to the nonce from the response.\r\n4. A new cluster with EDS is added\r\n5. go-control-plane updates envoy on the new cluster\r\n6. Envoy sends a ClusterLoadAssignment discovery request with the cluster name.\r\n7. request is *ignored* by go-control-plane as it thinks it is a stale nonce (as described here: https://github.com/envoyproxy/envoy/blob/master/api/XDS_PROTOCOL.md#resource-updates).\r\n8. Since there is no EDS response the cluster 'warm-up' is never finished and is not available. all requests to that cluster return 503.\r\n\r\nNote: I am not sure why, I only got this to reproduce when another non-eds cluster was added as well.\r\n\r\nTo fix this, I made the following patch, Where I update the nonce regardless if the resource list is empty:\r\nhttps://github.com/yuval-k/envoy/commit/340a2652c439087e0e40e931015d3f2cca5412a2\r\n(docker image is also available)\r\n\r\nBefore opening a PR and adding tests, I wanted to make sure with everyone that this is indeed the right solution. and maybe get some more insights about whats the best approach here.\r\n\r\nHappy to provide more information as needed, as I have a consistently reproducing test locally.",
  "closed_at": "2018-05-14T21:35:34Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/10914751?v=4",
    "events_url": "https://api.github.com/users/htuch/events{/privacy}",
    "followers_url": "https://api.github.com/users/htuch/followers",
    "following_url": "https://api.github.com/users/htuch/following{/other_user}",
    "gists_url": "https://api.github.com/users/htuch/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/htuch",
    "id": 10914751,
    "login": "htuch",
    "node_id": "MDQ6VXNlcjEwOTE0NzUx",
    "organizations_url": "https://api.github.com/users/htuch/orgs",
    "received_events_url": "https://api.github.com/users/htuch/received_events",
    "repos_url": "https://api.github.com/users/htuch/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/htuch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/htuch/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/htuch"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/3355/comments",
  "created_at": "2018-05-11T12:59:15Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/3355/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/3355",
  "id": 322287577,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/3355/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-06-23T16:17:31Z",
    "closed_issues": 70,
    "created_at": "2018-03-05T22:43:00Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/6",
    "id": 3163642,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/6/labels",
    "node_id": "MDk6TWlsZXN0b25lMzE2MzY0Mg==",
    "number": 6,
    "open_issues": 0,
    "state": "closed",
    "title": "1.7.0",
    "updated_at": "2018-06-23T16:17:31Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/6"
  },
  "node_id": "MDU6SXNzdWUzMjIyODc1Nzc=",
  "number": 3355,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "ads: nonce is ignored when empty response arrives, resulting in a 503 responses.",
  "updated_at": "2018-05-14T21:35:34Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/3355",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/325621?v=4",
    "events_url": "https://api.github.com/users/yuval-k/events{/privacy}",
    "followers_url": "https://api.github.com/users/yuval-k/followers",
    "following_url": "https://api.github.com/users/yuval-k/following{/other_user}",
    "gists_url": "https://api.github.com/users/yuval-k/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/yuval-k",
    "id": 325621,
    "login": "yuval-k",
    "node_id": "MDQ6VXNlcjMyNTYyMQ==",
    "organizations_url": "https://api.github.com/users/yuval-k/orgs",
    "received_events_url": "https://api.github.com/users/yuval-k/received_events",
    "repos_url": "https://api.github.com/users/yuval-k/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/yuval-k/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yuval-k/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/yuval-k"
  }
}