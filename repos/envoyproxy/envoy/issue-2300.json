{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "(cross-posting from [envoy-users](https://groups.google.com/forum/#!topic/envoy-users/lFCtyGZa3QU) for tracking an issue)\r\n\r\nWhat do you guys think about having more granular retry policy rather than just 5xx?\r\n\r\nThe motivation behind this post is that:\r\n1) we use nginx + uwsgi at $work.\r\n2) setting 5xx as default retry policy is not safe due to possible non-idempotent requests: did data arrive on the server? did server process them?\r\n3) however, in our setup, 502 errors are common: nginx failed to talk to uwsgi for whatever reason. Retry is safe, no data hit uwsgi. Same for 503 btw.\r\n\r\nBasically, what I'm trying to achieve is to provide safe default retry policy for my users which would be: \"connect-failure\" + 502 + 503.\r\n\r\nI see that envoy's code base has:\r\n```\r\nstatic bool isGatewayError(uint64_t code) { return code >= 502 && code < 505; }\r\n```\r\nwhich made me think about having retry policy: \"gateway_error\". This policy would cover my needs but as a downside includes 504 which is redundant.\r\n\r\nAlternatively, maybe explicitly enumerating HTTP response codes? retry_on=connect_failure,502,503",
  "closed_at": "2018-01-16T16:13:20Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 5,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2300/comments",
  "created_at": "2018-01-03T11:20:13Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2300/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/2300",
  "id": 285659340,
  "labels": [
    {
      "color": "bfdadc",
      "default": false,
      "description": "Good starter issues!",
      "id": 733818075,
      "name": "beginner",
      "node_id": "MDU6TGFiZWw3MzM4MTgwNzU=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/beginner"
    },
    {
      "color": "84b6eb",
      "default": true,
      "description": "Feature requests. Not bugs or questions.",
      "id": 421403909,
      "name": "enhancement",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDk=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/enhancement"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2300/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyODU2NTkzNDA=",
  "number": 2300,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "more granular 5xx retry policy",
  "updated_at": "2018-01-16T16:13:20Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/2300",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/4630547?v=4",
    "events_url": "https://api.github.com/users/ikruglov/events{/privacy}",
    "followers_url": "https://api.github.com/users/ikruglov/followers",
    "following_url": "https://api.github.com/users/ikruglov/following{/other_user}",
    "gists_url": "https://api.github.com/users/ikruglov/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ikruglov",
    "id": 4630547,
    "login": "ikruglov",
    "node_id": "MDQ6VXNlcjQ2MzA1NDc=",
    "organizations_url": "https://api.github.com/users/ikruglov/orgs",
    "received_events_url": "https://api.github.com/users/ikruglov/received_events",
    "repos_url": "https://api.github.com/users/ikruglov/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ikruglov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ikruglov/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ikruglov"
  }
}