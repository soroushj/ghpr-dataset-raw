{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "We use AWS load balancer in front of envoy, which is used as a sidecar. Envoy proxies all external traffic into our local application.\r\n\r\nWhen the application comes up for the first time, envoy waits 60 seconds between healthcheck attempts because of NO_TRAFFIC_INTERVAL constant, which is used in case there's no external traffic into the cluster. \r\n\r\nHowever, there can be no external traffic at this point, as for it to come, the healthcheck needs to become healthy at least once.\r\n\r\nWhat can we optimize to workaround this? Ideally, we'd like to be able to tune the NO_TRAFFIC_INTERVAL timeout ourselves to disable this behavior.\r\n\r\nHere's the config we use, note the ```envoy.health_check``` http_filter that is the endpoint that is served to AWS load balancer.\r\n\r\n```static_resources:\r\n  clusters:\r\n    name: local_tomcat\r\n    connect_timeout: 0.1s\r\n    health_checks:\r\n    - healthy_threshold: 2\r\n      http_health_check:\r\n        path: \"/app/status\"\r\n      interval: 5s\r\n      timeout: 5s\r\n      unhealthy_threshold: 3\r\n    hosts:\r\n    - socket_address:\r\n        address: 127.0.0.1\r\n        port_value: 8080\r\n    lb_policy: LEAST_REQUEST\r\n    type: STATIC\r\n  listeners:\r\n  - address:\r\n      socket_address:\r\n        address: 0.0.0.0\r\n        port_value: 9443\r\n    filter_chains:\r\n    - filters:\r\n      - name: envoy.http_connection_manager\r\n        config:\r\n          http_filters:\r\n            - name: envoy.health_check\r\n              config:\r\n                cluster_min_healthy_percentages:\r\n                  local_tomcat:\r\n                    value: 100\r\n                endpoint: \"/healthz\"\r\n                pass_through_mode: false\r\n            - name: envoy.router\r\n          route_config:\r\n            name: localhost_proxy\r\n            virtual_hosts:\r\n            - domains: \"*\"\r\n              name: localhost_proxy\r\n              routes:\r\n              - match:\r\n                  prefix: \"/\"\r\n                route:\r\n                  cluster: local_tomcat\r\n                  timeout: 60s\r\n        \r\n      tls_context: {...}\r\n    name: localhost_proxy\r\n```",
  "closed_at": "2018-03-16T03:41:11Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/10914751?v=4",
    "events_url": "https://api.github.com/users/htuch/events{/privacy}",
    "followers_url": "https://api.github.com/users/htuch/followers",
    "following_url": "https://api.github.com/users/htuch/following{/other_user}",
    "gists_url": "https://api.github.com/users/htuch/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/htuch",
    "id": 10914751,
    "login": "htuch",
    "node_id": "MDQ6VXNlcjEwOTE0NzUx",
    "organizations_url": "https://api.github.com/users/htuch/orgs",
    "received_events_url": "https://api.github.com/users/htuch/received_events",
    "repos_url": "https://api.github.com/users/htuch/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/htuch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/htuch/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/htuch"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2782/comments",
  "created_at": "2018-03-13T05:20:12Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2782/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/2782",
  "id": 304631698,
  "labels": [
    {
      "color": "84b6eb",
      "default": true,
      "description": "Feature requests. Not bugs or questions.",
      "id": 421403909,
      "name": "enhancement",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDk=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/enhancement"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2782/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMDQ2MzE2OTg=",
  "number": 2782,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "NO_TRAFFIC_INTERVAL constant causes deployments to needlessly take at least a minute",
  "updated_at": "2018-03-16T03:41:11Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/2782",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/221386?v=4",
    "events_url": "https://api.github.com/users/ikatson/events{/privacy}",
    "followers_url": "https://api.github.com/users/ikatson/followers",
    "following_url": "https://api.github.com/users/ikatson/following{/other_user}",
    "gists_url": "https://api.github.com/users/ikatson/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ikatson",
    "id": 221386,
    "login": "ikatson",
    "node_id": "MDQ6VXNlcjIyMTM4Ng==",
    "organizations_url": "https://api.github.com/users/ikatson/orgs",
    "received_events_url": "https://api.github.com/users/ikatson/received_events",
    "repos_url": "https://api.github.com/users/ikatson/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ikatson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ikatson/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ikatson"
  }
}