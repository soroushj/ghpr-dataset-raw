{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "Hi.\r\n\r\nTrying to remove duplicated slashes from URL, so enabled _merge_slashes_ option in http_connection_manager config. Duplicated slashes become single now, but now I'm getting trailing slash moved from the end of the URL path to the end of the query string, which is very unexpected.\r\n\r\nFor example:\r\nhttp://example.com//test/?somequery_string becomes http://example.com/test?somequery_string/\r\n\r\nHowever these requests are processing as expected:\r\nhttp://example.com/test/?somequery_string  -> http://example.com/test/?somequery_string\r\nhttp://example.com//test/foo  -> http://example.com/test/foo\r\n\r\nWhen merge_slashes is disabled, everything is kinda as expected too:\r\nhttp://example.com//test/?somequery_string -> http://example.com//test?somequery_string\r\n\r\nDidn't find any related issue, looks like a bug?\r\n\r\nTried on envoy 1.12.2, 1.13.0, 1.14.1\r\nnormalize_path option is off\r\n\r\nEnvoy config:\r\n```\r\n  - name: listener_0\r\n    address:\r\n      socket_address: { address: 0.0.0.0, port_value: 80 }\r\n    filter_chains:\r\n    - filters:\r\n      - name: envoy.http_connection_manager\r\n        config:\r\n          stat_prefix: ingress_http\r\n          codec_type: AUTO\r\n          common_http_protocol_options:\r\n            idle_timeout: 300s\r\n          use_remote_address: yes\r\n          xff_num_trusted_hops: 1\r\n          merge_slashes: yes\r\n          access_log:\r\n            - name: envoy.file_access_log\r\n              config:\r\n                path: /dev/stdout\r\n          route_config:\r\n            name: local_route\r\n            virtual_hosts:\r\n            - name: example_vhost\r\n              domains: [\"example.com\"]\r\n              routes:\r\n              - match: { prefix: \"/\" }\r\n                direct_response:\r\n                    status: \"200\"\r\n```",
  "closed_at": "2020-04-24T21:43:11Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/10912/comments",
  "created_at": "2020-04-23T04:13:01Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/10912/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/10912",
  "id": 605224480,
  "labels": [
    {
      "color": "d4c5f9",
      "default": false,
      "description": "",
      "id": 1715341036,
      "name": "area/http",
      "node_id": "MDU6TGFiZWwxNzE1MzQxMDM2",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/area/http"
    },
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/10912/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MDUyMjQ0ODA=",
  "number": 10912,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "merge_slashes option moves trailing slash from path to end of the the query string",
  "updated_at": "2020-04-24T21:43:11Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/10912",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/25861721?v=4",
    "events_url": "https://api.github.com/users/feature-id/events{/privacy}",
    "followers_url": "https://api.github.com/users/feature-id/followers",
    "following_url": "https://api.github.com/users/feature-id/following{/other_user}",
    "gists_url": "https://api.github.com/users/feature-id/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/feature-id",
    "id": 25861721,
    "login": "feature-id",
    "node_id": "MDQ6VXNlcjI1ODYxNzIx",
    "organizations_url": "https://api.github.com/users/feature-id/orgs",
    "received_events_url": "https://api.github.com/users/feature-id/received_events",
    "repos_url": "https://api.github.com/users/feature-id/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/feature-id/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/feature-id/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/feature-id"
  }
}