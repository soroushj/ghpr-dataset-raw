{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1016047?v=4",
    "events_url": "https://api.github.com/users/lizan/events{/privacy}",
    "followers_url": "https://api.github.com/users/lizan/followers",
    "following_url": "https://api.github.com/users/lizan/following{/other_user}",
    "gists_url": "https://api.github.com/users/lizan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/lizan",
    "id": 1016047,
    "login": "lizan",
    "node_id": "MDQ6VXNlcjEwMTYwNDc=",
    "organizations_url": "https://api.github.com/users/lizan/orgs",
    "received_events_url": "https://api.github.com/users/lizan/received_events",
    "repos_url": "https://api.github.com/users/lizan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/lizan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lizan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/lizan"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/1016047?v=4",
      "events_url": "https://api.github.com/users/lizan/events{/privacy}",
      "followers_url": "https://api.github.com/users/lizan/followers",
      "following_url": "https://api.github.com/users/lizan/following{/other_user}",
      "gists_url": "https://api.github.com/users/lizan/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/lizan",
      "id": 1016047,
      "login": "lizan",
      "node_id": "MDQ6VXNlcjEwMTYwNDc=",
      "organizations_url": "https://api.github.com/users/lizan/orgs",
      "received_events_url": "https://api.github.com/users/lizan/received_events",
      "repos_url": "https://api.github.com/users/lizan/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/lizan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lizan/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/lizan"
    }
  ],
  "author_association": "NONE",
  "body": "**Issue Template**\r\n\r\n*Title*: *Return appropriate HTTP error code when using gRPC-JSON Transcoder*\r\n\r\n*Description*:\r\n\r\nI have a .proto\r\n```\r\nsyntax = \"proto3\";\r\n\r\npackage helloworld;\r\n\r\nimport \"annotations.proto\";\r\n\r\n// The greeting service definition.\r\nservice Greeter {\r\n  // Sends a greeting\r\n  rpc SayHello (HelloRequest) returns (HelloReply) {\r\n    option (google.api.http) = {\r\n      post: \"/api/v1/hello\"\r\n      body: \"*\"\r\n    };\r\n  }\r\n}\r\n\r\n// The request message containing the user's name.\r\nmessage HelloRequest {\r\n  string name = 1;\r\n}\r\n\r\n// The response message containing the greetings\r\nmessage HelloReply {\r\n  string message = 1;\r\n}\r\n```\r\n\r\nAnd a Node.js server\r\n```\r\nvar PROTO_PATH = './hello.proto';\r\n\r\nvar grpc = require('grpc');\r\nvar hello_proto = grpc.load(PROTO_PATH).helloworld;\r\n\r\nfunction sayHello(call, callback) {\r\n    if (call.request.name === \"Error\") {\r\n        var err = new Error('PermissionDenied');\r\n        err.code = grpc.status.PERMISSION_DENIED;\r\n        return callback(err)\r\n    }\r\n    \r\n    return callback(null, {message: 'Hello ' + call.request.name});\r\n}\r\n\r\nfunction main() {\r\n    var server = new grpc.Server();\r\n    server.addService(hello_proto.Greeter.service, {sayHello: sayHello});\r\n    server.bind('0.0.0.0:50051', grpc.ServerCredentials.createInsecure());\r\n    server.start();\r\n}\r\n\r\nmain();\r\n```\r\n\r\nThen I run Envoy with following config\r\n```\r\n{\r\n    \"listeners\": [{\r\n        \"address\": \"tcp://0.0.0.0:80\",\r\n        \"filters\": [{\r\n            \"type\": \"read\",\r\n            \"name\": \"http_connection_manager\",\r\n            \"config\": {\r\n                \"server_name\": \"nextapi\",\r\n                \"codec_type\": \"auto\",\r\n                \"stat_prefix\": \"ingress_http\",\r\n                \"use_remote_address\": true,\r\n                \"access_log\": [{\"path\": \"/tmp/envoy.access.log\"}],\r\n                \"route_config\": {\r\n                    \"virtual_hosts\": [{\r\n                        \"name\": \"grpc_service\",\r\n                        \"domains\": [\"*\"],\r\n                        \"routes\": [{\r\n                            \"prefix\": \"/\",\r\n                            \"cluster\": \"grpc1\"\r\n                        }]\r\n                    }]\r\n                },\r\n                \"filters\": [\r\n                    {\r\n                        \"type\": \"both\",\r\n                        \"name\": \"grpc_json_transcoder\",\r\n                        \"config\": {\r\n                            \"proto_descriptor\": \"/etc/hello.pb\",\r\n                            \"services\": [\"helloworld.Greeter\"],\r\n                            \"print_options\": {\r\n                                \"add_whitespace\": false,\r\n                                \"always_print_primitive_fields\": false,\r\n                                \"always_print_enums_as_ints\": false,\r\n                                \"preserve_proto_field_names\": false\r\n                            }\r\n                        }\r\n                    },    \r\n                    {\r\n                        \"type\": \"decoder\",\r\n                        \"name\": \"router\",\r\n                        \"config\": {}\r\n                    }\r\n                ]\r\n            }\r\n        }]\r\n    }],\r\n    \"admin\": {\r\n        \"access_log_path\": \"/tmp/admin_access.log\",\r\n        \"address\": \"tcp://0.0.0.0:9901\"\r\n    },\r\n    \"cluster_manager\": {\r\n        \"clusters\": [{\r\n            \"name\": \"grpc1\",\r\n            \"connect_timeout_ms\": 250,\r\n            \"type\": \"static\",\r\n            \"lb_type\": \"random\",\r\n            \"features\": \"http2\",\r\n            \"hosts\": [\r\n                {\"url\": \"tcp://192.168.99.100:50051\"} \r\n            ]\r\n        }]\r\n    }\r\n}\r\n```\r\n\r\nTest with curl\r\n```\r\ncurl -X POST http://192.168.99.100/api/v1/hello -d '{\"name\":\"Jim\"}' -v\r\n*   Trying 192.168.99.100...\r\n* Connected to 192.168.99.100 (192.168.99.100) port 80 (#0)\r\n> POST /api/v1/hello HTTP/1.1\r\n> Host: 192.168.99.100\r\n> User-Agent: curl/7.43.0\r\n> Accept: */*\r\n> Content-Length: 14\r\n> Content-Type: application/x-www-form-urlencoded\r\n> \r\n* upload completely sent off: 14 out of 14 bytes\r\n< HTTP/1.1 200 OK\r\n< content-type: application/json\r\n< grpc-accept-encoding: identity,deflate,gzip\r\n< accept-encoding: identity,gzip\r\n< x-envoy-upstream-service-time: 9\r\n< grpc-status: 0\r\n< grpc-message: OK\r\n< content-length: 23\r\n< date: Tue, 07 Nov 2017 15:12:54 GMT\r\n< server: envoy\r\n< \r\n* Connection #0 to host 192.168.99.100 left intact\r\n{\"message\":\"Hello Jim\"}\r\n```\r\n\r\nThen with error case `(\"name\":\"Error\")`\r\n```\r\ncurl -X POST http://192.168.99.100/api/v1/hello -d '{\"name\":\"Error\"}' -v\r\n*   Trying 192.168.99.100...\r\n* Connected to 192.168.99.100 (192.168.99.100) port 80 (#0)\r\n> POST /api/v1/hello HTTP/1.1\r\n> Host: 192.168.99.100\r\n> User-Agent: curl/7.43.0\r\n> Accept: */*\r\n> Content-Length: 16\r\n> Content-Type: application/x-www-form-urlencoded\r\n> \r\n* upload completely sent off: 16 out of 16 bytes\r\n< HTTP/1.1 200 OK\r\n< content-type: application/json\r\n< grpc-status: 7\r\n< grpc-message: PermissionDenied\r\n< x-envoy-upstream-service-time: 7\r\n< date: Tue, 07 Nov 2017 15:12:52 GMT\r\n< server: envoy\r\n< content-length: 0\r\n< \r\n* Connection #0 to host 192.168.99.100 left intact\r\n```\r\n\r\ngRPC server returning error with status code 7 (PERMISSION_DENIED) but HTTP status code is 200 (OK). I expect HTTP status code should be 403 (Forbidden). I refer to https://cloud.google.com/apis/design/errors#error_codes. \r\n\r\nDid I missed something in the config or currently it's not available in envoy? How error code in gRPC can be translated to appropriate HTTP error code with gRPC-JSON transcoder?\r\n\r\n\r\n\r\n\r\n\r\n",
  "closed_at": "2017-11-12T18:54:01Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2006/comments",
  "created_at": "2017-11-07T15:26:17Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2006/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/2006",
  "id": 271871619,
  "labels": [
    {
      "color": "84b6eb",
      "default": true,
      "description": "Feature requests. Not bugs or questions.",
      "id": 421403909,
      "name": "enhancement",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDk=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/enhancement"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2006/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNzE4NzE2MTk=",
  "number": 2006,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Return appropriate HTTP error code when using gRPC-JSON Transcoder",
  "updated_at": "2017-11-12T18:54:01Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/2006",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/631971?v=4",
    "events_url": "https://api.github.com/users/arifsetiawan/events{/privacy}",
    "followers_url": "https://api.github.com/users/arifsetiawan/followers",
    "following_url": "https://api.github.com/users/arifsetiawan/following{/other_user}",
    "gists_url": "https://api.github.com/users/arifsetiawan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/arifsetiawan",
    "id": 631971,
    "login": "arifsetiawan",
    "node_id": "MDQ6VXNlcjYzMTk3MQ==",
    "organizations_url": "https://api.github.com/users/arifsetiawan/orgs",
    "received_events_url": "https://api.github.com/users/arifsetiawan/received_events",
    "repos_url": "https://api.github.com/users/arifsetiawan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/arifsetiawan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/arifsetiawan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/arifsetiawan"
  }
}