{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "*Title*: REST ApiConfigSource without refresh_delay results in floating point exception\r\n\r\n*Description*:\r\nWith Envoy version 1.5.0, when configuring an LDS or CDS v2 REST discovery service in the bootstrap configuration, if the `refresh_delay` parameter is not specified, Envoy will crash and exit with a floating point exception.\r\n\r\nI haven't checked if this is also the case with EDS or RDS.\r\n\r\nThe expected behaviour would be for Envoy to reject the configuration with an explanation of what went wrong.\r\n\r\nAdding the `refresh_delay` field fixes the crash.\r\n\r\n*Repro steps*:\r\nRun the Docker image `envoyproxy/envoy:v1.5.0` with the below config. It doesn't matter whether the `xds_cluster` is accessible or not.\r\n\r\n*Admin and Stats Output*:\r\nEnvoy does not stay up long enough to collect this information.\r\n\r\n*Config*:\r\nThis is almost exactly the same config as [the dynamic example](https://www.envoyproxy.io/docs/envoy/v1.5.0/configuration/overview/v2_overview.html#dynamic) in the documentation but with the xDS API type set to `REST` instead of `GRPC`. I'm also using HTTP 1.1 instead of HTTP/2, but I don't think that should matter.\r\n```yaml\r\nadmin:\r\n  access_log_path: /tmp/admin_access.log\r\n  address:\r\n    socket_address: { address: 127.0.0.1, port_value: 9901 }\r\n\r\ndynamic_resources:\r\n  lds_config:\r\n    api_config_source:\r\n      api_type: REST\r\n      cluster_name: [xds_cluster]\r\n  cds_config:\r\n    api_config_source:\r\n      api_type: REST\r\n      cluster_name: [xds_cluster]\r\n\r\nstatic_resources:\r\n  clusters:\r\n  - name: xds_cluster\r\n    connect_timeout: 0.25s\r\n    type: STATIC\r\n    lb_policy: ROUND_ROBIN\r\n    http_protocol_options: {}\r\n    hosts: [{ socket_address: { address: 127.0.0.1, port_value: 5000 }}]\r\n```\r\n\r\n*Logs*:\r\nNote that the config update fails below. Whether the update succeeds or fails, the error that follows still seems to occur.\r\n```\r\n[2018-01-10 12:29:35.691][1][info][main] source/server/server.cc:158] initializing epoch 0 (hot restart version=9.200.16384.127)\r\n[2018-01-10 12:29:35.706][1][info][upstream] source/common/upstream/cluster_manager_impl.cc:127] cm init: initializing cds\r\n[2018-01-10 12:29:35.707][1][warning][config] bazel-out/local-opt/bin/source/common/config/_virtual_includes/http_subscription_lib/common/config/http_subscription_impl.h:98] REST config update failed: fetch failure\r\n[2018-01-10 12:29:35.707][1][info][upstream] source/common/upstream/cluster_manager_impl.cc:131] cm init: all clusters initialized\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:101] Caught Floating point exception, suspect faulting address 0x684a52\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:85] Backtrace obj<envoy> thr<0> (use tools/stack_decode.py):\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #0 0x684a52\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #1 0x694755\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #2 0x696546\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #3 0x72ab99\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #4 0x69717b\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #5 0x69be07\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #6 0x69ca26\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #7 0x694a82\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #8 0x694c30\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #9 0x695635\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #10 0x684c3b\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #11 0x55399f\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #12 0x54fecc\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #13 0x54853d\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #14 0x54da16\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #15 0x54e107\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #16 0x67b967\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #17 0x51b078\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #18 0x51c35b\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #19 0x451700\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #20 0x41405f\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:93] thr<0> obj</usr/glibc-compat/lib/libc.so.6>\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #21 0x7f03337ca06f\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:93] thr<0> obj<envoy>\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:95] thr<0> #22 0x448658\r\n[2018-01-10 12:29:35.707][1][critical][backtrace] bazel-out/local-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:97] end backtrace thread 0\r\n```\r\n\r\n\r\n*Call Stack*:\r\n```\r\n  #1 Envoy::Http::RestApiFetcher::requestComplete() at rest_api_fetcher.cc:65\r\n  #2 Envoy::Http::AsyncRequestImpl::onComplete() at async_client_impl.cc:195\r\n  #3 Envoy::Http::AsyncStreamImpl::encodeData(Envoy::Buffer::Instance&, bool) at async_client_impl.cc:100\r\n  #4 std::function<void (Envoy::Buffer::Instance&, bool)>::operator()(Envoy::Buffer::Instance&, bool) const at functional:2267\r\n  #5  (inlined by) Envoy::Http::Utility::sendLocalReply(std::function<void (std::unique_ptr<Envoy::Http::HeaderMap, std::default_delete<Envoy::Http::HeaderMap> >&&, bool)>, std::function<void (Envoy::Buffer::Instance&, bool)>, bool const&, Envoy::Http::Code, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) at utility.cc:243\r\n  #6 Envoy::Router::Filter::sendLocalReply(Envoy::Http::Code, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, bool) at router.cc:188\r\n  #7 Envoy::Router::Filter::sendNoHealthyUpstreamResponse() at router.cc:315\r\n  #8 Envoy::Router::Filter::decodeHeaders(Envoy::Http::HeaderMap&, bool) at router.cc:259\r\n  #9 Envoy::Http::AsyncStreamImpl::sendHeaders(Envoy::Http::HeaderMap&, bool) at async_client_impl.cc:123\r\n  #10 Envoy::Http::AsyncRequestImpl::initialize() at async_client_impl.cc:188\r\n  #11 Envoy::Http::AsyncClientImpl::send(std::unique_ptr<Envoy::Http::Message, std::default_delete<Envoy::Http::Message> >&&, Envoy::Http::AsyncClient::Callbacks&, Envoy::Optional<std::chrono::duration<long, std::ratio<1l, 1000l> > > const&) at async_client_impl.cc:45 (discriminator 3)\r\n  #12 Envoy::Http::RestApiFetcher::refresh() at rest_api_fetcher.cc:55\r\n  #13 Envoy::Config::HttpSubscriptionImpl<envoy::api::v2::Cluster>::start(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > const&, Envoy::Config::SubscriptionCallbacks<envoy::api::v2::Cluster>&) at http_subscription_impl.h:54\r\n  #14 Envoy::Upstream::CdsApiImpl::initialize() at cds_api_impl.h:31\r\n  #15 Envoy::Upstream::ClusterManagerInitHelper::maybeFinishInitialize() at cluster_manager_impl.cc:129\r\n  #16 Envoy::Upstream::ClusterManagerInitHelper::onStaticLoadComplete() at cluster_manager_impl.cc:142\r\n  #17  (inlined by) Envoy::Upstream::ClusterManagerImpl::ClusterManagerImpl(envoy::api::v2::Bootstrap const&, Envoy::Upstream::ClusterManagerFactory&, Envoy::Stats::Store&, Envoy::ThreadLocal::SlotAllocator&, Envoy::Runtime::Loader&, Envoy::Runtime::RandomGenerator&, Envoy::LocalInfo::LocalInfo const&, Envoy::AccessLog::AccessLogManager&, Envoy::Event::Dispatcher&) at cluster_manager_impl.cc:236\r\n  #18 Envoy::Upstream::ProdClusterManagerFactory::clusterManagerFromProto(envoy::api::v2::Bootstrap const&, Envoy::Stats::Store&, Envoy::ThreadLocal::Instance&, Envoy::Runtime::Loader&, Envoy::Runtime::RandomGenerator&, Envoy::LocalInfo::LocalInfo const&, Envoy::AccessLog::AccessLogManager&) at cluster_manager_impl.cc:708\r\n  #19 Envoy::Server::Configuration::MainImpl::initialize(envoy::api::v2::Bootstrap const&, Envoy::Server::Instance&, Envoy::Upstream::ClusterManagerFactory&) at configuration_impl.cc:40\r\n  #20 Envoy::Server::InstanceImpl::initialize(Envoy::Server::Options&, std::shared_ptr<Envoy::Network::Address::Instance const>, Envoy::Server::ComponentFactory&) at server.cc:244 (discriminator 1)\r\n  #21 Envoy::Server::InstanceImpl::InstanceImpl(Envoy::Server::Options&, std::shared_ptr<Envoy::Network::Address::Instance const>, Envoy::TestHooks&, Envoy::Server::HotRestart&, Envoy::Stats::StoreRoot&, Envoy::Thread::BasicLockable&, Envoy::Server::ComponentFactory&, Envoy::ThreadLocal::Instance&) at server.cc:69\r\n  #22 Envoy::main_common(Envoy::OptionsImpl&) at main_common.cc:87\r\n  #23 main at main.cc:47\r\n  #24\r\n  #25 ?? ??:0\r\n  #26\r\n  #27 _start at ??:?\r\n  #28\r\n```",
  "closed_at": "2018-01-19T13:44:23Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/10914751?v=4",
    "events_url": "https://api.github.com/users/htuch/events{/privacy}",
    "followers_url": "https://api.github.com/users/htuch/followers",
    "following_url": "https://api.github.com/users/htuch/following{/other_user}",
    "gists_url": "https://api.github.com/users/htuch/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/htuch",
    "id": 10914751,
    "login": "htuch",
    "node_id": "MDQ6VXNlcjEwOTE0NzUx",
    "organizations_url": "https://api.github.com/users/htuch/orgs",
    "received_events_url": "https://api.github.com/users/htuch/received_events",
    "repos_url": "https://api.github.com/users/htuch/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/htuch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/htuch/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/htuch"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2338/comments",
  "created_at": "2018-01-10T13:49:04Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2338/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/2338",
  "id": 287439380,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2338/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-03-20T20:42:42Z",
    "closed_issues": 58,
    "created_at": "2017-11-03T00:16:48Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/5",
    "id": 2884977,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/5/labels",
    "node_id": "MDk6TWlsZXN0b25lMjg4NDk3Nw==",
    "number": 5,
    "open_issues": 0,
    "state": "closed",
    "title": "1.6.0",
    "updated_at": "2018-03-20T20:42:42Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/5"
  },
  "node_id": "MDU6SXNzdWUyODc0MzkzODA=",
  "number": 2338,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "REST ApiConfigSource without refresh_delay results in floating point exception",
  "updated_at": "2018-05-04T17:15:05Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/2338",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1748643?v=4",
    "events_url": "https://api.github.com/users/JayH5/events{/privacy}",
    "followers_url": "https://api.github.com/users/JayH5/followers",
    "following_url": "https://api.github.com/users/JayH5/following{/other_user}",
    "gists_url": "https://api.github.com/users/JayH5/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/JayH5",
    "id": 1748643,
    "login": "JayH5",
    "node_id": "MDQ6VXNlcjE3NDg2NDM=",
    "organizations_url": "https://api.github.com/users/JayH5/orgs",
    "received_events_url": "https://api.github.com/users/JayH5/received_events",
    "repos_url": "https://api.github.com/users/JayH5/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/JayH5/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/JayH5/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/JayH5"
  }
}