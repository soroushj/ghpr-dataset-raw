{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1109246?v=4",
    "events_url": "https://api.github.com/users/tonya11en/events{/privacy}",
    "followers_url": "https://api.github.com/users/tonya11en/followers",
    "following_url": "https://api.github.com/users/tonya11en/following{/other_user}",
    "gists_url": "https://api.github.com/users/tonya11en/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tonya11en",
    "id": 1109246,
    "login": "tonya11en",
    "node_id": "MDQ6VXNlcjExMDkyNDY=",
    "organizations_url": "https://api.github.com/users/tonya11en/orgs",
    "received_events_url": "https://api.github.com/users/tonya11en/received_events",
    "repos_url": "https://api.github.com/users/tonya11en/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tonya11en/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tonya11en/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tonya11en"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/1109246?v=4",
      "events_url": "https://api.github.com/users/tonya11en/events{/privacy}",
      "followers_url": "https://api.github.com/users/tonya11en/followers",
      "following_url": "https://api.github.com/users/tonya11en/following{/other_user}",
      "gists_url": "https://api.github.com/users/tonya11en/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/tonya11en",
      "id": 1109246,
      "login": "tonya11en",
      "node_id": "MDQ6VXNlcjExMDkyNDY=",
      "organizations_url": "https://api.github.com/users/tonya11en/orgs",
      "received_events_url": "https://api.github.com/users/tonya11en/received_events",
      "repos_url": "https://api.github.com/users/tonya11en/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/tonya11en/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tonya11en/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/tonya11en"
    }
  ],
  "author_association": "MEMBER",
  "body": "Adaptive Concurrency Control HTTP Filter\r\n---------------------------------------------------------\r\n\r\n*TL; DR:\r\nL7 filter to dynamically update request concurrency values based on sampled request latencies.* \r\n\r\n### Motivation\r\nAt Lyft, we\u2019re using Envoy\u2019s circuit breaking system to defend our services from load caused by too many concurrent requests. The circuit breakers currently require service owners to manually set limits for each service/upstream cluster. While the feature is beneficial, the service owners are expected to understand the ideal concurrency limits of their services, configure them, and update the limits as their service evolves. This is not a problem if the concurrency values are always tuned properly, but the inevitable stale values have caused several incidents in production.\r\n\r\nThis work aims to remove the need for manual tuning of these circuit breaking parameters and keep latencies low by using techniques from [Netflix\u2019s concurrency limits Java library](https://github.com/Netflix/concurrency-limits).\r\n\r\n### Planned Patches\r\nThe filter will be committed in stages to make the review process easier. Here's an ordered list of what is currently planned:\r\n\r\n- [x] L7 filter with calls to a noop concurrency control framework.\r\n- [x] Implement concurrency control framework and unit tests.\r\n- [x] Make parameters runtime configurable.\r\n- [x] Integration tests.\r\n- [ ] Documentation.\r\n\r\nNice-to-haves:\r\n- [ ] Benchmark.\r\n\r\n### Preliminary Data\r\nTo test the various concurrency control algorithms, I used [bufferbloater](https://github.com/tonya11en/bufferbloater) (whose functionality will eventually be added to Nighthawk) and a proof-of-concept implementation in my [envoy-filter-example fork](https://github.com/tonya11en/envoy-filter-example/tree/acc_poc).\r\n\r\nIdentical tests were performed on a system with sane CB settings configured and adaptive concurrency configured. The client RPS to the server remained constant, but the server's response times varied every 30 seconds.\r\n\r\n#### Circuit breaker configured\r\n![realistic_cb_well_configured](https://user-images.githubusercontent.com/1109246/62255847-deccea80-b3b3-11e9-9700-b14a754c7743.png)\r\n\r\n#### Adaptive concurrency control configured\r\n![realistic_server_degrade](https://user-images.githubusercontent.com/1109246/62255856-e8eee900-b3b3-11e9-99db-9ffd26d5702f.png)\r\n\r\nSo far, the results seem promising. The proof-of-concept filter was able to replicate the circuit breaker behavior, but did so with latencies that were <= the CB test latencies. All while not requiring any manual concurrency configurations.",
  "closed_at": "2019-10-17T16:28:44Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 11,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/7789/comments",
  "created_at": "2019-07-31T23:59:11Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/7789/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/7789",
  "id": 475407606,
  "labels": [
    {
      "color": "84b6eb",
      "default": true,
      "description": "Feature requests. Not bugs or questions.",
      "id": 421403909,
      "name": "enhancement",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDk=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/enhancement"
    },
    {
      "color": "e2ce8a",
      "default": false,
      "description": "Disables stalebot from closing an issue",
      "id": 988830710,
      "name": "no stalebot",
      "node_id": "MDU6TGFiZWw5ODg4MzA3MTA=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/no%20stalebot"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/7789/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-11-03T23:59:23Z",
    "closed_issues": 73,
    "created_at": "2019-07-03T16:32:43Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/11",
    "id": 4463348,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/11/labels",
    "node_id": "MDk6TWlsZXN0b25lNDQ2MzM0OA==",
    "number": 11,
    "open_issues": 0,
    "state": "closed",
    "title": "1.12.0",
    "updated_at": "2019-11-09T17:21:27Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/11"
  },
  "node_id": "MDU6SXNzdWU0NzU0MDc2MDY=",
  "number": 7789,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Adaptive Concurrency Control L7 Filter",
  "updated_at": "2019-10-17T16:28:44Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/7789",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1109246?v=4",
    "events_url": "https://api.github.com/users/tonya11en/events{/privacy}",
    "followers_url": "https://api.github.com/users/tonya11en/followers",
    "following_url": "https://api.github.com/users/tonya11en/following{/other_user}",
    "gists_url": "https://api.github.com/users/tonya11en/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tonya11en",
    "id": 1109246,
    "login": "tonya11en",
    "node_id": "MDQ6VXNlcjExMDkyNDY=",
    "organizations_url": "https://api.github.com/users/tonya11en/orgs",
    "received_events_url": "https://api.github.com/users/tonya11en/received_events",
    "repos_url": "https://api.github.com/users/tonya11en/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tonya11en/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tonya11en/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tonya11en"
  }
}