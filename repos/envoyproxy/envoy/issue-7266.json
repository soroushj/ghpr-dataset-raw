{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1016047?v=4",
    "events_url": "https://api.github.com/users/lizan/events{/privacy}",
    "followers_url": "https://api.github.com/users/lizan/followers",
    "following_url": "https://api.github.com/users/lizan/following{/other_user}",
    "gists_url": "https://api.github.com/users/lizan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/lizan",
    "id": 1016047,
    "login": "lizan",
    "node_id": "MDQ6VXNlcjEwMTYwNDc=",
    "organizations_url": "https://api.github.com/users/lizan/orgs",
    "received_events_url": "https://api.github.com/users/lizan/received_events",
    "repos_url": "https://api.github.com/users/lizan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/lizan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lizan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/lizan"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/1016047?v=4",
      "events_url": "https://api.github.com/users/lizan/events{/privacy}",
      "followers_url": "https://api.github.com/users/lizan/followers",
      "following_url": "https://api.github.com/users/lizan/following{/other_user}",
      "gists_url": "https://api.github.com/users/lizan/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/lizan",
      "id": 1016047,
      "login": "lizan",
      "node_id": "MDQ6VXNlcjEwMTYwNDc=",
      "organizations_url": "https://api.github.com/users/lizan/orgs",
      "received_events_url": "https://api.github.com/users/lizan/received_events",
      "repos_url": "https://api.github.com/users/lizan/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/lizan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lizan/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/lizan"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "\r\n*Title*: BufferFragmentImpl destructor not called by GoogleGrpcUtils, which may result in memory leak\r\n\r\n*Description*:\r\nIn GoogleGrpcUtils::makeBufferInstance, a \"placement new\" is used to allocate several instances of Buffer::BufferFragmentImpl into a previously allocated memory block that contains all of those objects.  The BufferFragmentImpl's use a releasor function to indicate when they are done with the memory, which releasor function uses a reference counter.  When all BufferFragmentImpls are done with the memory, the memory is deallocated in a block.  This means that the BufferFragmentImpl's *constructor* is called (by the placement new) but the class instances *destructor* is never called.  \r\n\r\nIf BufferFragmentImpl was a POD (plane old data) class, this would be fine.  However, it includes a std::function<> element.  That element is constructed via copying on construction of the BufferFragmentImpl.  If any memory is allocated in std::function<>'s constructor, it will be leaked.  I'm seeing such a leak in one of the internal tests we run @ Google; the backtrace is provided below.  \r\n\r\nThis is obviously dependent on the details of and path taken in std::function<>'s constructor.  That may explain why it wasn't seen in any CircleCI tests, and only in one of the many tests run on import into Google.  I'll admit that those two points still confuse me (i.e. why this isn't a more obvious leak than it appears to be) but I'm fairly comfortable in the bug by code inspection, so I figured I'd file it and get any feedback people had.\r\n\r\nBufferFragmentImpl placement new construction: https://github.com/envoyproxy/envoy/blob/master/source/common/grpc/google_grpc_utils.cc#L100\r\n\r\nBufferFragmentImpl's containing memory block's free: https://github.com/envoyproxy/envoy/blob/master/source/common/grpc/google_grpc_utils.cc#L89\r\n\r\nBufferFragmentImpl's definition: https://github.com/envoyproxy/envoy/blob/master/source/common/buffer/buffer_impl.h#L422\r\n",
  "closed_at": "2019-06-24T23:05:55Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/10914751?v=4",
    "events_url": "https://api.github.com/users/htuch/events{/privacy}",
    "followers_url": "https://api.github.com/users/htuch/followers",
    "following_url": "https://api.github.com/users/htuch/following{/other_user}",
    "gists_url": "https://api.github.com/users/htuch/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/htuch",
    "id": 10914751,
    "login": "htuch",
    "node_id": "MDQ6VXNlcjEwOTE0NzUx",
    "organizations_url": "https://api.github.com/users/htuch/orgs",
    "received_events_url": "https://api.github.com/users/htuch/received_events",
    "repos_url": "https://api.github.com/users/htuch/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/htuch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/htuch/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/htuch"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/7266/comments",
  "created_at": "2019-06-13T22:05:54Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/7266/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/7266",
  "id": 455973169,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/7266/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NTU5NzMxNjk=",
  "number": 7266,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "BufferFragmentImpl destructor not called by GoogleGrpcUtils, which may result in memory leak",
  "updated_at": "2019-06-24T23:05:55Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/7266",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/252255?v=4",
    "events_url": "https://api.github.com/users/curiouserrandy/events{/privacy}",
    "followers_url": "https://api.github.com/users/curiouserrandy/followers",
    "following_url": "https://api.github.com/users/curiouserrandy/following{/other_user}",
    "gists_url": "https://api.github.com/users/curiouserrandy/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/curiouserrandy",
    "id": 252255,
    "login": "curiouserrandy",
    "node_id": "MDQ6VXNlcjI1MjI1NQ==",
    "organizations_url": "https://api.github.com/users/curiouserrandy/orgs",
    "received_events_url": "https://api.github.com/users/curiouserrandy/received_events",
    "repos_url": "https://api.github.com/users/curiouserrandy/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/curiouserrandy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/curiouserrandy/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/curiouserrandy"
  }
}