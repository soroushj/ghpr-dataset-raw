{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "With the work on degraded lb (https://github.com/envoyproxy/envoy/pull/5367) the code now has a lot of different `std::vector<uint32_t>` types: degraded/healthy load, degraded/healthy availability. The lack of typing here makes working on this code somewhat painful, as passing the wrong type leads to subtle errors that take a while to debug. \r\n\r\nIt would be nice to improve the typing here to make the compiler do the work to enforce that the right variables are used. \r\n\r\nOne option is to use phantom types for this, eg:\r\n\r\n```\r\ntemplate<class T, class... Ts>\r\nstruct Phantom : T {\r\n\ttemplate<class... S>\r\n\texplicit Phantom(S&&... v) : T(std::forward<S>(v)...) {}\r\n};\r\n\r\nstruct Load {};\r\ntypedef Phantom<std::vector<uint32_t>, Load> PriorityLoad;\r\n\r\nstruct Health {};\r\nstruct Degraded {};\r\n\r\ntypedef Phantom<PriorityLoad, Health> HealthPriorityLoad;\r\ntypedef Phantom<PriorityLoad, Degraded> DegradedPriorityLoad;\r\n\r\nvoid priority(PriorityLoad pl) {}\r\nvoid healthPriority(HealthPriorityLoad hl) {}\r\n\r\nint main() {\r\n\tHealthPriorityLoad hpl{1, 2};\r\n\tpriority(hpl); // works because HealthPriorityLoad : PriorityLoad\r\n\thealthPriority(hpl);\r\n\tPriorityLoad pl{3,4};\r\n\tpriority(pl);\r\n\thealthPriority(hpl); // doesn't work since PriorityLoad isn't a HealthPriorityLoad\r\n\treturn 0;\r\n}\r\n```\r\n(https://ideone.com/h7E7MO)\r\n\r\nthis would allow using `HealthPriorityLoad` for more generic types that use `PriorityLoad` for reusable functions while still being able to differentiate it from `DegradedPriorityLoad` for more specific functions. \r\n\r\nUsing the wrong type yields an error like:\r\n\r\n```\r\nprog.cpp:26:8: error: could not convert \u2018pl\u2019 from \u2018PriorityLoad {aka Phantom<std::vector<unsigned int>, Load>}\u2019 to \u2018HealthPriorityLoad {aka Phantom<Phantom<std::vector<unsigned int>, Load>, Health>}\u2019\r\n  bar(pl);\r\n\r\n``` \r\nusing gcc.\r\n\r\nOpen for other suggestions as well, just figured I'd start out with a concrete proposal.",
  "closed_at": "2019-01-14T04:21:46Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/5570/comments",
  "created_at": "2019-01-11T06:50:02Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/5570/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/5570",
  "id": 398153633,
  "labels": [
    {
      "color": "0e8a16",
      "default": false,
      "description": null,
      "id": 527497761,
      "name": "tech debt",
      "node_id": "MDU6TGFiZWw1Mjc0OTc3NjE=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/tech%20debt"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/5570/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-04-05T18:08:09Z",
    "closed_issues": 57,
    "created_at": "2018-12-13T16:08:19Z",
    "creator": {
      "avatar_url": "https://avatars2.githubusercontent.com/u/18220477?v=4",
      "events_url": "https://api.github.com/users/alyssawilk/events{/privacy}",
      "followers_url": "https://api.github.com/users/alyssawilk/followers",
      "following_url": "https://api.github.com/users/alyssawilk/following{/other_user}",
      "gists_url": "https://api.github.com/users/alyssawilk/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/alyssawilk",
      "id": 18220477,
      "login": "alyssawilk",
      "node_id": "MDQ6VXNlcjE4MjIwNDc3",
      "organizations_url": "https://api.github.com/users/alyssawilk/orgs",
      "received_events_url": "https://api.github.com/users/alyssawilk/received_events",
      "repos_url": "https://api.github.com/users/alyssawilk/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/alyssawilk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alyssawilk/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/alyssawilk"
    },
    "description": null,
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/9",
    "id": 3897143,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/9/labels",
    "node_id": "MDk6TWlsZXN0b25lMzg5NzE0Mw==",
    "number": 9,
    "open_issues": 0,
    "state": "closed",
    "title": "1.10.0",
    "updated_at": "2019-04-05T18:08:09Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/9"
  },
  "node_id": "MDU6SXNzdWUzOTgxNTM2MzM=",
  "number": 5570,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Stronger typing in load_balancer_impl",
  "updated_at": "2019-01-14T04:21:46Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/5570",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/2023366?v=4",
    "events_url": "https://api.github.com/users/snowp/events{/privacy}",
    "followers_url": "https://api.github.com/users/snowp/followers",
    "following_url": "https://api.github.com/users/snowp/following{/other_user}",
    "gists_url": "https://api.github.com/users/snowp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/snowp",
    "id": 2023366,
    "login": "snowp",
    "node_id": "MDQ6VXNlcjIwMjMzNjY=",
    "organizations_url": "https://api.github.com/users/snowp/orgs",
    "received_events_url": "https://api.github.com/users/snowp/received_events",
    "repos_url": "https://api.github.com/users/snowp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/snowp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/snowp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/snowp"
  }
}