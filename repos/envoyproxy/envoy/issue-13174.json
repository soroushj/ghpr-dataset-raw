{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "We have some use-cases where a filter needs to set dynamic metadata when the stream ends, but before log() happens, to enrich the logs with data gathered through the lifecycle of the request (and regardless if it ended or reset).\r\n\r\nWe used to do it using onDestroy(), but now that log() happens before onDestroy, this approach doesn't work anymore (as of https://github.com/envoyproxy/envoy/pull/12850).\r\n\r\nsolution suggestion: adding another callback to `StreamFilterBase` named `onStreamCompleted` that will be called just before `log()` happens here: https://github.com/envoyproxy/envoy/blob/84f538f1ddcb5c16d98627df8b5e8c38f0f26720/source/common/http/conn_manager_impl.cc#L207-L208\r\n\r\nThis will allow extensions to enrich the logs, without the need to reason on all the cases where the stream might end (i.e. if it was reset or not).\r\n\r\nIf there are no objections, we can contribute this change.\r\n\r\ncc @kyessenov \r\n",
  "closed_at": "2020-09-30T20:47:54Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/13174/comments",
  "created_at": "2020-09-18T17:04:40Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/13174/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/13174",
  "id": 704527494,
  "labels": [
    {
      "color": "3f890b",
      "default": false,
      "description": "",
      "id": 1890308783,
      "name": "area/access_log",
      "node_id": "MDU6TGFiZWwxODkwMzA4Nzgz",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/area/access_log"
    },
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/13174/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU3MDQ1Mjc0OTQ=",
  "number": 13174,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "log: allow extensions enrich the logs (regression)",
  "updated_at": "2020-09-30T20:47:54Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/13174",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/325621?v=4",
    "events_url": "https://api.github.com/users/yuval-k/events{/privacy}",
    "followers_url": "https://api.github.com/users/yuval-k/followers",
    "following_url": "https://api.github.com/users/yuval-k/following{/other_user}",
    "gists_url": "https://api.github.com/users/yuval-k/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/yuval-k",
    "id": 325621,
    "login": "yuval-k",
    "node_id": "MDQ6VXNlcjMyNTYyMQ==",
    "organizations_url": "https://api.github.com/users/yuval-k/orgs",
    "received_events_url": "https://api.github.com/users/yuval-k/received_events",
    "repos_url": "https://api.github.com/users/yuval-k/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/yuval-k/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yuval-k/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/yuval-k"
  }
}