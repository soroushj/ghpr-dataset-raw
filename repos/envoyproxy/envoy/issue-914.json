{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "The UBSAN alignment test is currently disable https://github.com/lyft/envoy/pull/904, since it triggers a bunch of failures. Most of these are related to taking some `Buffer` slice address and using it directly for `uint16_t` or `uint32_t`. It's probably functionally not a big issue to have these misalignments, even though technically undefined behavior at the C++ level, on x86, but it hurts architectural portability and performance.\r\n\r\nTo discover the failures, enable `alignment` checking in `tools/bazel.rc`. Here's example output:\r\n\r\n```\r\n//test/common/grpc:rpc_channel_impl_test                                 FAILED in 1 out of 2 in 1.8s\r\n  /usr/local/google/home/htuch/.cache/bazel/_bazel_htuch/89676793239ac96d94294e6c7a44597f/execroot/envoy/bazel-out/local-dbg/testlogs/test/common/grpc/rpc_channel_impl_test/test.log\r\n//test/common/mongo:codec_impl_test                                      FAILED in 1 out of 2 in 0.3s\r\n  /usr/local/google/home/htuch/.cache/bazel/_bazel_htuch/89676793239ac96d94294e6c7a44597f/execroot/envoy/bazel-out/local-dbg/testlogs/test/common/mongo/codec_impl_test/test.log\r\n//test/common/network:dns_impl_test                                      FAILED in 1 out of 2 in 0.9s\r\n  /usr/local/google/home/htuch/.cache/bazel/_bazel_htuch/89676793239ac96d94294e6c7a44597f/execroot/envoy/bazel-out/local-dbg/testlogs/test/common/network/dns_impl_test/test.log\r\n//test/common/tracing:http_tracer_impl_test                              FAILED in 1 out of 2 in 1.8s\r\n  /usr/local/google/home/htuch/.cache/bazel/_bazel_htuch/89676793239ac96d94294e6c7a44597f/execroot/envoy/bazel-out/local-dbg/testlogs/test/common/tracing/http_tracer_impl_test/test.log\r\n\r\n<clang-san> htuch@htuch00:~/src/envoy \u22a7 cat /usr/local/google/home/htuch/.cache/bazel/_bazel_htuch/89676793239ac96d94294e6c7a44597f/execroot/envoy/bazel-out/local-dbg/testlogs/test/common/grpc/rpc_channel_impl_test/test.log\r\nexec ${PAGER:-/usr/bin/less} \"$0\" || exit 1\r\n-----------------------------------------------------------------------------\r\n[==========] Running 13 tests from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 13 tests from GrpcRequestImplTest\r\n[ RUN      ] GrpcRequestImplTest.NoError\r\nsource/common/grpc/common.cc:48:3: runtime error: store to misaligned address 0x6190000064b1 for type 'uint32_t' (aka 'unsigned int'), which requires 4 byte alignment\r\n0x6190000064b1: note: pointer points here\r\n 61 00 00  00 be be be be be be be  be be be be be be be be  be be be be be be be be  be be be be be\r\n              ^\r\nSUMMARY: AddressSanitizer: undefined-behavior source/common/grpc/common.cc:48:3 in\r\nUse --strategy=TestRunner=standalone to disable sandboxing for the failing actions.\r\n\r\n<clang-san> htuch@htuch00:~/src/envoy \u22a7 cat /usr/local/google/home/htuch/.cache/bazel/_bazel_htuch/89676793239ac96d94294e6c7a44597f/execroot/envoy/bazel-out/local-dbg/testlogs/test/common/mongo/codec_impl_test/test.log\r\nexec ${PAGER:-/usr/bin/less} \"$0\" || exit 1\r\n-----------------------------------------------------------------------------\r\n[==========] Running 14 tests from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 14 tests from MongoCodecImplTest\r\n[ RUN      ] MongoCodecImplTest.QueryEqual\r\n[       OK ] MongoCodecImplTest.QueryEqual (0 ms)\r\n[ RUN      ] MongoCodecImplTest.Query\r\nsource/common/mongo/bson_impl.cc:21:10: runtime error: load of misaligned address 0x6190000032c9 for type 'int32_t' (aka 'int'), which requires 4 byte alignment\r\n0x6190000032c9: note: pointer points here\r\n 65 73 74  00 14 00 00 00 ff ff ff  ff f1 00 00 00 02 73 74  72 69 6e 67 00 07 00 00  00 73 74 72 69\r\n              ^\r\nSUMMARY: AddressSanitizer: undefined-behavior source/common/mongo/bson_impl.cc:21:10 in\r\nUse --strategy=TestRunner=standalone to disable sandboxing for the failing actions.\r\n\r\n<clang-san> htuch@htuch00:~/src/envoy \u22a7 cat /usr/local/google/home/htuch/.cache/bazel/_bazel_htuch/89676793239ac96d94294e6c7a44597f/execroot/envoy/bazel-out/local-dbg/testlogs/test/common/network/dns_impl_test/test.log\r\nexec ${PAGER:-/usr/bin/less} \"$0\" || exit 1\r\n-----------------------------------------------------------------------------\r\n[==========] Running 6 tests from 2 test cases.\r\n[----------] Global test environment set-up.\r\n[----------] 5 tests from DnsImplTest\r\n[ RUN      ] DnsImplTest.DestructPending\r\n[       OK ] DnsImplTest.DestructPending (2 ms)\r\n[ RUN      ] DnsImplTest.LocalLookup\r\n[       OK ] DnsImplTest.LocalLookup (1 ms)\r\n[ RUN      ] DnsImplTest.RemoteAsyncLookup\r\n[       OK ] DnsImplTest.RemoteAsyncLookup (2 ms)\r\n[ RUN      ] DnsImplTest.MultiARecordLookup\r\n[       OK ] DnsImplTest.MultiARecordLookup (1 ms)\r\n[ RUN      ] DnsImplTest.Cancel\r\ntest/common/network/dns_impl_test.cc:69:20: runtime error: load of misaligned address 0x619000007dcf for type 'uint16_t' (aka 'unsigned short'), which requires 2 byte alignment\r\n0x619000007dcf: note: pointer points here\r\n 00 01 00 01 00  22 c2 d8 01 00 00 01 00  00 00 00 00 00 04 73 6f  6d 65 04 67 6f 6f 64 06  64 6f 6d\r\n             ^\r\nSUMMARY: AddressSanitizer: undefined-behavior test/common/network/dns_impl_test.cc:69:20 in\r\nUse --strategy=TestRunner=standalone to disable sandboxing for the failing actions.\r\n\r\n<clang-san> htuch@htuch00:~/src/envoy \u22a7 cat /usr/local/google/home/htuch/.cache/bazel/_bazel_htuch/89676793239ac96d94294e6c7a44597f/execroot/envoy/bazel-out/local-dbg/testlogs/test/common/tracing/http_tracer_impl_test/test.log\r\nexec ${PAGER:-/usr/bin/less} \"$0\" || exit 1\r\n-----------------------------------------------------------------------------\r\n[==========] Running 14 tests from 4 test cases.\r\n[----------] Global test environment set-up.\r\n[----------] 6 tests from HttpTracerUtilityTest\r\n[ RUN      ] HttpTracerUtilityTest.mutateHeaders\r\n[       OK ] HttpTracerUtilityTest.mutateHeaders (3 ms)\r\n[ RUN      ] HttpTracerUtilityTest.IsTracing\r\n[       OK ] HttpTracerUtilityTest.IsTracing (2 ms)\r\n[ RUN      ] HttpTracerUtilityTest.OriginalAndLongPath\r\n[       OK ] HttpTracerUtilityTest.OriginalAndLongPath (2 ms)\r\n[ RUN      ] HttpTracerUtilityTest.SpanOptionalHeaders\r\n[       OK ] HttpTracerUtilityTest.SpanOptionalHeaders (1 ms)\r\n[ RUN      ] HttpTracerUtilityTest.SpanPopulatedFailureResponse\r\n[       OK ] HttpTracerUtilityTest.SpanPopulatedFailureResponse (2 ms)\r\n[ RUN      ] HttpTracerUtilityTest.operationTypeToString\r\n[       OK ] HttpTracerUtilityTest.operationTypeToString (0 ms)\r\n[----------] 6 tests from HttpTracerUtilityTest (10 ms total)\r\n\r\n[----------] 1 test from HttpNullTracerTest\r\n[ RUN      ] HttpNullTracerTest.BasicFunctionality\r\n[       OK ] HttpNullTracerTest.BasicFunctionality (2 ms)\r\n[----------] 1 test from HttpNullTracerTest (2 ms total)\r\n\r\n[----------] 2 tests from HttpTracerImplTest\r\n[ RUN      ] HttpTracerImplTest.BasicFunctionalityNullSpan\r\n[       OK ] HttpTracerImplTest.BasicFunctionalityNullSpan (2 ms)\r\n[ RUN      ] HttpTracerImplTest.BasicFunctionalityNodeSet\r\n[       OK ] HttpTracerImplTest.BasicFunctionalityNodeSet (2 ms)\r\n[----------] 2 tests from HttpTracerImplTest (4 ms total)\r\n\r\n[----------] 5 tests from LightStepDriverTest\r\n[ RUN      ] LightStepDriverTest.InitializeDriver\r\n[       OK ] LightStepDriverTest.InitializeDriver (8 ms)\r\n[ RUN      ] LightStepDriverTest.FlushSeveralSpans\r\nsource/common/grpc/common.cc:48:3: runtime error: store to misaligned address 0x6190000087b1 for type 'uint32_t' (aka 'unsigned int'), which requires 4 byte alignment\r\n0x6190000087b1: note: pointer points here\r\n 61 00 00  00 be be be be be be be  be be be be be be be be  be be be be be be be be  be be be be be\r\n              ^\r\nSUMMARY: AddressSanitizer: undefined-behavior source/common/grpc/common.cc:48:3 in\r\nUse --strategy=TestRunner=standalone to disable sandboxing for the failing actions.\r\n```",
  "closed_at": "2017-05-11T15:13:11Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/914/comments",
  "created_at": "2017-05-07T14:35:33Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/914/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/914",
  "id": 226864529,
  "labels": [
    {
      "color": "0e8a16",
      "default": false,
      "description": null,
      "id": 527497761,
      "name": "tech debt",
      "node_id": "MDU6TGFiZWw1Mjc0OTc3NjE=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/tech%20debt"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/914/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMjY4NjQ1Mjk=",
  "number": 914,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Fix misaligned pointers in various places",
  "updated_at": "2017-05-11T15:13:11Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/914",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/10914751?v=4",
    "events_url": "https://api.github.com/users/htuch/events{/privacy}",
    "followers_url": "https://api.github.com/users/htuch/followers",
    "following_url": "https://api.github.com/users/htuch/following{/other_user}",
    "gists_url": "https://api.github.com/users/htuch/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/htuch",
    "id": 10914751,
    "login": "htuch",
    "node_id": "MDQ6VXNlcjEwOTE0NzUx",
    "organizations_url": "https://api.github.com/users/htuch/orgs",
    "received_events_url": "https://api.github.com/users/htuch/received_events",
    "repos_url": "https://api.github.com/users/htuch/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/htuch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/htuch/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/htuch"
  }
}