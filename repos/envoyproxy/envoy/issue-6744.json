{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/18220477?v=4",
    "events_url": "https://api.github.com/users/alyssawilk/events{/privacy}",
    "followers_url": "https://api.github.com/users/alyssawilk/followers",
    "following_url": "https://api.github.com/users/alyssawilk/following{/other_user}",
    "gists_url": "https://api.github.com/users/alyssawilk/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/alyssawilk",
    "id": 18220477,
    "login": "alyssawilk",
    "node_id": "MDQ6VXNlcjE4MjIwNDc3",
    "organizations_url": "https://api.github.com/users/alyssawilk/orgs",
    "received_events_url": "https://api.github.com/users/alyssawilk/received_events",
    "repos_url": "https://api.github.com/users/alyssawilk/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/alyssawilk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alyssawilk/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/alyssawilk"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/18220477?v=4",
      "events_url": "https://api.github.com/users/alyssawilk/events{/privacy}",
      "followers_url": "https://api.github.com/users/alyssawilk/followers",
      "following_url": "https://api.github.com/users/alyssawilk/following{/other_user}",
      "gists_url": "https://api.github.com/users/alyssawilk/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/alyssawilk",
      "id": 18220477,
      "login": "alyssawilk",
      "node_id": "MDQ6VXNlcjE4MjIwNDc3",
      "organizations_url": "https://api.github.com/users/alyssawilk/orgs",
      "received_events_url": "https://api.github.com/users/alyssawilk/received_events",
      "repos_url": "https://api.github.com/users/alyssawilk/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/alyssawilk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alyssawilk/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/alyssawilk"
    }
  ],
  "author_association": "NONE",
  "body": "*Title*: *Envoy is segfaulting*\r\n\r\n*Description*:\r\nEnvoy is segfaulting. I am sending http1 GET requests. Envoy has grpc transcoding setup. Backend service is a grpc service.\r\n\r\nI am running   envoyproxy/envoy-alpine-debug:v1.10.0 within a docker container on a VM.\r\n\r\n*Repro steps*:\r\n> Include sample requests, environment, etc. All data and inputs\r\nrequired to reproduce the bug.\r\n\r\n\r\n\r\n```\r\n[2019-04-29 19:13:28.720][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:75] #29: [0x7f9f0deefcf8] \r\n[2019-04-29 19:13:28.720][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #28: Envoy::Thread::ThreadImplPosix::ThreadImplPosix()::{lambda()#1}::_FUN() [0xfa90e5] \r\n[2019-04-29 19:13:28.717][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #27: Envoy::Server::WorkerImpl::threadRoutine() [0xa8d10e] \r\n[2019-04-29 19:13:28.715][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #26: Envoy::Event::DispatcherImpl::run() [0xa9226a] \r\n[2019-04-29 19:13:28.712][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #25: event_base_loop [0xdca5c8] \r\n[2019-04-29 19:13:28.709][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #24: event_process_active [0xdc89bf] \r\n[2019-04-29 19:13:28.706][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #23: event_process_active_single_queue.isra.31 [0xdc8489] \r\n[2019-04-29 19:13:28.703][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #22: Envoy::Event::FileEventImpl::assignEvents()::{lambda()#1}::_FUN() [0xa92bea] \r\n[2019-04-29 19:13:28.701][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #21: Envoy::Network::ConnectionImpl::onFileEvent() [0xa98f2a] \r\n[2019-04-29 19:13:28.698][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #20: Envoy::Network::ConnectionImpl::onReadReady() [0xa9881a] \r\n[2019-04-29 19:13:28.695][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #19: Envoy::Network::FilterManagerImpl::onContinueReading() [0xa9bfac] \r\n[2019-04-29 19:13:28.692][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #18: Envoy::Http::CodecClient::CodecReadFilter::onData() [0xbf0f9d] \r\n[2019-04-29 19:13:28.690][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #17: Envoy::Http::CodecClient::onData() [0xbf0dc1] \r\n[2019-04-29 19:13:28.687][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #16: Envoy::Http::Http2::ConnectionImpl::dispatch() [0xc5d6a7] \r\n[2019-04-29 19:13:28.684][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #15: nghttp2_session_mem_recv [0xc66a5b] \r\n[2019-04-29 19:13:28.681][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #14: nghttp2_session_on_data_received [0xc61f20] \r\n[2019-04-29 19:13:28.679][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #13: Envoy::Http::Http2::ConnectionImpl::onFrameReceived() [0xc5c4a1] \r\n[2019-04-29 19:13:28.676][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #12: Envoy::Http::ConnectionManagerImpl::ActiveStream::encodeData() [0xc4c36b] \r\n[2019-04-29 19:13:28.673][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #11: Envoy::Http::ConnectionManagerImpl::ActiveStreamFilterBase::commonHandleAfterDataCallback() [0xc499aa] \r\n[2019-04-29 19:13:28.670][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #10: Envoy::Http::ConnectionManagerImpl::ActiveStreamFilterBase::commonHandleBufferData() [0xc40170] \r\n[2019-04-29 19:13:28.668][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #9: Envoy::Http::ConnectionManagerImpl::ActiveStreamEncoderFilter::responseDataTooLarge() [0xc40347] \r\n[2019-04-29 19:13:28.665][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #8: Envoy::Http::ConnectionManagerImpl::doEndStream() [0xc3fa40] \r\n[2019-04-29 19:13:28.662][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #7: Envoy::Http::ConnectionManagerImpl::doDeferredStreamDestroy() [0xc3f91e] \r\n[2019-04-29 19:13:28.659][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #6: Envoy::Router::Filter::cleanup() [0xc02c9f] \r\n[2019-04-29 19:13:28.657][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #5: Envoy::Router::Filter::UpstreamRequest::~UpstreamRequest() [0xc0b601] \r\n[2019-04-29 19:13:28.654][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #4: Envoy::Router::Filter::UpstreamRequest::~UpstreamRequest() [0xc0b48f] \r\n[2019-04-29 19:13:28.651][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #3: Envoy::Extensions::AccessLoggers::File::FileAccessLog::log() [0xe3bc85] \r\n[2019-04-29 19:13:28.648][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #2: _ZNK5Envoy9AccessLog13FormatterImpl6formatB5cxx11ERKNS_4Http9HeaderMapES5_S5_RKNS_10StreamInfo10StreamInfoE [0xd5945b] \r\n[2019-04-29 19:13:28.645][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:73] #1: _ZNK5Envoy9AccessLog23ResponseHeaderFormatter6formatB5cxx11ERKNS_4Http9HeaderMapES5_S5_RKNS_10StreamInfo10StreamInfoE [0xd5aa08] \r\n[2019-04-29 19:13:28.642][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:75] #0: [0x7f9f0defa4b0] \r\n[2019-04-29 19:13:28.642][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:69] Backtrace (use tools/stack_decode.py to get line numbers): \r\n[2019-04-29 19:13:28.642][21][critical][backtrace] [bazel-out/k8-opt/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:81] Caught Segmentation fault, suspect faulting address 0x35d0150 \r\n[2019-04-29 19:13:27.809][1][info][config] [source/server/listener_manager_impl.cc:1006] all dependencies initialized. starting workers \r\n```\r\n\r\nEnvoy config here \r\n```\r\n\r\n# specify an admin endpoint for Envoy\r\nadmin:\r\n  access_log_path: /tmp/admin_access.log\r\n  address:\r\n    socket_address: { address: 0.0.0.0, port_value: 10000 }\r\n\r\nstatic_resources:\r\n  listeners:\r\n  - name: listener1\r\n    address:\r\n      socket_address: { address: 0.0.0.0, port_value: 8080 }\r\n    filter_chains:\r\n      # We want Envoy support SSL.\r\n      - tls_context:\r\n              common_tls_context:\r\n                alpn_protocols: h2,http/1.1\r\n                tls_certificates:\r\n                  # certificate chain - these could be self signed certificates\r\n                  - certificate_chain:\r\n                      filename: /certs/server.crt\r\n                    private_key:\r\n                      filename: /certs/server.key\r\n        # The filters we want to add\r\n        filters:\r\n          - name: envoy.http_connection_manager\r\n            config:\r\n              stat_prefix: grpc_json\r\n              codec_type: AUTO\r\n              # idle time for the connection from google load balancer\r\n              idle_timeout: 720s\r\n              # drain timeout for the connection from the google load balancer\r\n              drain_timeout: 140s\r\n              # stream idle timeout for the connection from the google load balancer\r\n              stream_idle_timeout: 720s\r\n              server_name: myserver\r\n              route_config:\r\n                name: local_route\r\n                virtual_hosts:\r\n                - name: local_service\r\n                  domains: [\"*\"]\r\n                  routes:\r\n                  - match:\r\n                      prefix: \"/\"\r\n                    route:\r\n                      # this cluster name should be defined in the clusters section\r\n                      cluster: my_service\r\n                      timeout: 110s\r\n                      retry_policy:\r\n                        # retry only on connection failures\r\n                        retry_on: connect-failure,refused-stream\r\n                        num_retries: 2\r\n                        num_retries: 2\r\n                  - match:\r\n                      # this is the grpc route. Grpc requests are actually http2 requests to the\r\n                      # fully qualified name of the service.\r\n                      # This should match the name of the service of the in the proto file\r\n                      prefix: \"/com.my.service/\"\r\n                    route:\r\n                      timeout: 110s\r\n                       # this cluster name should be defined in the clusters section\r\n                      cluster: my_service\r\n                      retry_policy:\r\n                        # retry only on connection failures\r\n                        retry_on: connect-failure,refused-stream\r\n                        num_retries: 2\r\n                        num_retries: 2\r\n                # we would like remove all three headers. But envoy won't remove grpc-status header\r\n                response_headers_to_remove: [\"grpc-encoding\", \"grpc-accept-encoding\"]\r\n              http_filters:\r\n              # configure envoy to respond to health check\r\n              - name: envoy.health_check\r\n                config:\r\n                    # we want envoy to handle to health check\r\n                    pass_through_mode: false\r\n                    cluster_min_healthy_percentages:\r\n                      # we require 100% of cluster 'my_service' to healthy\r\n                      my_service:\r\n                        value: 100\r\n                    headers:\r\n                    - name: \":path\"\r\n                      exact_match: \"/health\"\r\n              # we want envoy to accept json body and support REST endpoints\r\n              - name: envoy.grpc_json_transcoder\r\n                config:\r\n                  # Provide the descriptor file generated by protobuf\r\n                  proto_descriptor: \"/etc/envoy/pcs-model.desc\"\r\n                  # What services need envoy to support\r\n                  services: [\"com.my.service\"]\r\n                  print_options:\r\n                    add_whitespace: true\r\n                    always_print_primitive_fields: false\r\n                    always_print_enums_as_ints: false\r\n                    preserve_proto_field_names: true\r\n\r\n              - name: envoy.router\r\n                config:\r\n                    suppress_envoy_headers: true\r\n                    upstream_log:\r\n                        name: envoy.file_access_log\r\n                        filter:\r\n                            not_health_check_filter: {}\r\n                        config:\r\n                            path: /host/tmp/request_log.txt\r\n\r\n  # backends backing our envoy\r\n  clusters:\r\n  # this must match the name cluster name provided in the routes section\r\n  - name: my_service\r\n    connect_timeout: 1.25s\r\n    # static route\r\n    type: static\r\n    http2_protocol_options: {}\r\n    # localhost is our cluster\r\n    hosts:\r\n    - socket_address:\r\n        address: 127.0.0.1\r\n        port_value: 8000\r\n    # configure health check for the cluster\r\n    health_checks:\r\n    # health check section deleted\r\n\r\nstats_sinks:\r\n  - name: \"envoy.statsd\"\r\n    config:\r\n      address:\r\n        socket_address:\r\n          protocol: \"UDP\"\r\n          address: \"127.0.0.1\"\r\n          port_value: \"8125\"\r\n\r\nstats_flush_interval:\r\n  seconds: 60\r\n\r\nwatchdog:\r\n  kill_timeout: 90s\r\n  multikill_timeout: 90s\r\n\r\n```",
  "closed_at": "2019-05-03T01:51:25Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/18220477?v=4",
    "events_url": "https://api.github.com/users/alyssawilk/events{/privacy}",
    "followers_url": "https://api.github.com/users/alyssawilk/followers",
    "following_url": "https://api.github.com/users/alyssawilk/following{/other_user}",
    "gists_url": "https://api.github.com/users/alyssawilk/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/alyssawilk",
    "id": 18220477,
    "login": "alyssawilk",
    "node_id": "MDQ6VXNlcjE4MjIwNDc3",
    "organizations_url": "https://api.github.com/users/alyssawilk/orgs",
    "received_events_url": "https://api.github.com/users/alyssawilk/received_events",
    "repos_url": "https://api.github.com/users/alyssawilk/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/alyssawilk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alyssawilk/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/alyssawilk"
  },
  "comments": 9,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6744/comments",
  "created_at": "2019-04-29T20:04:38Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6744/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/6744",
  "id": 438484423,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6744/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-07-11T18:22:23Z",
    "closed_issues": 70,
    "created_at": "2019-03-01T23:01:48Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/10",
    "id": 4101146,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/10/labels",
    "node_id": "MDk6TWlsZXN0b25lNDEwMTE0Ng==",
    "number": 10,
    "open_issues": 0,
    "state": "closed",
    "title": "1.11.0",
    "updated_at": "2020-04-17T15:48:02Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/10"
  },
  "node_id": "MDU6SXNzdWU0Mzg0ODQ0MjM=",
  "number": 6744,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Envoy Segfaults",
  "updated_at": "2019-05-03T01:51:25Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/6744",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/700539?v=4",
    "events_url": "https://api.github.com/users/kiranisaac/events{/privacy}",
    "followers_url": "https://api.github.com/users/kiranisaac/followers",
    "following_url": "https://api.github.com/users/kiranisaac/following{/other_user}",
    "gists_url": "https://api.github.com/users/kiranisaac/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/kiranisaac",
    "id": 700539,
    "login": "kiranisaac",
    "node_id": "MDQ6VXNlcjcwMDUzOQ==",
    "organizations_url": "https://api.github.com/users/kiranisaac/orgs",
    "received_events_url": "https://api.github.com/users/kiranisaac/received_events",
    "repos_url": "https://api.github.com/users/kiranisaac/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/kiranisaac/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kiranisaac/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/kiranisaac"
  }
}