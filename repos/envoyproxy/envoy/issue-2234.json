{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    }
  ],
  "author_association": "MEMBER",
  "body": "Given a V2 bootstrap configuration with a `Listener` defined in `static_resources` and one or more listeners configured via `dynamic_resources`, the former is removed as soon as a successful DynamicResponse for LDS is received. Envoy then asserts, perhaps because the removed listener was never started. \r\n\r\nThe correct behavior should be to leave the statically defined Listener in place a la CDS/Cluster.\r\n\r\n*Repro steps*:\r\n\r\nSee attached tar ball for config file. It has a healthcheck listener configured in bootstrap.conf, and a second listener in lds.conf. The log file shows the lds listener being added, the healthcheck listener being removed, and then the subsequent crash with decoded stack trace.\r\n\r\n*Config*:\r\nSee attached file.\r\n\r\n*Logs*:\r\nSee attached file.\r\n\r\n*Call Stack*:\r\n```\r\n[2017-12-19 13:27:16.058][23811][debug][config] source/server/listener_manager_impl.cc:454] begin remove listener: name=healthcheck\r\n[2017-12-19 13:27:16.058][23811][debug][config] source/server/listener_manager_impl.cc:162] draining listener: name=healthcheck, hash=859362694391224026, address=0.0.0.0:8888\r\n[2017-12-19 13:27:16.058][23811][critical][assert] source/server/worker_impl.cc:96] assert failure: thread_\r\n[2017-12-19 13:27:16.058][23811][critical][backtrace] bazel-out/k8-fastbuild/bin/source/server/_virtual_includes/backtrace_lib/server/backtrace.h:101] Caught Aborted, suspect faulting address 0x3e800005d03\r\n[2017-12-19 13:27:16.058][23811][critical] Backtrace (most recent call first) from thread 0:\r\n  #1 ?? ??:0\r\n  #2 ?? ??:0\r\n  #3 \r\n  #4 Envoy::Server::WorkerImpl::stopListener(Envoy::Server::Listener&) at ??:?\r\n  #5 Envoy::Server::ListenerManagerImpl::drainListener(std::unique_ptr<Envoy::Server::ListenerImpl, std::default_delete<Envoy::Server::ListenerImpl> >&&) at ??:?\r\n  #6 Envoy::Server::ListenerManagerImpl::removeListener(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) at ??:?\r\n  #7 Envoy::Server::LdsApi::onConfigUpdate(google::protobuf::RepeatedPtrField<envoy::api::v2::Listener> const&) at ??:?\r\n  #8 Envoy::Config::FilesystemSubscriptionImpl<envoy::api::v2::Listener>::refresh() at ??:?\r\n  #9 Envoy::Config::FilesystemSubscriptionImpl<envoy::api::v2::Listener>::start(std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > const&, Envoy::Config::SubscriptionCallbacks<envoy::api::v2::Listener>&) at ??:?\r\n  #10 Envoy::Server::LdsApi::initialize(std::function<void ()>) at ??:?\r\n  #11 Envoy::Server::InitManagerImpl::initializeTarget(Envoy::Init::Target&) at ??:?\r\n  #12 Envoy::Server::InitManagerImpl::initialize(std::function<void ()>) at ??:?\r\n  #13 Envoy::Server::RunHelper::RunHelper(Envoy::Event::Dispatcher&, Envoy::Upstream::ClusterManager&, Envoy::Server::HotRestart&, Envoy::AccessLog::AccessLogManager&, Envoy::Server::InitManagerImpl&, std::function<void ()>)::{lambda()#4}::operator()() const at server.cc:?\r\n  #14 std::_Function_handler<void (), Envoy::Server::RunHelper::RunHelper(Envoy::Event::Dispatcher&, Envoy::Upstream::ClusterManager&, Envoy::Server::HotRestart&, Envoy::AccessLog::AccessLogManager&, Envoy::Server::InitManagerImpl&, std::function<void ()>)::{lambda()#4}>::_M_invoke(std::_Any_data const&) at server.cc:?\r\n  #15 std::function<void ()>::operator()() const at ??:?\r\n  #16 Envoy::Upstream::ClusterManagerInitHelper::setInitializedCb(std::function<void ()>) at ??:?\r\n  #17 Envoy::Upstream::ClusterManagerImpl::setInitializedCb(std::function<void ()>) at ??:?\r\n  #18 Envoy::Server::RunHelper::RunHelper(Envoy::Event::Dispatcher&, Envoy::Upstream::ClusterManager&, Envoy::Server::HotRestart&, Envoy::AccessLog::AccessLogManager&, Envoy::Server::InitManagerImpl&, std::function<void ()>) at ??:?\r\n  #19 Envoy::Server::InstanceImpl::run() at ??:?\r\n  #20 Envoy::main_common(Envoy::OptionsImpl&) at ??:?\r\n  #21 main at ??:?\r\n  #22 \r\n  #23 ?? ??:0\r\n  #24 \r\n  #25 _start at ??:?\r\n  #26 \r\n```\r\n\r\n[listener-bug.tar.gz](https://github.com/envoyproxy/envoy/files/1573339/listener-bug.tar.gz)\r\n",
  "closed_at": "2018-01-03T11:42:51Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/10914751?v=4",
    "events_url": "https://api.github.com/users/htuch/events{/privacy}",
    "followers_url": "https://api.github.com/users/htuch/followers",
    "following_url": "https://api.github.com/users/htuch/following{/other_user}",
    "gists_url": "https://api.github.com/users/htuch/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/htuch",
    "id": 10914751,
    "login": "htuch",
    "node_id": "MDQ6VXNlcjEwOTE0NzUx",
    "organizations_url": "https://api.github.com/users/htuch/orgs",
    "received_events_url": "https://api.github.com/users/htuch/received_events",
    "repos_url": "https://api.github.com/users/htuch/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/htuch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/htuch/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/htuch"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2234/comments",
  "created_at": "2017-12-19T21:36:29Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2234/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/2234",
  "id": 283377069,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2234/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-03-20T20:42:42Z",
    "closed_issues": 58,
    "created_at": "2017-11-03T00:16:48Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/5",
    "id": 2884977,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/5/labels",
    "node_id": "MDk6TWlsZXN0b25lMjg4NDk3Nw==",
    "number": 5,
    "open_issues": 0,
    "state": "closed",
    "title": "1.6.0",
    "updated_at": "2018-03-20T20:42:42Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/5"
  },
  "node_id": "MDU6SXNzdWUyODMzNzcwNjk=",
  "number": 2234,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "LDS clobbers statically configured listeners (and crashes)",
  "updated_at": "2018-01-03T11:42:51Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/2234",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/53179?v=4",
    "events_url": "https://api.github.com/users/zuercher/events{/privacy}",
    "followers_url": "https://api.github.com/users/zuercher/followers",
    "following_url": "https://api.github.com/users/zuercher/following{/other_user}",
    "gists_url": "https://api.github.com/users/zuercher/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/zuercher",
    "id": 53179,
    "login": "zuercher",
    "node_id": "MDQ6VXNlcjUzMTc5",
    "organizations_url": "https://api.github.com/users/zuercher/orgs",
    "received_events_url": "https://api.github.com/users/zuercher/received_events",
    "repos_url": "https://api.github.com/users/zuercher/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/zuercher/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zuercher/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/zuercher"
  }
}