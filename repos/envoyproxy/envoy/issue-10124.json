{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "We have configured the rate limiting service with three request headers actions like \r\n\r\n```\r\n        \"rate_limits\": [\r\n         {\r\n          \"stage\": 0,\r\n          \"actions\": [\r\n           {\r\n            \"source_cluster\": {}\r\n           },\r\n           {\r\n            \"destination_cluster\": {}\r\n           },\r\n           {\r\n            \"request_headers\": {\r\n             \"header_name\": \":authority\",\r\n             \"descriptor_key\": \"authority\"\r\n            }\r\n           },\r\n           {\r\n            \"request_headers\": {\r\n             \"header_name\": \":path\",\r\n             \"descriptor_key\": \"path\"\r\n            }\r\n           },\r\n           {\r\n            \"request_headers\": {\r\n             \"header_name\": \"custom-header\",\r\n             \"descriptor_key\": \"custom\"\r\n            }\r\n           },\r\n          ]\r\n         }\r\n        ]\r\n       }\r\n      ]\r\n```\r\nIf in a request the `custom-header` does not have a value, Envoy skips calling the rate limiting service.\r\n\r\nDebugging it further, found that if any of the `populateDescriptor` call here returns false it skips adding the descriptor\r\n\r\nhttps://github.com/envoyproxy/envoy/blob/5be15b31aa46e3c3776a15fd3d399c67ac432598/source/common/router/router_ratelimit.cc#L121\r\n\r\nand \r\n\r\n `populateDescriptor`  implementation of `RequestHeadersAction` returns false if there is no value\r\n\r\nhttps://github.com/envoyproxy/envoy/blob/5be15b31aa46e3c3776a15fd3d399c67ac432598/source/common/router/router_ratelimit.cc#L41\r\n\r\nSince the descriptor list is empty, rate limit service is not called.\r\n\r\nIs this expected behaviour? Should we not call rate limiting service with two headers as descriptor entries which have values rather than completely skipping it? \r\n\r\nShould we simply add a descriptor if it has atleast one entry? ",
  "closed_at": "2020-05-21T15:17:27Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/10124/comments",
  "created_at": "2020-02-21T05:13:28Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/10124/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/10124",
  "id": 568740634,
  "labels": [
    {
      "color": "cdfc8a",
      "default": false,
      "description": "",
      "id": 1811975459,
      "name": "area/ratelimit",
      "node_id": "MDU6TGFiZWwxODExOTc1NDU5",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/area/ratelimit"
    },
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/10124/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1Njg3NDA2MzQ=",
  "number": 10124,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Envoy skips calling rate limiting service when request header is not present",
  "updated_at": "2020-05-21T15:17:27Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/10124",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/17204904?v=4",
    "events_url": "https://api.github.com/users/ramaraochavali/events{/privacy}",
    "followers_url": "https://api.github.com/users/ramaraochavali/followers",
    "following_url": "https://api.github.com/users/ramaraochavali/following{/other_user}",
    "gists_url": "https://api.github.com/users/ramaraochavali/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ramaraochavali",
    "id": 17204904,
    "login": "ramaraochavali",
    "node_id": "MDQ6VXNlcjE3MjA0OTA0",
    "organizations_url": "https://api.github.com/users/ramaraochavali/orgs",
    "received_events_url": "https://api.github.com/users/ramaraochavali/received_events",
    "repos_url": "https://api.github.com/users/ramaraochavali/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ramaraochavali/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ramaraochavali/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ramaraochavali"
  }
}