{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    }
  ],
  "author_association": "NONE",
  "body": "*Title*: *Envoy crash when trying to mirror traffic to non-existent cluster*\r\n\r\n*Description*:\r\n\r\nWe tried to use the \"request_mirror_policy\" feature and noticed that we get a crash if the cluster that we try to mirror traffic to doesn't exist. The crash is happening on the first request that is using that route. This bug seems to manifest only if we load the route configuration via RDS. When we try to specify the route in configuration, validation fails and we can't reproduce the bug.\r\n\r\n*Repro steps*:\r\n\r\nThe minimal configuration that I used to reproduce the bug is this:\r\n```yaml\r\nnode:\r\n  id: test.node\r\n  cluster: test.cluster\r\n\r\nadmin:\r\n  access_log_path: /tmp/admin_access.log\r\n  address:\r\n    socket_address:\r\n      protocol: TCP\r\n      address: 127.0.0.1\r\n      port_value: 9901\r\n\r\nstatic_resources:\r\n  clusters:\r\n    - name: service_google\r\n      connect_timeout: 0.25s\r\n      type: \"LOGICAL_DNS\"\r\n      # Comment out the following line to test on v6 networks\r\n      dns_lookup_family: V4_ONLY\r\n      lb_policy: ROUND_ROBIN\r\n      hosts:\r\n        - socket_address:\r\n            address: google.com\r\n            port_value: 443\r\n      tls_context: { sni: www.google.com }\r\n\r\n  listeners:\r\n    - name: listener_0\r\n      address:\r\n        socket_address:\r\n          protocol: TCP\r\n          address: 0.0.0.0\r\n          port_value: 10000\r\n      filter_chains:\r\n      - filters:\r\n        - name: envoy.http_connection_manager\r\n          config:\r\n            stat_prefix: default\r\n            rds:\r\n              route_config_name: default\r\n              config_source:\r\n                path: ./mirror-crash-route.yaml\r\n            http_filters:\r\n            - name: envoy.router\r\n              config: {}\r\n```\r\nmirror-crash-route.yaml content:\r\n```yaml\r\nversion_info: \"0\"\r\nresources:\r\n  - \"@type\": type.googleapis.com/envoy.api.v2.RouteConfiguration\r\n    name: default\r\n    virtual_hosts:\r\n      - name: virtual_host_0\r\n        domains: [\"*\"]\r\n        routes:\r\n          - match:\r\n              prefix: \"/\"\r\n            route:\r\n              host_rewrite: www.google.com\r\n              cluster: service_google\r\n              request_mirror_policy:\r\n                cluster: invalid\r\n\r\n```\r\nVersion:\r\n```\r\n./envoy-static  version: 5a3baabe12152dea0f423065fba85f9618b676a3/1.8.0-dev/Clean/DEBUG\r\n```\r\nTo reproduce the crash I'm starting it like this:\r\n```\r\n ./envoy-static -c mirror-crash.yaml --log-path crash.log\r\n``` \r\nand sending a http request to http://localhost:10000.\r\n\r\n*Config*:\r\n\r\nI had to rename all the files to \".txt\" so I could upload them.\r\n\r\n[config_dump.txt](https://github.com/envoyproxy/envoy/files/2407819/config_dump.txt)\r\n[mirror-crash.yaml.txt](https://github.com/envoyproxy/envoy/files/2407811/mirror-crash.yaml.txt)\r\n[mirror-crash-route.yaml.txt](https://github.com/envoyproxy/envoy/files/2407812/mirror-crash-route.yaml.txt)\r\n\r\n*Logs*:\r\n[crash.log](https://github.com/envoyproxy/envoy/files/2407809/crash.log)\r\n\r\n",
  "closed_at": "2018-10-02T18:32:27Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/8603643?v=4",
    "events_url": "https://api.github.com/users/ggreenway/events{/privacy}",
    "followers_url": "https://api.github.com/users/ggreenway/followers",
    "following_url": "https://api.github.com/users/ggreenway/following{/other_user}",
    "gists_url": "https://api.github.com/users/ggreenway/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ggreenway",
    "id": 8603643,
    "login": "ggreenway",
    "node_id": "MDQ6VXNlcjg2MDM2NDM=",
    "organizations_url": "https://api.github.com/users/ggreenway/orgs",
    "received_events_url": "https://api.github.com/users/ggreenway/received_events",
    "repos_url": "https://api.github.com/users/ggreenway/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ggreenway/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ggreenway/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ggreenway"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/4504/comments",
  "created_at": "2018-09-22T13:34:05Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/4504/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/4504",
  "id": 362857600,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/4504/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-10-04T15:42:27Z",
    "closed_issues": 54,
    "created_at": "2018-05-28T22:46:02Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/7",
    "id": 3382114,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/7/labels",
    "node_id": "MDk6TWlsZXN0b25lMzM4MjExNA==",
    "number": 7,
    "open_issues": 0,
    "state": "closed",
    "title": "1.8.0",
    "updated_at": "2018-10-04T15:42:27Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/7"
  },
  "node_id": "MDU6SXNzdWUzNjI4NTc2MDA=",
  "number": 4504,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "crash when mirroring traffic to non-existent cluster",
  "updated_at": "2018-10-02T18:32:27Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/4504",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1172010?v=4",
    "events_url": "https://api.github.com/users/avereha/events{/privacy}",
    "followers_url": "https://api.github.com/users/avereha/followers",
    "following_url": "https://api.github.com/users/avereha/following{/other_user}",
    "gists_url": "https://api.github.com/users/avereha/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/avereha",
    "id": 1172010,
    "login": "avereha",
    "node_id": "MDQ6VXNlcjExNzIwMTA=",
    "organizations_url": "https://api.github.com/users/avereha/orgs",
    "received_events_url": "https://api.github.com/users/avereha/received_events",
    "repos_url": "https://api.github.com/users/avereha/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/avereha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/avereha/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/avereha"
  }
}