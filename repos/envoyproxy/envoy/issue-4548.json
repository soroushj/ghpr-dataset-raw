{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/73152?v=4",
    "events_url": "https://api.github.com/users/dio/events{/privacy}",
    "followers_url": "https://api.github.com/users/dio/followers",
    "following_url": "https://api.github.com/users/dio/following{/other_user}",
    "gists_url": "https://api.github.com/users/dio/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dio",
    "id": 73152,
    "login": "dio",
    "node_id": "MDQ6VXNlcjczMTUy",
    "organizations_url": "https://api.github.com/users/dio/orgs",
    "received_events_url": "https://api.github.com/users/dio/received_events",
    "repos_url": "https://api.github.com/users/dio/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dio/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dio"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/73152?v=4",
      "events_url": "https://api.github.com/users/dio/events{/privacy}",
      "followers_url": "https://api.github.com/users/dio/followers",
      "following_url": "https://api.github.com/users/dio/following{/other_user}",
      "gists_url": "https://api.github.com/users/dio/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dio",
      "id": 73152,
      "login": "dio",
      "node_id": "MDQ6VXNlcjczMTUy",
      "organizations_url": "https://api.github.com/users/dio/orgs",
      "received_events_url": "https://api.github.com/users/dio/received_events",
      "repos_url": "https://api.github.com/users/dio/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dio/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dio"
    }
  ],
  "author_association": "NONE",
  "body": "*Title*: Envoy leaks cluster members when using  STRICT_DNS and ClusterLoadAssignment\r\n\r\n*Description*:\r\nWe are using envoy sha f1aee97b079ad4a0130583ef7cd656351dd70bd7 with a configuration that sets up DNS entries in our cluster load assignment registered via a CDS\r\n\r\n```\r\n\"load_assignment\": {\r\n     \"cluster_name\": \"cluster_name\",\r\n     \"endpoints\": [\r\n      {\r\n       \"lb_endpoints\": [\r\n        {\r\n         \"endpoint\": {\r\n          \"address\": {\r\n           \"socket_address\": {\r\n            \"address\": \"host1\",\r\n            \"port_value\": 10652\r\n           }\r\n          }\r\n         }\r\n        }\r\n       ],\r\n       \"load_balancing_weight\": 70\r\n      },\r\n      {\r\n       \"lb_endpoints\": [\r\n        {\r\n         \"endpoint\": {\r\n          \"address\": {\r\n           \"socket_address\": {\r\n            \"address\": \"host2\",\r\n            \"port_value\": 10652\r\n           }\r\n          }\r\n         }\r\n        }\r\n       ],\r\n       \"load_balancing_weight\": 30\r\n      }\r\n     ]\r\n    }\r\n   },\r\n```\r\n\r\nWhen we had this envoy would resolve the DNS and continuously say in the debug logs that the hosts have changed, and so it would add new members to the cluster.  The only indication this was happening was in the cluster membership add/change stats and the cluster member list under 9901/clusters.  The config dump always showed the correct load assignment configuration. \r\n\r\nI should note that the host names in our cluster addresses were aliased in /etc/hosts and did not need to be resolved via pure DNS. I tried to replicate this scenario in a docker container using a public IP like from google.com but was unable to reproduce it, so not sure if this is related.\r\n\r\nWhen members are configured with health checks we ended up in a situation with a health check DDOS as envoy kept adding new cluster members.  \r\n\r\nWe switched over to using STATIC ip addresses, with the exact same configuration, and the membership changes stopped and stabilized.\r\n\r\n",
  "closed_at": "2018-10-04T15:42:07Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 14,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/4548/comments",
  "created_at": "2018-09-27T17:14:13Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/4548/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/4548",
  "id": 364572759,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/4548/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-10-04T15:42:27Z",
    "closed_issues": 54,
    "created_at": "2018-05-28T22:46:02Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/7",
    "id": 3382114,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/7/labels",
    "node_id": "MDk6TWlsZXN0b25lMzM4MjExNA==",
    "number": 7,
    "open_issues": 0,
    "state": "closed",
    "title": "1.8.0",
    "updated_at": "2018-10-04T15:42:27Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/7"
  },
  "node_id": "MDU6SXNzdWUzNjQ1NzI3NTk=",
  "number": 4548,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Envoy leaks cluster members when using  STRICT_DNS and ClusterLoadAssignment",
  "updated_at": "2018-10-04T15:42:07Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/4548",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1799346?v=4",
    "events_url": "https://api.github.com/users/devshorts/events{/privacy}",
    "followers_url": "https://api.github.com/users/devshorts/followers",
    "following_url": "https://api.github.com/users/devshorts/following{/other_user}",
    "gists_url": "https://api.github.com/users/devshorts/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/devshorts",
    "id": 1799346,
    "login": "devshorts",
    "node_id": "MDQ6VXNlcjE3OTkzNDY=",
    "organizations_url": "https://api.github.com/users/devshorts/orgs",
    "received_events_url": "https://api.github.com/users/devshorts/received_events",
    "repos_url": "https://api.github.com/users/devshorts/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/devshorts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/devshorts/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/devshorts"
  }
}