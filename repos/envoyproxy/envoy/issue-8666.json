{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/73152?v=4",
    "events_url": "https://api.github.com/users/dio/events{/privacy}",
    "followers_url": "https://api.github.com/users/dio/followers",
    "following_url": "https://api.github.com/users/dio/following{/other_user}",
    "gists_url": "https://api.github.com/users/dio/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dio",
    "id": 73152,
    "login": "dio",
    "node_id": "MDQ6VXNlcjczMTUy",
    "organizations_url": "https://api.github.com/users/dio/orgs",
    "received_events_url": "https://api.github.com/users/dio/received_events",
    "repos_url": "https://api.github.com/users/dio/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dio/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dio"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/73152?v=4",
      "events_url": "https://api.github.com/users/dio/events{/privacy}",
      "followers_url": "https://api.github.com/users/dio/followers",
      "following_url": "https://api.github.com/users/dio/following{/other_user}",
      "gists_url": "https://api.github.com/users/dio/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dio",
      "id": 73152,
      "login": "dio",
      "node_id": "MDQ6VXNlcjczMTUy",
      "organizations_url": "https://api.github.com/users/dio/orgs",
      "received_events_url": "https://api.github.com/users/dio/received_events",
      "repos_url": "https://api.github.com/users/dio/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dio/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dio"
    }
  ],
  "author_association": "NONE",
  "body": "*Title*: *ext_authz does not send Body in CheckRequest with HTTP2*\r\n\r\n*Description*:\r\nEnvoy version: **v1.11.0**\r\n\r\nWe are using the **External Authorization plugin via GRPC** (using envoy grpc service) for auth purposes. Our External Auth node needs sometimes to check the body in the request so we are sending it using the '_with_request_body_' parameter in the plugin configuration. Unfortunatelly, the Body is not send in the CheckRequest message when using HTTP/2 protocol. Using HTTP/1.1 it works properly.\r\n\r\n*Repro steps*:\r\nSending this curl operation reproduces the issue:\r\n\r\n`curl --http2-prior-knowledge -X POST 10.96.38.246:8080/endpoint -d ' { \"field1\" : \"data1\", \"field2\" : \"data2\", \"field3\" : [ \"field3_1\" ] } ' -H \"Content-Type: application/json\" -i`\r\n\r\n*Config*:\r\nThis is the configuration we are using related to the Ext Auth:\r\n\r\n```\r\n\thttp_filters:\r\n\t  - name: envoy.ext_authz\r\n\t\tconfig:\r\n\t\t  grpc_service:\r\n\t\t\tenvoy_grpc:\r\n\t\t\t  cluster_name: authz-cluster\r\n\t\t\ttimeout: 3s\r\n\t\t  clear_route_cache: true\r\n\t\t  status_on_error:\r\n\t\t\tcode: InternalServerError\r\n\t\t  with_request_body:\r\n\t\t\tmax_request_bytes: 2048\r\n\t\t\tallow_partial_message: true\r\n\t  - name: envoy.router\r\n```\r\n\r\n*Logs*:\r\n\r\n```\r\n[2019-10-18 18:03:04.149][19][debug][main] [source/server/server.cc:170] flushing stats\r\n[2019-10-18 18:03:05.627][19][trace][upstream] [source/common/upstream/strict_dns_cluster.cc:89] starting async DNS resolution for localhost\r\n[2019-10-18 18:03:05.627][19][trace][upstream] [source/common/upstream/strict_dns_cluster.cc:96] async DNS resolution complete for localhost\r\n[2019-10-18 18:03:05.627][19][trace][upstream] [source/common/upstream/strict_dns_cluster.cc:89] starting async DNS resolution for localhost\r\n[2019-10-18 18:03:05.627][19][trace][upstream] [source/common/upstream/strict_dns_cluster.cc:96] async DNS resolution complete for localhost\r\n[2019-10-18 18:03:08.668][28][debug][main] [source/server/connection_handler_impl.cc:280] [C18] new connection\r\n[2019-10-18 18:03:08.668][28][trace][connection] [source/common/network/connection_impl.cc:456] [C18] socket event: 3\r\n[2019-10-18 18:03:08.668][28][trace][connection] [source/common/network/connection_impl.cc:541] [C18] write ready\r\n[2019-10-18 18:03:08.668][28][trace][connection] [source/common/network/connection_impl.cc:494] [C18] read ready\r\n[2019-10-18 18:03:08.668][28][trace][connection] [source/common/network/raw_buffer_socket.cc:23] [C18] read returns: 357\r\n[2019-10-18 18:03:08.668][28][trace][connection] [source/common/network/raw_buffer_socket.cc:37] [C18] read error: Resource temporarily unavailable\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: reset nghttp2_active_outbound_item\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: aob->item = (nil)\r\n[2019-10-18 18:03:08.669][28][debug][http2] [source/common/http/http2/codec_impl.cc:726] [C18] setting stream-level initial window size to 268435456\r\n[2019-10-18 18:03:08.669][28][debug][http2] [source/common/http/http2/codec_impl.cc:748] [C18] updating connection-level initial window size to 268435456\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/codec_impl.cc:343] [C18] dispatching 357 bytes\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: connection recv_window_size=0, local_window=268435456\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_FIRST_SETTINGS]\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEAD]\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: payloadlen=18, type=4, flags=0x00, stream_id=0\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: SETTINGS\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_SETTINGS]\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=6, payloadleft=12\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_SETTINGS]\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=6, payloadleft=6\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_SETTINGS]\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=6, payloadleft=0\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/codec_impl.cc:401] [C18] recv frame type=4\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEAD]\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: payloadlen=4, type=8, flags=0x00, stream_id=0\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: WINDOW_UPDATE\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_NBYTE]\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=4, payloadleft=0, left=0\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/codec_impl.cc:401] [C18] recv frame type=8\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEAD]\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: payloadlen=88, type=1, flags=0x04, stream_id=1\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: HEADERS\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: no padding in payload\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: dep_add dep_stream(0x4068020)=0, stream(0x3d2d860)=1\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept closed streams num_closed_streams=0, num_incoming_streams=1, max_concurrent_streams=4294967295\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: call on_begin_headers callback stream_id=1\r\n[2019-10-18 18:03:08.669][28][debug][http] [source/common/http/conn_manager_impl.cc:246] [C18] new stream\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEADER_BLOCK]\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=88, payloadleft=0\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: block final=1\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: decoding header block 88 bytes\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=1\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexed repr\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 3\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=3\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: :method: POST\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=1\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: literal header repr - indexed name\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexing required=0, no_index=0\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 4\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=4\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: huffman encoded=1\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 35\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: valuelen=35\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: 35 bytes read\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: :path: /endpoint\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=37\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.669][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexed repr\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 6\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=6\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: :scheme: http\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=1\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: literal header repr - indexed name\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexing required=1, no_index=0\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 1\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=1\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: huffman encoded=1\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 13\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: valuelen=13\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: 13 bytes read\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: :authority: 10.96.38.246:8080\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=15\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: literal header repr - indexed name\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexing required=1, no_index=0\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 58\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=58\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: huffman encoded=1\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 8\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: valuelen=8\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: 8 bytes read\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: user-agent: curl/7.58.0\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=10\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: literal header repr - indexed name\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexing required=1, no_index=0\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 19\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=19\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: huffman encoded=0\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 3\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: valuelen=3\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: 3 bytes read\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: accept: */*\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=5\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: literal header repr - indexed name\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexing required=1, no_index=0\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 31\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=31\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: huffman encoded=1\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 11\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: valuelen=11\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: 11 bytes read\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: content-type: application/json\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=13\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: literal header repr - indexed name\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexing required=0, no_index=0\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 28\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=28\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: huffman encoded=0\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 3\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: valuelen=3\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: 3 bytes read\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: content-length: 187\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=6\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: all input bytes were processed\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: in_final set\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=0\r\n[2019-10-18 18:03:08.670][28][trace][http2] [source/common/http/http2/codec_impl.cc:401] [C18] recv frame type=1\r\n[2019-10-18 18:03:08.671][28][debug][http] [source/common/http/conn_manager_impl.cc:600] [C18][S666307875404832439] request headers complete (end_stream=false):\r\n':method', 'POST'\r\n':path', '/endpoint'\r\n':scheme', 'http'\r\n':authority', '10.96.38.246:8080'\r\n'user-agent', 'curl/7.58.0'\r\n'accept', '*/*'\r\n'content-type', 'application/json'\r\n'content-length', '187'\r\n\r\n[2019-10-18 18:03:08.671][28][debug][filter] [source/extensions/filters/http/ext_authz/ext_authz.cc:87] [C18][S666307875404832439] ext_authz filter is buffering the request\r\n[2019-10-18 18:03:08.671][28][trace][http] [source/common/http/conn_manager_impl.cc:857] [C18][S666307875404832439] decode headers called: filter=0x409e820 status=1\r\n[2019-10-18 18:03:08.671][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEAD]\r\n[2019-10-18 18:03:08.671][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: payloadlen=187, type=0, flags=0x01, stream_id=1\r\n[2019-10-18 18:03:08.671][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: DATA\r\n[2019-10-18 18:03:08.671][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: no padding in payload\r\n[2019-10-18 18:03:08.671][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_DATA]\r\n[2019-10-18 18:03:08.671][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=187, payloadleft=0\r\n[2019-10-18 18:03:08.671][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: data_readlen=187\r\n[2019-10-18 18:03:08.671][28][trace][http2] [source/common/http/http2/codec_impl.cc:401] [C18] recv frame type=0\r\n[2019-10-18 18:03:08.671][28][debug][http] [source/common/http/conn_manager_impl.cc:1092] [C18][S666307875404832439] request end stream\r\n[2019-10-18 18:03:08.671][28][debug][filter] [source/extensions/filters/http/ext_authz/ext_authz.cc:105] [C18][S666307875404832439] ext_authz filter finished buffering the request since stream is ended\r\n[2019-10-18 18:03:08.672][28][trace][filter] [source/extensions/filters/http/ext_authz/ext_authz.cc:72] [C18][S666307875404832439] ext_authz filter calling authorization server\r\n[2019-10-18 18:03:08.672][28][debug][router] [source/common/router/router.cc:401] [C0][S9232815829273650332] cluster 'authz-cluster' match for URL '/envoy.service.auth.v2.Authorization/Check'\r\n[2019-10-18 18:03:08.673][28][debug][router] [source/common/router/router.cc:514] [C0][S9232815829273650332] router decoding headers:\r\n':method', 'POST'\r\n':path', '/envoy.service.auth.v2.Authorization/Check'\r\n':authority', 'authz-cluster'\r\n':scheme', 'http'\r\n'te', 'trailers'\r\n'grpc-timeout', '3000m'\r\n'content-type', 'application/grpc'\r\n'x-envoy-internal', 'true'\r\n'x-forwarded-for', '192.168.0.43'\r\n'x-envoy-expected-rq-timeout-ms', '3000'\r\n\r\n[2019-10-18 18:03:08.673][28][debug][pool] [source/common/http/http2/conn_pool.cc:96] [C8] creating stream\r\n[2019-10-18 18:03:08.674][28][debug][router] [source/common/router/router.cc:1503] [C0][S9232815829273650332] pool ready\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: dep_add dep_stream(0x4068a20)=0, stream(0x3d2d950)=3\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating :method: POST\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name/value match index=2\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indexed index=2, 1 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating :path: /envoy.service.auth.v2.Authorization/Check\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name match index=3\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indname index=3, valuelen=42, indexing_mode=1\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit string str=/envoy.service.auth.v2.Authorization/Check, length=42, huffman=1, encoded_length=30\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating :authority: udr-query-router\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name/value match index=67\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indexed index=67, 1 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating :scheme: http\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name/value match index=5\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indexed index=5, 1 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating te: trailers\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name/value match index=66\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indexed index=66, 1 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating grpc-timeout: 3000m\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name/value match index=65\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indexed index=65, 1 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating content-type: application/grpc\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name/value match index=64\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indexed index=64, 1 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating x-envoy-internal: true\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name/value match index=63\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indexed index=63, 1 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating x-forwarded-for: 192.168.0.43\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name/value match index=62\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indexed index=62, 1 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: deflating x-envoy-expected-rq-timeout-ms: 3000\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: name/value match index=61\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: emit indexed index=61, 1 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: deflatehd: all input name/value pairs were deflated\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: HEADERS/PUSH_PROMISE, payloadlen=41\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: before padding, HEADERS serialized in 50 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: padding selected: payloadlen=41, padlen=0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: padlen = 0, nothing to do\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: HEADERS finally serialized in 50 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: next frame: payloadlen=41, type=1, flags=0x04, stream_id=3\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: start transmitting frame type=1, length=50\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/codec_impl.cc:559] [C8] send data: bytes=50\r\n[2019-10-18 18:03:08.674][28][trace][connection] [source/common/network/connection_impl.cc:392] [C8] writing 50 bytes, end_stream false\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: end transmission of a frame\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/codec_impl.cc:511] [C8] sent frame type=1\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: stream=3 attach item=0x40be140\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: stream=3 obq push cycle=0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: push stream 3 to stream 0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: reset nghttp2_active_outbound_item\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: aob->item = 0x40be0a0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: remote windowsize connection=4194304, remote maxframsize=4194304, stream(id 3)=4194304\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: available window=16384\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: DATA postponed due to Data transfer deferred\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: stream=3 defer item=0x40be140 cause=08\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: remove stream 3 from stream 0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: reset nghttp2_active_outbound_item\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: aob->item = (nil)\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: frame transmission deferred\r\n[2019-10-18 18:03:08.674][28][trace][router] [source/common/router/router.cc:1403] [C0][S9232815829273650332] proxying 507 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: stream=3 resume item=0x40be140 flags=08\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: stream=3 obq push cycle=0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: push stream 3 to stream 0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: remote windowsize connection=4194304, remote maxframsize=4194304, stream(id 3)=4194304\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: available window=16384\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: padlen = 0, nothing to do\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: stream=3 obq resched cycle=8112\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: next frame: DATA\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: no copy DATA\r\n[2019-10-18 18:03:08.674][28][trace][connection] [source/common/network/connection_impl.cc:392] [C8] writing 516 bytes, end_stream false\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: stream=3 detach item=0x40be140\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: remove stream 3 from stream 0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/codec_impl.cc:511] [C8] sent frame type=0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: reset nghttp2_active_outbound_item\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: aob->item = 0x40be140\r\n[2019-10-18 18:03:08.674][28][trace][http] [source/common/http/conn_manager_impl.cc:982] [C18][S666307875404832439] decode data called: filter=0x409e820 status=2\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/codec_impl.cc:358] [C18] dispatched 357 bytes\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: next frame: payloadlen=6, type=4, flags=0x00, stream_id=0\r\n[2019-10-18 18:03:08.674][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: start transmitting frame type=4, length=15\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/codec_impl.cc:559] [C18] send data: bytes=15\r\n[2019-10-18 18:03:08.675][28][trace][connection] [source/common/network/connection_impl.cc:392] [C18] writing 15 bytes, end_stream false\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: end transmission of a frame\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/codec_impl.cc:511] [C18] sent frame type=4\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: reset nghttp2_active_outbound_item\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: aob->item = 0x3caef00\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: next frame: payloadlen=0, type=4, flags=0x01, stream_id=0\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: start transmitting frame type=4, length=9\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/codec_impl.cc:559] [C18] send data: bytes=9\r\n[2019-10-18 18:03:08.675][28][trace][connection] [source/common/network/connection_impl.cc:392] [C18] writing 9 bytes, end_stream false\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: end transmission of a frame\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/codec_impl.cc:511] [C18] sent frame type=4\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: reset nghttp2_active_outbound_item\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: aob->item = 0x40be3c0\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: next frame: payloadlen=4, type=8, flags=0x00, stream_id=0\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: start transmitting frame type=8, length=13\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/codec_impl.cc:559] [C18] send data: bytes=13\r\n[2019-10-18 18:03:08.675][28][trace][connection] [source/common/network/connection_impl.cc:392] [C18] writing 13 bytes, end_stream false\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: end transmission of a frame\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/codec_impl.cc:511] [C18] sent frame type=8\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: reset nghttp2_active_outbound_item\r\n[2019-10-18 18:03:08.675][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: send: aob->item = 0x3caf7c0\r\n[2019-10-18 18:03:08.675][28][trace][connection] [source/common/network/connection_impl.cc:456] [C8] socket event: 2\r\n[2019-10-18 18:03:08.675][28][trace][connection] [source/common/network/connection_impl.cc:541] [C8] write ready\r\n[2019-10-18 18:03:08.675][28][trace][connection] [source/common/network/raw_buffer_socket.cc:66] [C8] write returns: 566\r\n[2019-10-18 18:03:08.675][28][trace][connection] [source/common/network/connection_impl.cc:456] [C18] socket event: 2\r\n[2019-10-18 18:03:08.675][28][trace][connection] [source/common/network/connection_impl.cc:541] [C18] write ready\r\n[2019-10-18 18:03:08.676][28][trace][connection] [source/common/network/raw_buffer_socket.cc:66] [C18] write returns: 37\r\n[2019-10-18 18:03:08.676][28][trace][connection] [source/common/network/connection_impl.cc:456] [C18] socket event: 3\r\n[2019-10-18 18:03:08.676][28][trace][connection] [source/common/network/connection_impl.cc:541] [C18] write ready\r\n[2019-10-18 18:03:08.676][28][trace][connection] [source/common/network/connection_impl.cc:494] [C18] read ready\r\n[2019-10-18 18:03:08.676][28][trace][connection] [source/common/network/raw_buffer_socket.cc:23] [C18] read returns: 9\r\n[2019-10-18 18:03:08.676][28][trace][connection] [source/common/network/raw_buffer_socket.cc:37] [C18] read error: Resource temporarily unavailable\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/codec_impl.cc:343] [C18] dispatching 9 bytes\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: connection recv_window_size=187, local_window=268435456\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEAD]\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: payloadlen=0, type=4, flags=0x01, stream_id=0\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: SETTINGS\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_SETTINGS]\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=0, payloadleft=0\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/codec_impl.cc:401] [C18] recv frame type=4\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/codec_impl.cc:358] [C18] dispatched 9 bytes\r\n[2019-10-18 18:03:08.676][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.678][28][trace][connection] [source/common/network/connection_impl.cc:456] [C8] socket event: 3\r\n[2019-10-18 18:03:08.678][28][trace][connection] [source/common/network/connection_impl.cc:541] [C8] write ready\r\n[2019-10-18 18:03:08.679][28][trace][connection] [source/common/network/connection_impl.cc:494] [C8] read ready\r\n[2019-10-18 18:03:08.679][28][trace][connection] [source/common/network/raw_buffer_socket.cc:23] [C8] read returns: 151\r\n[2019-10-18 18:03:08.679][28][trace][connection] [source/common/network/raw_buffer_socket.cc:37] [C8] read error: Resource temporarily unavailable\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/codec_impl.cc:343] [C8] dispatching 151 bytes\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: connection recv_window_size=89, local_window=268435456\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: stream: adjusting kept idle streams num_idle_streams=0, max=100\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEAD]\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: payloadlen=4, type=1, flags=0x04, stream_id=3\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: HEADERS\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: no padding in payload\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: call on_begin_headers callback stream_id=3\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEADER_BLOCK]\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=4, payloadleft=0\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: block final=1\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: decoding header block 4 bytes\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=1\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexed repr\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 8\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=8\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: :status: 200\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=1\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexed repr\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 65\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=65\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: content-type: application/grpc\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=1\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexed repr\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 64\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=64\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: grpc-accept-encoding: identity,deflate,gzip\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=1\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexed repr\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 63\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=63\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: accept-encoding: identity,gzip\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=1\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: all input bytes were processed\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: in_final set\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=0\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/codec_impl.cc:401] [C8] recv frame type=1\r\n[2019-10-18 18:03:08.679][28][debug][router] [source/common/router/router.cc:994] [C0][S9232815829273650332] upstream headers complete: end_stream=false\r\n[2019-10-18 18:03:08.679][28][debug][http] [source/common/http/async_client_impl.cc:91] async http request response headers (end_stream=false):\r\n':status', '200'\r\n'content-type', 'application/grpc'\r\n'grpc-accept-encoding', 'identity,deflate,gzip'\r\n'accept-encoding', 'identity,gzip'\r\n'x-envoy-upstream-service-time', '4'\r\n\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEAD]\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: payloadlen=89, type=0, flags=0x00, stream_id=3\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: DATA\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: no padding in payload\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_DATA]\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=89, payloadleft=0\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: data_readlen=89\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/codec_impl.cc:401] [C8] recv frame type=0\r\n[2019-10-18 18:03:08.679][28][trace][http] [source/common/http/async_client_impl.cc:99] async http request response data (length=89 end_stream=false)\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEAD]\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: payloadlen=1, type=1, flags=0x05, stream_id=3\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: HEADERS\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: no padding in payload\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: call on_begin_headers callback stream_id=3\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: [IB_READ_HEADER_BLOCK]\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: readlen=1, payloadleft=0\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: block final=1\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: decoding header block 1 bytes\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=1\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: indexed repr\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: decoded integer is 62\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: index=62\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: header emission: grpc-status: 0\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=1\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: start state=2\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: all input bytes were processed\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: inflatehd: in_final set\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/nghttp2.cc:20] nghttp2: recv: proclen=0\r\n[2019-10-18 18:03:08.679][28][trace][http2] [source/common/http/http2/codec_impl.cc:401] [C8] recv frame type=1\r\n[2019-10-18 18:03:08.679][28][debug][client] [source/common/http/codec_client.cc:95] [C8] response complete\r\n[2019-10-18 18:03:08.679][28][trace][main] [source/common/event/dispatcher_impl.cc:158] item added to deferred deletion list (size=1)\r\n[2019-10-18 18:03:08.679][28][debug][pool] [source/common/http/http2/conn_pool.cc:233] [C8] destroying stream: 0 remaining\r\n[2019-10-18 18:03:08.679][28][debug][http] [source/common/http/async_client_impl.cc:106] async http request response trailers:\r\n'grpc-status', '0'\r\n\r\n[2019-10-18 18:03:08.680][28][trace][filter] [source/extensions/filters/http/ext_authz/ext_authz.cc:150] [C18][S666307875404832439] ext_authz filter added header(s) to the request:\r\n[2019-10-18 18:03:08.680][28][debug][filter] [source/extensions/filters/http/ext_authz/ext_authz.cc:153] [C18][S666307875404832439] ext_authz is clearing route cache\r\n[2019-10-18 18:03:08.680][28][trace][http] [source/common/http/conn_manager_impl.cc:1673] [C18][S666307875404832439] continuing filter chain: filter=0x409e820\r\n[2019-10-18 18:03:08.680][28][debug][router] [source/common/router/router.cc:401] [C18][S666307875404832439] cluster 'local' match for URL '/endpoint'\r\n[2019-10-18 18:03:08.680][28][debug][router] [source/common/router/router.cc:514] [C18][S666307875404832439] router decoding headers:\r\n':method', 'POST'\r\n':path', '/endpoint'\r\n':scheme', 'http'\r\n':authority', '10.96.38.246:8080'\r\n'user-agent', 'curl/7.58.0'\r\n'accept', '*/*'\r\n'content-type', 'application/json'\r\n'content-length', '187'\r\n'x-forwarded-proto', 'http'\r\n'x-request-id', 'ede00eed-a8aa-4c59-87db-74b7274dfdfd'\r\n'x-envoy-expected-rq-timeout-ms', '15000'\r\n\r\n```\r\nI modified the code a little (hope I did it in the proper place) to log what is the body received when creating the HTTP Request and it says the buffer is null when it should not (file **check_request_utils.cc**, method **CheckRequestUtils::setHttpRequest**):\r\n\r\n```\r\nvoid CheckRequestUtils::setHttpRequest(\r\n    ::envoy::service::auth::v2::AttributeContext_HttpRequest& httpreq,\r\n    const Envoy::Http::StreamDecoderFilterCallbacks* callbacks,\r\n    const Envoy::Http::HeaderMap& headers, uint64_t max_request_bytes) {\r\n\r\n[...]\r\n\r\n  // Set request body.\r\n  std::cout << \"MYLOG: set request body\" << std::endl;\r\n  const Buffer::Instance* buffer = sdfc->decodingBuffer();\r\n  if (max_request_bytes > 0 && buffer != nullptr) {\r\n    const uint64_t length = std::min(buffer->length(), max_request_bytes);\r\n    std::string data(length, 0);\r\n    buffer->copyOut(0, length, &data[0]);\r\n    std::cout << \"DATA: \" << data << << std::endl;\r\n    httpreq.set_body(std::move(data));\r\n\r\n    // Add in a header to detect when a partial body is used.\r\n    (*mutable_headers)[Http::Headers::get().EnvoyAuthPartialBody.get()] =\r\n        length != buffer->length() ? \"true\" : \"false\";\r\n  } else {\r\n    if (buffer == nullptr) {\r\n      std::cout << \"MYLOG: buffer is null\" << std::endl;\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThe result of the curl operation prints out this:\r\n```\r\nMYLOG: set request body\r\nMYLOG: buffer is null\r\n```\r\n\r\nBut executing with HTTP1.1:\r\n```\r\nMYLOG: set request body\r\nDATA:  { \"field1\" : \"data1\", \"field2\" : \"data2\", \"field3\" : [ \"field3_1\" ] } \r\n```\r\n\r\nHope this helps.\r\n\r\nThanks a lot for your great product!\r\n\\Mariano.",
  "closed_at": "2019-11-14T02:57:07Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/73152?v=4",
    "events_url": "https://api.github.com/users/dio/events{/privacy}",
    "followers_url": "https://api.github.com/users/dio/followers",
    "following_url": "https://api.github.com/users/dio/following{/other_user}",
    "gists_url": "https://api.github.com/users/dio/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dio",
    "id": 73152,
    "login": "dio",
    "node_id": "MDQ6VXNlcjczMTUy",
    "organizations_url": "https://api.github.com/users/dio/orgs",
    "received_events_url": "https://api.github.com/users/dio/received_events",
    "repos_url": "https://api.github.com/users/dio/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dio/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dio"
  },
  "comments": 7,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/8666/comments",
  "created_at": "2019-10-18T18:27:01Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/8666/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/8666",
  "id": 509243598,
  "labels": [
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/8666/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MDkyNDM1OTg=",
  "number": 8666,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "ext_authz does not send Body in CheckRequest with HTTP2",
  "updated_at": "2019-11-14T02:57:07Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/8666",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/36000879?v=4",
    "events_url": "https://api.github.com/users/kikogolk/events{/privacy}",
    "followers_url": "https://api.github.com/users/kikogolk/followers",
    "following_url": "https://api.github.com/users/kikogolk/following{/other_user}",
    "gists_url": "https://api.github.com/users/kikogolk/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/kikogolk",
    "id": 36000879,
    "login": "kikogolk",
    "node_id": "MDQ6VXNlcjM2MDAwODc5",
    "organizations_url": "https://api.github.com/users/kikogolk/orgs",
    "received_events_url": "https://api.github.com/users/kikogolk/received_events",
    "repos_url": "https://api.github.com/users/kikogolk/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/kikogolk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kikogolk/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/kikogolk"
  }
}