{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/53179?v=4",
    "events_url": "https://api.github.com/users/zuercher/events{/privacy}",
    "followers_url": "https://api.github.com/users/zuercher/followers",
    "following_url": "https://api.github.com/users/zuercher/following{/other_user}",
    "gists_url": "https://api.github.com/users/zuercher/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/zuercher",
    "id": 53179,
    "login": "zuercher",
    "node_id": "MDQ6VXNlcjUzMTc5",
    "organizations_url": "https://api.github.com/users/zuercher/orgs",
    "received_events_url": "https://api.github.com/users/zuercher/received_events",
    "repos_url": "https://api.github.com/users/zuercher/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/zuercher/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zuercher/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/zuercher"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/53179?v=4",
      "events_url": "https://api.github.com/users/zuercher/events{/privacy}",
      "followers_url": "https://api.github.com/users/zuercher/followers",
      "following_url": "https://api.github.com/users/zuercher/following{/other_user}",
      "gists_url": "https://api.github.com/users/zuercher/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/zuercher",
      "id": 53179,
      "login": "zuercher",
      "node_id": "MDQ6VXNlcjUzMTc5",
      "organizations_url": "https://api.github.com/users/zuercher/orgs",
      "received_events_url": "https://api.github.com/users/zuercher/received_events",
      "repos_url": "https://api.github.com/users/zuercher/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/zuercher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zuercher/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/zuercher"
    }
  ],
  "author_association": "MEMBER",
  "body": "One use case Turbine Labs has for Envoy is to be able to generate a response header that contains information about the upstream host that was selected. In particular, when subset load balancing is enabled in conjunction with weighted clusters, we want to use a response header to determine which version a host reports and send subsequent requests back to the same subset (via a different route).\r\n\r\nI propose to do the refactoring mentioned in [resp_header_parser.cc](https://github.com/turbinelabs/envoy/blob/master/source/common/router/resp_header_parser.cc#L27) and provide a syntax for selecting host metadata from `AccessLog::RequestInfo::upstreamHost`. Something like `%HOST_METADATA(\"namespace\", \"key\")%` (where namespace for my case is \"envoy.lb\" and key might be \"version\"). I think it's reasonable to allow an arbitrary number of keys (e.g. `%HOST_METADATA(\"namspace\", \"k1\", \"k2\", \"k3\")%` to handle nested structs. I think we should avoid using a syntax like `%HOST_METADATA(namespace.k1.k2)%` since the namespaces already have periods in them. Beyond that, I'm not tied to the proposed syntax. If someone has a simpler idea, I'm all ears.\r\n\r\nAn open question for me is how to handle metadata values that are not primitive types. One possibility is that only string/number/boolean can be rendered in headers. That sufficient for our use case, and I lean towards doing just that. Other possibilities include converting lists into  appended headers. That gets confusing when the response header is configured not to append. Finally, if the selected value is a struct or list we could render it as JSON, but that seems like a bit much for HTTP headers and is probably slow to boot.\r\n",
  "closed_at": "2017-12-13T20:47:46Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/53179?v=4",
    "events_url": "https://api.github.com/users/zuercher/events{/privacy}",
    "followers_url": "https://api.github.com/users/zuercher/followers",
    "following_url": "https://api.github.com/users/zuercher/following{/other_user}",
    "gists_url": "https://api.github.com/users/zuercher/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/zuercher",
    "id": 53179,
    "login": "zuercher",
    "node_id": "MDQ6VXNlcjUzMTc5",
    "organizations_url": "https://api.github.com/users/zuercher/orgs",
    "received_events_url": "https://api.github.com/users/zuercher/received_events",
    "repos_url": "https://api.github.com/users/zuercher/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/zuercher/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zuercher/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/zuercher"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2148/comments",
  "created_at": "2017-12-01T21:57:45Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2148/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/2148",
  "id": 278608681,
  "labels": [
    {
      "color": "84b6eb",
      "default": true,
      "description": "Feature requests. Not bugs or questions.",
      "id": 421403909,
      "name": "enhancement",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDk=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/enhancement"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/2148/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNzg2MDg2ODE=",
  "number": 2148,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "ability to generate response headers based on host metadata",
  "updated_at": "2017-12-13T20:47:46Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/2148",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/53179?v=4",
    "events_url": "https://api.github.com/users/zuercher/events{/privacy}",
    "followers_url": "https://api.github.com/users/zuercher/followers",
    "following_url": "https://api.github.com/users/zuercher/following{/other_user}",
    "gists_url": "https://api.github.com/users/zuercher/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/zuercher",
    "id": 53179,
    "login": "zuercher",
    "node_id": "MDQ6VXNlcjUzMTc5",
    "organizations_url": "https://api.github.com/users/zuercher/orgs",
    "received_events_url": "https://api.github.com/users/zuercher/received_events",
    "repos_url": "https://api.github.com/users/zuercher/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/zuercher/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zuercher/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/zuercher"
  }
}