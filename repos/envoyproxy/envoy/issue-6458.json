{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "The ClusterLoadAssignment documentation suggests the weights of the locality and endpoint are multiplied together to get the effective weight.\r\n\r\nhttps://github.com/envoyproxy/envoy/blob/fd273a65e03cb14cd46891c539b623f4126114f8/api/envoy/api/v2/eds.proto#L46-L48\r\n\r\nIn my tests, this doesn't seem to be the case. Here is my config:\r\n\r\n```json\r\n      \"common_lb_config\": {\r\n       \"locality_weighted_lb_config\": {}\r\n      },\r\n      \"load_assignment\": {\r\n       \"cluster_name\": \"outbound|80||google.com\",\r\n       \"endpoints\": [\r\n        {\r\n         \"locality\": {\r\n          \"region\": \"us-central3\",\r\n          \"zone\": \"us-central1-a\"\r\n         },\r\n         \"lb_endpoints\": [\r\n          {\r\n           \"endpoint\": {\r\n            \"address\": {\r\n             \"socket_address\": {\r\n              \"address\": \"identity-a\",\r\n              \"port_value\": 80\r\n             }\r\n            }\r\n           },\r\n           \"load_balancing_weight\": 1\r\n          },\r\n          {\r\n           \"endpoint\": {\r\n            \"address\": {\r\n             \"socket_address\": {\r\n              \"address\": \"identity-b\",\r\n              \"port_value\": 80\r\n             }\r\n            }\r\n           },\r\n           \"load_balancing_weight\": 1\r\n          }\r\n         ],\r\n         \"load_balancing_weight\": 2\r\n        },\r\n        {\r\n         \"locality\": {\r\n          \"region\": \"us-central2\",\r\n          \"zone\": \"us-central1-a\"\r\n         },\r\n         \"lb_endpoints\": [\r\n          {\r\n           \"endpoint\": {\r\n            \"address\": {\r\n             \"socket_address\": {\r\n              \"address\": \"identity-c\",\r\n              \"port_value\": 80\r\n             }\r\n            }\r\n           },\r\n           \"load_balancing_weight\": 1\r\n          }\r\n         ],\r\n         \"load_balancing_weight\": 1\r\n        }\r\n       ]\r\n      }\r\n ```\r\n\r\nBased on this, I would expect:\r\nidentity-a gets a weight of 2, so 40% of traffic\r\nidentity-b gets a weight of 2, so 40% of traffic\r\nidentity-c gets a weight of 1, so 20% of traffic\r\n\r\nI am actually seeing an even 33/33/33% split though.\r\n\r\nIs this a documentation issue or is something going wrong?",
  "closed_at": "2019-04-10T12:12:17Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/2023366?v=4",
    "events_url": "https://api.github.com/users/snowp/events{/privacy}",
    "followers_url": "https://api.github.com/users/snowp/followers",
    "following_url": "https://api.github.com/users/snowp/following{/other_user}",
    "gists_url": "https://api.github.com/users/snowp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/snowp",
    "id": 2023366,
    "login": "snowp",
    "node_id": "MDQ6VXNlcjIwMjMzNjY=",
    "organizations_url": "https://api.github.com/users/snowp/orgs",
    "received_events_url": "https://api.github.com/users/snowp/received_events",
    "repos_url": "https://api.github.com/users/snowp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/snowp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/snowp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/snowp"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6458/comments",
  "created_at": "2019-04-02T04:20:34Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6458/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/6458",
  "id": 428017323,
  "labels": [
    {
      "color": "b60205",
      "default": false,
      "description": "",
      "id": 446541096,
      "name": "area/docs",
      "node_id": "MDU6TGFiZWw0NDY1NDEwOTY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/area/docs"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6458/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MjgwMTczMjM=",
  "number": 6458,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "ClusterLoadAssignment load_balancing_weight with locality seems to behave differently than documentation",
  "updated_at": "2019-04-10T12:12:17Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/6458",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/623453?v=4",
    "events_url": "https://api.github.com/users/howardjohn/events{/privacy}",
    "followers_url": "https://api.github.com/users/howardjohn/followers",
    "following_url": "https://api.github.com/users/howardjohn/following{/other_user}",
    "gists_url": "https://api.github.com/users/howardjohn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/howardjohn",
    "id": 623453,
    "login": "howardjohn",
    "node_id": "MDQ6VXNlcjYyMzQ1Mw==",
    "organizations_url": "https://api.github.com/users/howardjohn/orgs",
    "received_events_url": "https://api.github.com/users/howardjohn/received_events",
    "repos_url": "https://api.github.com/users/howardjohn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/howardjohn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/howardjohn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/howardjohn"
  }
}