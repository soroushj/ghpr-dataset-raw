{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/3404311?v=4",
    "events_url": "https://api.github.com/users/bartebor/events{/privacy}",
    "followers_url": "https://api.github.com/users/bartebor/followers",
    "following_url": "https://api.github.com/users/bartebor/following{/other_user}",
    "gists_url": "https://api.github.com/users/bartebor/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bartebor",
    "id": 3404311,
    "login": "bartebor",
    "node_id": "MDQ6VXNlcjM0MDQzMTE=",
    "organizations_url": "https://api.github.com/users/bartebor/orgs",
    "received_events_url": "https://api.github.com/users/bartebor/received_events",
    "repos_url": "https://api.github.com/users/bartebor/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bartebor/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bartebor/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bartebor"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/3404311?v=4",
      "events_url": "https://api.github.com/users/bartebor/events{/privacy}",
      "followers_url": "https://api.github.com/users/bartebor/followers",
      "following_url": "https://api.github.com/users/bartebor/following{/other_user}",
      "gists_url": "https://api.github.com/users/bartebor/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/bartebor",
      "id": 3404311,
      "login": "bartebor",
      "node_id": "MDQ6VXNlcjM0MDQzMTE=",
      "organizations_url": "https://api.github.com/users/bartebor/orgs",
      "received_events_url": "https://api.github.com/users/bartebor/received_events",
      "repos_url": "https://api.github.com/users/bartebor/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/bartebor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bartebor/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/bartebor"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "I would like to have a way of modifying upstream request headers _including_ `host/:authority`.\r\nI can alter headers via `request_headers_to_add` or lua code, but changing `host/:authority` is done before virtual host matching and so it changes virtual host picked, or results in 404.\r\nI need virtual host to be picked using downstream request's `host/:authority` and only then alter headers sent to upstream.\r\n\r\nWhy do I need it: I would like to multiplex traffic from many services to envoy through single listener with one virtual host per service. Envoy is not aware of all domains (with possible subdomains) of these services, so I would substitute original host with known per service vhost name storing original host in some other header first. Envoy selects exact virtual hosts efficiently with a map and so I would like not to use wildcard domains, or long route chains matching custom headers.\r\n\r\nExample of traffic:\r\n```\r\nOriginal request      | Request from load balancer to Envoy         | Request from Envoy to upstream\r\n------------------------------------------------------------------------------------------------------\r\nHost: a.example.com   | Host: a,  X-Original-Host: a.example.com    | vhost a -> Host: a.example.com\r\nHost: b.example.com   | Host: b,  X-Original-Host: b.example.com    | vhost b -> Host: b.example.com\r\nHost: a.c.example.com | Host: c,  X-Original-Host: a.c.example.com  | vhost c -> Host: a.c.example.com\r\nHost: b.c.example.com | Host: c,  X-Original-Host: b.c.example.com  | vhost c -> Host: b.c.example.com\r\n```\r\nIs it possible?\r\n",
  "closed_at": "2019-05-19T02:15:44Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/in/1724?v=4",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/apps/stale",
    "id": 26384082,
    "login": "stale[bot]",
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "type": "Bot",
    "url": "https://api.github.com/users/stale%5Bbot%5D"
  },
  "comments": 14,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6486/comments",
  "created_at": "2019-04-05T14:17:09Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6486/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/6486",
  "id": 429778349,
  "labels": [
    {
      "color": "cc317c",
      "default": true,
      "description": "Questions that are neither investigations, bugs, nor enhancements",
      "id": 421403912,
      "name": "question",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MTI=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/question"
    },
    {
      "color": "bfd4f2",
      "default": false,
      "description": "stalebot believes this issue/PR has not been touched recently",
      "id": 867150379,
      "name": "stale",
      "node_id": "MDU6TGFiZWw4NjcxNTAzNzk=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/stale"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6486/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0Mjk3NzgzNDk=",
  "number": 6486,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Upstream request header modification",
  "updated_at": "2019-10-18T11:09:01Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/6486",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/3404311?v=4",
    "events_url": "https://api.github.com/users/bartebor/events{/privacy}",
    "followers_url": "https://api.github.com/users/bartebor/followers",
    "following_url": "https://api.github.com/users/bartebor/following{/other_user}",
    "gists_url": "https://api.github.com/users/bartebor/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bartebor",
    "id": 3404311,
    "login": "bartebor",
    "node_id": "MDQ6VXNlcjM0MDQzMTE=",
    "organizations_url": "https://api.github.com/users/bartebor/orgs",
    "received_events_url": "https://api.github.com/users/bartebor/received_events",
    "repos_url": "https://api.github.com/users/bartebor/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bartebor/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bartebor/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bartebor"
  }
}