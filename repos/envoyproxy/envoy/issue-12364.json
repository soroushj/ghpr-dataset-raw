{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    }
  ],
  "author_association": "NONE",
  "body": "Envoy segfaults for me when a dynamic listener fails to bind to a port (e.g. because another process is already bound to that port) and gRPC access logging is enabled for that listener. This is happening since at least Envoy 07fa5e0a43b489d907e402d0bcb0ff85d40f823a (Jan 15 2020) and continues today on master (f958d39fcd927603e15460870d36febd27156e05).\r\n\r\nI'm not sure if this is truly related to gRPC access logging, but I wasn't able to narrow down the cause further.\r\n\r\n*Repro steps*:\r\n\r\nThe smallest reproduction I can find is using the `envoy.yaml` and `listeners.yaml` posted here:\r\nhttps://gist.github.com/chriskuehl/a0672bd237216f5b339daa2980fc3f17\r\n\r\n1. Copy `envoy.yaml` and `listeners.yaml` from the gist.\r\n2. Start any process (not envoy) listening on port 25000. This will conflict with the dynamic listener from the config above and cause the segfault. For example you can run `nc -l -p 25000`.\r\n3. With the port still occupied, start Envoy with `envoy --config-path envoy.yaml`; the Envoy worker should segfault immediately upon start (see the gist for output logs).\r\n\r\nNote that the listener needs to be defined as a dynamic resource for this to happen. If you comment out the \"access_log\" settings from the listener's config and try starting Envoy, you will see an error about the port being unavailable, but no segfault.\r\n\r\nI tested this using the `envoyproxy/envoy-alpine-debug-dev` Docker image today with Envoy sha f958d39fcd927603e15460870d36febd27156e05 and linux kernel `4.4.0-1094-aws`.\r\n\r\n*Config*:\r\nhttps://gist.github.com/chriskuehl/a0672bd237216f5b339daa2980fc3f17\r\n\r\n*Logs*:\r\nhttps://gist.github.com/chriskuehl/a0672bd237216f5b339daa2980fc3f17\r\n\r\n*Call Stack*:\r\nUnfortunately I have not been able to get a backtrace to be printed.",
  "closed_at": "2020-09-30T15:09:21Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 13,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/12364/comments",
  "created_at": "2020-07-29T18:40:16Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/12364/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/12364",
  "id": 668058118,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "",
      "id": 1759143334,
      "name": "area/listener",
      "node_id": "MDU6TGFiZWwxNzU5MTQzMzM0",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/area/listener"
    },
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/12364/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2020-10-07T17:36:15Z",
    "closed_issues": 18,
    "created_at": "2020-06-17T04:25:52Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/15",
    "id": 5551270,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/15/labels",
    "node_id": "MDk6TWlsZXN0b25lNTU1MTI3MA==",
    "number": 15,
    "open_issues": 0,
    "state": "closed",
    "title": "1.16.0",
    "updated_at": "2020-10-07T17:36:15Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/15"
  },
  "node_id": "MDU6SXNzdWU2NjgwNTgxMTg=",
  "number": 12364,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Envoy segfaults when a dynamic listener fails to bind to a port and gRPC access logging is enabled",
  "updated_at": "2020-09-30T15:09:21Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/12364",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/665269?v=4",
    "events_url": "https://api.github.com/users/chriskuehl/events{/privacy}",
    "followers_url": "https://api.github.com/users/chriskuehl/followers",
    "following_url": "https://api.github.com/users/chriskuehl/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriskuehl/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/chriskuehl",
    "id": 665269,
    "login": "chriskuehl",
    "node_id": "MDQ6VXNlcjY2NTI2OQ==",
    "organizations_url": "https://api.github.com/users/chriskuehl/orgs",
    "received_events_url": "https://api.github.com/users/chriskuehl/received_events",
    "repos_url": "https://api.github.com/users/chriskuehl/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/chriskuehl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriskuehl/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/chriskuehl"
  }
}