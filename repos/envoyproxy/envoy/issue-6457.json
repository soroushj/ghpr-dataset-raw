{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "*Description*:\r\nThe latest Envoy documentation describes the expected behavior of how X-Envoy-Internal is decided.\r\n\r\nThe notes at the end of XFF section say this:\r\n\r\n> XFF is what Envoy uses to determine whether a request is internal origin or external origin. If use_remote_address is set to true, the request is internal if and only if the request contains no XFF and the immediate downstream node\u2019s connection to Envoy has an internal (RFC1918 or RFC4193) source address. If use_remote_address is false, the request is internal if and only if XFF contains a single RFC1918 or RFC4193 address.\r\n\r\nMy takeaway here is: when `use_remote_address=false` only the XFF header is used to decide if the request is internal or external. \r\n\r\nHowever, a few lines above this we have Example 5:\r\n\r\n> Example 5: Envoy as an internal proxy, receiving a request from an internal client\r\nSettings:\r\nuse_remote_address = false\r\nxff_num_trusted_hops = 0\r\nRequest details:\r\nDownstream IP address = 10.20.30.40 (address of the internal client)\r\nXFF is not present\r\nResult:\r\nTrusted client address = 10.20.30.40\r\nX-Envoy-External-Address remains unset\r\nX-Envoy-Internal is set to \u201ctrue\u201d\r\n\r\nThis example makes it seem like when `use_remote_address = false` and XFF is absent, the remote address will be used to determine that `X-Envoy-Internal` is set to \"true\".\r\n\r\nFrom my testing the first quote accurately describes the behavior and Example 5 is misleading/incorrect.\r\n\r\n*Relevant Links*:\r\nhttps://www.envoyproxy.io/docs/envoy/latest/configuration/http_conn_man/headers#config-http-conn-man-headers-x-forwarded-for\r\n\r\n",
  "closed_at": "2019-06-08T19:50:12Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6457/comments",
  "created_at": "2019-04-02T03:08:11Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6457/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/6457",
  "id": 428002248,
  "labels": [
    {
      "color": "b60205",
      "default": false,
      "description": "",
      "id": 446541096,
      "name": "area/docs",
      "node_id": "MDU6TGFiZWw0NDY1NDEwOTY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/area/docs"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/6457/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MjgwMDIyNDg=",
  "number": 6457,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "X-Envoy-Internal Documentation Inconsistent",
  "updated_at": "2019-06-08T19:50:12Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/6457",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/64924?v=4",
    "events_url": "https://api.github.com/users/dfjones/events{/privacy}",
    "followers_url": "https://api.github.com/users/dfjones/followers",
    "following_url": "https://api.github.com/users/dfjones/following{/other_user}",
    "gists_url": "https://api.github.com/users/dfjones/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dfjones",
    "id": 64924,
    "login": "dfjones",
    "node_id": "MDQ6VXNlcjY0OTI0",
    "organizations_url": "https://api.github.com/users/dfjones/orgs",
    "received_events_url": "https://api.github.com/users/dfjones/received_events",
    "repos_url": "https://api.github.com/users/dfjones/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dfjones/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dfjones/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dfjones"
  }
}