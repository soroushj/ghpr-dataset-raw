{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    }
  ],
  "author_association": "NONE",
  "body": "*Title*: *statsd sink not able to send metrics to UnixDomainSocket address if the statsd agent didn't start before envoy starts*\r\n\r\n*Description*:\r\n> Envoy unable to send metrics to statsd sink specifically dog_statsd sink configured with pipe path pointing to Unix Domain Socket if statsd agent(eg: Veneur) doesn't start before envoy.\r\n\r\n*Repro steps*:\r\n>  We run statsd agent, [Veneur](https://github.com/stripe/veneur)  as a sidecar to our edge envoy and we noticed that envoy stats are not being successfully sent to UDS (Unix Domain Socket) that veneur listens on if veneur starts after envoy starts or if veneur restarts. It works fine as long as envoy starts after veneur starts first and starts reading from UDS. I am attaching the failed and successful strace calls below. \r\n\r\nSuccessful:\r\n```\r\n strace -yy -fp 156194  2>&1 | grep sendto\r\n[pid 156194] sendto(76<UNIX:[404333076->404322827]>, \"edge-envoy.cluster.edge_https.up\"..., 90, MSG_DONTWAIT, NULL, 0) = 90\r\n[pid 156194] sendto(76<UNIX:[404333076->404322827]>, \"edge-envoy.cluster.edge_http.ups\"..., 89, MSG_DONTWAIT, NULL, 0) = 89\r\n[pid 156194] sendto(76<UNIX:[404333076->404322827]>, \"edge-envoy.downstream_cx_rx_byte\"..., 98, MSG_DONTWAIT, NULL, 0) = 98\r\n[pid 156194] sendto(76<UNIX:[404333076->404322827]>, \"edge-envoy.downstream_cx_tx_byte\"..., 99, MSG_DONTWAIT, NULL, 0) = 99\r\n[pid 156194] sendto(76<UNIX:[404333076->404322827]>, \"edge-envoy.downstream_rq:0|c|#ap\"..., 100, MSG_DONTWAIT, NULL, 0) = 100\r\n[pid 156194] sendto(76<UNIX:[404333076->404322827]>, \"edge-envoy.downstream_cx_total:1\"..., 88, MSG_DONTWAIT, NULL, 0) = 88\r\n[pid 156194] sendto(76<UNIX:[404\r\n```\r\nUnsuccessful:\r\n```\r\nstrace -yy -fp 160027 2>&1 | grep sendto\r\n\r\nnot connected)\r\n[pid 160027] sendto(76<UNIX:[662414141]>, \"edge-envoy.downstream_rq_active:\"..., 89, MSG_DONTWAIT, NULL, 0) = -1 ENOTCONN (Transport endpoint is not connected)\r\n[pid 160027] sendto(76<UNIX:[662414141]>, \"edge-envoy.downstream_cx_active:\"..., 89, MSG_DONTWAIT, NULL, 0) = -1 ENOTCONN (Transport endpoint is not connected)\r\n[pid 160027] sendto(76<UNIX:[662414141]>, \"edge-envoy.downstream_cx_active:\"..., 99, MSG_DONTWAIT, NULL, 0) = -1 ENOTCONN (Transport endpoint is not connected)\r\n[pid 160027] sendto(76<UNIX:[662414141]>, \"edge-envoy.server.live:1|g|#app:\"..., 58, MSG_DONTWAIT, NULL, 0) = -1 ENOTCONN (Transport endpoint is not connected)\r\n[pid 160027] sendto(76<UNIX:[662414141]>, \"edge-envoy.downstream_cx_active:\"..., 82, MSG_DONTWAIT, NULL, 0) = -1 ENOTCONN (Transport endpoint is not connected)\r\n[pid 160027] sendto(76<UNIX:[662414141]>, \"edge-envoy.downstream_rq_active:\"..., 82, MSG_DONTWAIT, NULL, 0) = -1 ENOTCONN (Transport endpoint is not connected)\r\n[pid 160027] sendto(76<UNIX:[662414141]>, \"edge-envoy.downstream_cx_active:\"..., 98, MSG_DONTWAIT, NULL, 0) = -1 ENOTCONN (Transport endpoint is not connected)\r\n[pid 160027] sendto(76<UNIX:[662414141]>, \"edge-envoy.downst\r\n```\r\nI think the issue might be due the fact we do [connect](https://github.com/envoyproxy/envoy/blob/v1.11.2/source/extensions/stat_sinks/common/statsd/statsd.cc#L27) even for Datagram type in UDS and also write using [send](https://github.com/envoyproxy/envoy/blob/v1.11.2/source/extensions/stat_sinks/common/statsd/statsd.cc#L38) which doesn't explicitly use the configured path under pipe config as the destination socket address instead in a call using [sendto](https://linux.die.net/man/2/sendto). This issue doesn't happen when using udp port as statsd sink address (ie: statsd agent listening on udp port)\r\n\r\n*Config*:\r\n> \r\n```\r\nstats_sinks:\r\n   - name: envoy.dog_statsd\r\n      config:\r\n        address:\r\n          pipe:\r\n            path: \"data/app/tmp/veneur.sock\"\r\n      prefix: edge-envoy\r\n```\r\n\r\n",
  "closed_at": "2020-02-06T17:01:17Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/8911/comments",
  "created_at": "2019-11-06T04:44:21Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/8911/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/8911",
  "id": 518233220,
  "labels": [
    {
      "color": "fef2c0",
      "default": false,
      "description": "",
      "id": 1717585891,
      "name": "area/stats",
      "node_id": "MDU6TGFiZWwxNzE3NTg1ODkx",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/area/stats"
    },
    {
      "color": "ee0701",
      "default": true,
      "description": null,
      "id": 421403907,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDc=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/bug"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/8911/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2020-04-08T18:48:51Z",
    "closed_issues": 45,
    "created_at": "2019-12-05T23:44:41Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/13",
    "id": 4907478,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/13/labels",
    "node_id": "MDk6TWlsZXN0b25lNDkwNzQ3OA==",
    "number": 13,
    "open_issues": 0,
    "state": "closed",
    "title": "1.14.0",
    "updated_at": "2020-04-08T18:48:51Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/13"
  },
  "node_id": "MDU6SXNzdWU1MTgyMzMyMjA=",
  "number": 8911,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Statsd sink unable to send metrics via UDS if statsd agent starts after envoy starts.",
  "updated_at": "2020-02-06T17:01:17Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/8911",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/48123?v=4",
    "events_url": "https://api.github.com/users/prudhvi/events{/privacy}",
    "followers_url": "https://api.github.com/users/prudhvi/followers",
    "following_url": "https://api.github.com/users/prudhvi/following{/other_user}",
    "gists_url": "https://api.github.com/users/prudhvi/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/prudhvi",
    "id": 48123,
    "login": "prudhvi",
    "node_id": "MDQ6VXNlcjQ4MTIz",
    "organizations_url": "https://api.github.com/users/prudhvi/orgs",
    "received_events_url": "https://api.github.com/users/prudhvi/received_events",
    "repos_url": "https://api.github.com/users/prudhvi/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/prudhvi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prudhvi/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/prudhvi"
  }
}