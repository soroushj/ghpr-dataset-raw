{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**Issues**\r\n* Currently health check failure events are only log if the HealthFlag for a host transition from non-FAILED_ACTIVE_HC to FAILED_ACTIVE_HC.  However, since hosts are initialized in the FAILED_ACTIVE_HC state, hosts that never became healthy have no events associated with it.\r\n* Since the current health check events only log transitions, we'll have to scan the entire log in order to find the hosts in a current failing state.  Then we'll still have to filter the hosts permanently removed from the cluster by the discovery service.  This makes the events very difficult to use in operations.\r\n\r\n**Proposed solution**\r\nBoth of these 2 issues can be solved by emitting a health check failure event if either of these conditions are true:\r\n* If the active health check failed and it's the first health check for a host.  This ensures we have events for hosts that never became healthy.\r\n* If the active health check failed and a AlwaysLogFailures configuration is set to true, by default this flag is set to false.  This makes it very easy to find the hosts currently failing by looking at the last few seconds of logs.\r\n\r\n**Event volumes**\r\nThe volume of health check failures in a production systems are typically very low.  \r\n\r\nWith a 1000 machine cluster, assuming 0.1% machines in the cluster is failing active health check, with a health check interval of 3s, this would generate 0.3 event/s.  In the case of complete cluster failure, this would generate 333 events/s.\r\n\r\nAlso note that this is an opt-in feature, the AlwaysLogFailures flag can be leave to the default value if excessive failure logging is a concern.\r\n\r\n@danielhochman @junr03 \r\n",
  "closed_at": "2018-11-15T04:33:26Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
    "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
    "followers_url": "https://api.github.com/users/mattklein123/followers",
    "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mattklein123",
    "id": 6305260,
    "login": "mattklein123",
    "node_id": "MDQ6VXNlcjYzMDUyNjA=",
    "organizations_url": "https://api.github.com/users/mattklein123/orgs",
    "received_events_url": "https://api.github.com/users/mattklein123/received_events",
    "repos_url": "https://api.github.com/users/mattklein123/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mattklein123"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/envoyproxy/envoy/issues/4942/comments",
  "created_at": "2018-11-01T21:54:49Z",
  "events_url": "https://api.github.com/repos/envoyproxy/envoy/issues/4942/events",
  "html_url": "https://github.com/envoyproxy/envoy/issues/4942",
  "id": 376586443,
  "labels": [
    {
      "color": "84b6eb",
      "default": true,
      "description": "Feature requests. Not bugs or questions.",
      "id": 421403909,
      "name": "enhancement",
      "node_id": "MDU6TGFiZWw0MjE0MDM5MDk=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/enhancement"
    },
    {
      "color": "fbca04",
      "default": true,
      "description": "Needs help!",
      "id": 645516726,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw2NDU1MTY3MjY=",
      "url": "https://api.github.com/repos/envoyproxy/envoy/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/envoyproxy/envoy/issues/4942/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-12-21T19:26:51Z",
    "closed_issues": 62,
    "created_at": "2018-09-21T05:26:05Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6305260?v=4",
      "events_url": "https://api.github.com/users/mattklein123/events{/privacy}",
      "followers_url": "https://api.github.com/users/mattklein123/followers",
      "following_url": "https://api.github.com/users/mattklein123/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattklein123/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mattklein123",
      "id": 6305260,
      "login": "mattklein123",
      "node_id": "MDQ6VXNlcjYzMDUyNjA=",
      "organizations_url": "https://api.github.com/users/mattklein123/orgs",
      "received_events_url": "https://api.github.com/users/mattklein123/received_events",
      "repos_url": "https://api.github.com/users/mattklein123/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mattklein123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattklein123/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mattklein123"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/envoyproxy/envoy/milestone/8",
    "id": 3676682,
    "labels_url": "https://api.github.com/repos/envoyproxy/envoy/milestones/8/labels",
    "node_id": "MDk6TWlsZXN0b25lMzY3NjY4Mg==",
    "number": 8,
    "open_issues": 0,
    "state": "closed",
    "title": "1.9.0",
    "updated_at": "2018-12-21T19:26:51Z",
    "url": "https://api.github.com/repos/envoyproxy/envoy/milestones/8"
  },
  "node_id": "MDU6SXNzdWUzNzY1ODY0NDM=",
  "number": 4942,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/envoyproxy/envoy",
  "state": "closed",
  "title": "Emit healthcheck failure events",
  "updated_at": "2018-11-15T04:33:26Z",
  "url": "https://api.github.com/repos/envoyproxy/envoy/issues/4942",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/4411287?v=4",
    "events_url": "https://api.github.com/users/HenryYYang/events{/privacy}",
    "followers_url": "https://api.github.com/users/HenryYYang/followers",
    "following_url": "https://api.github.com/users/HenryYYang/following{/other_user}",
    "gists_url": "https://api.github.com/users/HenryYYang/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/HenryYYang",
    "id": 4411287,
    "login": "HenryYYang",
    "node_id": "MDQ6VXNlcjQ0MTEyODc=",
    "organizations_url": "https://api.github.com/users/HenryYYang/orgs",
    "received_events_url": "https://api.github.com/users/HenryYYang/received_events",
    "repos_url": "https://api.github.com/users/HenryYYang/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/HenryYYang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/HenryYYang/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/HenryYYang"
  }
}