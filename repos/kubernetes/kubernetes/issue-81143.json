{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/5452977?v=4",
    "events_url": "https://api.github.com/users/pjbgf/events{/privacy}",
    "followers_url": "https://api.github.com/users/pjbgf/followers",
    "following_url": "https://api.github.com/users/pjbgf/following{/other_user}",
    "gists_url": "https://api.github.com/users/pjbgf/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/pjbgf",
    "id": 5452977,
    "login": "pjbgf",
    "node_id": "MDQ6VXNlcjU0NTI5Nzc=",
    "organizations_url": "https://api.github.com/users/pjbgf/orgs",
    "received_events_url": "https://api.github.com/users/pjbgf/received_events",
    "repos_url": "https://api.github.com/users/pjbgf/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/pjbgf/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pjbgf/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/pjbgf"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/5452977?v=4",
      "events_url": "https://api.github.com/users/pjbgf/events{/privacy}",
      "followers_url": "https://api.github.com/users/pjbgf/followers",
      "following_url": "https://api.github.com/users/pjbgf/following{/other_user}",
      "gists_url": "https://api.github.com/users/pjbgf/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/pjbgf",
      "id": 5452977,
      "login": "pjbgf",
      "node_id": "MDQ6VXNlcjU0NTI5Nzc=",
      "organizations_url": "https://api.github.com/users/pjbgf/orgs",
      "received_events_url": "https://api.github.com/users/pjbgf/received_events",
      "repos_url": "https://api.github.com/users/pjbgf/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/pjbgf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pjbgf/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/pjbgf"
    }
  ],
  "author_association": "MEMBER",
  "body": "This issue was reported in the [Kubernetes Security Audit Report](https://github.com/kubernetes/community/blob/master/wg-security-audit/findings/Kubernetes%20Final%20Report.pdf)\r\n\r\n**Description**\r\nKubernetes includes a linkcheck command, intended to check the correctness of links within Kubernetes documentation. The command uses the strconv.Atoi function to parse the Retry-After response header. However, the backoff value that is later used to wait between making another linkcheck attempt is updated only if strconv.Atoi returns an error. In other words, a valid value of Retry-After header value is not used by linkcheck:\r\n```\r\nif resp.StatusCode == http.StatusTooManyRequests {\r\n\tretryAfter := resp.Header.Get(\"Retry-After\")\r\n\tif seconds, err := strconv.Atoi(retryAfter); err != nil {\r\n\t\tbackoff = seconds + 10\r\n\t}\r\n\tfmt.Fprintf(os.Stderr, \"Got %d visiting %s, retry after %d seconds.\\n\", resp.StatusCode, string(URL), backoff)\r\n\ttime.Sleep(time.Duration(backoff) * time.Second)\r\n\tbackoff *= 2\r\n\tretry++\r\n```\r\nFigure 34.1: Retry-After header parsing in linkcheck command\r\n\r\nFurthermore, note that:\r\n\r\n1. strconv.Atoi uses strconv.ParseInt, which has edge cases for parser failures, which will return MAXINT for values too large and zero for values that fail to parse as integers.\r\n2. linkcheck does not set an explicit redirect policy via CheckRedirect, meaning that Go\u2019s core HTTP library will follow redirects. While linkcheck has a whitelist for URLs, redirects are not checked against the whitelist.\r\n3. The Retry-After response header is used only in the case of \u201cToo many Requests\u201d (HTTP status code 429). However, the Retry-After header may also be returned with both 301 (Redirect) and 503 (Service Unavailable) status codes as well. \r\n\r\n**Exploit Scenario**\r\nAlice wishes to build a copy of Kubernetes. Unbeknownst to Alice, Eve has inserted a link into the documentation that returns a redirect to a URL that was initially blocked by the linkcheck link regex whitelist.\r\n\r\n**Recommendation**\r\nShort term, use the retryAfter value and always include reasonable minimum and maximum values for all untrusted data. These should meet the roughly-expected timelines of an operation. For example, if a server responds with a Retry-After header that is longer than 1 minute, mark the link as inactive and continue on. Define a CheckRedirect policy for HTTP clients, and ensure that developers and end-users may control if they want redirects to be followed.\r\n\r\nLong term, ensure that all timeouts and similar operations have both a maximum and a minimum value. This will prevent events from happening more frequently than developers expect, or from taking too long under imperfect situations. Additionally, ensure that any code that relies on standards such as HTTP adequately follows the standard. \r\n\r\n**Anything else we need to know?**:\r\n\r\nSee #81146 for current status of all issues created from these findings.\r\n\r\nThe vendor gave this issue an ID of TOB-K8S-003 and it was finding 35 of the report.\r\n\r\nThe vendor considers this issue Informational Severity.\r\n\r\nTo view the original finding, begin on page 83 of the [Kubernetes Security Review Report](https://github.com/kubernetes/community/blob/master/wg-security-audit/findings/Kubernetes%20Final%20Report.pdf)\r\n\r\n**Environment**:\r\n\r\n- Kubernetes version: 1.13.4",
  "closed_at": "2020-07-01T09:54:17Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 8,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/81143/comments",
  "created_at": "2019-08-08T02:04:43Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/81143/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/81143",
  "id": 478214219,
  "labels": [
    {
      "color": "d93f0b",
      "default": false,
      "description": null,
      "id": 116712923,
      "name": "area/security",
      "node_id": "MDU6TGFiZWwxMTY3MTI5MjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/security"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d3e2f0",
      "default": false,
      "description": "Indicates that an issue or PR should not be auto-closed due to staleness.",
      "id": 778118403,
      "name": "lifecycle/frozen",
      "node_id": "MDU6TGFiZWw3NzgxMTg0MDM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/lifecycle/frozen"
    },
    {
      "color": "fbca04",
      "default": false,
      "description": "Higher priority than priority/awaiting-more-evidence.",
      "id": 114528273,
      "name": "priority/backlog",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyNzM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/backlog"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Release.",
      "id": 614023989,
      "name": "sig/release",
      "node_id": "MDU6TGFiZWw2MTQwMjM5ODk=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/release"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to WG Security Audit.",
      "id": 1086787146,
      "name": "wg/security-audit",
      "node_id": "MDU6TGFiZWwxMDg2Nzg3MTQ2",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/wg/security-audit"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/81143/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NzgyMTQyMTk=",
  "number": 81143,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "TOB-K8S-003: Incorrect handling of Retry-After ",
  "updated_at": "2020-07-01T09:54:18Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/81143",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/419708?v=4",
    "events_url": "https://api.github.com/users/cji/events{/privacy}",
    "followers_url": "https://api.github.com/users/cji/followers",
    "following_url": "https://api.github.com/users/cji/following{/other_user}",
    "gists_url": "https://api.github.com/users/cji/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/cji",
    "id": 419708,
    "login": "cji",
    "node_id": "MDQ6VXNlcjQxOTcwOA==",
    "organizations_url": "https://api.github.com/users/cji/orgs",
    "received_events_url": "https://api.github.com/users/cji/received_events",
    "repos_url": "https://api.github.com/users/cji/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/cji/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cji/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/cji"
  }
}