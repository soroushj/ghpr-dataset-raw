{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/354?v=4",
    "events_url": "https://api.github.com/users/ncdc/events{/privacy}",
    "followers_url": "https://api.github.com/users/ncdc/followers",
    "following_url": "https://api.github.com/users/ncdc/following{/other_user}",
    "gists_url": "https://api.github.com/users/ncdc/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ncdc",
    "id": 354,
    "login": "ncdc",
    "node_id": "MDQ6VXNlcjM1NA==",
    "organizations_url": "https://api.github.com/users/ncdc/orgs",
    "received_events_url": "https://api.github.com/users/ncdc/received_events",
    "repos_url": "https://api.github.com/users/ncdc/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ncdc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ncdc/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ncdc"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/354?v=4",
      "events_url": "https://api.github.com/users/ncdc/events{/privacy}",
      "followers_url": "https://api.github.com/users/ncdc/followers",
      "following_url": "https://api.github.com/users/ncdc/following{/other_user}",
      "gists_url": "https://api.github.com/users/ncdc/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/ncdc",
      "id": 354,
      "login": "ncdc",
      "node_id": "MDQ6VXNlcjM1NA==",
      "organizations_url": "https://api.github.com/users/ncdc/orgs",
      "received_events_url": "https://api.github.com/users/ncdc/received_events",
      "repos_url": "https://api.github.com/users/ncdc/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/ncdc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ncdc/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/ncdc"
    },
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/920884?v=4",
      "events_url": "https://api.github.com/users/hongchaodeng/events{/privacy}",
      "followers_url": "https://api.github.com/users/hongchaodeng/followers",
      "following_url": "https://api.github.com/users/hongchaodeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/hongchaodeng/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/hongchaodeng",
      "id": 920884,
      "login": "hongchaodeng",
      "node_id": "MDQ6VXNlcjkyMDg4NA==",
      "organizations_url": "https://api.github.com/users/hongchaodeng/orgs",
      "received_events_url": "https://api.github.com/users/hongchaodeng/received_events",
      "repos_url": "https://api.github.com/users/hongchaodeng/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/hongchaodeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hongchaodeng/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/hongchaodeng"
    },
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/4479947?v=4",
      "events_url": "https://api.github.com/users/xiang90/events{/privacy}",
      "followers_url": "https://api.github.com/users/xiang90/followers",
      "following_url": "https://api.github.com/users/xiang90/following{/other_user}",
      "gists_url": "https://api.github.com/users/xiang90/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/xiang90",
      "id": 4479947,
      "login": "xiang90",
      "node_id": "MDQ6VXNlcjQ0Nzk5NDc=",
      "organizations_url": "https://api.github.com/users/xiang90/orgs",
      "received_events_url": "https://api.github.com/users/xiang90/received_events",
      "repos_url": "https://api.github.com/users/xiang90/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/xiang90/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xiang90/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/xiang90"
    }
  ],
  "author_association": "MEMBER",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n\r\n**Is this a request for help?** (If yes, you should use our troubleshooting guide and community support channels, see http://kubernetes.io/docs/troubleshooting/.): No\r\n\r\n\r\n**What keywords did you search in Kubernetes issues before filing this one?** (If you have found any duplicates, you should instead reply there.): etcd watcher\r\n\r\n---\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?** (choose one): Bug report\r\n\r\n<!--\r\nIf this is a BUG REPORT, please:\r\n  - Fill in as much of the template below as you can.  If you leave out\r\n    information, we can't help you as well.\r\n\r\nIf this is a FEATURE REQUEST, please:\r\n  - Describe *in detail* the feature/behavior/change you'd like to see.\r\n\r\nIn both cases, be ready for followup questions, and please respond in a timely\r\nmanner.  If we can't reproduce a bug or think a feature already exists, we\r\nmight close your issue.  If we're wrong, PLEASE feel free to reopen it and\r\nexplain why.\r\n-->\r\n\r\n**Kubernetes version** (use `kubectl version`): HEAD / commit 8b5264e\r\n\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**: local VM\r\n- **OS** (e.g. from /etc/os-release): Fedora 24\r\n- **Kernel** (e.g. `uname -a`): Linux localhost.localdomain 4.7.7-200.fc24.x86_64 #1 SMP Sat Oct 8 00:21:59 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n- **Install tools**: N/A\r\n- **Others**: N/A\r\n\r\n\r\n**What happened**:\r\n\r\nIf you do a watch from resource version \"0\" using etcd_watcher.go (the etcd v2 client code), it initially performs a get of the key in question and returns Added or Modified events, based on a comparison of each node's createdIndex and modifiedIndex. This works all the time.\r\n\r\nIf you do a watch from resource version \"0\" using watcher.go (the etcd v3 client code), it attempts to get `kv.modifiedIndex - 1` for each kv returned, in an attempt to provide both the previous and current versions of each kv/object. This works as long as `kv.modifiedIndex - 1` has not been compacted. If compaction has occurred, the initial `sync()` will fail, and it's not possible to watch from \"0\"' for this particular key.\r\n\r\n**What you expected to happen**:\r\n\r\nEither:\r\n\r\n1. The v3 watcher should not change the behavior from the v2 watcher; namely, it should not attempt to get the previous revision of each object and instead just return the current version as a `watch.Added` event\r\n2. We agree that it's ok to change the behavior, and in the event that the database has been compacted and the previous revision of an object cannot be retrieved, that object is sent as a `watch.Added` event instead of `watch.Modified`.\r\n\r\n**How to reproduce it** (as minimally and precisely as possible): I'm working on a unit test and fix.\r\n\r\n\r\n**Anything else do we need to know**:\r\n\r\ncc @wojtek-t @hongchaodeng @xiang90 @smarterclayton @liggitt @deads2k @derekwaynecarr @sttts ",
  "closed_at": "2016-11-12T06:33:20Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 11,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36545/comments",
  "created_at": "2016-11-09T22:53:06Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36545/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/36545",
  "id": 188373776,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 136601536,
      "name": "area/apiserver",
      "node_id": "MDU6TGFiZWwxMzY2MDE1MzY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/apiserver"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG API Machinery.",
      "id": 173493835,
      "name": "sig/api-machinery",
      "node_id": "MDU6TGFiZWwxNzM0OTM4MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/api-machinery"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36545/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxODgzNzM3NzY=",
  "number": 36545,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Behavior change between etcd v2 and v3 watch clients",
  "updated_at": "2016-11-12T06:33:20Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36545",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/354?v=4",
    "events_url": "https://api.github.com/users/ncdc/events{/privacy}",
    "followers_url": "https://api.github.com/users/ncdc/followers",
    "following_url": "https://api.github.com/users/ncdc/following{/other_user}",
    "gists_url": "https://api.github.com/users/ncdc/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ncdc",
    "id": 354,
    "login": "ncdc",
    "node_id": "MDQ6VXNlcjM1NA==",
    "organizations_url": "https://api.github.com/users/ncdc/orgs",
    "received_events_url": "https://api.github.com/users/ncdc/received_events",
    "repos_url": "https://api.github.com/users/ncdc/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ncdc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ncdc/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ncdc"
  }
}