{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\nBUG REPORT\r\n\r\n> Uncomment only one, leave it on its own line: \r\n>\r\n/kind bug\r\n> /kind feature\r\n\r\n\r\n**What happened**:\r\nOccasionally our nodes stop reporting their status to apiserver, and get marked as NotReady. However, they remain connected to the apiserver and receive the update to delete all their pods - which they do.\r\n\r\n```\r\n  OutOfDisk \t\tUnknown \tThu, 28 Sep 2017 07:55:44 +0000 \tThu, 28 Sep 2017 07:57:04 +0000 \tNodeStatusUnknown \tKubelet stopped posting node status.\r\n  MemoryPressure \tUnknown \tThu, 28 Sep 2017 07:55:44 +0000 \tThu, 28 Sep 2017 07:57:04 +0000 \tNodeStatusUnknown \tKubelet stopped posting node status.\r\n  DiskPressure \t\tUnknown \tThu, 28 Sep 2017 07:55:44 +0000 \tThu, 28 Sep 2017 07:57:04 +0000 \tNodeStatusUnknown \tKubelet stopped posting node status.\r\n  Ready \t\tUnknown \tThu, 28 Sep 2017 07:55:44 +0000 \tThu, 28 Sep 2017 07:57:04 +0000 \tNodeStatusUnknown \tKubelet stopped posting node status.\r\n  KernelDeadlock \tFalse \t\tThu, 28 Sep 2017 07:58:38 +0000 \tWed, 27 Sep 2017 08:44:28 +0000 \tKernelHasNoDeadlock \tkernel has no deadlock\r\n```\r\n\r\nIn this example, the node last reported at 7:55:44.\r\n\r\nThis always seems to happen after I see these sort of log messages:\r\n```\r\nSep 28 07:57:54 ip-10-50-97-190 start-kubelet.sh[1748]: E0928 07:57:54.064121    1748 remote_runtime.go:163] ListPodSandbox with filter \"nil\" from runtime service failed: rpc error: code = 4 desc = context deadline exceeded\r\nSep 28 07:57:54 ip-10-50-97-190 start-kubelet.sh[1748]: E0928 07:57:54.064194    1748 kuberuntime_sandbox.go:185] ListPodSandbox failed: rpc error: code = 4 desc = context deadline exceeded\r\nSep 28 07:57:54 ip-10-50-97-190 start-kubelet.sh[1748]: E0928 07:57:54.064209    1748 generic.go:198] GenericPLEG: Unable to retrieve pods: rpc error: code = 4 desc = context deadline exceeded\r\nSep 28 07:57:54 ip-10-50-97-190 start-kubelet.sh[1748]: E0928 07:57:54.081115    1748 remote_runtime.go:163] ListPodSandbox with filter \"&PodSandboxFilter{Id:,State:&PodSandboxStateValue{State:SANDBOX_READY,},LabelSelector:map[string]string{},}\" from runtime service failed: rpc error: code = 4 desc = context deadline exceeded\r\nSep 28 07:57:54 ip-10-50-97-190 start-kubelet.sh[1748]: E0928 07:57:54.081169    1748 kuberuntime_sandbox.go:185] ListPodSandbox failed: rpc error: code = 4 desc = context deadline exceeded\r\nSep 28 07:57:54 ip-10-50-97-190 start-kubelet.sh[1748]: E0928 07:57:54.081187    1748 kubelet_pods.go:842] Error listing containers: &grpc.rpcError{code:0x4, desc:\"context deadline exceeded\"}\r\nSep 28 07:57:54 ip-10-50-97-190 start-kubelet.sh[1748]: E0928 07:57:54.081210    1748 kubelet.go:1886] Failed cleaning pods: rpc error: code = 4 desc = context deadline exceeded\r\n```\r\n\r\nWhich looks like the dockershim is timing out, maybe blocked on something.\r\n\r\nOddly, I never see these errors again in the kubelet logs - which indicates to me the PLEG loop continues to run successfully.\r\n\r\nHowever after this time, all heartbeats to the apiserver stop. This even happened on an apiserver node, where kubelet connects to the localhost. So it doesn't seem like a network issue to me.\r\n\r\nNext time this happens I'll try to capture a goroutine dump.\r\n\r\n**What you expected to happen**:\r\n\r\nEven if there is a temporary blip in the PLEG loop, kubelet should continue to send heartbeats, and then eventually go ready again.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nI've been unable to reproduce it yet - it happens quite infrequently.\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.6.9 / 1.7.10\r\n- Cloud provider or hardware configuration**:\r\n- OS (e.g. from /etc/os-release): Ubuntu 16.04.3\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools:\r\n- Others:\r\n",
  "closed_at": "2017-12-12T03:58:21Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 14,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53207/comments",
  "created_at": "2017-09-28T15:03:41Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53207/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/53207",
  "id": 261352171,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "ededed",
      "default": false,
      "description": null,
      "id": 680168330,
      "name": "milestone/needs-attention",
      "node_id": "MDU6TGFiZWw2ODAxNjgzMzA=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/milestone/needs-attention"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Highest priority. Must be actively worked on as someone's top priority right now.",
      "id": 114528068,
      "name": "priority/critical-urgent",
      "node_id": "MDU6TGFiZWwxMTQ1MjgwNjg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/critical-urgent"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53207/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:23:22Z",
    "closed_issues": 632,
    "created_at": "2017-03-30T14:12:39Z",
    "creator": {
      "avatar_url": "https://avatars1.githubusercontent.com/u/903617?v=4",
      "events_url": "https://api.github.com/users/mtaufen/events{/privacy}",
      "followers_url": "https://api.github.com/users/mtaufen/followers",
      "following_url": "https://api.github.com/users/mtaufen/following{/other_user}",
      "gists_url": "https://api.github.com/users/mtaufen/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mtaufen",
      "id": 903617,
      "login": "mtaufen",
      "node_id": "MDQ6VXNlcjkwMzYxNw==",
      "organizations_url": "https://api.github.com/users/mtaufen/orgs",
      "received_events_url": "https://api.github.com/users/mtaufen/received_events",
      "repos_url": "https://api.github.com/users/mtaufen/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mtaufen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mtaufen/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mtaufen"
    },
    "description": "",
    "due_on": "2017-12-13T08:00:00Z",
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/35",
    "id": 2422217,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/35/labels",
    "node_id": "MDk6TWlsZXN0b25lMjQyMjIxNw==",
    "number": 35,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.9",
    "updated_at": "2019-08-26T17:23:22Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/35"
  },
  "node_id": "MDU6SXNzdWUyNjEzNTIxNzE=",
  "number": 53207,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kubelet status updates wedging after failed CRI call",
  "updated_at": "2017-12-12T03:58:21Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53207",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/522123?v=4",
    "events_url": "https://api.github.com/users/jsravn/events{/privacy}",
    "followers_url": "https://api.github.com/users/jsravn/followers",
    "following_url": "https://api.github.com/users/jsravn/following{/other_user}",
    "gists_url": "https://api.github.com/users/jsravn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jsravn",
    "id": 522123,
    "login": "jsravn",
    "node_id": "MDQ6VXNlcjUyMjEyMw==",
    "organizations_url": "https://api.github.com/users/jsravn/orgs",
    "received_events_url": "https://api.github.com/users/jsravn/received_events",
    "repos_url": "https://api.github.com/users/jsravn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jsravn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jsravn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jsravn"
  }
}