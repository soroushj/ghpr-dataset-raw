{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind bug\r\n\r\n**What happened**:\r\n\r\nWhen TaintNodesByCondition is enabled, if a node lost connection to apiserver, node lifecycle manager doesn't add \"unreachable\" taint to the node.\r\nSo that results in scheduler still scheduled pods onto that \"lost\" node, in a Pending status.\r\n\r\n**What you expected to happen**:\r\n\r\nIf a node is lost, an \"unreachable\" taint should be added onto the node, so that new pods won't be scheduled onto the \"unreachable\" node.\r\nAnd if the node gets recovered, the taint should be removed. \r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n- enable TaintNodesByCondition - it's default behavior of current master branch\r\n- create a 1-node cluster\r\n- create a deployment with 10 replicas, and they landed on the only node with running status\r\n- SSH into the node and break connectivity to apiserver (`iptables --insert OUTPUT --destination <apiserver ip> --jump REJECT`)\r\n- wait for the node-1 to be NotReady (not that at this moment, the 10 pods are still running status, but internally the Ready condition is false, I guess it's node lifecycle manager modifying them when it's not getting heartbeat from kubelet within a time period)\r\n- then create node-2 and join the cluster\r\n- a few mins later, 5 pods were created with running status onto node-2, and 5 pods still get scheduled to node-1 with Pending status. And old 10 pods switches to Unknown status.\r\n\r\nIf I disable TaintNodesByCondition and repeat the whole process, result of last step above is different:\r\n\r\n- a few mins later, another 10 pods were created with running status onto node-2. And old 10 pods switches to Unknown status.\r\n\r\n**Anything else we need to know?**:\r\n\r\n#67536 might be another symptom due to the same bug.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): v1.12 (or v1.1x where TaintNodesByCondition is enabled manually)\r\n- Cloud provider or hardware configuration: kubeadm\r\n- OS (e.g. from /etc/os-release): Ubuntu 16.04\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools: kubeadm\r\n- Others:\r\n",
  "closed_at": "2018-08-28T05:18:12Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/67733/comments",
  "created_at": "2018-08-22T22:34:36Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/67733/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/67733",
  "id": 353150887,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/67733/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNTMxNTA4ODc=",
  "number": 67733,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "node wasn't tainted unreachable when TaintNodesByCondition is enabled",
  "updated_at": "2018-08-28T05:18:12Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/67733",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1425903?v=4",
    "events_url": "https://api.github.com/users/Huang-Wei/events{/privacy}",
    "followers_url": "https://api.github.com/users/Huang-Wei/followers",
    "following_url": "https://api.github.com/users/Huang-Wei/following{/other_user}",
    "gists_url": "https://api.github.com/users/Huang-Wei/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/Huang-Wei",
    "id": 1425903,
    "login": "Huang-Wei",
    "node_id": "MDQ6VXNlcjE0MjU5MDM=",
    "organizations_url": "https://api.github.com/users/Huang-Wei/orgs",
    "received_events_url": "https://api.github.com/users/Huang-Wei/received_events",
    "repos_url": "https://api.github.com/users/Huang-Wei/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/Huang-Wei/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Huang-Wei/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/Huang-Wei"
  }
}