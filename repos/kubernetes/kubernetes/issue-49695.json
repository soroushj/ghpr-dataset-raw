{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n> /kind bug\r\n\r\n**What happened**:\r\nI have two deployments with different names running the same image and sharing a label (they differ in replica count and some environment variables). I am trying to update both deployments with kubectl using the `--selector` flag instead of naming the deployment explicitly, and instead of getting the desired behavior I'm observing that only one deployment would be affected (the first one alphabetically, but that may be a coincidence)\r\n\r\n```\r\n$ kubectl set image \\\r\n\tdeployments \\\r\n\t--namespace=some-namespace \\\r\n\t--dry-run \\\r\n\t--selector app=worker \\\r\n\tworker=my/image:newtag\r\n\r\nNAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\r\nadd-stories-worker   1         1         1            1           3d\r\n```\r\n\r\nI've also tried `--all` instead of the `--selector` line, which also does not work. Substituting either worker name on that line has the expected result, but of course does not impact all of the deployments.\r\n\r\n**What you expected to happen**:\r\nAll of the deployments matching the label are affected by the command:\r\n```\r\nNAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\r\nadd-stories-worker   1         1         1            1           3d\r\npull-worker          3         3         3            3           3d\r\n```\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nCreate two deployments that are nearly identical:\r\n```yaml\r\napiVersion: apps/v1beta1\r\nkind: Deployment\r\nmetadata:\r\n  name: add-stories-worker\r\nspec:\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: worker\r\n    spec:\r\n      containers:\r\n        - image: nginx:1.13.2-alpine\r\n          name: worker\r\n---\r\napiVersion: apps/v1beta1\r\nkind: Deployment\r\nmetadata:\r\n  name: pull-worker\r\nspec:\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: worker\r\n    spec:\r\n      containers:\r\n        - image: nginx:1.13.2-alpine\r\n          name: worker\r\n```\r\nthen run the command noted above (remove the namespace line, or modify the above yaml to put the deployments in one), substituting a different image (e.g. `worker=nginx:1.13.3-alpine`) \r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\nClient Version: version.Info{Major:\"1\", Minor:\"6\", GitVersion:\"v1.6.6\", GitCommit:\"7fa1c1756d8bc963f1a389f4a6937dc71f08ada2\", GitTreeState:\"clean\", BuildDate:\"2017-06-16T18:34:20Z\", GoVersion:\"go1.7.6\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"7+\", GitVersion:\"v1.7.1-gke.0\", GitCommit:\"841411e511bfb1ccd78e76bf8633d4515061e18b\", GitTreeState:\"clean\", BuildDate:\"2017-07-14T17:52:01Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n- Cloud provider or hardware configuration**: GKE\r\n",
  "closed_at": "2017-08-25T17:10:13Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/49695/comments",
  "created_at": "2017-07-27T08:18:50Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/49695/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/49695",
  "id": 245961463,
  "labels": [
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG CLI.",
      "id": 450823910,
      "name": "sig/cli",
      "node_id": "MDU6TGFiZWw0NTA4MjM5MTA=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cli"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/49695/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNDU5NjE0NjM=",
  "number": 49695,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kubectl set image deployment is ignoring --selector",
  "updated_at": "2017-08-25T17:10:13Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/49695",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/354842?v=4",
    "events_url": "https://api.github.com/users/Firehed/events{/privacy}",
    "followers_url": "https://api.github.com/users/Firehed/followers",
    "following_url": "https://api.github.com/users/Firehed/following{/other_user}",
    "gists_url": "https://api.github.com/users/Firehed/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/Firehed",
    "id": 354842,
    "login": "Firehed",
    "node_id": "MDQ6VXNlcjM1NDg0Mg==",
    "organizations_url": "https://api.github.com/users/Firehed/orgs",
    "received_events_url": "https://api.github.com/users/Firehed/received_events",
    "repos_url": "https://api.github.com/users/Firehed/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/Firehed/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Firehed/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/Firehed"
  }
}