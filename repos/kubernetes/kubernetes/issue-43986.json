{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "This registry guide is probably outdated or nor sufficiently self-contained:\r\n\r\nhttps://github.com/kubernetes/kubernetes/blob/master/cluster/addons/registry/README.md\r\n\r\n**Kubernetes version**:\r\n\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"6\", GitVersion:\"v1.6.0\", GitCommit:\"fff5156092b56e6bd60fff75aad4dc9de6b6ef37\", GitTreeState:\"clean\", BuildDate:\"2017-03-28T16:36:33Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"6\", GitVersion:\"v1.6.0\", GitCommit:\"fff5156092b56e6bd60fff75aad4dc9de6b6ef37\", GitTreeState:\"clean\", BuildDate:\"2017-03-28T16:24:30Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\n**Environment**:\r\n- **OS**: Ubuntu 16.04.2 LTS (Xenial Xerus)\r\n- **Install**: `kubeadm init` and weave: https://github.com/weaveworks/weave/releases/download/latest_release/weave-daemonset-k8s-1.6.yaml\r\n\r\nThere are two nodes. I've followed the registry guide https://github.com/kubernetes/kubernetes/blob/master/cluster/addons/registry/README.md\r\n\r\nIt promises that at the end there will be a port on localhost of each node to access the registry.\r\n\r\nBut the `nmap -p 5050 localhost` on any node shows that it's closed on all nodes.\r\n\r\n\r\n**State**:\r\n```\r\n$ kubectl get pods\r\nNAME                        READY     STATUS    RESTARTS   AGE\r\nkube-registry-proxy-plx03   1/1       Running   0          15m\r\nkube-registry-v0-07b4g      1/1       Running   0          1h\r\n$ kubectl get service kube-registry\r\nNAME            CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\r\nkube-registry   10.107.139.82   <none>        5050/TCP   19m\r\n```\r\n\r\n**Config to reproduce:**\r\n```\r\napiVersion: v1\r\nkind: ReplicationController\r\nmetadata:\r\n  name: kube-registry-v0\r\n  namespace: default\r\n  labels:\r\n    k8s-app: kube-registry\r\n    version: v0\r\n    kubernetes.io/cluster-service: \"true\"\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    k8s-app: kube-registry\r\n    version: v0\r\n  template:\r\n    metadata:\r\n      labels:\r\n        k8s-app: kube-registry\r\n        version: v0\r\n        kubernetes.io/cluster-service: \"true\"\r\n    spec:\r\n      containers:\r\n      - name: registry\r\n        image: registry:2\r\n        resources:\r\n          limits:\r\n            cpu: 100m\r\n            memory: 100Mi\r\n        env:\r\n        - name: REGISTRY_HTTP_ADDR\r\n          value: :5050\r\n        - name: REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY\r\n          value: /var/lib/registry\r\n        volumeMounts:\r\n        - name: image-store\r\n          mountPath: /var/lib/registry\r\n        ports:\r\n        - containerPort: 5050\r\n          name: registry\r\n          protocol: TCP\r\n      volumes:\r\n      - name: image-store\r\n        emptyDir: {}\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: kube-registry\r\n  namespace: default\r\n  labels:\r\n    k8s-app: kube-registry\r\n    kubernetes.io/cluster-service: \"true\"\r\n    kubernetes.io/name: \"KubeRegistry\"\r\nspec:\r\n  selector:\r\n    k8s-app: kube-registry\r\n  ports:\r\n  - name: registry\r\n    port: 5050\r\n    protocol: TCP\r\napiVersion: extensions/v1beta1\r\nkind: DaemonSet\r\nmetadata:\r\n  name: kube-registry-proxy\r\n  namespace: default\r\n  labels:\r\n    k8s-app: kube-registry\r\n    kubernetes.io/cluster-service: \"true\"\r\n    version: v0.4\r\nspec:\r\n  template:\r\n    metadata:\r\n      labels:\r\n        k8s-app: kube-registry\r\n        kubernetes.io/name: \"kube-registry-proxy\"\r\n        kubernetes.io/cluster-service: \"true\"\r\n        version: v0.4\r\n    spec:\r\n      containers:\r\n      - name: kube-registry-proxy\r\n        image: gcr.io/google_containers/kube-registry-proxy:0.4\r\n        resources:\r\n          limits:\r\n            cpu: 100m\r\n            memory: 50Mi\r\n        env:\r\n        - name: REGISTRY_HOST\r\n          value: kube-registry.default.svc.cluster.local\r\n        - name: REGISTRY_PORT\r\n          value: \"5050\"\r\n        ports:\r\n        - name: registry\r\n          containerPort: 80\r\n          hostPort: 5050\r\n```\r\n",
  "closed_at": "2017-04-19T08:49:20Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43986/comments",
  "created_at": "2017-04-03T15:12:36Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43986/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/43986",
  "id": 218966286,
  "labels": [],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43986/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMTg5NjYyODY=",
  "number": 43986,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Docker registry addon produces a non-functional proxy foor the registry",
  "updated_at": "2017-04-19T08:49:20Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43986",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5393579?v=4",
    "events_url": "https://api.github.com/users/ChipmunkV/events{/privacy}",
    "followers_url": "https://api.github.com/users/ChipmunkV/followers",
    "following_url": "https://api.github.com/users/ChipmunkV/following{/other_user}",
    "gists_url": "https://api.github.com/users/ChipmunkV/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ChipmunkV",
    "id": 5393579,
    "login": "ChipmunkV",
    "node_id": "MDQ6VXNlcjUzOTM1Nzk=",
    "organizations_url": "https://api.github.com/users/ChipmunkV/orgs",
    "received_events_url": "https://api.github.com/users/ChipmunkV/received_events",
    "repos_url": "https://api.github.com/users/ChipmunkV/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ChipmunkV/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ChipmunkV/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ChipmunkV"
  }
}