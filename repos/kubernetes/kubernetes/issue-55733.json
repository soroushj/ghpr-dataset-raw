{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\nBug Report\r\n> Uncomment only one, leave it on its own line: \r\n>\r\n> /kind bug\r\n\r\n\r\n**What happened**:\r\nIn Kubernetes 1.8, I cherry picked [this](https://github.com/kubernetes/kubernetes/pull/54177) which correctly sets destination IP with corresponding front end ip in nsg rule when creating service. Kubernetes, however, does not automatically update already existing nsg rules by setting correct destination IP.\r\n\r\nThe fix can be done in `findSecurityRule` in `azure_loadbalancer.go` to not only check rule.Name, but also to check other properties: Portocol, SourcePortRange, DestinationPortRange, SourceAddressPrefix, DestinationAddressPrefix, etc.  If any of these doesn't match, it should drop the rule and add the new rule. (I will create PR shortly and refer to this issue)\r\n\r\n**What you expected to happen**:\r\nFor existing nsg rules for services, Kubernetes should update each nsg rules to have correct destination IP instead of already existing Any as destination. \r\n\r\nAlso if I manually make change to nsg rule, for example to have random destination port different from what's specified in service definition, Kubernetes should detect the difference and automatically update it back to what's specified in service.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nGo to Azure portal and manually change a nsg rule's any specification. ex) change destination Port. And then realize Kubernetes does not automatically fix it.\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): v1.8.2\r\n- Cloud provider or hardware configuration: Azure\r\n- OS (e.g. from /etc/os-release): \r\n```\r\nNAME=\"Container Linux by CoreOS\"\r\nID=coreos\r\nVERSION=1548.4.0\r\nVERSION_ID=1548.4.0\r\nBUILD_ID=2017-10-26-0356\r\nPRETTY_NAME=\"Container Linux by CoreOS 1548.4.0 (Ladybug)\"\r\nANSI_COLOR=\"38;5;75\"\r\nHOME_URL=\"https://coreos.com/\"\r\nBUG_REPORT_URL=\"https://issues.coreos.com\"\r\nCOREOS_BOARD=\"amd64-usr\"\r\n```\r\n`- Kernel (e.g. `uname -a`): Linux master 4.13.9-coreos #1 SMP Thu Oct 26 03:35:38 UTC 2017 x86_64 Intel(R) Xeon(R) CPU E5-2673 v3 @ 2.40GHz GenuineIntel GNU/Linux`\r\n\r\n\r\n/sig azure",
  "closed_at": "2017-11-22T01:57:32Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/55733/comments",
  "created_at": "2017-11-14T22:07:48Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/55733/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/55733",
  "id": 273960789,
  "labels": [],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/55733/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNzM5NjA3ODk=",
  "number": 55733,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Azure loadbalancer should reconcile security groups properly. (not just by name, but also by other properties)",
  "updated_at": "2017-11-22T01:57:32Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/55733",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/6677811?v=4",
    "events_url": "https://api.github.com/users/kevinkim9264/events{/privacy}",
    "followers_url": "https://api.github.com/users/kevinkim9264/followers",
    "following_url": "https://api.github.com/users/kevinkim9264/following{/other_user}",
    "gists_url": "https://api.github.com/users/kevinkim9264/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/kevinkim9264",
    "id": 6677811,
    "login": "kevinkim9264",
    "node_id": "MDQ6VXNlcjY2Nzc4MTE=",
    "organizations_url": "https://api.github.com/users/kevinkim9264/orgs",
    "received_events_url": "https://api.github.com/users/kevinkim9264/received_events",
    "repos_url": "https://api.github.com/users/kevinkim9264/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/kevinkim9264/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kevinkim9264/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/kevinkim9264"
  }
}