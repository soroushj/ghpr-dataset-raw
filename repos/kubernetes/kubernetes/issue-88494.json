{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
    "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
    "followers_url": "https://api.github.com/users/liggitt/followers",
    "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
    "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/liggitt",
    "id": 980082,
    "login": "liggitt",
    "node_id": "MDQ6VXNlcjk4MDA4Mg==",
    "organizations_url": "https://api.github.com/users/liggitt/orgs",
    "received_events_url": "https://api.github.com/users/liggitt/received_events",
    "repos_url": "https://api.github.com/users/liggitt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/liggitt"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
      "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
      "followers_url": "https://api.github.com/users/liggitt/followers",
      "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
      "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/liggitt",
      "id": 980082,
      "login": "liggitt",
      "node_id": "MDQ6VXNlcjk4MDA4Mg==",
      "organizations_url": "https://api.github.com/users/liggitt/orgs",
      "received_events_url": "https://api.github.com/users/liggitt/received_events",
      "repos_url": "https://api.github.com/users/liggitt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/liggitt"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**What happened**:\r\n\r\nThe cluster master in a Kubernetes v1.14.10 cluster was upgraded to V1.16.7.  The process of upgrading nodes is under way and has been spread over a week so far.  The cluster owner reported seeing a high percentage of pod status PATCH failures.  The apiserver logs show errors like:\r\n```\r\nI0223 20:40:57.482215       1 httplog.go:90] PATCH /api/v1/namespaces/cache-images-2-10-2/pods/dashdb-daemonset-s4crw/status: (8.261945ms) 500\r\n...\r\nlogging error output: \"k8s\\x00\\n\\f\\n\\x02v1\\x12\\x06Status\\x12b\\n\\x06\\n\\x00\\x12\\x00\\x1a\\x00\\x12\\aFailure\\x1aJconversion Error: v1.PodIP(172.30.147.226) != v1.PodIPs[0](172.30.147.223)\\\"\\x000\\xf4\\x03\\x1a\\x00\\\"\\x00\"\r\n [hyperkube/v1.14.5+IKS (linux/amd64) kubernetes/7bc6122 172.16.25.64:65323]\r\n```\r\n\r\nThe errors are all from the v1.14 nodes and have all been for pods associated with DaemonSets.\r\n\r\nWe don't yet know why pods' IPs are changing, but it appears that pod status patches that include a changed `PodIP` result in an object where `PodIPs[]` contains the old IP, and `podIP` has the new IP. We believe this is because `PodIPs[]` was introduced in Kubernetes v1.15 and the patch request from a v1.14 node results in both `PodIP=new IP` and `PodIPs = [old IP]` being present in the result.\r\n\r\nIf you aren't monitoring for request failures it may not obvious that any error is occurring: The pods continue to show their last successfully reported state.  Deleting such pods, however, results in the pod being stuck in a `Terminating` state.\r\n\r\nWe are only seeing this for DaemonSet pods - I suspect because whatever resulted in pod IPs changing also causes non-DaemonSet pods to be deleted and recreated.\r\n\r\nWe have a number of cluster still on v1.14 that we expect to upgrade to v1.15 or v1.16.\r\n\r\n**What you expected to happen**:\r\n\r\nKubernetes v1.14 nodes should be able to update pod status during the transition from v1.14 to v1.16 even if pod IPs change during that time.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nWe have recreated this in the IBM Cloud Kubernetes Service by \"reloading\" nodes.  The reload process leaves the Kubernetes node object in place, and essentially reloads the image with the proper kubeconfig to rejoin the cluster.  The cluster I was debugging does not appear to have had nodes \"reloaded\" - something else is triggering the pod IP changes.\r\n\r\n- Create a v1.14 cluster\r\n- Deploy a DaemonSet (anything with pod networking should suffice)\r\n- Upgrade cluster master to v1.16\r\n- Reload a v1.14 node.\r\n\r\nOne the node is back up, `crictl inspectp` shows the pod's network IP has changed.  Kubelet and apiserver logs show the errors describe earlier.\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): v1.14.x (nodes) and v1.16.7 (master)\r\n- Cloud provider or hardware configuration: IBM Cloud Kubernetes Service\r\n- OS (e.g: `cat /etc/os-release`): 18.04.4 LTS\r\n- Kernel (e.g. `uname -a`): 4.15.0-76-generic\r\n- Install tools:\r\n- Network plugin and version (if this is a network-related bug):\r\n- Others:\r\n",
  "closed_at": "2020-03-03T00:16:37Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 6,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/88494/comments",
  "created_at": "2020-02-24T22:15:49Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/88494/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/88494",
  "id": 570181101,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Highest priority. Must be actively worked on as someone's top priority right now.",
      "id": 114528068,
      "name": "priority/critical-urgent",
      "node_id": "MDU6TGFiZWwxMTQ1MjgwNjg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/critical-urgent"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    },
    {
      "color": "d455d0",
      "default": false,
      "description": "Indicates an issue that can not or will not be resolved.",
      "id": 862108765,
      "name": "triage/unresolved",
      "node_id": "MDU6TGFiZWw4NjIxMDg3NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/triage/unresolved"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/88494/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1NzAxODExMDE=",
  "number": 88494,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Daemonset pod status PATCH errors after upgrading cluster from 1.14 to 1.16",
  "updated_at": "2020-03-03T00:16:37Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/88494",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/11507505?v=4",
    "events_url": "https://api.github.com/users/jmcmeek/events{/privacy}",
    "followers_url": "https://api.github.com/users/jmcmeek/followers",
    "following_url": "https://api.github.com/users/jmcmeek/following{/other_user}",
    "gists_url": "https://api.github.com/users/jmcmeek/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jmcmeek",
    "id": 11507505,
    "login": "jmcmeek",
    "node_id": "MDQ6VXNlcjExNTA3NTA1",
    "organizations_url": "https://api.github.com/users/jmcmeek/orgs",
    "received_events_url": "https://api.github.com/users/jmcmeek/received_events",
    "repos_url": "https://api.github.com/users/jmcmeek/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jmcmeek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jmcmeek/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jmcmeek"
  }
}