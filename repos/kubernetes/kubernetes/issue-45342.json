{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1703842?v=4",
    "events_url": "https://api.github.com/users/gmarek/events{/privacy}",
    "followers_url": "https://api.github.com/users/gmarek/followers",
    "following_url": "https://api.github.com/users/gmarek/following{/other_user}",
    "gists_url": "https://api.github.com/users/gmarek/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/gmarek",
    "id": 1703842,
    "login": "gmarek",
    "node_id": "MDQ6VXNlcjE3MDM4NDI=",
    "organizations_url": "https://api.github.com/users/gmarek/orgs",
    "received_events_url": "https://api.github.com/users/gmarek/received_events",
    "repos_url": "https://api.github.com/users/gmarek/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/gmarek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gmarek/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/gmarek"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/1703842?v=4",
      "events_url": "https://api.github.com/users/gmarek/events{/privacy}",
      "followers_url": "https://api.github.com/users/gmarek/followers",
      "following_url": "https://api.github.com/users/gmarek/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmarek/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/gmarek",
      "id": 1703842,
      "login": "gmarek",
      "node_id": "MDQ6VXNlcjE3MDM4NDI=",
      "organizations_url": "https://api.github.com/users/gmarek/orgs",
      "received_events_url": "https://api.github.com/users/gmarek/received_events",
      "repos_url": "https://api.github.com/users/gmarek/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/gmarek/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmarek/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/gmarek"
    }
  ],
  "author_association": "MEMBER",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n\r\n**Is this a request for help?** (If yes, you should use our troubleshooting guide and community support channels, see http://kubernetes.io/docs/troubleshooting/.):\r\n\r\n\r\n**What keywords did you search in Kubernetes issues before filing this one?** (If you have found any duplicates, you should instead reply there.):\r\n\r\n---\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?** (choose one):\r\n\r\n<!--\r\nIf this is a BUG REPORT, please:\r\n  - Fill in as much of the template below as you can.  If you leave out\r\n    information, we can't help you as well.\r\n\r\nIf this is a FEATURE REQUEST, please:\r\n  - Describe *in detail* the feature/behavior/change you'd like to see.\r\n\r\nIn both cases, be ready for followup questions, and please respond in a timely\r\nmanner.  If we can't reproduce a bug or think a feature already exists, we\r\nmight close your issue.  If we're wrong, PLEASE feel free to reopen it and\r\nexplain why.\r\n-->\r\n\r\n**Kubernetes version** (use `kubectl version`):\r\nHEAD\r\n\r\n```\r\nroot@k8s001:~/cases/taint# kubectl version\r\nClient Version: version.Info{Major:\"1\", Minor:\"7+\", GitVersion:\"v1.7.0-alpha.2.718+3b8aac9b22f862\", GitCommit:\"3b8aac9b22f86288ebc40073c8705bd9d4484c33\", GitTreeState:\"clean\", BuildDate:\"2017-05-04T09:14:20Z\", GoVersion:\"go1.8.1\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"7+\", GitVersion:\"v1.7.0-alpha.2.718+3b8aac9b22f862\", GitCommit:\"3b8aac9b22f86288ebc40073c8705bd9d4484c33\", GitTreeState:\"clean\", BuildDate:\"2017-05-04T09:14:20Z\", GoVersion:\"go1.8.1\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**:\r\n- **OS** (e.g. from /etc/os-release):\r\n- **Kernel** (e.g. `uname -a`):\r\n- **Install tools**:\r\n- **Others**:\r\n```\r\nroot@k8s001:~/cases/taint# kubectl get nodes -owide\r\nNAME      STATUS    AGE       VERSION                             EXTERNAL-IP   OS-IMAGE           KERNEL-VERSION\r\nk8s001    Ready     28d       v1.7.0-alpha.2.718+3b8aac9b22f862   <none>        Ubuntu 16.04 LTS   4.4.0-72-generic\r\nk8s004    Ready     28d       v1.7.0-alpha.2.718+3b8aac9b22f862   <none>        Ubuntu 16.04 LTS   4.4.0-75-generic\r\n```\r\n\r\n**What happened**:\r\n1) Enable `TaintBasedEvictions`\r\n\r\n```\r\n/opt/bin/kube-controller-manager --logtostderr=false --log-dir=/var/log/kubernetes --v=4 --master=http://192.168.56.11:8080 --cluster-name=kubernetes --root-ca-file=/srv/kubernetes/ca.crt --service-account-private-key-file=/srv/kubernetes/server.key --feature-gates=TaintBasedEvictions=true\r\n```\r\n\r\n2) Create a pod.\r\n\r\npod yaml\r\n```\r\napiVersion: extensions/v1beta1\r\nkind: Deployment\r\nmetadata:\r\n  labels:\r\n    run: my-nginx\r\n  name: my-nginx\r\n  namespace: default\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      run: my-nginx\r\n  template:\r\n    metadata:\r\n      labels:\r\n        run: my-nginx\r\n    spec:\r\n      containers:\r\n      - image: nginx:1.8.1\r\n        imagePullPolicy: IfNotPresent\r\n        name: my-nginx\r\n        ports:\r\n        - containerPort: 80\r\n          protocol: TCP\r\n```\r\n\r\nAfter deploy, it is running on `k8s004`\r\n```\r\nroot@k8s001:~/cases/taint# kubectl get pods -owide\r\nNAME                        READY     STATUS    RESTARTS   AGE       IP                NODE\r\nmy-nginx-1257052682-lkjpq   1/1       Running   0          6m        192.168.124.147   k8s004\r\n```\r\n\r\n3) Add taint to `k8s004`\r\n\r\n```\r\nkubectl taint nodes k8s004 x=y:NoExecute\r\n```\r\n\r\n```\r\nroot@k8s001:~/cases/taint# kubectl describe nodes k8s004\r\nName:\t\t\tk8s004\r\nRole:\r\nLabels:\t\t\tbeta.kubernetes.io/arch=amd64\r\n\t\t\tbeta.kubernetes.io/os=linux\r\n\t\t\tkubernetes.io/hostname=k8s004\r\n\t\t\trole=ok\r\nAnnotations:\t\tnode.alpha.kubernetes.io/ttl=0\r\n\t\t\tvolumes.kubernetes.io/controller-managed-attach-detach=true\r\nTaints:\t\t\tx=y:NoExecute\r\nCreationTimestamp:\tThu, 06 Apr 2017 10:18:10 +0800\r\nConditions:\r\n  Type\t\t\tStatus\tLastHeartbeatTime\t\t\tLastTransitionTime\t\t\tReason\t\t\t\tMessage\r\n  ----\t\t\t------\t-----------------\t\t\t------------------\t\t\t------\t\t\t\t-------\r\n  OutOfDisk \t\tFalse \tThu, 04 May 2017 17:56:12 +0800 \tThu, 04 May 2017 17:03:14 +0800 \tKubeletHasSufficientDisk \tkubelet has sufficient disk space available\r\n  MemoryPressure \tFalse \tThu, 04 May 2017 17:56:12 +0800 \tThu, 04 May 2017 17:03:14 +0800 \tKubeletHasSufficientMemory \tkubelet has sufficient memory available\r\n  DiskPressure \t\tFalse \tThu, 04 May 2017 17:56:12 +0800 \tThu, 04 May 2017 17:03:14 +0800 \tKubeletHasNoDiskPressure \tkubelet has no disk pressure\r\n  Ready \t\tTrue \tThu, 04 May 2017 17:56:12 +0800 \tThu, 04 May 2017 17:26:50 +0800 \tKubeletReady \t\t\tkubelet is posting ready status. AppArmor enabled\r\nAddresses:\r\n  LegacyHostIP:\t192.168.56.14\r\n  InternalIP:\t192.168.56.14\r\n  Hostname:\tk8s004\r\nCapacity:\r\n cpu:\t\t4\r\n memory:\t4046240Ki\r\n pods:\t\t110\r\nAllocatable:\r\n cpu:\t\t4\r\n memory:\t3943840Ki\r\n pods:\t\t110\r\nSystem Info:\r\n Machine ID:\t\t\t1ed0241c581fcc54296c57315864e03e\r\n System UUID:\t\t\tAB6794AC-B3E9-4E95-80CB-9C7E64D2AB09\r\n Boot ID:\t\t\t3dd022be-280b-4018-9929-8a9900ca359a\r\n Kernel Version:\t\t4.4.0-75-generic\r\n OS Image:\t\t\tUbuntu 16.04 LTS\r\n Operating System:\t\tlinux\r\n Architecture:\t\t\tamd64\r\n Container Runtime Version:\tdocker://1.12.5\r\n Kubelet Version:\t\tv1.7.0-alpha.2.718+3b8aac9b22f862\r\n Kube-Proxy Version:\t\tv1.7.0-alpha.2.718+3b8aac9b22f862\r\nExternalID:\t\t\tk8s004\r\nNon-terminated Pods:\t\t(1 in total)\r\n  Namespace\t\t\tName\t\t\t\t\tCPU Requests\tCPU Limits\tMemory Requests\tMemory Limits\r\n  ---------\t\t\t----\t\t\t\t\t------------\t----------\t---------------\t-------------\r\n  default\t\t\tmy-nginx-1257052682-lkjpq\t\t0 (0%)\t\t0 (0%)\t\t0 (0%)\t\t0 (0%)\r\nAllocated resources:\r\n  (Total limits may be over 100 percent, i.e., overcommitted.)\r\n  CPU Requests\tCPU Limits\tMemory Requests\tMemory Limits\r\n  ------------\t----------\t---------------\t-------------\r\n  0 (0%)\t0 (0%)\t\t0 (0%)\t\t0 (0%)\r\nEvents:\r\n  FirstSeen\tLastSeen\tCount\tFrom\t\t\tSubObjectPath\tType\t\tReason\t\t\tMessage\r\n  ---------\t--------\t-----\t----\t\t\t-------------\t--------\t------\t\t\t-------\r\n  52m\t\t52m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tStarting\t\tStarting kubelet.\r\n  52m\t\t52m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tNodeAllocatableEnforced\tUpdated Node Allocatable limit across pods\r\n  52m\t\t52m\t\t2\tkubelet, k8s004\t\t\t\tNormal\t\tNodeHasSufficientDisk\tNode k8s004 status is now: NodeHasSufficientDisk\r\n  52m\t\t52m\t\t2\tkubelet, k8s004\t\t\t\tNormal\t\tNodeHasSufficientMemory\tNode k8s004 status is now: NodeHasSufficientMemory\r\n  52m\t\t52m\t\t2\tkubelet, k8s004\t\t\t\tNormal\t\tNodeHasNoDiskPressure\tNode k8s004 status is now: NodeHasNoDiskPressure\r\n  52m\t\t52m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tNodeNotReady\t\tNode k8s004 status is now: NodeNotReady\r\n  52m\t\t52m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tNodeReady\t\tNode k8s004 status is now: NodeReady\r\n  29m\t\t29m\t\t1\tkube-proxy, k8s004\t\t\tNormal\t\tStarting\t\tStarting kube-proxy.\r\n  29m\t\t29m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tStarting\t\tStarting kubelet.\r\n  29m\t\t29m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tNodeAllocatableEnforced\tUpdated Node Allocatable limit across pods\r\n  29m\t\t29m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tNodeHasSufficientDisk\tNode k8s004 status is now: NodeHasSufficientDisk\r\n  29m\t\t29m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tNodeHasSufficientMemory\tNode k8s004 status is now: NodeHasSufficientMemory\r\n  29m\t\t29m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tNodeHasNoDiskPressure\tNode k8s004 status is now: NodeHasNoDiskPressure\r\n  29m\t\t29m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tNodeNotReady\t\tNode k8s004 status is now: NodeNotReady\r\n  29m\t\t29m\t\t1\tkubelet, k8s004\t\t\t\tNormal\t\tNodeReady\t\tNode k8s004 status is now: NodeReady\r\n```\r\n\r\n4) The pod running on `k8s004` does not get evicted.\r\n\r\n```\r\nroot@k8s001:~/cases/taint# kubectl get pods -owide\r\nNAME                        READY     STATUS    RESTARTS   AGE       IP                NODE\r\nmy-nginx-1257052682-lkjpq   1/1       Running   0          8m        192.168.124.147   k8s004\r\nroot@k8s001:~/cases/taint# kubectl describe pods\r\nName:\t\tmy-nginx-1257052682-lkjpq\r\nNamespace:\tdefault\r\nNode:\t\tk8s004/192.168.56.14\r\nStart Time:\tThu, 04 May 2017 17:48:29 +0800\r\nLabels:\t\tpod-template-hash=1257052682\r\n\t\trun=my-nginx\r\nAnnotations:\tkubernetes.io/created-by={\"kind\":\"SerializedReference\",\"apiVersion\":\"v1\",\"reference\":{\"kind\":\"ReplicaSet\",\"namespace\":\"default\",\"name\":\"my-nginx-1257052682\",\"uid\":\"d3d8c316-30ae-11e7-993a-08002759511a...\r\nStatus:\t\tRunning\r\nIP:\t\t192.168.124.147\r\nCreated By:\tReplicaSet/my-nginx-1257052682\r\nControlled By:\tReplicaSet/my-nginx-1257052682\r\nContainers:\r\n  my-nginx:\r\n    Container ID:\tdocker://130537e470866308223620786b7abc266b24eb215c9211562d9ef98c5232294a\r\n    Image:\t\tnginx:1.8.1\r\n    Image ID:\t\tdocker-pullable://nginx@sha256:9b3e9f189890ef9d6713c3384da3809731bdb0bff84e7b68da330ebadf533085\r\n    Port:\t\t80/TCP\r\n    State:\t\tRunning\r\n      Started:\t\tThu, 04 May 2017 17:48:30 +0800\r\n    Ready:\t\tTrue\r\n    Restart Count:\t0\r\n    Environment:\t<none>\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-0qlw6 (ro)\r\nConditions:\r\n  Type\t\tStatus\r\n  Initialized \tTrue\r\n  Ready \tTrue\r\n  PodScheduled \tTrue\r\nVolumes:\r\n  default-token-0qlw6:\r\n    Type:\tSecret (a volume populated by a Secret)\r\n    SecretName:\tdefault-token-0qlw6\r\n    Optional:\tfalse\r\nQoS Class:\tBestEffort\r\nNode-Selectors:\t<none>\r\nTolerations:\t<none>\r\nEvents:\r\n  FirstSeen\tLastSeen\tCount\tFrom\t\t\tSubObjectPath\t\t\tType\t\tReason\t\tMessage\r\n  ---------\t--------\t-----\t----\t\t\t-------------\t\t\t--------\t------\t\t-------\r\n  8m\t\t8m\t\t1\tdefault-scheduler\t\t\t\t\tNormal\t\tScheduled\tSuccessfully assigned my-nginx-1257052682-lkjpq to k8s004\r\n  8m\t\t8m\t\t1\tkubelet, k8s004\t\tspec.containers{my-nginx}\tNormal\t\tPulled\t\tContainer image \"nginx:1.8.1\" already present on machine\r\n  8m\t\t8m\t\t1\tkubelet, k8s004\t\tspec.containers{my-nginx}\tNormal\t\tCreated\t\tCreated container with id 130537e470866308223620786b7abc266b24eb215c9211562d9ef98c5232294a\r\n  8m\t\t8m\t\t1\tkubelet, k8s004\t\tspec.containers{my-nginx}\tNormal\t\tStarted\t\tStarted container with id 130537e470866308223620786b7abc266b24eb215c9211562d9ef98c5232294a\r\nroot@k8s001:~/cases/taint#\r\n```\r\n\r\nI also test another automatic case by killing `kubelet` on `k8s004`, and I can see the `controller-manager` add a taint `node.alpha.kubernetes.io/unreachable:NoExecute`, but the pods also does not get evicted.\r\n\r\n**What you expected to happen**:\r\nPods should be evicted.\r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\n\r\n\r\n**Anything else we need to know**:\r\n\r\n",
  "closed_at": "2017-05-05T15:19:44Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45342/comments",
  "created_at": "2017-05-04T09:59:03Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45342/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/45342",
  "id": 226231171,
  "labels": [
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45342/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMjYyMzExNzE=",
  "number": 45342,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Taint based evictions is broken",
  "updated_at": "2017-05-05T15:19:44Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45342",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4461983?v=4",
    "events_url": "https://api.github.com/users/gyliu513/events{/privacy}",
    "followers_url": "https://api.github.com/users/gyliu513/followers",
    "following_url": "https://api.github.com/users/gyliu513/following{/other_user}",
    "gists_url": "https://api.github.com/users/gyliu513/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/gyliu513",
    "id": 4461983,
    "login": "gyliu513",
    "node_id": "MDQ6VXNlcjQ0NjE5ODM=",
    "organizations_url": "https://api.github.com/users/gyliu513/orgs",
    "received_events_url": "https://api.github.com/users/gyliu513/received_events",
    "repos_url": "https://api.github.com/users/gyliu513/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/gyliu513/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gyliu513/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/gyliu513"
  }
}