{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n /kind bug\r\n\r\n**What happened**:\r\n\r\nAs we know, for these serivces, nodeports, externalIPs without endpoint, kube-proxy iptables will make rejection rules in filter tables, it can avoid `close wait issue` #43212.\r\nall these filter rules will match `KUBE-SERVICES` chain in both `INPUT` and `OUTPUT` chain\r\n(`\"-A INPUT -j KUBE-SERVICES\"`, `\"-A OUTPUT -j KUBE-SERVICES\"`)\r\n\r\nHowever, we find if there are large numbers of filter rules, will badly impact network performence.\r\nWe do some tests and find the impact mainly cause by INPUT chain. After manually remove rule \"`INPUT -j KUBE-SERVICES`\", the network performence will have a greate improvement\r\n\r\n**What you expected to happen**:\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nwe have an enviroment with more than 1000 reject rules,\r\nuse iperf test pod2pod network bandwidth\uff08Theoretical upper limit 1000Mb/s\uff09\r\nthe bandwidth is only `50Mb/s` !\r\nand after manually remove rule \"`INPUT -j KUBE-SERVICES`\", bandwidth result is about `600Mb/s`\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n- Cloud provider or hardware configuration:\r\n- OS (e.g. from /etc/os-release): CentOS-7\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools:\r\n- Others:\r\n\r\n/sig network\r\n/area kube-proxy",
  "closed_at": "2018-02-25T00:19:56Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 13,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56842/comments",
  "created_at": "2017-12-05T08:30:42Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56842/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/56842",
  "id": 279287225,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 128716589,
      "name": "area/kube-proxy",
      "node_id": "MDU6TGFiZWwxMjg3MTY1ODk=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/kube-proxy"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56842/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNzkyODcyMjU=",
  "number": 56842,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kube-proxy:  too many iptables input filter chain will cause performence issue",
  "updated_at": "2018-02-25T00:19:56Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56842",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/27760600?v=4",
    "events_url": "https://api.github.com/users/xujieasd/events{/privacy}",
    "followers_url": "https://api.github.com/users/xujieasd/followers",
    "following_url": "https://api.github.com/users/xujieasd/following{/other_user}",
    "gists_url": "https://api.github.com/users/xujieasd/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/xujieasd",
    "id": 27760600,
    "login": "xujieasd",
    "node_id": "MDQ6VXNlcjI3NzYwNjAw",
    "organizations_url": "https://api.github.com/users/xujieasd/orgs",
    "received_events_url": "https://api.github.com/users/xujieasd/received_events",
    "repos_url": "https://api.github.com/users/xujieasd/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/xujieasd/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/xujieasd/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/xujieasd"
  }
}