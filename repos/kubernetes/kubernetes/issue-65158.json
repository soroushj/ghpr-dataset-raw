{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4953962?v=4",
    "events_url": "https://api.github.com/users/m1093782566/events{/privacy}",
    "followers_url": "https://api.github.com/users/m1093782566/followers",
    "following_url": "https://api.github.com/users/m1093782566/following{/other_user}",
    "gists_url": "https://api.github.com/users/m1093782566/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/m1093782566",
    "id": 4953962,
    "login": "m1093782566",
    "node_id": "MDQ6VXNlcjQ5NTM5NjI=",
    "organizations_url": "https://api.github.com/users/m1093782566/orgs",
    "received_events_url": "https://api.github.com/users/m1093782566/received_events",
    "repos_url": "https://api.github.com/users/m1093782566/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/m1093782566/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/m1093782566/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/m1093782566"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/4953962?v=4",
      "events_url": "https://api.github.com/users/m1093782566/events{/privacy}",
      "followers_url": "https://api.github.com/users/m1093782566/followers",
      "following_url": "https://api.github.com/users/m1093782566/following{/other_user}",
      "gists_url": "https://api.github.com/users/m1093782566/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/m1093782566",
      "id": 4953962,
      "login": "m1093782566",
      "node_id": "MDQ6VXNlcjQ5NTM5NjI=",
      "organizations_url": "https://api.github.com/users/m1093782566/orgs",
      "received_events_url": "https://api.github.com/users/m1093782566/received_events",
      "repos_url": "https://api.github.com/users/m1093782566/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/m1093782566/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/m1093782566/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/m1093782566"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "/kind bug\r\n/sig network\r\n\r\n(I'm not sure this is actually a bug but it is definitely a behavior that is different from iptables and some applications rely on this)\r\n\r\n**What happened**:\r\nFrom the host network namespace accessing a ClusterIP when using IPVS does not work (it only works when traffic is sent to a local pod)\r\n\r\n**What you expected to happen**:\r\nTo be able to use ClusterIPs from the host network namespace\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n- Configure kube-proxy in IPVS mode\r\n- Create a deployment and the associated service\r\n- Try to access the ClusterIP from the host\r\n\r\n**Anything else we need to know?**:\r\nThis does not work due to how routing is set up when using IPVS\r\nIf we create a service with ClusterIP ```10.200.10.10```, kube-proxy will add this IP to the kube-ivps0 dummy interface:\r\n```\r\nip addr show dev kube-ipvs0\r\n3: kube-ipvs0: <BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN group default\r\n    link/ether da:08:05:49:16:56 brd ff:ff:ff:ff:ff:ff\r\n    inet 10.200.10.10/32 brd 10.200.10.10 scope global kube-ipvs0\r\n       valid_lft forever preferred_lft forever\r\n```\r\nwhich will add the IP to the local route table:\r\n```\r\nip route show table local\r\nlocal 10.0.0.5 dev ens4 proto kernel scope host src 10.0.0.5\r\nlocal 10.200.10.10 dev kube-ipvs0 proto kernel scope host src 10.200.10.10\r\n```\r\n(where 10.0.0.5 is the main interface for the instance)\r\nSo when accessing the ClusterIP from the host, the source IP will default to the ClusterIP:\r\n```\r\nip route get 10.200.10.10\r\nlocal 10.200.10.10 de lo src 10.200.10.10 uid 1001\r\n```\r\nAfter IPVS, the destination will be changed to a pod IP but the source will still be ClusterIP. Since ClusterIPs are not routable the answer will be lost.\r\nA workaround would be to modify the local route to use the IP of the main interface as source:\r\n```\r\nip route replace local 10.200.10.10 dev kube-ipvs0 proto kernel scope host src 10.0.0.5 table local\r\n```\r\nI tested this and it seems to work fine.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): `v1.10.3`\r\n- Cloud provider or hardware configuration: `GCE`\r\n- OS (e.g. from /etc/os-release): Ubuntu 18.04\r\n- Kernel (e.g. `uname -a`): 4.15.0-1008-gcp\r\n",
  "closed_at": "2018-06-22T02:13:44Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 15,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/65158/comments",
  "created_at": "2018-06-15T23:09:31Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/65158/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/65158",
  "id": 332937089,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 755527763,
      "name": "area/ipvs",
      "node_id": "MDU6TGFiZWw3NTU1Mjc3NjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/ipvs"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/65158/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMzI5MzcwODk=",
  "number": 65158,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "ClusterIPs are not accessible from the host when kube-proxy runs in IPVS mode",
  "updated_at": "2018-06-22T12:10:22Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/65158",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/5391707?v=4",
    "events_url": "https://api.github.com/users/lbernail/events{/privacy}",
    "followers_url": "https://api.github.com/users/lbernail/followers",
    "following_url": "https://api.github.com/users/lbernail/following{/other_user}",
    "gists_url": "https://api.github.com/users/lbernail/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/lbernail",
    "id": 5391707,
    "login": "lbernail",
    "node_id": "MDQ6VXNlcjUzOTE3MDc=",
    "organizations_url": "https://api.github.com/users/lbernail/orgs",
    "received_events_url": "https://api.github.com/users/lbernail/received_events",
    "repos_url": "https://api.github.com/users/lbernail/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/lbernail/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lbernail/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/lbernail"
  }
}