{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/8264113?v=4",
    "events_url": "https://api.github.com/users/davidopp/events{/privacy}",
    "followers_url": "https://api.github.com/users/davidopp/followers",
    "following_url": "https://api.github.com/users/davidopp/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidopp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/davidopp",
    "id": 8264113,
    "login": "davidopp",
    "node_id": "MDQ6VXNlcjgyNjQxMTM=",
    "organizations_url": "https://api.github.com/users/davidopp/orgs",
    "received_events_url": "https://api.github.com/users/davidopp/received_events",
    "repos_url": "https://api.github.com/users/davidopp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/davidopp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidopp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/davidopp"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/8264113?v=4",
      "events_url": "https://api.github.com/users/davidopp/events{/privacy}",
      "followers_url": "https://api.github.com/users/davidopp/followers",
      "following_url": "https://api.github.com/users/davidopp/following{/other_user}",
      "gists_url": "https://api.github.com/users/davidopp/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/davidopp",
      "id": 8264113,
      "login": "davidopp",
      "node_id": "MDQ6VXNlcjgyNjQxMTM=",
      "organizations_url": "https://api.github.com/users/davidopp/orgs",
      "received_events_url": "https://api.github.com/users/davidopp/received_events",
      "repos_url": "https://api.github.com/users/davidopp/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/davidopp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davidopp/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/davidopp"
    }
  ],
  "author_association": "NONE",
  "body": "When mounting several shares over NFS to container and when one of the directories is deleted from NFS server, something in the node is deleting content from other shares. I suspect that something goes wrong with \"cleanupOrphanedVolumes\"? not sure tough.\n\nUse case: php-app is running in container, uses php-sessions for remembering login. php sessions are stored in file and shared through nfs-share between containers. also app code is shared and several other directories to store different data (data dirs are mapped under code, code is in separate share so generated document files don't get to git tree), all is managed by separate integration server (in container), that uses same shares to prepare the code.\n\nThis happened first time in GCE with Cluster API version 0.17.something, now it acts same on 1.0.1 and 0.18.2. Problem is repeatable:\nFirst of all you need to install package \"nfs-common\" to **all cluster nodes**, otherwise you can't map NFS shares at all:\n\n```\napt-get update && apt-get install nfs-common\n```\n\nnow you need nfs server. I created small instance for that with /etc/export stating:\n\n```\n/export     10.240.0.0/16(rw,sync,crossmnt,no_subtree_check)\n```\n\nalso I made directories under /export/test/:\n\n```\n#ls -la ubuntutest ubuntutest2 ubuntutest3\nubuntutest:\ntotal 12\ndrwxrwxrwx  2 root root 4096 Aug  3 15:07 .\ndrwxr-xr-x 12 root root 4096 Aug  3 15:06 ..\n-rw-r--r--  1 root root 1580 Aug  3 15:06 testifail\nubuntutest2:\ntotal 12\ndrwxrwxrwx  2 root root 4096 Aug  3 15:06 .\ndrwxr-xr-x 12 root root 4096 Aug  3 15:06 ..\n-rw-r--r--  1 root root 1580 Aug  3 15:06 testifail2\nubuntutest3:\ntotal 12\ndrwxr-xr-x  2 root root 4096 Aug  3 15:07 .\ndrwxr-xr-x 12 root root 4096 Aug  3 15:06 ..\n-rw-r--r--  1 root root 1580 Aug  3 15:07 testifail3\n```\n\nnext you need ubuntutest.yaml to start it up (replace nfs server ip with your own):\n\n```\napiVersion: v1\nkind: ReplicationController\nmetadata:\n  labels:\n    name: zubuntu\n  name: zubuntu\nspec:\n  replicas: 1\n  selector:\n    name: zubuntu-rc\n  template:\n    metadata:\n      labels:\n        name: zubuntu-rc\n    spec:\n      restartPolicy: Always\n      containers:\n        - image: tutum/apache-php\n          name: ubuntu-cont\n          ports:\n            - containerPort: 80\n              name: web-port\n          volumeMounts:\n            - name: test-nfs-1\n              mountPath: /app\n            - name: test-nfs-2\n              mountPath: /app2\n            - name: test-nfs-3\n              mountPath: /app3\n      volumes:\n        - name: test-nfs-1\n          nfs:\n            server: 10.240.175.237\n            path: /export/test/ubuntutest\n        - name: test-nfs-2\n          nfs:\n            server: 10.240.175.237\n            path: /export/test/ubuntutest2\n        - name: test-nfs-3\n          nfs:\n            server: 10.240.175.237\n            path: /export/test/ubuntutest3\n```\n\nnow start up the pod:\n\n```\nkubectl create -f ubuntutest.yaml \nkubectl get pods\n```\n\nverify, that the directories are mapped:\n\n```\nkubectl exec -ti zubuntu-8y55c bash\n# ls -la /app*\n/app:\ntotal 12\ndrwxrwxrwx  2 root root 4096 Aug  3 18:07 .\ndrwxr-xr-x 69 root root 4096 Aug  3 18:09 ..\n-rw-r--r--  1 root root 1580 Aug  3 18:06 testifail\n\n/app2:\ntotal 12\ndrwxrwxrwx  2 root root 4096 Aug  3 18:06 .\ndrwxr-xr-x 69 root root 4096 Aug  3 18:09 ..\n-rw-r--r--  1 root root 1580 Aug  3 18:06 testifail2\n\n/app3:\ntotal 12\ndrwxr-xr-x  2 root root 4096 Aug  3 18:07 .\ndrwxr-xr-x 69 root root 4096 Aug  3 18:09 ..\n-rw-r--r--  1 root root 1580 Aug  3 18:07 testifail3\n```\n\nnow the funny part:\nremove directory from nfs server\n\n```\n # rm -rf ubuntutest\n```\n\nthe zubuntu pod shows:\n\n```\n# ls -la /app*\n/app:\nls: reading directory /app: Stale file handle\ntotal 0\n\n/app2:\ntotal 12\ndrwxrwxrwx  2 root root 4096 Aug  3 18:06 .\ndrwxr-xr-x 69 root root 4096 Aug  3 18:09 ..\n-rw-r--r--  1 root root 1580 Aug  3 18:06 testifail2\n\n/app3:\ntotal 12\ndrwxr-xr-x  2 root root 4096 Aug  3 18:07 .\ndrwxr-xr-x 69 root root 4096 Aug  3 18:09 ..\n-rw-r--r--  1 root root 1580 Aug  3 18:07 testifail3\n```\n\nnothing happens on nfs server yet, but just launch the stop command:\n\n```\nkubectl stop -f ubuntutest.yaml \n```\n\nand now nfs server shows:\n\n```\n# ls -la ubuntutest ubuntutest2 ubuntutest3\nls: cannot access ubuntutest: No such file or directory\nubuntutest2:\ntotal 8\ndrwxrwxrwx  2 root root 4096 Aug  3 15:18 .\ndrwxr-xr-x 11 root root 4096 Aug  3 15:17 ..\nubuntutest3:\ntotal 12\ndrwxr-xr-x  2 root root 4096 Aug  3 15:07 .\ndrwxr-xr-x 11 root root 4096 Aug  3 15:17 ..\n-rw-r--r--  1 root root 1580 Aug  3 15:07 testifail3\n```\n\nyou see, that one file was left, but not for long. this is because root in client does not have root access in nfs-file system, but just after giving rights, the file is gone:\n\n```\n# chmod 777 ubuntutest3\n\n# ls -la ubuntutest ubuntutest2 ubuntutest3\nls: cannot access ubuntutest: No such file or directory\nubuntutest2:\ntotal 8\ndrwxrwxrwx  2 root root 4096 Aug  3 15:18 .\ndrwxr-xr-x 11 root root 4096 Aug  3 15:17 ..\nubuntutest3:\ntotal 8\ndrwxrwxrwx  2 root root 4096 Aug  3 15:20 .\ndrwxr-xr-x 11 root root 4096 Aug  3 15:17 ..\n```\n\nnow you can test \"black hole\" by creating new files. they dissaperar from the server in few moments. the dissapearing continues until cluster node is restarted.\n",
  "closed_at": "2015-09-18T21:44:33Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 14,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/12155/comments",
  "created_at": "2015-08-03T16:54:57Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/12155/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/12155",
  "id": 98793085,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to gcp provider",
      "id": 158907408,
      "name": "area/provider/gcp",
      "node_id": "MDU6TGFiZWwxNTg5MDc0MDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/gcp"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": "Must be staffed and worked on either currently, or very soon, ideally in time for the next release.",
      "id": 114528223,
      "name": "priority/important-soon",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyMjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/important-soon"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Storage.",
      "id": 169428334,
      "name": "sig/storage",
      "node_id": "MDU6TGFiZWwxNjk0MjgzMzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/storage"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/12155/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU5ODc5MzA4NQ==",
  "number": 12155,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kubernetes deletes info from all NFS shares when one of the mounts becames stalled (google container engine)",
  "updated_at": "2015-09-18T21:44:33Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/12155",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/13198426?v=4",
    "events_url": "https://api.github.com/users/jyrip/events{/privacy}",
    "followers_url": "https://api.github.com/users/jyrip/followers",
    "following_url": "https://api.github.com/users/jyrip/following{/other_user}",
    "gists_url": "https://api.github.com/users/jyrip/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jyrip",
    "id": 13198426,
    "login": "jyrip",
    "node_id": "MDQ6VXNlcjEzMTk4NDI2",
    "organizations_url": "https://api.github.com/users/jyrip/orgs",
    "received_events_url": "https://api.github.com/users/jyrip/received_events",
    "repos_url": "https://api.github.com/users/jyrip/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jyrip/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jyrip/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jyrip"
  }
}