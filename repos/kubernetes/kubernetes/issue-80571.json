{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1856066?v=4",
    "events_url": "https://api.github.com/users/ritazh/events{/privacy}",
    "followers_url": "https://api.github.com/users/ritazh/followers",
    "following_url": "https://api.github.com/users/ritazh/following{/other_user}",
    "gists_url": "https://api.github.com/users/ritazh/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ritazh",
    "id": 1856066,
    "login": "ritazh",
    "node_id": "MDQ6VXNlcjE4NTYwNjY=",
    "organizations_url": "https://api.github.com/users/ritazh/orgs",
    "received_events_url": "https://api.github.com/users/ritazh/received_events",
    "repos_url": "https://api.github.com/users/ritazh/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ritazh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ritazh/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ritazh"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/1856066?v=4",
      "events_url": "https://api.github.com/users/ritazh/events{/privacy}",
      "followers_url": "https://api.github.com/users/ritazh/followers",
      "following_url": "https://api.github.com/users/ritazh/following{/other_user}",
      "gists_url": "https://api.github.com/users/ritazh/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/ritazh",
      "id": 1856066,
      "login": "ritazh",
      "node_id": "MDQ6VXNlcjE4NTYwNjY=",
      "organizations_url": "https://api.github.com/users/ritazh/orgs",
      "received_events_url": "https://api.github.com/users/ritazh/received_events",
      "repos_url": "https://api.github.com/users/ritazh/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/ritazh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ritazh/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/ritazh"
    }
  ],
  "author_association": "NONE",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\nThe issue has been observed on Azure but should also apply to other providers as well. On Azure we observed that there are orphaned Public IPs that don't belong to any Kubernetes LoadBalancer service but from looking at the tags and the name it is clear that Kubernetes created them. In the Azure Activity Log, you can see that the Public IP was deleted when the K8s service was deleted but recreated a few minutes later. That re-creation is also visible in the K8s controller manager logs as a reconcile of the service.\r\n\r\nIn our case, we add additional worker nodes and delete services at the same time. I think this leads to the re-creation here https://github.com/kubernetes/kubernetes/blob/41b3e60f0e4032eec2caf38348d82641395f7af6/pkg/controller/service/service_controller.go#L686\r\n\r\nBecause the service list is retrieved at the beginning of the reconcile loop, services that are deleted while the loop is reconciling a recreated by that loop and afterwards orphaned.\r\n\r\n**What you expected to happen**:\r\nNo orphaned public IPs\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nCreate a few Kubernetes Load Balancer services (we have around 20). Then scale your worker nodes and delete one service at the same time.\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.15.0\r\n- Cloud provider or hardware configuration: Azure\r\n- OS (e.g: `cat /etc/os-release`): Core OS\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools:\r\n- Network plugin and version (if this is a network-related bug):\r\n- Others:\r\n",
  "closed_at": "2019-09-28T13:05:39Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 13,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80571/comments",
  "created_at": "2019-07-25T09:39:17Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80571/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/80571",
  "id": 472765669,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to azure provider",
      "id": 852130786,
      "name": "area/provider/azure",
      "node_id": "MDU6TGFiZWw4NTIxMzA3ODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/azure"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Cloud Provider.",
      "id": 958178286,
      "name": "sig/cloud-provider",
      "node_id": "MDU6TGFiZWw5NTgxNzgyODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cloud-provider"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80571/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NzI3NjU2Njk=",
  "number": 80571,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Service Controller loop creates orphaned resources",
  "updated_at": "2019-09-28T13:05:39Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80571",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/5032476?v=4",
    "events_url": "https://api.github.com/users/MSSedusch/events{/privacy}",
    "followers_url": "https://api.github.com/users/MSSedusch/followers",
    "following_url": "https://api.github.com/users/MSSedusch/following{/other_user}",
    "gists_url": "https://api.github.com/users/MSSedusch/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/MSSedusch",
    "id": 5032476,
    "login": "MSSedusch",
    "node_id": "MDQ6VXNlcjUwMzI0NzY=",
    "organizations_url": "https://api.github.com/users/MSSedusch/orgs",
    "received_events_url": "https://api.github.com/users/MSSedusch/received_events",
    "repos_url": "https://api.github.com/users/MSSedusch/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/MSSedusch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MSSedusch/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/MSSedusch"
  }
}