{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?** BUG report\r\n\r\n**Kubernetes version** (use `kubectl version`):\r\nkubectl version\r\nClient Version: version.Info{Major:\"1\", Minor:\"6\", GitVersion:\"v1.6.0\", GitCommit:\"fff5156092b56e6bd60fff75aad4dc9de6b6ef37\", GitTreeState:\"clean\", BuildDate:\"2017-03-28T16:36:33Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"6+\", GitVersion:\"v1.6.0-1+c0b74ebf3ce26e-dirty\", GitCommit:\"c0b74ebf3ce26e46b5397ffb5ce71cd02f951130\", GitTreeState:\"dirty\", BuildDate:\"2017-03-30T08:19:21Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**: openstack\r\n- **OS** (e.g. from /etc/os-release): centos 7\r\n- **Kernel** (e.g. `uname -a`):\r\n- **Install tools**:\r\n- **Others**:\r\n\r\n\r\n**What happened**:\r\n\r\nI created new cinder storageclass, however it does ignore availability zone and it will provision volumes zone called nova (default)\r\n\r\nyaml used to create cinder:\r\n\r\n```\r\nkind: StorageClass\r\napiVersion: storage.k8s.io/v1beta1\r\nmetadata:\r\n  name: standard\r\nprovisioner: kubernetes.io/cinder\r\nparameters:\r\n  availability: zone-1\r\n```\r\n\r\n```\r\n% openstack volume list\r\n+--------------------------------------+-------------------------------------------------------------+-----------+------+-------------+\r\n| ID                                   | Display Name                                                | Status    | Size | Attached to |\r\n+--------------------------------------+-------------------------------------------------------------+-----------+------+-------------+\r\n| d71f8af4-2e84-4908-a3e8-b5f64d0ed3aa | kubernetes-dynamic-pvc-810f0f8b-191b-11e7-9a54-fa163e26fe46 | error     |   12 |             |\r\n+--------------------------------------+-------------------------------------------------------------+-----------+------+-------------+\r\n\r\n% openstack volume show d71f8af4-2e84-4908-a3e8-b5f64d0ed3aa\r\n+------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\r\n| Field                        | Value                                                                                                                                                                                   |\r\n+------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\r\n| attachments                  | []                                                                                                                                                                                      |\r\n| availability_zone            | nova                                                                                                                                                                                    |\r\n| bootable                     | false                                                                                                                                                                                   |\r\n| consistencygroup_id          | None                                                                                                                                                                                    |\r\n| created_at                   | 2017-04-04T09:56:43.000000                                                                                                                                                              |\r\n| description                  | None                                                                                                                                                                                    |\r\n| encrypted                    | False                                                                                                                                                                                   |\r\n| id                           | d71f8af4-2e84-4908-a3e8-b5f64d0ed3aa                                                                                                                                                    |\r\n| multiattach                  | False                                                                                                                                                                                   |\r\n| name                         | kubernetes-dynamic-pvc-810f0f8b-191b-11e7-9a54-fa163e26fe46                                                                                                                             |\r\n| os-vol-tenant-attr:tenant_id | b23efb65b1d44b5abd561511f40c565d                                                                                                                                                        |\r\n| properties                   | kubernetes.io/created-for/pv/name='pvc-810f0f8b-191b-11e7-9a54-fa163e26fe46', kubernetes.io/created-for/pvc/name='storage-es-data-0', kubernetes.io/created-for/pvc/namespace='default' |\r\n| replication_status           | disabled                                                                                                                                                                                |\r\n| size                         | 12                                                                                                                                                                                      |\r\n| snapshot_id                  | None                                                                                                                                                                                    |\r\n| source_volid                 | None                                                                                                                                                                                    |\r\n| status                       | error                                                                                                                                                                                   |\r\n| type                         | None                                                                                                                                                                                    |\r\n| updated_at                   | 2017-04-04T09:56:43.000000                                                                                                                                                              |\r\n| user_id                      | 56ebdadedcbd34ccac211665a0bf5d78060040f1ff05fb5e896d77e7f882650d                                                                                                                        |\r\n+------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\r\n\r\n```\r\n\r\nI added manual print here https://github.com/kubernetes/kubernetes/blob/v1.6.0/pkg/cloudprovider/providers/openstack/openstack_volumes.go#L145\r\n\r\nIt prints out:\r\n```\r\n{\"log\":\"I0404 11:08:15.852302       1 openstack_volumes.go:145] Createvolume availability: zone-1\\n\",\"stream\":\"stderr\",\"time\":\"2017-04-04T11:08:15.852382116Z\"\r\n```\r\n\r\nI tried to remove that newline from that string, but still it is creating that to nova availability zone. For me this looks like gophercloud volumes.CreateOpts{ is not working as should in createvolume function https://github.com/kubernetes/kubernetes/blob/v1.6.0/pkg/cloudprovider/providers/openstack/openstack_volumes.go#L144-L171 \r\n**What you expected to happen**:\r\nI except that if I define availability, like docs says it should also use that parameter when provisioning volume.\r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\n\r\n```\r\nkind: StorageClass\r\napiVersion: storage.k8s.io/v1beta1\r\nmetadata:\r\n  name: standard\r\nprovisioner: kubernetes.io/cinder\r\nparameters:\r\n  availability: zone-1\r\n```\r\n\r\n```\r\napiVersion: apps/v1beta1\r\nkind: StatefulSet\r\nmetadata:\r\n  name: es-data\r\n  labels:\r\n    component: elasticsearch\r\n    role: data\r\nspec:\r\n  serviceName: elasticsearch-data\r\n  replicas: 3\r\n  template:\r\n    metadata:\r\n      labels:\r\n        component: elasticsearch\r\n        role: data\r\n      annotations:\r\n        pod.beta.kubernetes.io/init-containers: '[\r\n          {\r\n          \"name\": \"sysctl\",\r\n            \"image\": \"busybox\",\r\n            \"imagePullPolicy\": \"IfNotPresent\",\r\n            \"command\": [\"sysctl\", \"-w\", \"vm.max_map_count=262144\"],\r\n            \"securityContext\": {\r\n              \"privileged\": true\r\n            }\r\n          }\r\n        ]'\r\n    spec:\r\n      containers:\r\n      - name: es-data\r\n        securityContext:\r\n          privileged: true\r\n          capabilities:\r\n            add:\r\n              - IPC_LOCK\r\n        image: quay.io/pires/docker-elasticsearch-kubernetes:5.2.2_2\r\n        imagePullPolicy: Always\r\n        env:\r\n        - name: NAMESPACE\r\n          valueFrom:\r\n            fieldRef:\r\n              fieldPath: metadata.namespace\r\n        - name: NODE_NAME\r\n          valueFrom:\r\n            fieldRef:\r\n              fieldPath: metadata.name\r\n        - name: \"CLUSTER_NAME\"\r\n          value: \"myesdb\"\r\n        - name: NODE_MASTER\r\n          value: \"false\"\r\n        - name: NODE_INGEST\r\n          value: \"false\"\r\n        - name: HTTP_ENABLE\r\n          value: \"false\"\r\n        - name: \"ES_JAVA_OPTS\"\r\n          value: \"-Xms256m -Xmx256m\"\r\n        ports:\r\n        - containerPort: 9300\r\n          name: transport\r\n          protocol: TCP\r\n        volumeMounts:\r\n        - name: storage\r\n          mountPath: /data\r\n      nodeSelector:\r\n        failure-domain.beta.kubernetes.io/zone: zone-1\r\n  volumeClaimTemplates:\r\n  - metadata:\r\n      name: storage\r\n      annotations:\r\n        volume.beta.kubernetes.io/storage-class: standard\r\n    spec:\r\n      accessModes: [ \"ReadWriteOnce\" ]\r\n      resources:\r\n        requests:\r\n          storage: 12Gi\r\n```\r\n\r\n\r\n**Anything else we need to know**:\r\n\r\n",
  "closed_at": "2017-04-19T10:26:26Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 5,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44032/comments",
  "created_at": "2017-04-04T10:04:23Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44032/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/44032",
  "id": 219200031,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to openstack provider",
      "id": 239914558,
      "name": "area/provider/openstack",
      "node_id": "MDU6TGFiZWwyMzk5MTQ1NTg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/openstack"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Storage.",
      "id": 169428334,
      "name": "sig/storage",
      "node_id": "MDU6TGFiZWwxNjk0MjgzMzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/storage"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44032/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMTkyMDAwMzE=",
  "number": 44032,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "storageclass cinder is ignoring availability zone",
  "updated_at": "2017-04-19T15:26:19Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44032",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/22482503?v=4",
    "events_url": "https://api.github.com/users/zetaab/events{/privacy}",
    "followers_url": "https://api.github.com/users/zetaab/followers",
    "following_url": "https://api.github.com/users/zetaab/following{/other_user}",
    "gists_url": "https://api.github.com/users/zetaab/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/zetaab",
    "id": 22482503,
    "login": "zetaab",
    "node_id": "MDQ6VXNlcjIyNDgyNTAz",
    "organizations_url": "https://api.github.com/users/zetaab/orgs",
    "received_events_url": "https://api.github.com/users/zetaab/received_events",
    "repos_url": "https://api.github.com/users/zetaab/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/zetaab/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zetaab/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/zetaab"
  }
}