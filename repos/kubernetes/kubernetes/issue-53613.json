{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n/kind bug\r\n\r\n**What happened**:\r\nThe controller manager crashed and then could not start up again due to NPE.\r\n\r\n**What you expected to happen**:\r\nIt to startup or recover from this state automatically.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nUnfortunately I haven't been able to reproduce in a separate cluster (yet).  Steps that may have caused it: shortly after we had done approx 300 deployment scale down actions using \" kubectl scale --replicas=0\". We then attempted to delete approx 100 services (with serviceType:LoadBalancer) that had created ELBs (and therefor needed to delete ELBs).  This scenario was triggered and I noticed because only two ELBs succeeded in deleting before the crash prevented further deletion.  We were not able to recover from the nil pointer but we do still have this cluster in a stuck state for more investigation. \r\n\r\n**Anything else we need to know?**:\r\nTraceback from the controller manager is:\r\n```\r\nI0920 01:10:37.699697       1 controller_utils.go:1001] Caches are synced for GC controller\r\nI0920 01:10:37.700511       1 controller_utils.go:1001] Caches are synced for RC controller\r\nI0920 01:10:37.700690       1 controller_utils.go:1001] Caches are synced for endpoint controller\r\nI0920 01:10:37.701144       1 controller_utils.go:1001] Caches are synced for certificate controller\r\nI0920 01:10:37.716689       1 controller_utils.go:1001] Caches are synced for resource quota controller\r\nI0920 01:10:37.743727       1 controller_utils.go:1001] Caches are synced for attach detach controller\r\nI0920 01:10:38.026325       1 controller_utils.go:1001] Caches are synced for deployment controller\r\nI0920 01:10:38.131808       1 controller_utils.go:1001] Caches are synced for garbage collector controller\r\nI0920 01:10:38.131901       1 garbagecollector.go:132] Garbage collector: all resource monitors have synced. Proceeding to collect garbage\r\nI0920 01:10:38.132769       1 controller_utils.go:1001] Caches are synced for replica set controller\r\nI0920 01:10:38.141202       1 controller_utils.go:1001] Caches are synced for disruption controller\r\nI0920 01:10:38.141249       1 disruption.go:305] Sending events to api server.\r\nI0920 01:10:38.560887       1 event.go:218] Event(v1.ObjectReference{Kind:\"ReplicaSet\", Namespace:\"kube-system\", Name:\"heapster-1152096127\", UID:\"079405ef-9da0-11e7-be81-12ee649370f8\", APIVersion:\"extensions\", ResourceVersion:\"2341744\", FieldPath:\"\"}): type: 'Normal' reason: 'SuccessfulDelete' Deleted pod: heapster-1152096127-61wrv\r\nE0920 01:10:39.782309       1 runtime.go:66] Observed a panic: \"invalid memory address or nil pointer dereference\" (runtime error: invalid memory address or nil pointer dereference)\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:72\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:65\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:51\r\n/usr/local/go/src/runtime/asm_amd64.s:514\r\n/usr/local/go/src/runtime/panic.go:489\r\n/usr/local/go/src/runtime/panic.go:63\r\n/usr/local/go/src/runtime/signal_unix.go:290\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/progress.go:100\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/recreate.go:49\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:686\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:135\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:471\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:460\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:160\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:97\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:98\r\n/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:52\r\n/usr/local/go/src/runtime/asm_amd64.s:2197\r\npanic: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n\tpanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x355229c]\r\n\r\ngoroutine 1075 [running]:\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime.HandleCrash(0x0, 0x0, 0x0)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:58 +0x126\r\npanic(0x4304920, 0x8f474a0)\r\n\t/usr/local/go/src/runtime/panic.go:489 +0x2cf\r\nk8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).syncRolloutStatus(0xc420add180, 0xc429164380, 0x2, 0x2, 0x0, 0xc42196d800, 0x0, 0x0)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/progress.go:100 +0x9cc\r\nk8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).rolloutRecreate(0xc420add180, 0xc42196d800, 0xc42806e0a0, 0x1, 0x1, 0xc4291ca060, 0x0, 0x0)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/recreate.go:49 +0x485\r\nk8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).syncDeployment(0xc420add180, 0xc422090680, 0x32, 0x0, 0x0)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:686 +0x990\r\nk8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).(k8s.io/kubernetes/pkg/controller/deployment.syncDeployment)-fm(0xc422090680, 0x32, 0xc42119f060, 0x4081260)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:135 +0x3e\r\nk8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).processNextWorkItem(0xc420add180, 0x50d800)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:471 +0xd9\r\nk8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).worker(0xc420add180)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:460 +0x2b\r\nk8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).(k8s.io/kubernetes/pkg/controller/deployment.worker)-fm()\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:160 +0x2a\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil.func1(0xc4267c2420)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:97 +0x5e\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil(0xc4267c2420, 0x3b9aca00, 0x0, 0x2110ff01, 0xc4200837a0)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:98 +0xbd\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.Until(0xc4267c2420, 0x3b9aca00, 0xc4200837a0)\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:52 +0x4d\r\ncreated by k8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).Run\r\n\t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/controller/deployment/deployment_controller.go:160 +0x22d\r\n```\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\nServer Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.6+coreos.0\", GitCommit:\"e14ebed378d5380b9936455584fa454daa67f23b\", GitTreeState:\"clean\", BuildDate:\"2017-09-14T21:52:44Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n- Cloud provider or hardware configuration**:\r\nAWS\r\n\r\n- OS (e.g. from /etc/os-release):\r\nNAME=\"Container Linux by CoreOS\"\r\nID=coreos\r\nVERSION=1465.7.0\r\nVERSION_ID=1465.7.0\r\nBUILD_ID=2017-09-05-2043\r\nPRETTY_NAME=\"Container Linux by CoreOS 1465.7.0 (Ladybug)\"\r\n\r\n- Kernel (e.g. `uname -a`):\r\nLinux ip-10-100-102-222.ec2.internal 4.12.10-coreos #1 SMP Tue Sep 5 20:29:13 UTC 2017 x86_64 Intel(R) Xeon(R) CPU E5-2686 v4 @ 2.30GHz GenuineIntel GNU/Linux\r\n\r\n- Install tools:\r\nkube-aws\r\n\r\n- Others:\r\nEtcd version 3.2.7\r\n",
  "closed_at": "2017-10-10T17:01:41Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53613/comments",
  "created_at": "2017-10-09T20:55:54Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53613/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/53613",
  "id": 264023447,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "ededed",
      "default": false,
      "description": "Indicates an issue or PR lacks a `sig/foo` label and requires one.",
      "id": 617149945,
      "name": "needs-sig",
      "node_id": "MDU6TGFiZWw2MTcxNDk5NDU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/needs-sig"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53613/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNjQwMjM0NDc=",
  "number": 53613,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "deployment controller null pointer exception",
  "updated_at": "2017-10-10T17:01:41Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53613",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/4072?v=4",
    "events_url": "https://api.github.com/users/jeremyd/events{/privacy}",
    "followers_url": "https://api.github.com/users/jeremyd/followers",
    "following_url": "https://api.github.com/users/jeremyd/following{/other_user}",
    "gists_url": "https://api.github.com/users/jeremyd/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jeremyd",
    "id": 4072,
    "login": "jeremyd",
    "node_id": "MDQ6VXNlcjQwNzI=",
    "organizations_url": "https://api.github.com/users/jeremyd/orgs",
    "received_events_url": "https://api.github.com/users/jeremyd/received_events",
    "repos_url": "https://api.github.com/users/jeremyd/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jeremyd/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jeremyd/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jeremyd"
  }
}