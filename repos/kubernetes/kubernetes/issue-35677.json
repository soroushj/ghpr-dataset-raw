{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**Kubernetes version**: 1.4.4\n\n**Environment**:\n- **Cloud provider or hardware configuration**: GKE\n- **Kernel**: Linux gke-pool 3.16.0-4-amd64 1 SMP Debian 3.16.7-ckt25-2 (2016-04-08) x86_64 GNU/Linux\n\n**What happened**: Session affinity is lost frequently when using a service to connect from a pod to another pod using a service with sessionAffinity: ClientIP on Kubernetes 1.4.4 with the iptables proxy mode.\n\n**What you expected to happen**: Adhere to sessionAffinity: ClientIP setting and do not open/route connections to other endpoints off the service for this ClientIP.\n\n**How to reproduce it**: Make a service with sessionAffinity set to ClientIP.\n\n``` yaml\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    name: galera-saf-cli\n  name: galera-saf-cli\nspec:\n  ports:\n    - port: 3306\n      targetPort: 3306\n  selector:\n    type: galera\n  sessionAffinity: ClientIP\n```\n\n**Anything else do we need to know**:\nIt seems like the stickyMaxAgeMinutes is refactored to stickyMaxAgeSeconds in this commit: https://github.com/kubernetes/kubernetes/commit/8e503f3814a007408ce91572bd57c4749b6884d7\n\nWhere previously stickyMaxAgeMinutes was indeed incorrect since the setting was seconds there was a multiply of 60 to convert the property from seconds to minutes `info.stickyMaxAgeMinutes*60` on this line: https://github.com/kubernetes/kubernetes/commit/731d5e519139da63b1d551d45708484bbde4a9b8#diff-d51765b83fe795b469e8a86276b12dc9L513\n\nIn my opinion the behaviour should be that the stickiness is retained for 180 minutes instead of 180 seconds. The affinity is also 180 minutes in the kube-proxy implementation: https://github.com/kubernetes/kubernetes/blob/8fd414537b5143ab039cb910590237cabf4af783/pkg/proxy/userspace/proxier.go#L356\n",
  "closed_at": "2016-11-22T18:35:37Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/35677/comments",
  "created_at": "2016-10-27T07:22:10Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/35677/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/35677",
  "id": 185591697,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 138247961,
      "name": "area/kubectl",
      "node_id": "MDU6TGFiZWwxMzgyNDc5NjE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/kubectl"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/35677/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxODU1OTE2OTc=",
  "number": 35677,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Service sessionAffinity with ClientIP 180 sec instead of minutes when using iptables proxy mode.",
  "updated_at": "2016-11-22T18:35:37Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/35677",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/981177?v=4",
    "events_url": "https://api.github.com/users/vincentheet/events{/privacy}",
    "followers_url": "https://api.github.com/users/vincentheet/followers",
    "following_url": "https://api.github.com/users/vincentheet/following{/other_user}",
    "gists_url": "https://api.github.com/users/vincentheet/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/vincentheet",
    "id": 981177,
    "login": "vincentheet",
    "node_id": "MDQ6VXNlcjk4MTE3Nw==",
    "organizations_url": "https://api.github.com/users/vincentheet/orgs",
    "received_events_url": "https://api.github.com/users/vincentheet/received_events",
    "repos_url": "https://api.github.com/users/vincentheet/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/vincentheet/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vincentheet/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/vincentheet"
  }
}