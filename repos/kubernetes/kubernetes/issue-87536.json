{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "\r\n\r\n**What happened**:\r\nWhen running external CSI Driver tests with the Kubernetes E2E: https://prow.k8s.io/view/gcs/kubernetes-jenkins/pr-logs/pull/sigs.k8s.io_gcp-compute-persistent-disk-csi-driver/458/pull-gcp-compute-persistent-disk-csi-driver-kubernetes-integration/1220789322400141312/\r\n\r\nWe seem to be getting the following error.\r\n\r\n```\r\nI0124 20:03:31.324] [BeforeEach] [Testpattern: Pre-provisioned PV (block volmode)] multiVolume [Slow]\r\nI0124 20:03:31.324]   /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/storage/testsuites/base.go:95\r\nI0124 20:03:31.324] Jan 24 20:03:31.150: INFO: Driver supports dynamic provisioning, skipping PreprovisionedPV pattern\r\nI0124 20:03:31.329] [AfterEach] [Testpattern: Pre-provisioned PV (block volmode)] multiVolume [Slow]\r\nI0124 20:03:31.329]   /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/framework/framework.go:175\r\nI0124 20:03:31.329] Jan 24 20:03:31.151: INFO: Waiting up to 3m0s for all (but 0) nodes to be ready\r\nI0124 20:03:31.329] E0124 20:03:31.152140   71880 runtime.go:78] Observed a panic: \"invalid memory address or nil pointer dereference\" (runtime error: invalid memory address or nil pointer dereference)\r\nI0124 20:03:31.329] goroutine 143 [running]:\r\nI0124 20:03:31.330] k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime.logPanic(0x41cc500, 0x7c969c0)\r\nI0124 20:03:31.330] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:74 +0xa3\r\nI0124 20:03:31.330] k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime.HandleCrash(0x0, 0x0, 0x0)\r\nI0124 20:03:31.330] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:48 +0x82\r\nI0124 20:03:31.330] panic(0x41cc500, 0x7c969c0)\r\nI0124 20:03:31.331] \t/usr/local/go/src/runtime/panic.go:679 +0x1b2\r\nI0124 20:03:31.331] k8s.io/kubernetes/test/e2e/framework.AllNodesReady.func1(0xc00243cc50, 0xc00056a000, 0x7f5987da1d98)\r\nI0124 20:03:31.331] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/framework/util.go:1351 +0x5e\r\nI0124 20:03:31.331] k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.runConditionWithCrashProtection(0xc00243cde0, 0xbedf00, 0x0, 0x0)\r\nI0124 20:03:31.332] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:209 +0x6f\r\nI0124 20:03:31.332] k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.pollImmediateInternal(0xc000894b80, 0xc00243cde0, 0xc000894b80, 0x1)\r\nI0124 20:03:31.332] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:344 +0x2f\r\nI0124 20:03:31.342] k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.PollImmediate(0x77359400, 0x29e8d60800, 0xc00243cde0, 0x33, 0xc00243cda0)\r\nI0124 20:03:31.343] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:340 +0x4d\r\nI0124 20:03:31.343] k8s.io/kubernetes/test/e2e/framework.AllNodesReady(0x0, 0x0, 0x29e8d60800, 0x4aca277, 0xb)\r\nI0124 20:03:31.343] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/framework/util.go:1348 +0x17f\r\nI0124 20:03:31.343] k8s.io/kubernetes/test/e2e/framework.(*Framework).AfterEach(0xc00221dcc0)\r\nI0124 20:03:31.344] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/framework/framework.go:457 +0x43c\r\nI0124 20:03:31.344] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/leafnodes.(*runner).runSync(0xc001976f00, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\nI0124 20:03:31.345] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/leafnodes/runner.go:113 +0xb8\r\nI0124 20:03:31.345] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/leafnodes.(*runner).run(0xc001976f00, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\nI0124 20:03:31.345] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/leafnodes/runner.go:64 +0xcf\r\nI0124 20:03:31.346] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/leafnodes.(*SetupNode).Run(0xc0022657d8, 0x53a8460, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\nI0124 20:03:31.346] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/leafnodes/setup_nodes.go:15 +0x64\r\nI0124 20:03:31.346] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/spec.(*Spec).runSample.func1(0xc00243d6e0, 0xc002f444b0, 0x53a8460, 0xc0001188c0)\r\nI0124 20:03:31.346] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/spec/spec.go:180 +0x344\r\nI0124 20:03:31.347] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/spec.(*Spec).runSample(0xc002f444b0, 0x0, 0x53a8460, 0xc0001188c0)\r\nI0124 20:03:31.347] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/spec/spec.go:197 +0x2e6\r\nI0124 20:03:31.347] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/spec.(*Spec).Run(0xc002f444b0, 0x53a8460, 0xc0001188c0)\r\nI0124 20:03:31.347] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/spec/spec.go:138 +0x101\r\nI0124 20:03:31.348] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/specrunner.(*SpecRunner).runSpec(0xc002c103c0, 0xc002f444b0, 0x4)\r\nI0124 20:03:31.348] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/specrunner/spec_runner.go:200 +0x10f\r\nI0124 20:03:31.348] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/specrunner.(*SpecRunner).runSpecs(0xc002c103c0, 0x1)\r\nI0124 20:03:31.349] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/specrunner/spec_runner.go:170 +0x120\r\nI0124 20:03:31.349] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/specrunner.(*SpecRunner).Run(0xc002c103c0, 0xc0020d70f8)\r\nI0124 20:03:31.350] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/specrunner/spec_runner.go:66 +0x117\r\nI0124 20:03:31.350] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/suite.(*Suite).Run(0xc0001022d0, 0x7f5984092e50, 0xc001e90f00, 0x4af08de, 0x14, 0xc0026ea750, 0x3, 0x3, 0x5473440, 0xc0001188c0, ...)\r\nI0124 20:03:31.350] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/internal/suite/suite.go:62 +0x42b\r\nI0124 20:03:31.351] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo.RunSpecsWithCustomReporters(0x53ac980, 0xc001e90f00, 0x4af08de, 0x14, 0xc002ce41c0, 0x3, 0x4, 0x4)\r\nI0124 20:03:31.351] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/ginkgo_dsl.go:226 +0x217\r\nI0124 20:03:31.351] k8s.io/kubernetes/vendor/github.com/onsi/ginkgo.RunSpecsWithDefaultAndCustomReporters(0x53ac980, 0xc001e90f00, 0x4af08de, 0x14, 0xc001fae860, 0x2, 0x2, 0x2)\r\nI0124 20:03:31.351] \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/onsi/ginkgo/ginkgo_dsl.go:214 +0xad\r\nI0124 20:03:31.352] k8s.io/kubernetes/test/e2e.RunE2ETests(0xc001e90f00)\r\nI0124 20:03:31.352] \t_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/e2e.go:110 +0x30a\r\nI0124 20:03:31.352] k8s.io/kubernetes/test/e2e.TestE2E(0xc001e90f00)\r\nI0124 20:03:31.352] \t_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/e2e_test.go:111 +0x2b\r\nI0124 20:03:31.356] testing.tRunner(0xc001e90f00, 0x4c9fc68)\r\nI0124 20:03:31.356] \t/usr/local/go/src/testing/testing.go:909 +0xc9\r\nI0124 20:03:31.356] created by testing.(*T).Run\r\nI0124 20:03:31.357] \t/usr/local/go/src/testing/testing.go:960 +0x350\r\nI0124 20:03:31.357] \r\nI0124 20:03:31.357] \r\nI0124 20:03:31.358] S [SKIPPING] in Spec Setup (BeforeEach) [0.003 seconds]\r\nI0124 20:03:31.358] External Storage [Driver: csi-gcepd]\r\nI0124 20:03:31.358] /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/storage/external/external.go:165\r\nI0124 20:03:31.358]   [Testpattern: Pre-provisioned PV (block volmode)] multiVolume [Slow]\r\nI0124 20:03:31.358]   /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/storage/testsuites/base.go:94\r\nI0124 20:03:31.359]     should access to two volumes with different volume mode and retain data across pod recreation on the same node [BeforeEach]\r\nI0124 20:03:31.359]     /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/storage/testsuites/multivolume.go:211\r\nI0124 20:03:31.359] \r\nI0124 20:03:31.359]     Driver supports dynamic provisioning, skipping PreprovisionedPV pattern\r\nI0124 20:03:31.359] \r\nI0124 20:03:31.360]     /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/storage/testsuites/base.go:688\r\n```\r\n\r\nFrom initial investigation it looks like this happens in the `AfterEach` during `AllNodesReady` check but only when the test is being skipped. Hunch is that maybe since the test is skipped some resources are never created or they are cleaned up already and they are nil when the `AfterEach` is called and expecting them. Kind of low priority since it doesn't make any tests actually fail.\r\n\r\n/cc @msau42 @misterikkit \r\n/sig storage",
  "closed_at": "2020-01-26T19:13:03Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/87536/comments",
  "created_at": "2020-01-24T23:07:58Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/87536/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/87536",
  "id": 554996389,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Storage.",
      "id": 169428334,
      "name": "sig/storage",
      "node_id": "MDU6TGFiZWwxNjk0MjgzMzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/storage"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/87536/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1NTQ5OTYzODk=",
  "number": 87536,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Test panic in \"AfterEach\" for skipped tests during \"AllNodesReady\"",
  "updated_at": "2020-01-26T19:13:03Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/87536",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/5459214?v=4",
    "events_url": "https://api.github.com/users/davidz627/events{/privacy}",
    "followers_url": "https://api.github.com/users/davidz627/followers",
    "following_url": "https://api.github.com/users/davidz627/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidz627/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/davidz627",
    "id": 5459214,
    "login": "davidz627",
    "node_id": "MDQ6VXNlcjU0NTkyMTQ=",
    "organizations_url": "https://api.github.com/users/davidz627/orgs",
    "received_events_url": "https://api.github.com/users/davidz627/received_events",
    "repos_url": "https://api.github.com/users/davidz627/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/davidz627/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidz627/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/davidz627"
  }
}