{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\n\r\nkubelet terminated unexpectedly during hack/local-up-cluster\r\n```\r\n$ sudo PATH=$PATH hack/local-up-cluster.sh\r\n...\r\nAlternatively, you can write to the default kubeconfig:\r\n\r\n  export KUBERNETES_PROVIDER=local\r\n\r\n  cluster/kubectl.sh config set-cluster local --server=https://localhost:6443 --certificate-authority=/var/run/kubernetes/server-ca.crt\r\n  cluster/kubectl.sh config set-credentials myself --client-key=/var/run/kubernetes/client-admin.key --client-certificate=/var/run/kubernetes/client-admin.crt\r\n  cluster/kubectl.sh config set-context local --cluster=local --user=myself\r\n  cluster/kubectl.sh config use-context local\r\n  cluster/kubectl.sh\r\nW0612 13:13:27]: kubelet terminated unexpectedly, see /tmp/kubelet.log\r\n```\r\nkubelet log\r\n```\r\nI0612 13:13:26.603449  174709 plugins.go:103] No cloud provider specified.\r\nI0612 13:13:26.603467  174709 server.go:540] No cloud provider specified: \"\" from the config file: \"\"\r\nF0612 13:13:26.605288  174709 server.go:272] failed to run Kubelet: failed to get the kubelet's cgroup: cpu and memory cgroup hierarchy not unified.  cpu: /user.slice, memory: /user.slice/user-484802.slice/session-c2.scope\r\n```\r\nas a result apiserver cannot find the node to schedule pods\r\n```\r\n$ kubectl get nodes\r\nNo resources found.\r\n$ kubectl get po foo -oyaml\r\n...\r\nstatus:\r\n  conditions:\r\n  - lastProbeTime: null\r\n    lastTransitionTime: \"2019-06-12T20:22:18Z\"\r\n    message: no nodes available to schedule pods\r\n    reason: Unschedulable\r\n    status: \"False\"\r\n    type: PodScheduled\r\n```\r\n**What you expected to happen**:\r\n\r\nkubelet runs successfully and hack/local-up-cluster creates a single node cluster\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nrun hack/local-up-cluster from HEAD\r\n\r\n**Anything else we need to know?**:\r\n\r\n1. the additional cgroups check seemed to be introduced in https://github.com/kubernetes/kubernetes/commit/f8dff6bd5b700d624b802b747160576473c558d7; hack/local-up-cluster works when I check out the parent commit https://github.com/kubernetes/kubernetes/commit/21bec91e895a828ee8ed8d45a7d58279b8cae46f\r\n```\r\n$ kubectl get nodes\r\nNAME        STATUS   ROLES    AGE    VERSION\r\n127.0.0.1   Ready    <none>   2m3s   v1.15.0-alpha.3.179+21bec91e895a82-dirty\r\n```\r\n\r\n2. we have CI for hack/local-up-cluster and [it's green](https://k8s-testgrid.appspot.com/sig-testing-misc#ci-kubernetes-local-e2e), so I'm not sure if it's an error on my side. It would be greatly appreciated if someone could explain it to me\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n- Cloud provider or hardware configuration:\r\n- OS (e.g: `cat /etc/os-release`): Debian GNU/Linux\r\n- Kernel (e.g. `uname -a`): \r\n- Install tools:\r\n- Network plugin and version (if this is a network-related bug):\r\n- Others:\r\n\r\n/sig node\r\ncc @dashpole ",
  "closed_at": "2019-06-21T22:48:13Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 7,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/78950/comments",
  "created_at": "2019-06-12T20:49:43Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/78950/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/78950",
  "id": 455418075,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/78950/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NTU0MTgwNzU=",
  "number": 78950,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "hack/local-up-cluster fails to bring up kubelet and a node",
  "updated_at": "2019-06-21T22:48:13Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/78950",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/6629765?v=4",
    "events_url": "https://api.github.com/users/roycaihw/events{/privacy}",
    "followers_url": "https://api.github.com/users/roycaihw/followers",
    "following_url": "https://api.github.com/users/roycaihw/following{/other_user}",
    "gists_url": "https://api.github.com/users/roycaihw/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/roycaihw",
    "id": 6629765,
    "login": "roycaihw",
    "node_id": "MDQ6VXNlcjY2Mjk3NjU=",
    "organizations_url": "https://api.github.com/users/roycaihw/orgs",
    "received_events_url": "https://api.github.com/users/roycaihw/received_events",
    "repos_url": "https://api.github.com/users/roycaihw/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/roycaihw/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roycaihw/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/roycaihw"
  }
}