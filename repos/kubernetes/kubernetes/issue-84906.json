{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/12699319?v=4",
    "events_url": "https://api.github.com/users/andrewsykim/events{/privacy}",
    "followers_url": "https://api.github.com/users/andrewsykim/followers",
    "following_url": "https://api.github.com/users/andrewsykim/following{/other_user}",
    "gists_url": "https://api.github.com/users/andrewsykim/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/andrewsykim",
    "id": 12699319,
    "login": "andrewsykim",
    "node_id": "MDQ6VXNlcjEyNjk5MzE5",
    "organizations_url": "https://api.github.com/users/andrewsykim/orgs",
    "received_events_url": "https://api.github.com/users/andrewsykim/received_events",
    "repos_url": "https://api.github.com/users/andrewsykim/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/andrewsykim/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/andrewsykim/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/andrewsykim"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/12699319?v=4",
      "events_url": "https://api.github.com/users/andrewsykim/events{/privacy}",
      "followers_url": "https://api.github.com/users/andrewsykim/followers",
      "following_url": "https://api.github.com/users/andrewsykim/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewsykim/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/andrewsykim",
      "id": 12699319,
      "login": "andrewsykim",
      "node_id": "MDQ6VXNlcjEyNjk5MzE5",
      "organizations_url": "https://api.github.com/users/andrewsykim/orgs",
      "received_events_url": "https://api.github.com/users/andrewsykim/received_events",
      "repos_url": "https://api.github.com/users/andrewsykim/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/andrewsykim/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewsykim/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/andrewsykim"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- Please only use this template for submitting enhancement requests -->\r\n\r\n**What would you like to be added**:\r\nperformance enhance for kube-proxy/ipvs syncProxyRules\r\n\r\n**Why is this needed**:\r\nFor kube-proxy/ipvs, syncProxyRules will take about 10s+ when the number of k8s Service with external ip > 1500+. It has those problem:\r\n- The ipvs rules of endpoints change may delay 10s after a pod is terminated, within the period, all requests route to this endpoint will fail.\r\n- The ipvs rules of Services change may delay 10s. It means that, a service may not be ready after created successfully until 10s later.\r\n\r\nAfter some debug tests, I found that most of time spend on [utilproxy.IsLocalIP(externalIP)](https://github.com/kubernetes/kubernetes/blob/master/pkg/proxy/ipvs/proxier.go#L1103)\r\n```\r\nI1104 16:34:01.051111   14602 proxier.go:980] [debug] check externalIP open port: 4.5211ms\r\nI1104 16:34:01.066563   14602 proxier.go:980] [debug] check externalIP open port: 6.349011ms\r\nI1104 16:39:51.858951   11581 proxier.go:744] [debug] syncProxyRules took 12.045648906s\r\n```\r\n\r\nAnd fortunately, we could simply move the logic of geting net interface addrs from the for loop to enhance performance safely. After this change, the sync time could reduce from 12s to 730ms.\r\n```\r\nI1105 10:18:30.002215   31985 proxier.go:1002] [debug] check externalIP open port: 156ns\r\nI1105 10:18:30.687643   31985 proxier.go:793] [debug] syncProxyRules, took 731.416349ms\r\n```\r\n\r\nI will push a PR soon for this.\r\n\r\n",
  "closed_at": "2019-11-12T19:51:18Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84906/comments",
  "created_at": "2019-11-07T07:54:26Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84906/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/84906",
  "id": 519100803,
  "labels": [
    {
      "color": "c7def8",
      "default": false,
      "description": "Categorizes issue or PR as related to a new feature.",
      "id": 267761362,
      "name": "kind/feature",
      "node_id": "MDU6TGFiZWwyNjc3NjEzNjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/feature"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    },
    {
      "color": "d455d0",
      "default": false,
      "description": "Indicates an issue that can not or will not be resolved.",
      "id": 862108765,
      "name": "triage/unresolved",
      "node_id": "MDU6TGFiZWw4NjIxMDg3NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/triage/unresolved"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84906/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MTkxMDA4MDM=",
  "number": 84906,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "performance enhance for kube-proxy/ipvs syncProxyRules",
  "updated_at": "2019-11-12T19:51:18Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84906",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/8842478?v=4",
    "events_url": "https://api.github.com/users/njuicsgz/events{/privacy}",
    "followers_url": "https://api.github.com/users/njuicsgz/followers",
    "following_url": "https://api.github.com/users/njuicsgz/following{/other_user}",
    "gists_url": "https://api.github.com/users/njuicsgz/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/njuicsgz",
    "id": 8842478,
    "login": "njuicsgz",
    "node_id": "MDQ6VXNlcjg4NDI0Nzg=",
    "organizations_url": "https://api.github.com/users/njuicsgz/orgs",
    "received_events_url": "https://api.github.com/users/njuicsgz/received_events",
    "repos_url": "https://api.github.com/users/njuicsgz/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/njuicsgz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/njuicsgz/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/njuicsgz"
  }
}