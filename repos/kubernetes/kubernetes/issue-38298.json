{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/10820769?v=4",
    "events_url": "https://api.github.com/users/jszczepkowski/events{/privacy}",
    "followers_url": "https://api.github.com/users/jszczepkowski/followers",
    "following_url": "https://api.github.com/users/jszczepkowski/following{/other_user}",
    "gists_url": "https://api.github.com/users/jszczepkowski/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jszczepkowski",
    "id": 10820769,
    "login": "jszczepkowski",
    "node_id": "MDQ6VXNlcjEwODIwNzY5",
    "organizations_url": "https://api.github.com/users/jszczepkowski/orgs",
    "received_events_url": "https://api.github.com/users/jszczepkowski/received_events",
    "repos_url": "https://api.github.com/users/jszczepkowski/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jszczepkowski/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jszczepkowski/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jszczepkowski"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/10820769?v=4",
      "events_url": "https://api.github.com/users/jszczepkowski/events{/privacy}",
      "followers_url": "https://api.github.com/users/jszczepkowski/followers",
      "following_url": "https://api.github.com/users/jszczepkowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/jszczepkowski/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jszczepkowski",
      "id": 10820769,
      "login": "jszczepkowski",
      "node_id": "MDQ6VXNlcjEwODIwNzY5",
      "organizations_url": "https://api.github.com/users/jszczepkowski/orgs",
      "received_events_url": "https://api.github.com/users/jszczepkowski/received_events",
      "repos_url": "https://api.github.com/users/jszczepkowski/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jszczepkowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jszczepkowski/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jszczepkowski"
    }
  ],
  "author_association": "MEMBER",
  "body": "I was diagnosing the test timeout in https://k8s-gubernator.appspot.com/build/kubernetes-jenkins/logs/ci-kubernetes-e2e-gke-container_vm-1.4-container_vm-1.5-upgrade-cluster-new/76 and saw that \r\n\r\n```console\r\n\"[k8s.io] [HPA] Horizontal pod autoscaling (scale resource: CPU) [k8s.io] [Serial] [Slow] ReplicaSet \" took 9h17m49.08s. Lines 3734-3870\r\n```\r\n\r\nThe interesting part is\r\n\r\n```console\r\nI1206 05:49:33.555] [k8s.io] [HPA] Horizontal pod autoscaling (scale resource: CPU) [k8s.io] [Serial] [Slow] ReplicaSet \r\nI1206 05:49:33.555]   Should scale from 5 pods to 3 pods and from 3 to 1\r\nI1206 05:49:33.555]   /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/horizontal_pod_autoscaling.go:62\r\nI1206 05:49:33.556] [BeforeEach] [k8s.io] [HPA] Horizontal pod autoscaling (scale resource: CPU)\r\nI1206 05:49:33.556]   /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/framework/framework.go:141\r\nI1206 05:49:33.556] STEP: Creating a kubernetes client\r\nI1206 05:49:33.556] Dec  6 05:49:33.554: INFO: >>> kubeConfig: /workspace/.kube/config\r\nI1206 05:49:33.556] \r\nI1206 05:49:33.559] STEP: Building a namespace api object\r\nI1206 05:49:33.644] STEP: Waiting for a default service account to be provisioned in namespace\r\nI1206 05:49:33.648] [It] Should scale from 5 pods to 3 pods and from 3 to 1\r\nI1206 05:49:33.648]   /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/test/e2e/horizontal_pod_autoscaling.go:62\r\nI1206 05:49:33.648] STEP: Running consuming RC rs via replicaset with 5 replicas\r\nI1206 05:49:33.678] STEP: creating replicaset rs in namespace e2e-tests-horizontal-pod-autoscaling-lvvbf\r\nI1206 05:49:33.678] STEP: creating replicaset rs in namespace e2e-tests-horizontal-pod-autoscaling-lvvbf\r\nI1206 05:49:33.713] I1206 05:49:33.713479    3051 runners.go:103] Created replica set with name: rs, namespace: e2e-tests-horizontal-pod-autoscaling-lvvbf, replica count: 5\r\nI1206 05:49:43.714] I1206 05:49:43.713850    3051 runners.go:103] rs Pods: 5 out of 5 created, 5 running, 0 pending, 0 waiting, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady \r\nI1206 05:49:43.714] STEP: Running controller\r\nI1206 05:49:43.722] STEP: creating replication controller rs-ctrl in namespace e2e-tests-horizontal-pod-autoscaling-lvvbf\r\nI1206 05:49:43.763] I1206 05:49:43.762667    3051 runners.go:103] Created replication controller with name: rs-ctrl, namespace: e2e-tests-horizontal-pod-autoscaling-lvvbf, replica count: 1\r\nI1206 05:49:53.763] I1206 05:49:53.763029    3051 runners.go:103] rs-ctrl Pods: 1 out of 1 created, 1 running, 0 pending, 0 waiting, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady \r\nI1206 05:50:03.763] Dec  6 05:50:03.763: INFO: RC rs: consume 375 millicores in total\r\nI1206 05:50:03.764] Dec  6 05:50:03.763: INFO: RC rs: setting consumption to 375 millicores in total\r\nI1206 05:50:03.764] Dec  6 05:50:03.763: INFO: RC rs: consume 0 MB in total\r\nI1206 05:50:03.764] Dec  6 05:50:03.763: INFO: RC rs: sending request to consume 375 millicores\r\nI1206 05:50:03.764] Dec  6 05:50:03.763: INFO: RC rs: consume custom metric 0 in total\r\nI1206 05:50:03.764] Dec  6 05:50:03.763: INFO: RC rs: setting bump of metric QPS to 0 in total\r\nI1206 05:50:03.764] Dec  6 05:50:03.763: INFO: RC rs: setting consumption to 0 MB in total\r\nI1206 05:50:03.764] Dec  6 05:50:03.763: INFO: RC rs: sending request to consume 0 of custom metric QPS\r\nI1206 05:50:03.764] Dec  6 05:50:03.763: INFO: RC rs: sending request to consume 0 MB\r\nI1206 05:50:03.769] Dec  6 05:50:03.768: INFO: URL: {https  <nil> 130.211.200.26 /api/v1/namespaces/e2e-tests-horizontal-pod-autoscaling-lvvbf/services/rs-ctrl/proxy/ConsumeCPU  false durationSec=30&millicores=375&requestSizeMillicores=20 }\r\nI1206 05:50:03.769] Dec  6 05:50:03.768: INFO: URL: {https  <nil> 130.211.200.26 /api/v1/namespaces/e2e-tests-horizontal-pod-autoscaling-lvvbf/services/rs-ctrl/proxy/ConsumeMem  false durationSec=30&megabytes=0&requestSizeMegabytes=100 }\r\nI1206 05:50:03.769] Dec  6 05:50:03.769: INFO: URL: {https  <nil> 130.211.200.26 /api/v1/namespaces/e2e-tests-horizontal-pod-autoscaling-lvvbf/services/rs-ctrl/proxy/BumpMetric  false delta=0&durationSec=30&metric=QPS&requestSizeMetrics=10 }\r\nI1206 05:50:03.838] Dec  6 05:50:03.838: INFO: replicaset: current replicas number 5 waiting to be 3\r\n... snip ...\r\nI1206 06:04:45.146] Dec  6 06:04:45.146: INFO: replicaset: current replicas number 5 waiting to be 3\r\nI1206 06:05:05.147] Dec  6 06:05:05.146: INFO: timeout waiting 15m0s for pods size to be 3\r\nI1206 06:05:05.147] STEP: Removing consuming RC rs\r\nW1206 14:51:20.408] 2016/12/06 14:51:20 e2e.go:956: Interrupt testing after 10h0m0s timeout. Will terminate in another 15m\r\n```\r\n\r\nIt seems to hit [ResourceConsumer.CleanUp()](https://github.com/kubernetes/kubernetes/blob/master/test/e2e/autoscaling_utils.go#L301) and hang. I think it's attempting to write to a blocking channel because we never see any cleanup messages from the framework functions that would be called right after the channel writes.\r\n\r\nWe no longer see messages about millicores, so it makes me think that the `ResourceConsumer.makeConsumeCPURequests()` loop terminated. This was probably some sort of GOmega error that propagates as a panic, and then gets swallowed by `GinkgoRecover()`.\r\n\r\nThe early loop exit might be the cause of a lot of HPA flakes, but the hang on a channel write should be fixed. You can make the channel buffered, but it might be better to just close the channel. I would also like this cherry picked at least to 1.5 for test stability.\r\n\r\nFound while investigating https://github.com/kubernetes/kubernetes/issues/37981",
  "closed_at": "2016-12-08T18:51:54Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/38298/comments",
  "created_at": "2016-12-07T16:27:29Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/38298/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/38298",
  "id": 194096964,
  "labels": [
    {
      "color": "eb6420",
      "default": false,
      "description": "Must be staffed and worked on either currently, or very soon, ideally in time for the next release.",
      "id": 114528223,
      "name": "priority/important-soon",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyMjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/important-soon"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Autoscaling.",
      "id": 238245616,
      "name": "sig/autoscaling",
      "node_id": "MDU6TGFiZWwyMzgyNDU2MTY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/autoscaling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/38298/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:22:47Z",
    "closed_issues": 1412,
    "created_at": "2016-08-16T21:47:28Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/647318?v=4",
      "events_url": "https://api.github.com/users/lavalamp/events{/privacy}",
      "followers_url": "https://api.github.com/users/lavalamp/followers",
      "following_url": "https://api.github.com/users/lavalamp/following{/other_user}",
      "gists_url": "https://api.github.com/users/lavalamp/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/lavalamp",
      "id": 647318,
      "login": "lavalamp",
      "node_id": "MDQ6VXNlcjY0NzMxOA==",
      "organizations_url": "https://api.github.com/users/lavalamp/orgs",
      "received_events_url": "https://api.github.com/users/lavalamp/received_events",
      "repos_url": "https://api.github.com/users/lavalamp/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/lavalamp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lavalamp/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/lavalamp"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/23",
    "id": 1945978,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/23/labels",
    "node_id": "MDk6TWlsZXN0b25lMTk0NTk3OA==",
    "number": 23,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.5",
    "updated_at": "2019-08-26T17:22:47Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/23"
  },
  "node_id": "MDU6SXNzdWUxOTQwOTY5NjQ=",
  "number": 38298,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "HPA test can hang indefinitely",
  "updated_at": "2016-12-15T22:14:51Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/38298",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/157083?v=4",
    "events_url": "https://api.github.com/users/krousey/events{/privacy}",
    "followers_url": "https://api.github.com/users/krousey/followers",
    "following_url": "https://api.github.com/users/krousey/following{/other_user}",
    "gists_url": "https://api.github.com/users/krousey/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/krousey",
    "id": 157083,
    "login": "krousey",
    "node_id": "MDQ6VXNlcjE1NzA4Mw==",
    "organizations_url": "https://api.github.com/users/krousey/orgs",
    "received_events_url": "https://api.github.com/users/krousey/received_events",
    "repos_url": "https://api.github.com/users/krousey/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/krousey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/krousey/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/krousey"
  }
}