{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/29497748?v=4",
    "events_url": "https://api.github.com/users/jiayingz/events{/privacy}",
    "followers_url": "https://api.github.com/users/jiayingz/followers",
    "following_url": "https://api.github.com/users/jiayingz/following{/other_user}",
    "gists_url": "https://api.github.com/users/jiayingz/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jiayingz",
    "id": 29497748,
    "login": "jiayingz",
    "node_id": "MDQ6VXNlcjI5NDk3NzQ4",
    "organizations_url": "https://api.github.com/users/jiayingz/orgs",
    "received_events_url": "https://api.github.com/users/jiayingz/received_events",
    "repos_url": "https://api.github.com/users/jiayingz/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jiayingz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jiayingz/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jiayingz"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/7063592?v=4",
      "events_url": "https://api.github.com/users/vishh/events{/privacy}",
      "followers_url": "https://api.github.com/users/vishh/followers",
      "following_url": "https://api.github.com/users/vishh/following{/other_user}",
      "gists_url": "https://api.github.com/users/vishh/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vishh",
      "id": 7063592,
      "login": "vishh",
      "node_id": "MDQ6VXNlcjcwNjM1OTI=",
      "organizations_url": "https://api.github.com/users/vishh/orgs",
      "received_events_url": "https://api.github.com/users/vishh/received_events",
      "repos_url": "https://api.github.com/users/vishh/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vishh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vishh/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vishh"
    },
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/29497748?v=4",
      "events_url": "https://api.github.com/users/jiayingz/events{/privacy}",
      "followers_url": "https://api.github.com/users/jiayingz/followers",
      "following_url": "https://api.github.com/users/jiayingz/following{/other_user}",
      "gists_url": "https://api.github.com/users/jiayingz/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jiayingz",
      "id": 29497748,
      "login": "jiayingz",
      "node_id": "MDQ6VXNlcjI5NDk3NzQ4",
      "organizations_url": "https://api.github.com/users/jiayingz/orgs",
      "received_events_url": "https://api.github.com/users/jiayingz/received_events",
      "repos_url": "https://api.github.com/users/jiayingz/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jiayingz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jiayingz/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jiayingz"
    }
  ],
  "author_association": "MEMBER",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n/kind bug\r\n/area hw-accelerators \r\n\r\n\r\n**What happened**:\r\nIn the context of the device plugin, when using init containers in your pod spec, the current behavior will  not reuse devices between init containers and regular containers.\r\n\r\nThis is problematic as Pod scheduling is currently wrong: \r\n[In the scheduler](https://github.com/kubernetes/kubernetes/blob/master/plugin/pkg/scheduler/algorithm/predicates/predicates.go#L550), the current predicate algorithm rightly assumes the maximum number of devices in use at one time is `max(NumDevices(Ctr1, Ctr2, ...), NumDevices(InitCtr1),  ...)`.\r\n\r\nHowever, the pod predicate ran on the node is the sum of devices used by regular and init containers. Meaning that your pod can bounce back between the scheduler and a node infinitely.\r\n\r\nAlso given that many of the extended resources are typically more expensive that the built-in ones like CPU, Memory and Storage this bug has very real financial drawbacks in terms of resource usage (e.g: using 4 GPUs on a pod that only uses 2 GPUs at a time).\r\n\r\nFurthermore, this unexpected behavior was caught during implementation (but we did not catch the scheduling implications) and decision was taken to ignore it for the first implementation. We need to document it for 1.9\r\n\r\n**What you expected to happen**:\r\n- Devices can be reused by Init Containers\r\n- Correct resource accounting\r\n\r\nIn terms of the current behavior of the Allocate call to the device plugin, I'd expect the allocate call to be done before every Init containers start and once at the end of the last Init container (for regular containers).\r\n\r\n/assign @jiayingz @vishh ",
  "closed_at": "2017-12-13T01:25:56Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 38,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56022/comments",
  "created_at": "2017-11-19T17:48:23Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56022/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/56022",
  "id": 275177661,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 644163893,
      "name": "area/hw-accelerators",
      "node_id": "MDU6TGFiZWw2NDQxNjM4OTM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/hw-accelerators"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56022/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNzUxNzc2NjE=",
  "number": 56022,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Devices are not re-used when paired with init containers",
  "updated_at": "2017-12-13T01:25:56Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56022",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/2519571?v=4",
    "events_url": "https://api.github.com/users/RenaudWasTaken/events{/privacy}",
    "followers_url": "https://api.github.com/users/RenaudWasTaken/followers",
    "following_url": "https://api.github.com/users/RenaudWasTaken/following{/other_user}",
    "gists_url": "https://api.github.com/users/RenaudWasTaken/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/RenaudWasTaken",
    "id": 2519571,
    "login": "RenaudWasTaken",
    "node_id": "MDQ6VXNlcjI1MTk1NzE=",
    "organizations_url": "https://api.github.com/users/RenaudWasTaken/orgs",
    "received_events_url": "https://api.github.com/users/RenaudWasTaken/received_events",
    "repos_url": "https://api.github.com/users/RenaudWasTaken/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/RenaudWasTaken/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RenaudWasTaken/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/RenaudWasTaken"
  }
}