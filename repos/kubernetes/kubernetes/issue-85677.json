{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/40361897?v=4",
    "events_url": "https://api.github.com/users/ahg-g/events{/privacy}",
    "followers_url": "https://api.github.com/users/ahg-g/followers",
    "following_url": "https://api.github.com/users/ahg-g/following{/other_user}",
    "gists_url": "https://api.github.com/users/ahg-g/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ahg-g",
    "id": 40361897,
    "login": "ahg-g",
    "node_id": "MDQ6VXNlcjQwMzYxODk3",
    "organizations_url": "https://api.github.com/users/ahg-g/orgs",
    "received_events_url": "https://api.github.com/users/ahg-g/received_events",
    "repos_url": "https://api.github.com/users/ahg-g/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ahg-g/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ahg-g/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ahg-g"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/40361897?v=4",
      "events_url": "https://api.github.com/users/ahg-g/events{/privacy}",
      "followers_url": "https://api.github.com/users/ahg-g/followers",
      "following_url": "https://api.github.com/users/ahg-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahg-g/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/ahg-g",
      "id": 40361897,
      "login": "ahg-g",
      "node_id": "MDQ6VXNlcjQwMzYxODk3",
      "organizations_url": "https://api.github.com/users/ahg-g/orgs",
      "received_events_url": "https://api.github.com/users/ahg-g/received_events",
      "repos_url": "https://api.github.com/users/ahg-g/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/ahg-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahg-g/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/ahg-g"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**What happened**:\r\n\r\nScheduler decided that it wants to schedule Pod P on Node N after preempting some pods from N.\r\nIt set the P.nominatedNodeName to N. After a while (before scheduling actually happened) node N was removed from the cluster.\r\nScheduler did not reset P.nominatedNodeName to empty value.\r\n\r\n**What you expected to happen**:\r\n\r\nI would expect scheduler to unset P.nominatedNodeName when the node is no longer valid.\r\nThe trivial reason for node not being valid any more is it is removed from the cluster. \r\nBut there are more cases to cover. Out of the top of my head I may think of:\r\n- extra Pod was scheduled to node and there is not enough resources any more\r\n  - either scheduled by scheduler\r\n  - or directly as static pod/daemonset\r\n- node became unschedulable\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nWe did not try to reproduce issue manually. Yet following setup should work.\r\n- create cluster with nodes A and B.\r\n- ensure all system pods are running on A. Fill up A so it does not have spare resources.\r\n- add a low priority Pod L with long termination, with requests matching allocatable of B. It should be scheduled to B.\r\n- add a high priority Pod H. It should get B as nominatedNodeName\r\n- kill node B\r\n- the H.nominatedNodeName will still point to B which is no longer in the cluster\r\n\r\n**Anything else we need to know?**:\r\n\r\nCurrent behavior does not play well with Cluster Autoscaler which assumes that Pod with nominatedNodeName will be scheduled in a while.\r\nTherefore such pods do not trigger scale-up. If we can have P.nominatedNodeName set incorrectly for unbounded period of time CA will never\r\nprovision node for P to run.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n\r\nWe observed the behavior during presubmit tests which run k8s built from HEAD of master on 27.11.2019.\r\n\r\nVersions logged in test log:\r\nI1125 18:55:11.691] Client Version: version.Info{Major:\"1\", Minor:\"18+\", GitVersion:\"v1.18.0-alpha.0.1183+414202578ba1ad\", GitCommit:\"414202578ba1ad53a26bc5126b3828a3a410097e\", GitTreeState:\"clean\", BuildDate:\"2019-11-25T17:04:18Z\", GoVersion:\"go1.13.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nI1125 18:55:11.692] Server Version: version.Info{Major:\"1\", Minor:\"18+\", GitVersion:\"v1.18.0-alpha.0.1183+414202578ba1ad\", GitCommit:\"414202578ba1ad53a26bc5126b3828a3a410097e\", GitTreeState:\"clean\", BuildDate:\"2019-11-25T17:04:18Z\", GoVersion:\"go1.13.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n- Cloud provider or hardware configuration:\r\nGCE\r\n\r\n/sig scheduling\r\n",
  "closed_at": null,
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 16,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85677/comments",
  "created_at": "2019-11-27T10:48:51Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85677/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/85677",
  "id": 529266976,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85677/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MjkyNjY5NzY=",
  "number": 85677,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "open",
  "title": "Scheduler does not clear nominatedNodeName on Pod when node is no longer valid",
  "updated_at": "2020-10-08T04:14:05Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85677",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/890111?v=4",
    "events_url": "https://api.github.com/users/losipiuk/events{/privacy}",
    "followers_url": "https://api.github.com/users/losipiuk/followers",
    "following_url": "https://api.github.com/users/losipiuk/following{/other_user}",
    "gists_url": "https://api.github.com/users/losipiuk/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/losipiuk",
    "id": 890111,
    "login": "losipiuk",
    "node_id": "MDQ6VXNlcjg5MDExMQ==",
    "organizations_url": "https://api.github.com/users/losipiuk/orgs",
    "received_events_url": "https://api.github.com/users/losipiuk/received_events",
    "repos_url": "https://api.github.com/users/losipiuk/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/losipiuk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/losipiuk/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/losipiuk"
  }
}