{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4953962?v=4",
    "events_url": "https://api.github.com/users/m1093782566/events{/privacy}",
    "followers_url": "https://api.github.com/users/m1093782566/followers",
    "following_url": "https://api.github.com/users/m1093782566/following{/other_user}",
    "gists_url": "https://api.github.com/users/m1093782566/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/m1093782566",
    "id": 4953962,
    "login": "m1093782566",
    "node_id": "MDQ6VXNlcjQ5NTM5NjI=",
    "organizations_url": "https://api.github.com/users/m1093782566/orgs",
    "received_events_url": "https://api.github.com/users/m1093782566/received_events",
    "repos_url": "https://api.github.com/users/m1093782566/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/m1093782566/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/m1093782566/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/m1093782566"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/4953962?v=4",
      "events_url": "https://api.github.com/users/m1093782566/events{/privacy}",
      "followers_url": "https://api.github.com/users/m1093782566/followers",
      "following_url": "https://api.github.com/users/m1093782566/following{/other_user}",
      "gists_url": "https://api.github.com/users/m1093782566/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/m1093782566",
      "id": 4953962,
      "login": "m1093782566",
      "node_id": "MDQ6VXNlcjQ5NTM5NjI=",
      "organizations_url": "https://api.github.com/users/m1093782566/orgs",
      "received_events_url": "https://api.github.com/users/m1093782566/received_events",
      "repos_url": "https://api.github.com/users/m1093782566/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/m1093782566/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/m1093782566/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/m1093782566"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n/kind bug\r\n\r\n**What happened**:\r\nUpon removing an endpoint, the ipvs proxier immediately deletes the ipvs real server, causing all connections to get dropped.\r\n\r\n**What you expected to happen**:\r\nIt should allow the terminating pod to gracefully close connections, just like the iptables proxier.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n1. Enable ipvs proxier\r\n2. Create a keepalive / long lived connection to a pod (e.g. `while :; do echo -e \"GET / HTTP/1.1\\nhost: $host\\n\\n\"; sleep 5; echo; done | telnet $serviceip 80`)\r\n3. Delete that pod - observe the connection gets closed immediately, further requests will fail. On iptables proxier, it will continue to work (until the pod itself stops or closes the connection).\r\n\r\n**Anything else we need to know?**:\r\nThe ipvs proxier should instead be setting weight to 0, then reaping the stale real servers after some time period (that should be greater than any pod's graceful termination time). This may also fix the existing bug around UDP connections getting dropped prematurely (https://github.com/kubernetes/kubernetes/issues/45976).\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): tested on 1.8, but same issue in 1.9 afaict\r\n- Cloud provider or hardware configuration: AWS\r\n- OS (e.g. from /etc/os-release): Ubuntu 16.04\r\n- Kernel (e.g. `uname -a`): 4.4.0\r\n- Install tools:\r\n- Others:\r\n\r\n  ",
  "closed_at": "2018-09-28T08:56:13Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 32,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/57841/comments",
  "created_at": "2018-01-04T14:39:33Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/57841/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/57841",
  "id": 286005437,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 755527763,
      "name": "area/ipvs",
      "node_id": "MDU6TGFiZWw3NTU1Mjc3NjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/ipvs"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/57841/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyODYwMDU0Mzc=",
  "number": 57841,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "ipvs proxier doesn't respect graceful termination",
  "updated_at": "2018-09-28T08:56:13Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/57841",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/522123?v=4",
    "events_url": "https://api.github.com/users/jsravn/events{/privacy}",
    "followers_url": "https://api.github.com/users/jsravn/followers",
    "following_url": "https://api.github.com/users/jsravn/following{/other_user}",
    "gists_url": "https://api.github.com/users/jsravn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jsravn",
    "id": 522123,
    "login": "jsravn",
    "node_id": "MDQ6VXNlcjUyMjEyMw==",
    "organizations_url": "https://api.github.com/users/jsravn/orgs",
    "received_events_url": "https://api.github.com/users/jsravn/received_events",
    "repos_url": "https://api.github.com/users/jsravn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jsravn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jsravn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jsravn"
  }
}