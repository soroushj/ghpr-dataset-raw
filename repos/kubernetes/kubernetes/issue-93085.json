{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\nWhen adding the backend pool for the VMSS model after updating VMSSVM instances, there is currently no check to determine the correct ip config to use based on the IP family. This results in an error at the first attempt. When controller retries to ensure load balancer, since the VMSSVMs were successfully updated, a success is returned instead. \r\n\r\n```\r\n  Warning  SyncLoadBalancerFailed  6m52s  service-controller  Error syncing load balancer: failed to ensure load balancer: Retriable: false, RetryAfter: 0s, HTTPStatusCode: 400, RawError: Retriable: false, RetryAfter: 0s, HTTPStatusCode: 400, RawError: {\r\n\"error\": {\r\n    \"details\": [],\r\n    \"code\": \"AllNicIpConfigurationsOfLbBackendPoolOnVMScaleSetMustHaveSamePrivateIpAddressVersion\",\r\n    \"message\": \"Network interface ipConfiguration 'ipconfig1' of VM Scale Set '/subscriptions/<subscription>/resourceGroups/<resource group>/providers/Microsoft.Compute/virtualMachineScaleSets/3236k8s00' has privateIpAddressVersion 'IPv4' that does not match with privateIpAddressVersion 'IPv6' of ipConfiguration 'ipconfig1v6' in the same load balancer backend address pool '/subscriptions/<subscription>/resourceGroups/<resource group>/providers/Microsoft.Network/loadBalancers/vavenk-dualstack2-eafd/backendAddressPools/vavenk-dualstack2-eafd-IPv6'.\"\r\n  }\r\n}\r\n```\r\n\r\n**What you expected to happen**:\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.16+\r\n- Cloud provider or hardware configuration: cloud provider\r\n- OS (e.g: `cat /etc/os-release`):\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools:\r\n- Network plugin and version (if this is a network-related bug):\r\n- Others:\r\n\r\n/area provider/azure\r\n/priority important-soon\r\n/kind bug",
  "closed_at": "2020-07-17T22:02:51Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/93085/comments",
  "created_at": "2020-07-15T00:09:12Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/93085/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/93085",
  "id": 656970313,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to azure provider",
      "id": 852130786,
      "name": "area/provider/azure",
      "node_id": "MDU6TGFiZWw4NTIxMzA3ODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/azure"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": "Must be staffed and worked on either currently, or very soon, ideally in time for the next release.",
      "id": 114528223,
      "name": "priority/important-soon",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyMjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/important-soon"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Cloud Provider.",
      "id": 958178286,
      "name": "sig/cloud-provider",
      "node_id": "MDU6TGFiZWw5NTgxNzgyODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cloud-provider"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/93085/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2NTY5NzAzMTM=",
  "number": 93085,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "failed to add backend pool for VMSS for IPv6 service",
  "updated_at": "2020-07-17T22:02:51Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/93085",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/10608509?v=4",
    "events_url": "https://api.github.com/users/aramase/events{/privacy}",
    "followers_url": "https://api.github.com/users/aramase/followers",
    "following_url": "https://api.github.com/users/aramase/following{/other_user}",
    "gists_url": "https://api.github.com/users/aramase/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/aramase",
    "id": 10608509,
    "login": "aramase",
    "node_id": "MDQ6VXNlcjEwNjA4NTA5",
    "organizations_url": "https://api.github.com/users/aramase/orgs",
    "received_events_url": "https://api.github.com/users/aramase/received_events",
    "repos_url": "https://api.github.com/users/aramase/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/aramase/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aramase/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/aramase"
  }
}