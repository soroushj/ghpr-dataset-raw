{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind feature\r\n\r\n\r\n**What happened**:\r\nAccording to the nature of Azure network, it is implement things a little different. So right now, we are facing many issues.\r\n1. We have seeing resources leaking. The reason is that, to enable k8s's LoadBalancer, we need multiple resources from Azure, such as Azure LoadBalancer, Azure Network Security Group, Azure Public IP, etc. And also Azure LoadBalancer, and Azure Network Security Group are shared resources across different services. The fact makes resources are more likely to out of sync. I have seen Public IP resource remains, after remove the corresponding service\r\n\r\n2. For Azure K8s cluster, we currently only use a single Azure Load Balancer resource to hold configs for all the services. Because the limitation of one Azure Load Balancer resources, such as we only can create 150 LB rules by default, we somehow limited the number of services user can create. \r\n\r\n3. Similar to Azure LB's limit, Network Security Group also has limit for its rules. It also limits number of services user can create. \r\n\r\n**What you expected to happen**:\r\n1. We expect resources for one service can share the same life cycle of the corresponding service.\r\n2. We expect we can create more Azure LB resources, so services can be distributed on more multiple Azure LBs. It increases the number of services user can create. \r\n3. We expect to consolidate NSG rules. Services can share the exact same NSG rule in many scenarios. In this way, we can dramatically decrease number of rules for cluster. It also improves number of services user can create. \r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n1. When we delete services, if we hit 429 after removed Azure LB config, but before removing Azure Public IP. The public ip will stay there forever, until manually cleaned up.\r\n2. Only one LB is used. It is the current behavior\r\n3. Create 2 services, only with name different. You will see two exact same NSG rules created. Which is unnecessary.\r\n\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n- Cloud provider or hardware configuration: Azure\r\n- OS (e.g. from /etc/os-release):\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools:\r\n- Others:\r\n\r\n/sig azure",
  "closed_at": "2017-11-21T05:03:45Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/55627/comments",
  "created_at": "2017-11-13T18:10:27Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/55627/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/55627",
  "id": 273525596,
  "labels": [
    {
      "color": "c7def8",
      "default": false,
      "description": "Categorizes issue or PR as related to a new feature.",
      "id": 267761362,
      "name": "kind/feature",
      "node_id": "MDU6TGFiZWwyNjc3NjEzNjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/feature"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/55627/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNzM1MjU1OTY=",
  "number": 55627,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "[Azure] cloud provider load balancer general improvement",
  "updated_at": "2017-11-21T05:03:45Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/55627",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/10858648?v=4",
    "events_url": "https://api.github.com/users/rjtsdl/events{/privacy}",
    "followers_url": "https://api.github.com/users/rjtsdl/followers",
    "following_url": "https://api.github.com/users/rjtsdl/following{/other_user}",
    "gists_url": "https://api.github.com/users/rjtsdl/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/rjtsdl",
    "id": 10858648,
    "login": "rjtsdl",
    "node_id": "MDQ6VXNlcjEwODU4NjQ4",
    "organizations_url": "https://api.github.com/users/rjtsdl/orgs",
    "received_events_url": "https://api.github.com/users/rjtsdl/received_events",
    "repos_url": "https://api.github.com/users/rjtsdl/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/rjtsdl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rjtsdl/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/rjtsdl"
  }
}