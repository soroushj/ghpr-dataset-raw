{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n\r\n**Is this a request for help?** (If yes, you should use our troubleshooting guide and community support channels, see http://kubernetes.io/docs/troubleshooting/.):\r\n\r\n\r\n**What keywords did you search in Kubernetes issues before filing this one?** (If you have found any duplicates, you should instead reply there.):\r\n\r\n---\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?** (choose one): BUG REPORT\r\n\r\n<!--\r\nIf this is a BUG REPORT, please:\r\n  - Fill in as much of the template below as you can.  If you leave out\r\n    information, we can't help you as well.\r\n\r\nIf this is a FEATURE REQUEST, please:\r\n  - Describe *in detail* the feature/behavior/change you'd like to see.\r\n\r\nIn both cases, be ready for followup questions, and please respond in a timely\r\nmanner.  If we can't reproduce a bug or think a feature already exists, we\r\nmight close your issue.  If we're wrong, PLEASE feel free to reopen it and\r\nexplain why.\r\n-->\r\n\r\n**Kubernetes version** (use `kubectl version`): K8S 1.5.3, and kubectl 1.5.3\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**: azure\r\n- **OS** (e.g. from /etc/os-release): xenial\r\n- **Kernel** (e.g. `uname -a`): latest xenial\r\n- **Install tools**:\r\n- **Others**: ACS-Engine cluster, 3 masters\r\n\r\n\r\n**What happened**:\r\nNodeport 30177 is assigned to dashboard and to the nginx service that was started within a minute of starting the dashboard.  The dashboard is being started as part of the addon manager.\r\n\r\n**What you expected to happen**:\r\nEach service should receive a separate node port.\r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\nRun 3 master setup, with 3 API servers, 3 addon managers, 3 controllers (but one controller is elected leader).  Run dashboard as an add-on.  Create service shortly after dashboard is started an assigned nodeport.\r\n\r\nWe run a Jenkin's job, and this repros about 30-50% of the time. \r\n\r\n**Anything else we need to know**:\r\nWe instrumented the build and found the following:\r\n1. Dashboard is initially created by the addon manager by issuing a POST to/api/v1/namespaces/kube-system/services.  This is where port 30177 is added, and snapshotted to etcd\r\n2.  Immediately after the POST, another addon manager issues PATCH /api/v1/namespaces/kube-system/services/kubernetes-dashboard.  The post calls a release to 30177, and this is snapshotted to etcd.\r\n3. Another API server receives the request for nginx and assigns 30177 to nginx service.\r\n4. Afterwards all api servers start reporting message the node port 30177 for service nginx/namespace-15616 was assigned to multiple services.\r\n\r\n**Workaround**: delete the nginx service, re-create the service.\r\n\r\n@thockin have you seen this before?  This build has your latest changelist around repair.go #39206, but from best we can observe is unrelated to the changes.\r\n\r\n",
  "closed_at": "2017-03-17T05:39:30Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 17,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43233/comments",
  "created_at": "2017-03-16T17:39:59Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43233/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/43233",
  "id": 214784277,
  "labels": [],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43233/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMTQ3ODQyNzc=",
  "number": 43233,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Nodeport assigned to two services on 3 Master HA Cluster",
  "updated_at": "2017-03-17T05:39:30Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43233",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/12574506?v=4",
    "events_url": "https://api.github.com/users/anhowe/events{/privacy}",
    "followers_url": "https://api.github.com/users/anhowe/followers",
    "following_url": "https://api.github.com/users/anhowe/following{/other_user}",
    "gists_url": "https://api.github.com/users/anhowe/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/anhowe",
    "id": 12574506,
    "login": "anhowe",
    "node_id": "MDQ6VXNlcjEyNTc0NTA2",
    "organizations_url": "https://api.github.com/users/anhowe/orgs",
    "received_events_url": "https://api.github.com/users/anhowe/received_events",
    "repos_url": "https://api.github.com/users/anhowe/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/anhowe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/anhowe/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/anhowe"
  }
}