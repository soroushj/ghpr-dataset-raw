{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4876867?v=4",
    "events_url": "https://api.github.com/users/janetkuo/events{/privacy}",
    "followers_url": "https://api.github.com/users/janetkuo/followers",
    "following_url": "https://api.github.com/users/janetkuo/following{/other_user}",
    "gists_url": "https://api.github.com/users/janetkuo/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/janetkuo",
    "id": 4876867,
    "login": "janetkuo",
    "node_id": "MDQ6VXNlcjQ4NzY4Njc=",
    "organizations_url": "https://api.github.com/users/janetkuo/orgs",
    "received_events_url": "https://api.github.com/users/janetkuo/received_events",
    "repos_url": "https://api.github.com/users/janetkuo/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/janetkuo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/janetkuo/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/janetkuo"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/4876867?v=4",
      "events_url": "https://api.github.com/users/janetkuo/events{/privacy}",
      "followers_url": "https://api.github.com/users/janetkuo/followers",
      "following_url": "https://api.github.com/users/janetkuo/following{/other_user}",
      "gists_url": "https://api.github.com/users/janetkuo/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/janetkuo",
      "id": 4876867,
      "login": "janetkuo",
      "node_id": "MDQ6VXNlcjQ4NzY4Njc=",
      "organizations_url": "https://api.github.com/users/janetkuo/orgs",
      "received_events_url": "https://api.github.com/users/janetkuo/received_events",
      "repos_url": "https://api.github.com/users/janetkuo/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/janetkuo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/janetkuo/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/janetkuo"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind bug\r\n/sig auth\r\n\r\n**What happened**:\r\n\r\nTesting a daemon-set spec, I deleted/recreated it multiple times. At one of the recreations, the daemon-set was not scheduled anymore, and the number of desired pods went to 0 (on a 3 nodes cluster):\r\n\r\n```\r\n$ kubectl get ds -n pks-infrastructure\r\nNAME             DESIRED   CURRENT   READY     UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\r\nnsx-node-agent   0         0         0         0            0           <none>          2m\r\n```\r\n\r\nThe kube-apiserver stderr logs shows:\r\n\r\n```\r\nI0404 14:33:01.871517    5724 wrap.go:42] POST /apis/extensions/v1beta1/namespaces/pks-infrastructure/daemonsets: (7.588801ms) 201 [[kubectl/v1.9.5 (linux/amd64) kubernetes/f01a2bf] 30.0.1.3:38984]\r\nI0404 14:33:01.880581    5724 wrap.go:42] POST /apis/apps/v1beta1/namespaces/pks-infrastructure/controllerrevisions: (7.853889ms) 409 [[kube-controller-manager/v1.9.5 (linux/amd64) kubernetes/f01a2bf/system:serviceaccount:kube-system:daemon-set-controller] 30.0.1.2:50964]\r\nI0404 14:33:01.881572    5724 rbac.go:116] RBAC DENY: user \"system:serviceaccount:kube-system:daemon-set-controller\" groups [\"system:serviceaccounts\" \"system:serviceaccounts:kube-system\" \"system:authenticated\"] cannot \"get\" resource \"controllerrevisions.apps\" named \"nsx-node-agent-8f5d66fd6\" in namespace \"pks-infrastructure\"\r\nI0404 14:33:01.881971    5724 wrap.go:42] GET /apis/apps/v1beta1/namespaces/pks-infrastructure/controllerrevisions/nsx-node-agent-8f5d66fd6: (633.24\u00b5s) 403 [[kube-controller-manager/v1.9.5 (linux/amd64) kubernetes/f01a2bf/system:serviceaccount:kube-system:daemon-set-controller] 30.0.1.2:50964]\r\n```\r\nThe kube-controller stderr logs shows:\r\n\r\n```\r\nE0404 14:57:48.743754   10416 daemon_controller.go:265] pks-infrastructure/nsx-node-agent failed with : failed to construct revisions of DaemonSet: controllerrevisions.apps \"nsx-node-agent-8f5d66fd6\" is forbidden: User \"system:serviceaccount:kube-system:daemon-set-controller\" cannot get controllerrevisions.apps in the namespace \"pks-infrastructure\"\r\n```\r\n\r\nThe (default) permissions for the `system:controller:daemon-set-controller` cluster role are:\r\n\r\n```\r\n$ kubectl describe  clusterroles system:controller:daemon-set-controller\r\nName:         system:controller:daemon-set-controller\r\nLabels:       kubernetes.io/bootstrapping=rbac-defaults\r\nAnnotations:  rbac.authorization.kubernetes.io/autoupdate=true\r\nPolicyRule:\r\n  Resources                         Non-Resource URLs  Resource Names  Verbs\r\n  ---------                         -----------------  --------------  -----\r\n  events                            []                 []              [create patch update]\r\n  nodes                             []                 []              [list watch]\r\n  pods                              []                 []              [create delete list patch watch]\r\n  pods/binding                      []                 []              [create]\r\n  controllerrevisions.apps          []                 []              [create delete list patch update watch]\r\n  daemonsets.apps                   []                 []              [get list watch]\r\n  daemonsets.apps/finalizers        []                 []              [update]\r\n  daemonsets.apps/status            []                 []              [update]\r\n  daemonsets.extensions             []                 []              [get list watch]\r\n  daemonsets.extensions/finalizers  []                 []              [update]\r\n  daemonsets.extensions/status      []                 []              [update]\r\n```\r\n\r\nSeems to be missing a `get` permission for the `controllerrevisions.apps` resource. I edited manually the cluster-role adding the `get` permission and then the daemonset was scheduled again.\r\n\r\n**What you expected to happen**:\r\n\r\nThe `system:controller:daemon-set-controller` cluster role default permissions should allow getting the `controllerrevisions.apps` resource.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nI tried to reproduce it again, but I'm unable to find the exact pattern to reproduce it. \r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): `v1.9.2`\r\n- Cloud provider or hardware configuration: `vSphere`\r\n- OS (e.g. from /etc/os-release): \r\n```\r\nNAME=\"Ubuntu\"\r\nVERSION=\"14.04.5 LTS, Trusty Tahr\"\r\nID=ubuntu\r\nID_LIKE=debian\r\nPRETTY_NAME=\"Ubuntu 14.04.5 LTS\"\r\nVERSION_ID=\"14.04\"\r\nHOME_URL=\"http://www.ubuntu.com/\"\r\nSUPPORT_URL=\"http://help.ubuntu.com/\"\r\nBUG_REPORT_URL=\"http://bugs.launchpad.net/ubuntu/\"\r\n```\r\n- Kernel (e.g. `uname -a`): `Linux dc9711b4-9208-444b-9eac-78048ca082a5 4.4.0-116-generic #140~14.04.1-Ubuntu SMP Fri Feb 16 09:25:20 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux`\r\n- Install tools:\r\n- Others:\r\n",
  "closed_at": "2018-04-13T07:27:01Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/62145/comments",
  "created_at": "2018-04-04T22:17:25Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/62145/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/62145",
  "id": 311410210,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Apps.",
      "id": 404091735,
      "name": "sig/apps",
      "node_id": "MDU6TGFiZWw0MDQwOTE3MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/apps"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/62145/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMTE0MTAyMTA=",
  "number": 62145,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "`daemon-set-controller` bootstrap RBAC policy does not include `get` permission for `controllerrevisions`",
  "updated_at": "2018-04-13T07:27:01Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/62145",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/405846?v=4",
    "events_url": "https://api.github.com/users/frodenas/events{/privacy}",
    "followers_url": "https://api.github.com/users/frodenas/followers",
    "following_url": "https://api.github.com/users/frodenas/following{/other_user}",
    "gists_url": "https://api.github.com/users/frodenas/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/frodenas",
    "id": 405846,
    "login": "frodenas",
    "node_id": "MDQ6VXNlcjQwNTg0Ng==",
    "organizations_url": "https://api.github.com/users/frodenas/orgs",
    "received_events_url": "https://api.github.com/users/frodenas/received_events",
    "repos_url": "https://api.github.com/users/frodenas/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/frodenas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frodenas/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/frodenas"
  }
}