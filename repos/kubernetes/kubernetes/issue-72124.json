{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/14308438?v=4",
    "events_url": "https://api.github.com/users/bsalamat/events{/privacy}",
    "followers_url": "https://api.github.com/users/bsalamat/followers",
    "following_url": "https://api.github.com/users/bsalamat/following{/other_user}",
    "gists_url": "https://api.github.com/users/bsalamat/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bsalamat",
    "id": 14308438,
    "login": "bsalamat",
    "node_id": "MDQ6VXNlcjE0MzA4NDM4",
    "organizations_url": "https://api.github.com/users/bsalamat/orgs",
    "received_events_url": "https://api.github.com/users/bsalamat/received_events",
    "repos_url": "https://api.github.com/users/bsalamat/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bsalamat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bsalamat/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bsalamat"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/14308438?v=4",
      "events_url": "https://api.github.com/users/bsalamat/events{/privacy}",
      "followers_url": "https://api.github.com/users/bsalamat/followers",
      "following_url": "https://api.github.com/users/bsalamat/following{/other_user}",
      "gists_url": "https://api.github.com/users/bsalamat/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/bsalamat",
      "id": 14308438,
      "login": "bsalamat",
      "node_id": "MDQ6VXNlcjE0MzA4NDM4",
      "organizations_url": "https://api.github.com/users/bsalamat/orgs",
      "received_events_url": "https://api.github.com/users/bsalamat/received_events",
      "repos_url": "https://api.github.com/users/bsalamat/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/bsalamat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bsalamat/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/bsalamat"
    }
  ],
  "author_association": "MEMBER",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!-->\r\n\r\n\r\n**What happened**:\r\nSetting nominatedNodeName has an inherent race:\r\n1. The scheduler tries a pod and finds it unschedulable.\r\n1. The preemption logic tries and finds a node to schedule the pod (with or without preempting any other pod).\r\n1. The scheduler sends a pod update to update nominatedNodeName of the pod.\r\n    The scheduler has NOT received the pod update for setting \"nominatedNodeName\" yet.\r\n1. The scheduler tries another pod and finds the same node schedulable. So, it binds the second pod.\r\n1. The nominated Pod has the nominatedNodeName set, but the resources on the node are already taken by another pod, so the nominated pod is no longer schedulable on that node.\r\n\r\nThe race that I described above can cause an issue:\r\n1. There is a pod which has nominatedNodeName, but is affected by the above race.\r\n1. A smaller pod with the same priority is scheduled on the same node (due to the above race condition).\r\n1. There is enough room on the node for other small pods, but since there exists a nominated pod for the node, other smaller pods won't be scheduled there. The nominated pod cannot be scheduled there either, because the available resources are partially taken by the other smaller pod and there are not enough resources for the nominated pod.\r\n\r\n**What you expected to happen**:\r\n\r\nThe race condition in setting nominatedNodeName must be eliminated. We should use a similar approach to \"assume\" to update the scheduler cache with nominated pods early and not wait for pod status updates.\r\n\r\n<!-- DO NOT EDIT BELOW THIS LINE -->\r\n/kind bug\r\n\r\n/sig scheduling\r\n/assign",
  "closed_at": "2018-12-30T08:01:27Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/72124/comments",
  "created_at": "2018-12-17T20:08:43Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/72124/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/72124",
  "id": 391870956,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/72124/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzOTE4NzA5NTY=",
  "number": 72124,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Race condition in preemption logic of the scheduler when setting nominatedNodeName ",
  "updated_at": "2018-12-30T08:01:27Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/72124",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/14308438?v=4",
    "events_url": "https://api.github.com/users/bsalamat/events{/privacy}",
    "followers_url": "https://api.github.com/users/bsalamat/followers",
    "following_url": "https://api.github.com/users/bsalamat/following{/other_user}",
    "gists_url": "https://api.github.com/users/bsalamat/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bsalamat",
    "id": 14308438,
    "login": "bsalamat",
    "node_id": "MDQ6VXNlcjE0MzA4NDM4",
    "organizations_url": "https://api.github.com/users/bsalamat/orgs",
    "received_events_url": "https://api.github.com/users/bsalamat/received_events",
    "repos_url": "https://api.github.com/users/bsalamat/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bsalamat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bsalamat/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bsalamat"
  }
}