{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/5331316?v=4",
    "events_url": "https://api.github.com/users/tnqn/events{/privacy}",
    "followers_url": "https://api.github.com/users/tnqn/followers",
    "following_url": "https://api.github.com/users/tnqn/following{/other_user}",
    "gists_url": "https://api.github.com/users/tnqn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tnqn",
    "id": 5331316,
    "login": "tnqn",
    "node_id": "MDQ6VXNlcjUzMzEzMTY=",
    "organizations_url": "https://api.github.com/users/tnqn/orgs",
    "received_events_url": "https://api.github.com/users/tnqn/received_events",
    "repos_url": "https://api.github.com/users/tnqn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tnqn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tnqn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tnqn"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/5331316?v=4",
      "events_url": "https://api.github.com/users/tnqn/events{/privacy}",
      "followers_url": "https://api.github.com/users/tnqn/followers",
      "following_url": "https://api.github.com/users/tnqn/following{/other_user}",
      "gists_url": "https://api.github.com/users/tnqn/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/tnqn",
      "id": 5331316,
      "login": "tnqn",
      "node_id": "MDQ6VXNlcjUzMzEzMTY=",
      "organizations_url": "https://api.github.com/users/tnqn/orgs",
      "received_events_url": "https://api.github.com/users/tnqn/received_events",
      "repos_url": "https://api.github.com/users/tnqn/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/tnqn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tnqn/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/tnqn"
    }
  ],
  "author_association": "MEMBER",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\nI used `k8s.io/client-go/kubernetes/fake.NewSimpleClientset` to fake a clientset to test my code. I found that it became very slow to init the clientset with a big number of objects when I was trying to simulate a large scale cluster, and the time seemed exponential increasing. For example:\r\nInitializing a clientset with:\r\n- 5000 objects took 300ms\r\n- 10000 objects took 2.58s\r\n- 20000 objects took 11.82s\r\n- 40000 objects took 54.64s.\r\n\r\nIt's because the fake clientset used a slice to store each kind of objects, so it's quite slow to init the clientset with massive objects because it checked existence of an object by traversing all objects and comparing with them before adding one, which leads to O(n^2) time complexity.\r\n\r\n**What you expected to happen**:\r\nThe fake clientset is very useful for development, it should have a reasonable time complexity to allow developers to use it for large scale scenario.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nRun this code:\r\n```\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"fmt\"\r\n\t\"time\"\r\n\r\n\t\"github.com/google/uuid\"\r\n\t\"k8s.io/api/core/v1\"\r\n\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\r\n\t\"k8s.io/apimachinery/pkg/runtime\"\r\n\t\"k8s.io/apimachinery/pkg/types\"\r\n\t\"k8s.io/apimachinery/pkg/util/rand\"\r\n\t\"k8s.io/client-go/kubernetes/fake\"\r\n)\r\n\r\nfunc main() {\r\n\tnumPods := 40000\r\n\tpods := make([]runtime.Object, numPods)\r\n\tfor i := range pods {\r\n\t\tpods[i] = &v1.Pod{\r\n\t\t\tObjectMeta: metav1.ObjectMeta{Namespace: rand.String(10), Name: rand.String(10), UID: types.UID(uuid.New().String())},\r\n\t\t}\r\n\t}\r\n\tstart := time.Now()\r\n\tclientset := fake.NewSimpleClientset(pods...)\r\n\tfmt.Printf(\"Init took %v\\n\", time.Since(start))\r\n\r\n\tnewPod := &v1.Pod{\r\n\t\tObjectMeta: metav1.ObjectMeta{Namespace: rand.String(10), Name: rand.String(10), UID: types.UID(uuid.New().String())},\r\n\t}\r\n\tstart = time.Now()\r\n\tclientset.CoreV1().Pods(newPod.Namespace).Create(context.Background(), newPod, metav1.CreateOptions{})\r\n\tfmt.Printf(\"Create took %v\\n\", time.Since(start))\r\n\r\n\tlastPod := pods[numPods-1].(*v1.Pod)\r\n\tstart = time.Now()\r\n\tclientset.CoreV1().Pods(lastPod.Namespace).Get(context.Background(), lastPod.Name, metav1.GetOptions{})\r\n\tfmt.Printf(\"Get took %v\\n\", time.Since(start))\r\n}\r\n```\r\nYou would see the time spent on each operation, like:\r\n```\r\nInit took 54.649879329s\r\nCreate took 5.697015ms\r\nGet took 2.741645ms\r\n```\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.15.0-1.18.0\r\n- Cloud provider or hardware configuration:\r\n- OS (e.g: `cat /etc/os-release`):\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools:\r\n- Network plugin and version (if this is a network-related bug):\r\n- Others:\r\n",
  "closed_at": "2020-03-30T15:22:08Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/89574/comments",
  "created_at": "2020-03-27T12:40:15Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/89574/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/89574",
  "id": 589106265,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "ededed",
      "default": false,
      "description": "Indicates an issue or PR lacks a `sig/foo` label and requires one.",
      "id": 617149945,
      "name": "needs-sig",
      "node_id": "MDU6TGFiZWw2MTcxNDk5NDU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/needs-sig"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/89574/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1ODkxMDYyNjU=",
  "number": 89574,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "NewSimpleClientset is very slow when it's called with a big number objects",
  "updated_at": "2020-03-30T15:22:08Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/89574",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/5331316?v=4",
    "events_url": "https://api.github.com/users/tnqn/events{/privacy}",
    "followers_url": "https://api.github.com/users/tnqn/followers",
    "following_url": "https://api.github.com/users/tnqn/following{/other_user}",
    "gists_url": "https://api.github.com/users/tnqn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tnqn",
    "id": 5331316,
    "login": "tnqn",
    "node_id": "MDQ6VXNlcjUzMzEzMTY=",
    "organizations_url": "https://api.github.com/users/tnqn/orgs",
    "received_events_url": "https://api.github.com/users/tnqn/received_events",
    "repos_url": "https://api.github.com/users/tnqn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tnqn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tnqn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tnqn"
  }
}