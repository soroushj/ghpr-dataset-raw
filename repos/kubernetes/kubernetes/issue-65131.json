{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/24448061?v=4",
    "events_url": "https://api.github.com/users/msau42/events{/privacy}",
    "followers_url": "https://api.github.com/users/msau42/followers",
    "following_url": "https://api.github.com/users/msau42/following{/other_user}",
    "gists_url": "https://api.github.com/users/msau42/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/msau42",
    "id": 24448061,
    "login": "msau42",
    "node_id": "MDQ6VXNlcjI0NDQ4MDYx",
    "organizations_url": "https://api.github.com/users/msau42/orgs",
    "received_events_url": "https://api.github.com/users/msau42/received_events",
    "repos_url": "https://api.github.com/users/msau42/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/msau42/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/msau42/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/msau42"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/24448061?v=4",
      "events_url": "https://api.github.com/users/msau42/events{/privacy}",
      "followers_url": "https://api.github.com/users/msau42/followers",
      "following_url": "https://api.github.com/users/msau42/following{/other_user}",
      "gists_url": "https://api.github.com/users/msau42/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/msau42",
      "id": 24448061,
      "login": "msau42",
      "node_id": "MDQ6VXNlcjI0NDQ4MDYx",
      "organizations_url": "https://api.github.com/users/msau42/orgs",
      "received_events_url": "https://api.github.com/users/msau42/received_events",
      "repos_url": "https://api.github.com/users/msau42/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/msau42/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msau42/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/msau42"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "/kind bug\r\n\r\n**What happened**:\r\nWe have 3 rack at the cluster, and then I create 3 pods, which have anti-affinity rules by rack.\r\nI create these 3 pods without interval.\r\nThen I found there is just 1 pod is `running` and other 2 pods are stuck at `pending`\r\n**But all the pod's pvc had been bound.** \r\nThe bound pv has the same node affinity rule.\r\n```\r\nvolume.alpha.kubernetes.io/node-affinity: '{\"requiredDuringSchedulingIgnoredDuringExecution\":{\"nodeSelectorTerms\":[{\"matchExpressions\":[{\"key\":\"kubernetes.io/hostname\",\"operator\":\"In\",\"values\":[\"XXXXXXXXXXX\"]}]}]}}'\r\n```\r\n\r\n**What you expected to happen**:\r\nAll these three pod can be running\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n1. Create pods with the anti-affinity rules, the number of pods can be the same with the rack numbers\r\n2. These pods should use local volume pvc\r\n3. Create these pods with few interval \r\n\r\n**Anything else we need to know?**:\r\nI think the issue maybe caused by:\r\n1. We assume bound volume first at https://github.com/kubernetes/kubernetes/blob/master/pkg/scheduler/scheduler.go#L480\r\nAfter all the volume had bound, then assume the pod\r\n2. But the issue is, there maybe many pods with anti-affinity rules are assume volumes, and waiting for the volume to be bound.  At this time, the pod is not considered with a anti-affinity pod, so they may choose the same rack's pv and then their pvc will bound the the pv.\r\n3. The pod will be scheduled again, and they will never be scheduled, because there pvc had bound to the pv at the same rack. \r\n4. Pod stuck at `pending`\r\n\r\n**Environment**:\r\n-  k8s 1.9",
  "closed_at": "2018-09-05T06:19:37Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 14,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/65131/comments",
  "created_at": "2018-06-15T07:39:45Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/65131/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/65131",
  "id": 332675062,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Storage.",
      "id": 169428334,
      "name": "sig/storage",
      "node_id": "MDU6TGFiZWwxNjk0MjgzMzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/storage"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/65131/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMzI2NzUwNjI=",
  "number": 65131,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Pod use local volume pvc stuck at pending",
  "updated_at": "2018-09-05T06:19:37Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/65131",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/7530735?v=4",
    "events_url": "https://api.github.com/users/wenlxie/events{/privacy}",
    "followers_url": "https://api.github.com/users/wenlxie/followers",
    "following_url": "https://api.github.com/users/wenlxie/following{/other_user}",
    "gists_url": "https://api.github.com/users/wenlxie/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/wenlxie",
    "id": 7530735,
    "login": "wenlxie",
    "node_id": "MDQ6VXNlcjc1MzA3MzU=",
    "organizations_url": "https://api.github.com/users/wenlxie/orgs",
    "received_events_url": "https://api.github.com/users/wenlxie/received_events",
    "repos_url": "https://api.github.com/users/wenlxie/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/wenlxie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wenlxie/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/wenlxie"
  }
}