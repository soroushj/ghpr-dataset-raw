{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4178417?v=4",
    "events_url": "https://api.github.com/users/andyzhangx/events{/privacy}",
    "followers_url": "https://api.github.com/users/andyzhangx/followers",
    "following_url": "https://api.github.com/users/andyzhangx/following{/other_user}",
    "gists_url": "https://api.github.com/users/andyzhangx/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/andyzhangx",
    "id": 4178417,
    "login": "andyzhangx",
    "node_id": "MDQ6VXNlcjQxNzg0MTc=",
    "organizations_url": "https://api.github.com/users/andyzhangx/orgs",
    "received_events_url": "https://api.github.com/users/andyzhangx/received_events",
    "repos_url": "https://api.github.com/users/andyzhangx/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/andyzhangx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/andyzhangx/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/andyzhangx"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/4178417?v=4",
      "events_url": "https://api.github.com/users/andyzhangx/events{/privacy}",
      "followers_url": "https://api.github.com/users/andyzhangx/followers",
      "following_url": "https://api.github.com/users/andyzhangx/following{/other_user}",
      "gists_url": "https://api.github.com/users/andyzhangx/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/andyzhangx",
      "id": 4178417,
      "login": "andyzhangx",
      "node_id": "MDQ6VXNlcjQxNzg0MTc=",
      "organizations_url": "https://api.github.com/users/andyzhangx/orgs",
      "received_events_url": "https://api.github.com/users/andyzhangx/received_events",
      "repos_url": "https://api.github.com/users/andyzhangx/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/andyzhangx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andyzhangx/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/andyzhangx"
    }
  ],
  "author_association": "MEMBER",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n**What happened**:\r\nIf a node with a Azure Disk attached is deleted (before the volume is detached), subsequent attempts by the attach/detach controller to detach it continuously fail, and prevent the controller from attaching the volume to another node.\r\n\r\n**What you expected to happen**:\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n - Create a pod referencing a Azure Disk\r\n - Wait for pod to get scheduled and running.\r\n - Delete the node VM that the pod is scheduled to.\r\n - Check if volume is detached by attach/detach controller:\r\n   - Expected: Volume detached.\r\n   - Actual: Volume continuously fails detach.\r\n\r\n**Workaround**:\r\nRestart the kube-controller-manager binary on the master.\r\n\r\n**Error logs**:\r\n```\r\n{\"log\":\"W0911 21:54:47.425643       1 reconciler.go:232] attacherDetacher.DetachVolume started for volume \\\"pvc-131956f0-ae4e-11e9-9582-1ab5e19ca550\\\" (UniqueName: \\\"kubernetes.io/azure-disk//subscriptions/xxx/resourceGroups/MC_xxx_eastus2/providers/Microsoft.Compute/disks/kubernetes-dynamic-pvc-131956f0-ae4e-11e9-9582-1ab5e19ca550\\\") on node \\\"aks-nodepool1-40127584-4\\\" This volume is not safe to detach, but maxWaitForUnmountDuration 6m0s expired, force detaching\\n\",\"stream\":\"stderr\",\"pod\":\"kube-controller-manager-584bc784fb-xwqch\",\"containerID\":\"ef167863bdfd6b5cda00dfe767c3da36720225a31fbb5d52d0895ff8b7ffb2c6\"}\r\n{\"log\":\"W0911 21:54:47.446090       1 azure_controller_common.go:128] failed to get azure instance id (instance not found)\\n\",\"stream\":\"stderr\",\"pod\":\"kube-controller-manager-584bc784fb-xwqch\",\"containerID\":\"ef167863bdfd6b5cda00dfe767c3da36720225a31fbb5d52d0895ff8b7ffb2c6\"}\r\n{\"log\":\"E0911 21:54:47.446125       1 attacher.go:276] failed to detach azure disk \\\"/subscriptions/xxx/resourceGroups/MC_xxx_eastus2/providers/Microsoft.Compute/disks/kubernetes-dynamic-pvc-131956f0-ae4e-11e9-9582-1ab5e19ca550\\\", err failed to get azure instance id for node \\\"aks-nodepool1-40127584-4\\\" (instance not found)\\n\",\"stream\":\"stderr\",\"pod\":\"kube-controller-manager-584bc784fb-xwqch\",\"containerID\":\"ef167863bdfd6b5cda00dfe767c3da36720225a31fbb5d52d0895ff8b7ffb2c6\"}\r\n{\"log\":\"E0911 21:54:47.446216       1 nestedpendingoperations.go:267] Operation for \\\"\\\\\\\"kubernetes.io/azure-disk//subscriptions/xxx/resourceGroups/MC_xxx_eastus2/providers/Microsoft.Compute/disks/kubernetes-dynamic-pvc-131956f0-ae4e-11e9-9582-1ab5e19ca550\\\\\\\"\\\" failed. No retries permitted until 2019-09-11 21:56:49.446176916 +0000 UTC m=+608192.051683681 (durationBeforeRetry 2m2s). Error: \\\"DetachVolume.Detach failed for volume \\\\\\\"pvc-131956f0-ae4e-11e9-9582-1ab5e19ca550\\\\\\\" (UniqueName: \\\\\\\"kubernetes.io/azure-disk//subscriptions/xxx/resourceGroups/MC_xxx_eastus2/providers/Microsoft.Compute/disks/kubernetes-dynamic-pvc-131956f0-ae4e-11e9-9582-1ab5e19ca550\\\\\\\") on node \\\\\\\"aks-nodepool1-40127584-4\\\\\\\" : failed to get azure instance id for node \\\\\\\"aks-nodepool1-40127584-4\\\\\\\" (instance not found)\\\"\\n\",\"stream\":\"stderr\",\"pod\":\"kube-controller-manager-584bc784fb-xwqch\",\"containerID\":\"ef167863bdfd6b5cda00dfe767c3da36720225a31fbb5d52d0895ff8b7ffb2c6\"}\r\n```\r\n\r\n**Anything else we need to know?**:\r\n\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.16\r\n- Cloud provider or hardware configuration:\r\n- OS (e.g: `cat /etc/os-release`):\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools:\r\n- Network plugin and version (if this is a network-related bug):\r\n- Others:\r\n\r\n/kind bug\r\n/assign\r\n/priority important-soon\r\n/sig cloud-provider\r\n/area provider/azure\r\n\r\ncc @feiskyer ",
  "closed_at": "2019-09-14T09:46:41Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/82617/comments",
  "created_at": "2019-09-12T07:19:43Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/82617/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/82617",
  "id": 492630206,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to azure provider",
      "id": 852130786,
      "name": "area/provider/azure",
      "node_id": "MDU6TGFiZWw4NTIxMzA3ODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/azure"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": "Must be staffed and worked on either currently, or very soon, ideally in time for the next release.",
      "id": 114528223,
      "name": "priority/important-soon",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyMjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/important-soon"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Cloud Provider.",
      "id": 958178286,
      "name": "sig/cloud-provider",
      "node_id": "MDU6TGFiZWw5NTgxNzgyODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cloud-provider"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/82617/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0OTI2MzAyMDY=",
  "number": 82617,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Azure disk detach fails if node no longer exists",
  "updated_at": "2019-09-14T09:46:41Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/82617",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4178417?v=4",
    "events_url": "https://api.github.com/users/andyzhangx/events{/privacy}",
    "followers_url": "https://api.github.com/users/andyzhangx/followers",
    "following_url": "https://api.github.com/users/andyzhangx/following{/other_user}",
    "gists_url": "https://api.github.com/users/andyzhangx/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/andyzhangx",
    "id": 4178417,
    "login": "andyzhangx",
    "node_id": "MDQ6VXNlcjQxNzg0MTc=",
    "organizations_url": "https://api.github.com/users/andyzhangx/orgs",
    "received_events_url": "https://api.github.com/users/andyzhangx/received_events",
    "repos_url": "https://api.github.com/users/andyzhangx/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/andyzhangx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/andyzhangx/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/andyzhangx"
  }
}