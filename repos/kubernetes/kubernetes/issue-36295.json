{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n\r\n**Is this a request for help?** (If yes, you should use our troubleshooting guide and community support channels, see http://kubernetes.io/docs/troubleshooting/.): No\r\n\r\n\r\n**What keywords did you search in Kubernetes issues before filing this one?** (If you have found any duplicates, you should instead reply there.): vsphere, ResourcePool, ComputeResource\r\n\r\n---\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?** (choose one): Bug Report\r\n\r\n<!--\r\nIf this is a BUG REPORT, please:\r\n  - Fill in as much of the template below as you can.  If you leave out\r\n    information, we can't help you as well.\r\n\r\nIf this is a FEATURE REQUEST, please:\r\n  - Describe *in detail* the feature/behavior/change you'd like to see.\r\n\r\nIn both cases, be ready for followup questions, and please respond in a timely\r\nmanner.  If we can't reproduce a bug or think a feature already exists, we\r\nmight close your issue.  If we're wrong, PLEASE feel free to reopen it and\r\nexplain why.\r\n-->\r\n\r\n**Kubernetes version** (use `kubectl version`): Server Version: version.Info{Major:\"1\", Minor:\"4\", GitVersion:\"v1.4.5+coreos.0\", GitCommit:\"f70c2e5b2944cb5d622621a706bdec3d8a5a9c5e\", GitTreeState:\"clean\", BuildDate:\"2016-10-31T19:16:47Z\", GoVersion:\"go1.6.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n\r\n**Environment**: CoreOS on vSphere\r\n- **Cloud provider or hardware configuration**: vSphere\r\n- **OS** (e.g. from /etc/os-release): CoreOS 1185.3.0 (MoreOS)\r\n- **Kernel** (e.g. `uname -a`): Linux k8-m1 4.7.3-coreos-r2 #1 SMP Tue Nov 1 01:38:43 UTC 2016\r\n\r\n\r\n**What happened**:\r\nI configured the controller-manager to use vsphere as the cloud provider and supplied it with a provider cloud configuration. When the controller-manager pod started, it panicked with the following stack trace;\r\n\r\n```\r\n2016-11-06T00:34:22.670422172Z panic: reflect.Set: value of type mo.ResourcePool is not assignable to type mo.ComputeResource\r\n2016-11-06T00:34:22.670477454Z \r\n2016-11-06T00:34:22.670494551Z goroutine 68 [running]:\r\n2016-11-06T00:34:22.670592707Z panic(0x38d5200, 0xc820d2b310)\r\n2016-11-06T00:34:22.670754360Z \t/usr/local/go/src/runtime/panic.go:481 +0x3e6\r\n2016-11-06T00:34:22.670990355Z reflect.Value.assignTo(0x4a676e0, 0xc8200a5600, 0x99, 0x4df7650, 0xb, 0x4a66e60, 0x0, 0x0, 0x0, 0x0)\r\n2016-11-06T00:34:22.671019041Z \t/usr/local/go/src/reflect/value.go:2164 +0x3be\r\n2016-11-06T00:34:22.671380809Z reflect.Value.Set(0x4a66e60, 0xc82049e780, 0x199, 0x4a676e0, 0xc8200a5600, 0x99)\r\n2016-11-06T00:34:22.671462864Z \t/usr/local/go/src/reflect/value.go:1334 +0x95\r\n2016-11-06T00:34:22.671715875Z k8s.io/kubernetes/vendor/github.com/vmware/govmomi/vim25/mo.LoadRetrievePropertiesResponse(0xc820d308e0, 0x46ecda0, 0xc82049e780, 0x0, 0x0)\r\n2016-11-06T00:34:22.672055230Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/vmware/govmomi/vim25/mo/retrieve.go:128 +0xe21\r\n2016-11-06T00:34:22.672431372Z k8s.io/kubernetes/vendor/github.com/vmware/govmomi/property.(*Collector).Retrieve(0xc820b54418, 0x7f8a572ab340, 0xc8202d2540, 0xc820d3ca80, 0x1, 0x1, 0xc820cecfd0, 0x1, 0x1, 0x46ecda0, ...)\r\n2016-11-06T00:34:22.672467148Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/vmware/govmomi/property/collector.go:167 +0x52f\r\n2016-11-06T00:34:22.672606970Z k8s.io/kubernetes/vendor/github.com/vmware/govmomi/property.(*Collector).RetrieveOne(0xc820b54418, 0x7f8a572ab340, 0xc8202d2540, 0xc820cec9c0, 0xc, 0xc820cec9e0, 0xa, 0xc820cecfd0, 0x1, 0x1, ...)\r\n2016-11-06T00:34:22.672681600Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/vmware/govmomi/property/collector.go:173 +0x10e\r\n2016-11-06T00:34:22.672871709Z k8s.io/kubernetes/vendor/github.com/vmware/govmomi/object.Common.Properties(0x0, 0x0, 0xc820b1e500, 0xc8202cedd0, 0xb, 0xc8202cee00, 0xb, 0x7f8a572ab340, 0xc8202d2540, 0xc820cec9c0, ...)\r\n2016-11-06T00:34:22.672904730Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/vmware/govmomi/object/common.go:97 +0x19f\r\n2016-11-06T00:34:22.673072861Z k8s.io/kubernetes/pkg/cloudprovider/providers/vsphere.readInstance(0xc82025b0e0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n2016-11-06T00:34:22.673104582Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/cloudprovider/providers/vsphere/vsphere.go:223 +0xe8f\r\n2016-11-06T00:34:22.673118861Z k8s.io/kubernetes/pkg/cloudprovider/providers/vsphere.newVSphere(0xc820252200, 0x18, 0xc8204c25f0, 0xc, 0xc82011fd60, 0x9, 0xc8204c2048, 0x3, 0x1, 0xc8204c2ae8, ...)\r\n2016-11-06T00:34:22.673128111Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/cloudprovider/providers/vsphere/vsphere.go:237 +0x7e\r\n2016-11-06T00:34:22.673204822Z k8s.io/kubernetes/pkg/cloudprovider/providers/vsphere.init.1.func1(0x7f8a572c9488, 0xc82014c668, 0x0, 0x0, 0x0, 0x0)\r\n2016-11-06T00:34:22.673274571Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/cloudprovider/providers/vsphere/vsphere.go:153 +0xdf\r\n2016-11-06T00:34:22.673365023Z k8s.io/kubernetes/pkg/cloudprovider.GetCloudProvider(0x7ffc9a344abf, 0x7, 0x7f8a572c9488, 0xc82014c668, 0x0, 0x0, 0x0, 0x0)\r\n2016-11-06T00:34:22.673457368Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/cloudprovider/plugins.go:62 +0x112\r\n2016-11-06T00:34:22.673526314Z k8s.io/kubernetes/pkg/cloudprovider.InitCloudProvider(0x7ffc9a344abf, 0x7, 0x7ffc9a344ad6, 0x1c, 0x0, 0x0, 0x0, 0x0)\r\n2016-11-06T00:34:22.673582280Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/cloudprovider/plugins.go:84 +0x3e2\r\n2016-11-06T00:34:22.673593710Z k8s.io/kubernetes/cmd/kube-controller-manager/app.StartControllers(0xc82062f900, 0xc8203aea80, 0xc8201de340, 0xc8203af860, 0x7f8a572d6790, 0xc820418640, 0x0, 0x0)\r\n2016-11-06T00:34:22.673674949Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/cmd/kube-controller-manager/app/controllermanager.go:225 +0x719\r\n2016-11-06T00:34:22.673686774Z k8s.io/kubernetes/cmd/kube-controller-manager/app.Run.func2(0xc8203af860)\r\n2016-11-06T00:34:22.673696396Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/cmd/kube-controller-manager/app/controllermanager.go:166 +0x6a\r\n2016-11-06T00:34:22.673755265Z created by k8s.io/kubernetes/pkg/client/leaderelection.(*LeaderElector).Run\r\n2016-11-06T00:34:22.673766424Z \t/go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/client/leaderelection/leaderelection.go:177 +0x91\r\n```\r\n\r\n\r\n**What you expected to happen**:\r\nI expected the controller-manager pod to run as normal.\r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\nConfigure the controller-manager pod to use the vsphere cloud provider and pass the following provider cloud configuration file;\r\n\r\n```\r\n[Global]\r\nserver = vcenter\r\nport = 443\r\nuser = administrator@vsphere.local\r\npassword = removed\r\ninsecure-flag = true\r\ndatacenter = FC\r\n\r\n[Network]\r\npublic-network = External\r\n```\r\n\r\n**Anything else do we need to know**:\r\n\r\n- This cluster was created by following the [CoreOS + Kubernetes Step by Step](https://coreos.com/kubernetes/docs/latest/getting-started.html) guide. The only deviation from the guide was to adjust the /etc/kubernetes/manifests/kube-controller-manager.yaml file to include configuration flags for cloud-provider and cloud-config, and adding an additional volume and volume mount for the provider cloud config file.\r\n- The CoreOS VMs are part of a single resource group (K8) on the same ESXi host.\r\n- My base image for all of the hyperkube containers is quay.io/coreos/hyperkube:v1.4.5_coreos.0\r\n- Before adding the additional configuration to use the vsphere cloud provider, this cluster was working as expected. The only change that was made to produce the stack trace above was to enable the vsphere cloud provider and pass the provider cloud config above.\r\n- I am still fairly new to Kubernetes so i'm open to the possibility that I might have made a fatal error somewhere, but as far as I can tell this does appear to be a genuine bug. Apologies if this does turn out to be a mistake on my behalf!\r\n\r\n\r\n",
  "closed_at": "2016-12-10T02:21:47Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 16,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36295/comments",
  "created_at": "2016-11-06T01:24:48Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36295/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/36295",
  "id": 187535167,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 140091046,
      "name": "area/nodecontroller",
      "node_id": "MDU6TGFiZWwxNDAwOTEwNDY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/nodecontroller"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36295/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxODc1MzUxNjc=",
  "number": 36295,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "vSphere Cloud Provider triggers panic in controller-manager pod",
  "updated_at": "2017-02-10T09:27:09Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36295",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/6966796?v=4",
    "events_url": "https://api.github.com/users/KingJ/events{/privacy}",
    "followers_url": "https://api.github.com/users/KingJ/followers",
    "following_url": "https://api.github.com/users/KingJ/following{/other_user}",
    "gists_url": "https://api.github.com/users/KingJ/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/KingJ",
    "id": 6966796,
    "login": "KingJ",
    "node_id": "MDQ6VXNlcjY5NjY3OTY=",
    "organizations_url": "https://api.github.com/users/KingJ/orgs",
    "received_events_url": "https://api.github.com/users/KingJ/received_events",
    "repos_url": "https://api.github.com/users/KingJ/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/KingJ/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KingJ/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/KingJ"
  }
}