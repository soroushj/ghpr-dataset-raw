{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
    "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
    "followers_url": "https://api.github.com/users/liggitt/followers",
    "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
    "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/liggitt",
    "id": 980082,
    "login": "liggitt",
    "node_id": "MDQ6VXNlcjk4MDA4Mg==",
    "organizations_url": "https://api.github.com/users/liggitt/orgs",
    "received_events_url": "https://api.github.com/users/liggitt/received_events",
    "repos_url": "https://api.github.com/users/liggitt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/liggitt"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
      "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
      "followers_url": "https://api.github.com/users/liggitt/followers",
      "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
      "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/liggitt",
      "id": 980082,
      "login": "liggitt",
      "node_id": "MDQ6VXNlcjk4MDA4Mg==",
      "organizations_url": "https://api.github.com/users/liggitt/orgs",
      "received_events_url": "https://api.github.com/users/liggitt/received_events",
      "repos_url": "https://api.github.com/users/liggitt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/liggitt"
    }
  ],
  "author_association": "NONE",
  "body": "At least twice now, we've created a namespace and seen that the corresponding service account default secret token is never created. (The service account itself is, but not the default secret.)\n\n**Namespace creation + apiserver logs**\n\n**logstash-ingester: namespace creation triggered service account creation but no secret**\n\n```\n$ echo \"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Namespace\\\",\\\"metadata\\\":{\\\"name\\\":\\\"logstash-ingester\\\"}}\" | kubectl create -f -\n\nI0504 12:28:33.331396       1 handlers.go:152] POST /api/v1/namespaces: (13.998977ms) 201 [[kubectl/v1.2.2 (linux/amd64) kubernetes/528f879] 192.168.0.16:42612]\nI0504 12:28:33.862690       1 handlers.go:152] GET /api/v1/namespaces/logstash-ingester/replicationcontrollers?labelSelector=name%3Dlogstash-ingester: (1.486039ms) 200 [[kubectl/v1.2.2 (linux/amd64) kubernetes/528f879] 192.168.0.16:42615]\nI0504 12:28:34.101045       1 handlers.go:152] GET /api/v1/namespaces/logstash-ingester/serviceaccounts/default: (1.178765ms) 404 [[hyperkube/v1.2.2 (linux/amd64) kubernetes/528f879/tokens-controller] 127.0.0.1:45497]\nI0504 12:28:34.102937       1 handlers.go:152] POST /api/v1/namespaces/logstash-ingester/serviceaccounts: (15.911881ms) 201 [[hyperkube/v1.2.2 (linux/amd64) kubernetes/528f879/service-account-controller] 127.0.0.1:45495]\n...\n(never any POST to /api/v1/namespaces/logstash-ingester/secrets)\n```\n\n**logstash-broker: namespace creation triggered service account creation and secret creation**\n\n```\n$ echo \"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Namespace\\\",\\\"metadata\\\":{\\\"name\\\":\\\"logstash-broker\\\"}}\" | kubectl create -f -\n\nI0504 12:29:01.541478       1 handlers.go:152] POST /api/v1/namespaces: (9.31755ms) 201 [[kubectl/v1.2.2 (linux/amd64) kubernetes/528f879] 192.168.0.16:42675]\nI0504 12:29:01.547657       1 handlers.go:152] POST /api/v1/namespaces/logstash-broker/serviceaccounts: (4.763383ms) 201 [[hyperkube/v1.2.2 (linux/amd64) kubernetes/528f879/service-account-controller] 127.0.0.1:45516]\nI0504 12:29:01.551010       1 handlers.go:152] GET /api/v1/namespaces/logstash-broker/serviceaccounts/default: (1.304463ms) 200 [[hyperkube/v1.2.2 (linux/amd64) kubernetes/528f879/tokens-controller] 127.0.0.1:45516]\nI0504 12:29:01.587075       1 handlers.go:152] GET /api/v1/namespaces/logstash-broker/resourcequotas: (1.294544ms) 200 [[hyperkube/v1.2.2 (linux/amd64) kubernetes/528f879] 127.0.0.1:45384]\nI0504 12:29:01.593363       1 handlers.go:152] POST /api/v1/namespaces/logstash-broker/secrets: (8.396083ms) 201 [[hyperkube/v1.2.2 (linux/amd64) kubernetes/528f879/tokens-controller] 127.0.0.1:45516]\nI0504 12:29:01.612385       1 handlers.go:152] PUT /api/v1/namespaces/logstash-broker/serviceaccounts/default: (17.334548ms) 200 [[hyperkube/v1.2.2 (linux/amd64) kubernetes/528f879/tokens-controller] 127.0.0.1:45516]\n...\n```\n\n**Resulting service accounts**\n\n```\n$ kubectl get serviceaccounts --all-namespaces\nNAMESPACE            NAME      SECRETS   AGE\ndefault              default   1         10h\nlogstash-broker      default   1         10h\nlogstash-ingester    default   0         10h\n```\n\n**Resulting secrets**\n\n```\n$ kubectl get secrets --all-namespaces\nNAMESPACE            NAME                  TYPE                                  DATA      AGE\ndefault              default-token-fxpho   kubernetes.io/service-account-token   3         10h\nlogstash-broker      default-token-3y3el   kubernetes.io/service-account-token   3         10h\n```\n\n**Controller-manager logs for broken case**\n\n```\n$ kubectl.sh logs kube-controller-manager-m1kmaster2 | grep logstash-ingester | (head -n4; python -c \"print '-'*50\"; tail -n4)\n\nI0504 12:28:35.215493       1 replication_controller.go:434] Too few \"logstash-ingester\"/\"logstash-ingester-20160504-122831\" replicas, need 1, creating 1\nI0504 12:28:35.219456       1 replication_controller.go:440] Failed creation, decrementing expectations for controller \"logstash-ingester\"/\"logstash-ingester-20160504-122831\"\nE0504 12:28:35.219502       1 replication_controller.go:442] unable to create pods: pods \"logstash-ingester-20160504-122831-\" is forbidden: no API token found for service account logstash-ingester/default, retry after the token is automatically created and added to the service account\nI0504 12:28:35.232246       1 event.go:211] Event(api.ObjectReference{Kind:\"ReplicationController\", Namespace:\"logstash-ingester\", Name:\"logstash-ingester-20160504-122831\", UID:\"b888278b-11f3-11e6-afb3-00505615bcae\", APIVersion:\"v1\", ResourceVersion:\"932\", FieldPath:\"\"}): type: 'Warning' reason: 'FailedCreate' Error creating: pods \"logstash-ingester-20160504-122831-\" is forbidden: no API token found for service account logstash-ingester/default, retry after the token is automatically created and added to the service account\n--------------------------------------------------\nI0504 22:45:38.575166       1 replication_controller.go:434] Too few \"logstash-ingester\"/\"logstash-ingester-20160504-122831\" replicas, need 1, creating 1\nI0504 22:45:38.590631       1 replication_controller.go:440] Failed creation, decrementing expectations for controller \"logstash-ingester\"/\"logstash-ingester-20160504-122831\"\nE0504 22:45:38.590750       1 replication_controller.go:442] unable to create pods: pods \"logstash-ingester-20160504-122831-\" is forbidden: no API token found for service account logstash-ingester/default, retry after the token is automatically created and added to the service account\nI0504 22:45:38.591223       1 event.go:211] Event(api.ObjectReference{Kind:\"ReplicationController\", Namespace:\"logstash-ingester\", Name:\"logstash-ingester-20160504-122831\", UID:\"b888278b-11f3-11e6-afb3-00505615bcae\", APIVersion:\"v1\", ResourceVersion:\"934\", FieldPath:\"\"}): type: 'Warning' reason: 'FailedCreate' Error creating: pods \"logstash-ingester-20160504-122831-\" is forbidden: no API token found for service account logstash-ingester/default, retry after the token is automatically created and added to the service account\n```\n\n**Controller-manager logs for working case**\n\n```\n$ kubectl.sh logs kube-controller-manager-m1kmaster2 | grep logstash-broker | head -n2\n\nI0504 12:29:03.699793       1 replication_controller.go:434] Too few \"logstash-broker\"/\"logstash-broker-20160504-122858\" replicas, need 1, creating 1\nI0504 12:29:03.733761       1 event.go:211] Event(api.ObjectReference{Kind:\"ReplicationController\", Namespace:\"logstash-broker\", Name:\"logstash-broker-20160504-122858\", UID:\"c97f9a9b-11f3-11e6-afb3-00505615bcae\", APIVersion:\"v1\", ResourceVersion:\"982\", FieldPath:\"\"}): type: 'Normal' reason: 'SuccessfulCreate' Created pod: logstash-broker-20160504-122858-vtbky\n```\n\n**Version Info:**\n\n```\n$ kubectl --server=https://192.168.0.204:6443 --kubeconfig=/highland/config/kubernetes/config   version\nClient Version: version.Info{Major:\"1\", Minor:\"2\", GitVersion:\"v1.2.2\", GitCommit:\"528f879e7d3790ea4287687ef0ab3f2a01cc2718\", GitTreeState:\"clean\"}\nServer Version: version.Info{Major:\"1\", Minor:\"2\", GitVersion:\"v1.2.2\", GitCommit:\"528f879e7d3790ea4287687ef0ab3f2a01cc2718\", GitTreeState:\"clean\"}\n```\n",
  "closed_at": "2017-04-21T20:48:59Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 18,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/25416/comments",
  "created_at": "2016-05-10T18:34:55Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/25416/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/25416",
  "id": 154076041,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Auth.",
      "id": 357119284,
      "name": "sig/auth",
      "node_id": "MDU6TGFiZWwzNTcxMTkyODQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/auth"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/25416/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:23:42Z",
    "closed_issues": 1693,
    "created_at": "2016-11-12T00:35:38Z",
    "creator": {
      "avatar_url": "https://avatars1.githubusercontent.com/u/10052848?v=4",
      "events_url": "https://api.github.com/users/saad-ali/events{/privacy}",
      "followers_url": "https://api.github.com/users/saad-ali/followers",
      "following_url": "https://api.github.com/users/saad-ali/following{/other_user}",
      "gists_url": "https://api.github.com/users/saad-ali/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/saad-ali",
      "id": 10052848,
      "login": "saad-ali",
      "node_id": "MDQ6VXNlcjEwMDUyODQ4",
      "organizations_url": "https://api.github.com/users/saad-ali/orgs",
      "received_events_url": "https://api.github.com/users/saad-ali/received_events",
      "repos_url": "https://api.github.com/users/saad-ali/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/saad-ali/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/saad-ali/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/saad-ali"
    },
    "description": "",
    "due_on": "2017-03-22T07:00:00Z",
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/31",
    "id": 2130587,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/31/labels",
    "node_id": "MDk6TWlsZXN0b25lMjEzMDU4Nw==",
    "number": 31,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.6",
    "updated_at": "2019-08-26T17:23:42Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/31"
  },
  "node_id": "MDU6SXNzdWUxNTQwNzYwNDE=",
  "number": 25416,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "default secret token for service account failed to be created (preventing pods from spawning)",
  "updated_at": "2017-04-21T20:48:59Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/25416",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1418951?v=4",
    "events_url": "https://api.github.com/users/DreadPirateShawn/events{/privacy}",
    "followers_url": "https://api.github.com/users/DreadPirateShawn/followers",
    "following_url": "https://api.github.com/users/DreadPirateShawn/following{/other_user}",
    "gists_url": "https://api.github.com/users/DreadPirateShawn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/DreadPirateShawn",
    "id": 1418951,
    "login": "DreadPirateShawn",
    "node_id": "MDQ6VXNlcjE0MTg5NTE=",
    "organizations_url": "https://api.github.com/users/DreadPirateShawn/orgs",
    "received_events_url": "https://api.github.com/users/DreadPirateShawn/received_events",
    "repos_url": "https://api.github.com/users/DreadPirateShawn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/DreadPirateShawn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DreadPirateShawn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/DreadPirateShawn"
  }
}