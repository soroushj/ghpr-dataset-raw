{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4953962?v=4",
    "events_url": "https://api.github.com/users/m1093782566/events{/privacy}",
    "followers_url": "https://api.github.com/users/m1093782566/followers",
    "following_url": "https://api.github.com/users/m1093782566/following{/other_user}",
    "gists_url": "https://api.github.com/users/m1093782566/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/m1093782566",
    "id": 4953962,
    "login": "m1093782566",
    "node_id": "MDQ6VXNlcjQ5NTM5NjI=",
    "organizations_url": "https://api.github.com/users/m1093782566/orgs",
    "received_events_url": "https://api.github.com/users/m1093782566/received_events",
    "repos_url": "https://api.github.com/users/m1093782566/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/m1093782566/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/m1093782566/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/m1093782566"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/4953962?v=4",
      "events_url": "https://api.github.com/users/m1093782566/events{/privacy}",
      "followers_url": "https://api.github.com/users/m1093782566/followers",
      "following_url": "https://api.github.com/users/m1093782566/following{/other_user}",
      "gists_url": "https://api.github.com/users/m1093782566/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/m1093782566",
      "id": 4953962,
      "login": "m1093782566",
      "node_id": "MDQ6VXNlcjQ5NTM5NjI=",
      "organizations_url": "https://api.github.com/users/m1093782566/orgs",
      "received_events_url": "https://api.github.com/users/m1093782566/received_events",
      "repos_url": "https://api.github.com/users/m1093782566/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/m1093782566/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/m1093782566/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/m1093782566"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**What happened**:\r\nAfter PR: #70530, we noticed communications issue in our pods.\r\nWe use the Lyft CNI plugin (https://github.com/lyft/cni-ipvlan-vpc-k8s) which relies on two interfaces in pod:\r\n* an IPVLAN interface connecting to the AWS VPC which has a VPC IP\r\n* an Unnumbered point-to-point interface (veth) connecting to the host and that does not have an IP (it \"borrows\" the one from the IPVLAN interface)\r\n\r\nOn the host side, there is a veth interface which also doesn't have an IP (it borrows one from the main interface).\r\n\r\nWith the latest versions of kube-proxy communication between host and pods break\r\n\r\n**What you expected to happen**:\r\nCommunication still works\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n* Use the Lyft CNI plugin\r\n* Deploy kube-proxy `v1.13.0-beta.2`\r\n* Try to ping the host from a pod (or a pod from the host)\r\n\r\n**Anything else we need to know?**:\r\nThe new sysctls create 2 issues:\r\n* containers started after kube-proxy inherit net.ipv4.conf.all.arp_ignore=1 so they will not answer ARP queries on the veth interface\r\n* the veth on the host side also does not have an IP so it will no answer ARP queries from the pods\r\n\r\nI know that our setup is pretty uncommon but assuming that the veth on the host side will have an IP seems dangerous. Some discussions on the PTP plugin for instance suggest not using IP for the host interface: containernetworking/plugins#137\r\n\r\nPossible fixes:\r\n* create a flag to enable ARP filtering (I think to avoid breaking existing setups, we should disable it by default but I'm fine with enabling it by default as long as we document the solution)\r\n* use arptables to filter ARP queries for clusterIPs (`arptables -A INPUT -d <clusterIP> -j DROP`): a bit more work because we need to do it for all clusterIPs (there may be a more efficient way to do it but I could not make it work by filtering on the kube-ipvs interface) and this requires the arptables binary. We could test for the existence of the binary and log a warning if it is missing (similar to behavior with conntrack)\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): kube-proxy `v1.13.0-alpha.3`\r\n- OS (e.g. from /etc/os-release): `Ubuntu 18.04.1 LTS`\r\n- Kernel (e.g. `uname -a`): `Linux ip-10-128-212-113 4.15.0-1023-aws #23-Ubuntu SMP Mon Sep 24 16:31:06 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux`\r\n\r\n/area ipvs\r\n/sig network\r\n/kind bug\r\n\r\n/assign @m1093782566 \r\nping @kvaps ",
  "closed_at": "2019-03-20T14:41:53Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71555/comments",
  "created_at": "2018-11-29T10:33:06Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71555/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/71555",
  "id": 385669237,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 755527763,
      "name": "area/ipvs",
      "node_id": "MDU6TGFiZWw3NTU1Mjc3NjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/ipvs"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    },
    {
      "color": "d455d0",
      "default": false,
      "description": "Indicates an issue that can not or will not be resolved.",
      "id": 862108765,
      "name": "triage/unresolved",
      "node_id": "MDU6TGFiZWw4NjIxMDg3NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/triage/unresolved"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71555/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzODU2NjkyMzc=",
  "number": 71555,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kube-proxy/IPVS: arp_ignore and arp_announce break some CNI plugins",
  "updated_at": "2019-07-12T14:27:50Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71555",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/5391707?v=4",
    "events_url": "https://api.github.com/users/lbernail/events{/privacy}",
    "followers_url": "https://api.github.com/users/lbernail/followers",
    "following_url": "https://api.github.com/users/lbernail/following{/other_user}",
    "gists_url": "https://api.github.com/users/lbernail/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/lbernail",
    "id": 5391707,
    "login": "lbernail",
    "node_id": "MDQ6VXNlcjUzOTE3MDc=",
    "organizations_url": "https://api.github.com/users/lbernail/orgs",
    "received_events_url": "https://api.github.com/users/lbernail/received_events",
    "repos_url": "https://api.github.com/users/lbernail/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/lbernail/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lbernail/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/lbernail"
  }
}