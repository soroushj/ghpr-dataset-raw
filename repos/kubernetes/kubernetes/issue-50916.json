{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
    "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
    "followers_url": "https://api.github.com/users/liggitt/followers",
    "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
    "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/liggitt",
    "id": 980082,
    "login": "liggitt",
    "node_id": "MDQ6VXNlcjk4MDA4Mg==",
    "organizations_url": "https://api.github.com/users/liggitt/orgs",
    "received_events_url": "https://api.github.com/users/liggitt/received_events",
    "repos_url": "https://api.github.com/users/liggitt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/liggitt"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
      "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
      "followers_url": "https://api.github.com/users/liggitt/followers",
      "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
      "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/liggitt",
      "id": 980082,
      "login": "liggitt",
      "node_id": "MDQ6VXNlcjk4MDA4Mg==",
      "organizations_url": "https://api.github.com/users/liggitt/orgs",
      "received_events_url": "https://api.github.com/users/liggitt/received_events",
      "repos_url": "https://api.github.com/users/liggitt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/liggitt"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind bug\r\n\r\n/sig scheduling\r\n\r\n**What happened**:\r\n\r\nThe scheduler panics with \"Schedulercache is corrupted and can badly affect scheduling decisions\". There are a few related issues reporting a similar bug (#46347, #47150), but in both of those issues the recommended fix is to upgrade to etcd 3.0.17. We're using etcd 3.2.0 which is newer than that. This happened in our production cluster twice today.\r\n\r\nsome evidence that this is issue an with etcd:\r\n\r\n1. scheduler fails with \"Schedulercache is corrupted and can badly affect scheduling decisions\"\r\n2. another scheduler on another machine gets elected the leader\r\n3. that scheduler *also* fails with \"Schedulercache is corrupted and can badly affect scheduling decisions\"\r\n\r\nConversely, evidence that it **isn't** an issue with etcd: when we later restart the scheduler (~30 minutes later), the system recovers without any changes to etcd (according to the apiserver lots). So etcd's contents are at least not permanently corrupted.\r\n\r\nHere's an excerpt of the logs. [full logs are in this gist (all the relevant kubelet/controller manager/apiserver/scheduler logs)](https://gist.github.com/julia-stripe/5db6969f5d5d72d551d366317eb39161)\r\n\r\n```\r\n======== scheduler (kubemaster--0fd4bec98eba7656c) ======\r\n\r\nI0818 09:16:25.678670       1 factory.go:511] About to try and schedule pod explorer-job-1503047460-7681l\r\nI0818 09:16:25.678677       1 scheduler.go:261] Attempting to schedule pod: scheduled-jobs/explorer-job-1503047460-7681l\r\nW0818 09:16:25.679040       1 cache.go:228] Pod scheduled-jobs/explorer-job-1503047460-7681l assumed to a different node than added to.\r\nI0818 09:16:25.679059       1 factory.go:725] Attempting to bind explorer-job-1503047460-7681l to ip-10-68-30-4.us-west-2.compute.internal\r\nE0818 09:16:25.679061       1 cache.go:263] Pod scheduled-jobs/explorer-job-1503047460-7681l updated on a different node than previously added to.\r\nW0818 09:16:25.679040       1 cache.go:228] Pod scheduled-jobs/explorer-job-1503047460-7681l assumed to a different node than added to.\r\nE0818 09:16:25.679061       1 cache.go:263] Pod scheduled-jobs/explorer-job-1503047460-7681l updated on a different node than previously added to.\r\nF0818 09:16:25.679081       1 cache.go:264] Schedulercache is corrupted and can badly affect scheduling decisions\r\n\r\n\r\n>>>> stack trace redacted: panic <<<<\r\n\r\n======== apiserver audit ======\r\n\r\n2017-08-18T09:16:25.679953099Z AUDIT: id=\"1e0516d4-9a95-4b4b-aaee-98a0894b3625\" ip=\"10.68.24.10\" method=\"POST\" user=\"kubemaster--0fd4bec98eba7656c.nw\" groups=\"\\\"kubemaster.northwest.prod\\\",\\\"system:authenticated\\\"\" as=\"<self>\" asgroups=\"<lookup>\" namespace=\"scheduled-jobs\" uri=\"/api/v1/namespaces/scheduled-jobs/pods/explorer-job-1503047460-7681l/binding\"\r\n\r\n======== scheduler (kubemaster--0aa8e87a222ebc781.nw) ======\r\n\r\nI0818 09:16:45.738257       1 leaderelection.go:189] successfully acquired lease kube-system/kube-scheduler\r\nI0818 09:16:45.738413       1 event.go:218] Event(v1.ObjectReference{Kind:\"Endpoints\", Namespace:\"kube-system\", Name:\"kube-scheduler\", UID:\"3d55f039-8367-11e7-8b13-02708673f6f6\", APIVersion:\"v1\", ResourceVersion:\"737096\", FieldPath:\"\"}): type: 'Normal' reason: 'LeaderElection' kubemaster--0aa8e87a222ebc781.nw became leader\r\nI0818 09:16:45.838560       1 shared_informer.go:116] caches populated\r\n\r\nI0818 09:19:22.361105       1 leaderelection.go:204] successfully renewed lease kube-system/kube-scheduler\r\nI0818 09:19:24.369669       1 leaderelection.go:204] successfully renewed lease kube-system/kube-scheduler\r\nI0818 09:19:25.338146       1 reflector.go:405] external/com_github_kubernetes/plugin/cmd/kube-scheduler/app/server.go:100: Watch close - *v1.Pod total 21 items received\r\nI0818 09:19:25.340488       1 factory.go:511] About to try and schedule pod explorer-job-1503047460-7681l\r\nI0818 09:19:25.340495       1 scheduler.go:261] Attempting to schedule pod: scheduled-jobs/explorer-job-1503047460-7681l\r\nW0818 09:19:25.340723       1 cache.go:228] Pod scheduled-jobs/explorer-job-1503047460-7681l assumed to a different node than added to.\r\nE0818 09:19:25.340741       1 cache.go:263] Pod scheduled-jobs/explorer-job-1503047460-7681l updated on a different node than previously added to.\r\nF0818 09:19:25.340759       1 cache.go:264] Schedulercache is corrupted and can badly affect scheduling decisions\r\n```\r\n\r\n\r\n**Environment**:\r\n\r\n- Kubernetes version (use `kubectl version`): 1.7.4\r\n- Etcd version: 3.2.0-rc.1+git\r\n- Cloud provider or hardware configuration**: AWS\r\n- OS: Ubuntu 15.04\r\n- Kernel: 4.4.0\r\n",
  "closed_at": "2017-11-08T07:23:33Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 31,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/50916/comments",
  "created_at": "2017-08-18T15:39:17Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/50916/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/50916",
  "id": 251283586,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "ededed",
      "default": false,
      "description": null,
      "id": 687345274,
      "name": "milestone/removed",
      "node_id": "MDU6TGFiZWw2ODczNDUyNzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/milestone/removed"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": "Must be staffed and worked on either currently, or very soon, ideally in time for the next release.",
      "id": 114528223,
      "name": "priority/important-soon",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyMjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/important-soon"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/50916/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNTEyODM1ODY=",
  "number": 50916,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Scheduler dies with \"Schedulercache is corrupted\"",
  "updated_at": "2017-11-08T18:24:57Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/50916",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/23065472?v=4",
    "events_url": "https://api.github.com/users/julia-stripe/events{/privacy}",
    "followers_url": "https://api.github.com/users/julia-stripe/followers",
    "following_url": "https://api.github.com/users/julia-stripe/following{/other_user}",
    "gists_url": "https://api.github.com/users/julia-stripe/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/julia-stripe",
    "id": 23065472,
    "login": "julia-stripe",
    "node_id": "MDQ6VXNlcjIzMDY1NDcy",
    "organizations_url": "https://api.github.com/users/julia-stripe/orgs",
    "received_events_url": "https://api.github.com/users/julia-stripe/received_events",
    "repos_url": "https://api.github.com/users/julia-stripe/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/julia-stripe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/julia-stripe/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/julia-stripe"
  }
}