{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**Kubernetes version** (use `kubectl version`):\r\n1.5.2\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**: LXD\r\n- **OS** (e.g. from /etc/os-release): Ubuntu 16.04\r\n- **Kernel** (e.g. `uname -a`): 4.4.0-57-generic #78-Ubuntu\r\n- **Install tools**: Juju\r\n- **Others**:\r\n\r\n\r\n**What happened**:\r\n\r\nThe kubernetes-master charm entered a `hook failed: \"update-status\"` state with the following stacktrace:\r\n```\r\nThe Service \"kube-dns\" is invalid: spec.clusterIP: Invalid value: \"10.152.183.10\": provided IP is already allocated\r\n2017-01-24 20:52:16 INFO update-status Traceback (most recent call last):\r\n2017-01-24 20:52:16 INFO update-status   File \"/var/lib/juju/agents/unit-kubernetes-master-0/charm/hooks/update-status\", line 19, in <module>\r\n2017-01-24 20:52:16 INFO update-status     main()\r\n2017-01-24 20:52:16 INFO update-status   File \"/usr/local/lib/python3.5/dist-packages/charms/reactive/__init__.py\", line 78, in main\r\n2017-01-24 20:52:16 INFO update-status     bus.dispatch()\r\n2017-01-24 20:52:16 INFO update-status   File \"/usr/local/lib/python3.5/dist-packages/charms/reactive/bus.py\", line 434, in dispatch\r\n2017-01-24 20:52:16 INFO update-status     _invoke(other_handlers)\r\n2017-01-24 20:52:16 INFO update-status   File \"/usr/local/lib/python3.5/dist-packages/charms/reactive/bus.py\", line 417, in _invoke\r\n2017-01-24 20:52:16 INFO update-status     handler.invoke()\r\n2017-01-24 20:52:16 INFO update-status   File \"/usr/local/lib/python3.5/dist-packages/charms/reactive/bus.py\", line 291, in invoke\r\n2017-01-24 20:52:16 INFO update-status     self._action(*args)\r\n2017-01-24 20:52:16 INFO update-status   File \"/var/lib/juju/agents/unit-kubernetes-master-0/charm/reactive/kubernetes_master.py\", line 313, in start_kube_dns\r\n2017-01-24 20:52:16 INFO update-status     create_addon('kubedns-svc.yaml', context)\r\n2017-01-24 20:52:16 INFO update-status   File \"/var/lib/juju/agents/unit-kubernetes-master-0/charm/reactive/kubernetes_master.py\", line 431, in create_addon\r\n2017-01-24 20:52:16 INFO update-status     check_call(cmd)\r\n2017-01-24 20:52:16 INFO update-status   File \"/usr/lib/python3.5/subprocess.py\", line 581, in check_call\r\n2017-01-24 20:52:16 INFO update-status     raise CalledProcessError(retcode, cmd)\r\n2017-01-24 20:52:16 INFO update-status subprocess.CalledProcessError: Command '['kubectl', 'apply', '-f', '/etc/kubernetes/addons/kubedns-svc.yaml']' returned non-zero exit status 1\r\n```\r\n\r\nThe 10.152.183.10 IP was already claimed by default-http-backend:\r\n```\r\n$ kubectl get svc default-http-backend\r\nNAME                   CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\r\ndefault-http-backend   10.152.183.10   <none>        80/TCP    32m\r\n```\r\n\r\n**What you expected to happen**:\r\n\r\ndefault-http-backend should not deploy until after kube-dns has had a chance to reserve its dedicated IP\r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\n\r\nIt'll be hard to reproduce this reliably since the default-http-backend service IP is chosen randomly. However, this might occur sporadically when deploying with juju.",
  "closed_at": "2017-04-26T17:10:18Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/40386/comments",
  "created_at": "2017-01-24T21:40:48Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/40386/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/40386",
  "id": 202948087,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 154660912,
      "name": "area/cloudprovider",
      "node_id": "MDU6TGFiZWwxNTQ2NjA5MTI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/cloudprovider"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/40386/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMDI5NDgwODc=",
  "number": 40386,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kube-dns deployment occasionally fails with juju",
  "updated_at": "2017-04-26T17:10:18Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/40386",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/2251600?v=4",
    "events_url": "https://api.github.com/users/Cynerva/events{/privacy}",
    "followers_url": "https://api.github.com/users/Cynerva/followers",
    "following_url": "https://api.github.com/users/Cynerva/following{/other_user}",
    "gists_url": "https://api.github.com/users/Cynerva/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/Cynerva",
    "id": 2251600,
    "login": "Cynerva",
    "node_id": "MDQ6VXNlcjIyNTE2MDA=",
    "organizations_url": "https://api.github.com/users/Cynerva/orgs",
    "received_events_url": "https://api.github.com/users/Cynerva/received_events",
    "repos_url": "https://api.github.com/users/Cynerva/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/Cynerva/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Cynerva/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/Cynerva"
  }
}