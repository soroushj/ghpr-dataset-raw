{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "We found a bug about GPU allocation failed with upstream code. \r\nIf the container with GPU in a `Pod` dead and restart, the GPU is still occupied by the old container so that the new container can not get GPU anymore. You can replay the bug by the script below:\r\n```yaml\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: gpu\r\n  labels:\r\n    name: gpu\r\nspec:\r\n  containers:\r\n  - name: gpu\r\n    image: nvidia/cuda:jian\r\n    command: [\"/bin/sh\", \"-c\"]\r\n    args: [\"sleep 10\"]\r\n    resources:\r\n      limits:\r\n        cpu: 0.5\r\n        memory: 128Mi\r\n        alpha.kubernetes.io/nvidia-gpu: 4\r\n    ports:\r\n    - containerPort: 6379 \r\n```\r\nAfter we created the pod, we can see the output as below:\r\n```\r\nroot@slave2:/home/zhangjian/testK8s# kubectl get pods\r\nNAME      READY     STATUS    RESTARTS   AGE\r\ngpu       1/1       Running   0          7s\r\nroot@slave2:/home/zhangjian/testK8s# kubectl get pods\r\nNAME      READY     STATUS      RESTARTS   AGE\r\ngpu       0/1       Completed   0          20s\r\nroot@slave2:/home/zhangjian/testK8s# kubectl get pods\r\nNAME      READY     STATUS                                                             RESTARTS   AGE\r\ngpu       0/1       requested number of GPUs unavailable. Requested: 4, Available: 0   0          36s\r\n```\r\nAfter container completed, `Pod` try to restart a new container. But the new container can not get GPU because GPU is still unreleased by the fisrt container. Depolyment and RC controller have the same problem. ",
  "closed_at": "2017-03-14T17:19:17Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 10,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/42412/comments",
  "created_at": "2017-03-02T09:53:40Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/42412/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/42412",
  "id": 211340898,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/42412/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:22:37Z",
    "closed_issues": 1514,
    "created_at": "2017-01-19T17:41:27Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/7882754?v=4",
      "events_url": "https://api.github.com/users/pwittrock/events{/privacy}",
      "followers_url": "https://api.github.com/users/pwittrock/followers",
      "following_url": "https://api.github.com/users/pwittrock/following{/other_user}",
      "gists_url": "https://api.github.com/users/pwittrock/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/pwittrock",
      "id": 7882754,
      "login": "pwittrock",
      "node_id": "MDQ6VXNlcjc4ODI3NTQ=",
      "organizations_url": "https://api.github.com/users/pwittrock/orgs",
      "received_events_url": "https://api.github.com/users/pwittrock/received_events",
      "repos_url": "https://api.github.com/users/pwittrock/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/pwittrock/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pwittrock/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/pwittrock"
    },
    "description": "",
    "due_on": "2017-06-28T07:00:00Z",
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/32",
    "id": 2264750,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/32/labels",
    "node_id": "MDk6TWlsZXN0b25lMjI2NDc1MA==",
    "number": 32,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.7",
    "updated_at": "2019-08-26T17:22:37Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/32"
  },
  "node_id": "MDU6SXNzdWUyMTEzNDA4OTg=",
  "number": 42412,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "GPU allocation failed after container in Pod restart ",
  "updated_at": "2017-03-14T17:19:17Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/42412",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/15416633?v=4",
    "events_url": "https://api.github.com/users/jianzhangbjz/events{/privacy}",
    "followers_url": "https://api.github.com/users/jianzhangbjz/followers",
    "following_url": "https://api.github.com/users/jianzhangbjz/following{/other_user}",
    "gists_url": "https://api.github.com/users/jianzhangbjz/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jianzhangbjz",
    "id": 15416633,
    "login": "jianzhangbjz",
    "node_id": "MDQ6VXNlcjE1NDE2NjMz",
    "organizations_url": "https://api.github.com/users/jianzhangbjz/orgs",
    "received_events_url": "https://api.github.com/users/jianzhangbjz/received_events",
    "repos_url": "https://api.github.com/users/jianzhangbjz/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jianzhangbjz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jianzhangbjz/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jianzhangbjz"
  }
}