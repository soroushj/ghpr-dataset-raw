{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind bug\r\n/area ipv6\r\n/area ipvs\r\n/sig network\r\n\r\n**What happened**:\r\n\r\nIn an ipv6-only cluster with proxy-mode=ipvs the entries for NodePort in ipvs are created for ipv4 addresses. The target's (if there are any) consists of ipv6 addresses (wrongly) interpreted as ipv4;\r\n\r\n```\r\n# kubectl get svc\r\nNAME         TYPE        CLUSTER-IP        EXTERNAL-IP   PORT(S)          AGE\r\ncgen         NodePort    fd00:4000::c698   1000::2       5001:30669/TCP   42m\r\n...\r\n# ipvsadm -L -n\r\nIP Virtual Server version 1.2.1 (size=4096)\r\nProt LocalAddress:Port Scheduler Flags\r\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\r\nTCP  127.0.0.1:30669 rr\r\n  -> 253.0.48.0:5001              Masq    1      0          0         \r\nTCP  192.168.0.4:30669 rr\r\n  -> 253.0.48.0:5001              Masq    1      0          0         \r\nTCP  [fd00:4000::c698]:5001 rr\r\n  -> [fd00:3000:1::2]:5001        Masq    1      0          0         \r\n  -> [fd00:3000:2::2]:5001  \r\n...\r\n```\r\n\r\nAttempts to use the NodePort with ipv6 addresses are black-holed.\r\n\r\n**What you expected to happen**:\r\n\r\nIpv6 addresses to the nodes should be used for NotePort and the LB-targets shall be the ipv6 address of the pods. Traffic to NodePorts shall be distributed among the (ipv6) endpoints.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n* Setup an ipv6-only cluster\r\n* Create a service with type `NodePort` with endpoints\r\n* Try to connect to the NodePort\r\n* Do `ipvsadm -L -n`\r\n\r\n**Anything else we need to know?**:\r\n\r\nThe nodes have both ipv4 and ipv6 addresses and it is possible that if the nodes only had ipv6 addresses it would work (I havn't tested). But even in an ipv6-only k8s cluster the nodes almost always need ipv4 addresses for other purposes.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n```\r\n# kubectl version\r\nClient Version: version.Info{Major:\"1\", Minor:\"13+\", GitVersion:\"v1.13.0-alpha.0.1136+edd4fc25330c7f\", GitCommit:\"edd4fc25330c7fba7f0fd8a127b872c8614c7363\", GitTreeState:\"clean\", BuildDate:\"2018-09-07T16:28:26Z\", GoVersion:\"go1.10.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"13+\", GitVersion:\"v1.13.0-alpha.0.1136+edd4fc25330c7f\", GitCommit:\"edd4fc25330c7fba7f0fd8a127b872c8614c7363\", GitTreeState:\"clean\", BuildDate:\"2018-09-07T16:27:51Z\", GoVersion:\"go1.10.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n- Cloud provider or hardware configuration:\r\n  Kvm VMs on Ubuntu 18.04.01 LTS\r\n- OS (e.g. from /etc/os-release):\r\n  Own BusyBox based system\r\n- Kernel (e.g. `uname -a`):\r\n```\r\n# uname -a\r\nLinux vm-004 4.18.5 #1 SMP Fri Sep 7 14:40:23 CEST 2018 x86_64 GNU/Linux\r\n```\r\n- Install tools:\r\n  None\r\n- Others:\r\n",
  "closed_at": "2018-12-10T16:53:43Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 5,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68437/comments",
  "created_at": "2018-09-08T19:37:44Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68437/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/68437",
  "id": 358322366,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 608460743,
      "name": "area/ipv6",
      "node_id": "MDU6TGFiZWw2MDg0NjA3NDM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/ipv6"
    },
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 755527763,
      "name": "area/ipvs",
      "node_id": "MDU6TGFiZWw3NTU1Mjc3NjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/ipvs"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68437/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNTgzMjIzNjY=",
  "number": 68437,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "In ipv6-only cluster with proxy-mode=ipvs ipv4 entries are used for NodePort",
  "updated_at": "2018-12-10T16:53:43Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68437",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/37046727?v=4",
    "events_url": "https://api.github.com/users/uablrek/events{/privacy}",
    "followers_url": "https://api.github.com/users/uablrek/followers",
    "following_url": "https://api.github.com/users/uablrek/following{/other_user}",
    "gists_url": "https://api.github.com/users/uablrek/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/uablrek",
    "id": 37046727,
    "login": "uablrek",
    "node_id": "MDQ6VXNlcjM3MDQ2NzI3",
    "organizations_url": "https://api.github.com/users/uablrek/orgs",
    "received_events_url": "https://api.github.com/users/uablrek/received_events",
    "repos_url": "https://api.github.com/users/uablrek/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/uablrek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/uablrek/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/uablrek"
  }
}