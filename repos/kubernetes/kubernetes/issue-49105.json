{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n/kind bug\r\n\r\n**What happened**:\r\n\r\nI have a transient local disk mounted under /var/lib/docker in order to take advantage of faster IO on Azure VMs. This means that all that data is lost when a reboot occurs, but the rest of the data outside that mountpoint persists. After the reboot, the existing pods are relaunched, and kubelet is unable to create the log file symlinks because they already exist, but they are pointing to an invalid place, that container no longer exists. Here are the relevant log lines:\r\n\r\n```\r\nJul 18 09:54:41 node-2-vm kubelet-wrapper[773]: E0718 09:54:41.752901     773 remote_runtime.go:203] StartContainer \"b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35\" from runtime service failed: rpc error: code = 2 desc = failed to create symbolic link \"/var/log/pods/f4c0303476d69c6f78ffd13253de3723/kube-proxy_0.log\" to the container log file \"/var/lib/docker/containers/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35-json.log\" for container \"b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35\": symlink /var/lib/docker/containers/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35-json.log /var/log/pods/f4c0303476d69c6f78ffd13253de3723/kube-proxy_0.log: file exists\r\nJul 18 09:54:41 node-2-vm kubelet-wrapper[773]: E0718 09:54:41.752978     773 kuberuntime_manager.go:719] container start failed: rpc error: code = 2 desc = failed to create symbolic link \"/var/log/pods/f4c0303476d69c6f78ffd13253de3723/kube-proxy_0.log\" to the container log file \"/var/lib/docker/containers/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35-json.log\" for container \"b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35\": symlink /var/lib/docker/containers/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35-json.log /var/log/pods/f4c0303476d69c6f78ffd13253de3723/kube-proxy_0.log: file exists: Start Container Failed\r\nJul 18 09:54:41 node-2-vm kubelet-wrapper[773]: E0718 09:54:41.753007     773 pod_workers.go:182] Error syncing pod f4c0303476d69c6f78ffd13253de3723 (\"kube-proxy-node-2-vm_kube-system(f4c0303476d69c6f78ffd13253de3723)\"), skipping: failed to \"StartContainer\" for \"kube-proxy\" with rpc error: code = 2 desc = failed to create symbolic link \"/var/log/pods/f4c0303476d69c6f78ffd13253de3723/kube-proxy_0.log\" to the container log file \"/var/lib/docker/containers/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35-json.log\" for container \"b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35\": symlink /var/lib/docker/containers/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35/b27338f68b9fff70a321f0887bceb45707fe4375e948201c0ea19ac087b64f35-json.log /var/log/pods/f4c0303476d69c6f78ffd13253de3723/kube-proxy_0.log: file exists: \"Start Container Failed\"\r\nJul 18 09:55:32 node-2-vm kubelet-wrapper[773]: E0718 09:55:32.418162     773 remote_runtime.go:203] StartContainer \"c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424\" from runtime service failed: rpc error: code = 2 desc = failed to create symbolic link \"/var/log/pods/d700822b-6aff-11e7-80e8-000d3a2a0829/omsagent_0.log\" to the container log file \"/var/lib/docker/containers/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424-json.log\" for container \"c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424\": symlink /var/lib/docker/containers/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424-json.log /var/log/pods/d700822b-6aff-11e7-80e8-000d3a2a0829/omsagent_0.log: file exists\r\nJul 18 09:55:32 node-2-vm kubelet-wrapper[773]: E0718 09:55:32.418212     773 kuberuntime_manager.go:719] container start failed: rpc error: code = 2 desc = failed to create symbolic link \"/var/log/pods/d700822b-6aff-11e7-80e8-000d3a2a0829/omsagent_0.log\" to the container log file \"/var/lib/docker/containers/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424-json.log\" for container \"c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424\": symlink /var/lib/docker/containers/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424-json.log /var/log/pods/d700822b-6aff-11e7-80e8-000d3a2a0829/omsagent_0.log: file exists: Start Container Failed\r\nJul 18 09:55:32 node-2-vm kubelet-wrapper[773]: E0718 09:55:32.418253     773 pod_workers.go:182] Error syncing pod d700822b-6aff-11e7-80e8-000d3a2a0829 (\"omsagent-8npxv_kube-system(d700822b-6aff-11e7-80e8-000d3a2a0829)\"), skipping: failed to \"StartContainer\" for \"omsagent\" with rpc error: code = 2 desc = failed to create symbolic link \"/var/log/pods/d700822b-6aff-11e7-80e8-000d3a2a0829/omsagent_0.log\" to the container log file \"/var/lib/docker/containers/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424-json.log\" for container \"c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424\": symlink /var/lib/docker/containers/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424/c87d32fd34acbb11486b28a8eaaee2553dd83516c2ebe7552662599046300424-json.log /var/log/pods/d700822b-6aff-11e7-80e8-000d3a2a0829/omsagent_0.log: file exists: \"Start Container Failed\"\r\n```\r\n\r\nThe old symlinks are there:\r\n```\r\n# ls -l `find /var/log/pods/ -name *.log`\r\nlrwxrwxrwx. 1 root root 165 Jul 17 14:56 /var/log/pods/d700822b-6aff-11e7-80e8-000d3a2a0829/omsagent_0.log -> /var/lib/docker/containers/1488f596179a3a6da1b818cc658b975c37aa4346beceef2158af82a89b3de84a/1488f596179a3a6da1b818cc658b975c37aa4346beceef2158af82a89b3de84a-json.log\r\nlrwxrwxrwx. 1 root root 165 Jul 17 14:44 /var/log/pods/f4c0303476d69c6f78ffd13253de3723/kube-proxy_0.log -> /var/lib/docker/containers/8cafac3d554bd13d858a7843aed1f51a02ec125291d89209d9407e31fd2b010b/8cafac3d554bd13d858a7843aed1f51a02ec125291d89209d9407e31fd2b010b-json.log\r\n```\r\n\r\n**What you expected to happen**:\r\n\r\nThe correct symlinks should overwrite the old ones.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nErase /var/lib/docker between reboots with existing pods.\r\n\r\n**Anything else we need to know?**:\r\n\r\nNo.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): Server Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.0+coreos.0\", GitCommit:\"8c1bf133b4129042ef8f7d1ffac1be14ee83ed10\", GitTreeState:\"clean\", BuildDate:\"2017-06-30T17:46:00Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n- Cloud provider or hardware configuration**: Azure VMs\r\n- OS (e.g. from /etc/os-release): Container Linux by CoreOS 1409.6.0 (Ladybug)\r\n- Kernel (e.g. `uname -a`): Linux node-2-vm 4.11.9-coreos #1 SMP Thu Jul 6 00:54:42 UTC 2017 x86_64 Intel(R) Xeon(R) CPU E5-2673 v3 @ 2.40GHz GenuineIntel GNU/Linux\r\n- Install tools: https://github.com/edevil/kubernetes-deployment\r\n",
  "closed_at": "2017-07-20T22:08:17Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/49105/comments",
  "created_at": "2017-07-18T10:12:44Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/49105/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/49105",
  "id": 243666204,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/49105/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNDM2NjYyMDQ=",
  "number": 49105,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Transient /var/lib/docker prevents correct container log symlink",
  "updated_at": "2017-07-20T22:08:17Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/49105",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/12426?v=4",
    "events_url": "https://api.github.com/users/edevil/events{/privacy}",
    "followers_url": "https://api.github.com/users/edevil/followers",
    "following_url": "https://api.github.com/users/edevil/following{/other_user}",
    "gists_url": "https://api.github.com/users/edevil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/edevil",
    "id": 12426,
    "login": "edevil",
    "node_id": "MDQ6VXNlcjEyNDI2",
    "organizations_url": "https://api.github.com/users/edevil/orgs",
    "received_events_url": "https://api.github.com/users/edevil/received_events",
    "repos_url": "https://api.github.com/users/edevil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/edevil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/edevil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/edevil"
  }
}