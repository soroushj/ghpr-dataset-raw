{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "### Problem outline\r\n\r\nWhen we want to rotate certificates for aggregated API servers, we have to restart (kill) pods in order for API server to pick the new certificates. It would be very useful to implement some sort of self-awareness for the aggregated API servers, so they can pick-up new certificates when they're updated, without user interaction.\r\n\r\n### Problem description\r\n\r\nIf we have certificate files in pods, that are provided by some volumeSource, that can be persistent storage or a Secret, when file gets changed on the volume, the kubelet updates file in the pod usually in matters of few seconds.\r\n\r\nHowever, aggregated API servers are not self-aware of such change and users have to manually restart the pods. \r\n\r\nThis brings additional complexity, especially if you want to automate the process.\r\n\r\nThe first problem is that you need to know what pods you need to restart. But the potentially biggest problem is that you need additional permissions to do so. That would include RBAC permissions for listing pods, listing deployments and for deleting pods. That can make a security issue in some setups. By making aggregated API servers sort of self-aware, this could be avoided.\r\n\r\n### Problem solution\r\n\r\nCreate a health check somewhere in `k8s.io/apiserver`, that utilizes a file watcher to watch for certificates changes. When certificate is changed, fail a health check. Failing health check will restart the pod without user interaction.\r\n\r\nThis could be the most easiest and simplest solution to the problem.\r\n\r\n#### Potential caveats\r\n\r\nSuch feature should/could be optional and guarded by a flag, let's name it `--restart-on-certs-change`.\r\n\r\nSome delay could be required between restarting pods. We probably don't want to kill all pods in the same time. This is up to be discussed.\r\n\r\nI would like to work on this issue, so feel free to assign it to me.\r\n\r\n/kind feature\r\n/sig api-machinery\r\n/area apiserver\r\n/cc @deads2k @sttts ",
  "closed_at": "2019-06-28T20:18:29Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66448/comments",
  "created_at": "2018-07-20T14:53:56Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66448/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/66448",
  "id": 343138595,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 136601536,
      "name": "area/apiserver",
      "node_id": "MDU6TGFiZWwxMzY2MDE1MzY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/apiserver"
    },
    {
      "color": "c7def8",
      "default": false,
      "description": "Categorizes issue or PR as related to a new feature.",
      "id": 267761362,
      "name": "kind/feature",
      "node_id": "MDU6TGFiZWwyNjc3NjEzNjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/feature"
    },
    {
      "color": "604460",
      "default": false,
      "description": "Denotes an issue or PR that has aged beyond stale and will be auto-closed.",
      "id": 778118402,
      "name": "lifecycle/rotten",
      "node_id": "MDU6TGFiZWw3NzgxMTg0MDI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/lifecycle/rotten"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG API Machinery.",
      "id": 173493835,
      "name": "sig/api-machinery",
      "node_id": "MDU6TGFiZWwxNzM0OTM4MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/api-machinery"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66448/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNDMxMzg1OTU=",
  "number": 66448,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Implement mechanism for certificates rotation in aggregated API servers",
  "updated_at": "2019-06-28T20:18:30Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66448",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/18719127?v=4",
    "events_url": "https://api.github.com/users/xmudrii/events{/privacy}",
    "followers_url": "https://api.github.com/users/xmudrii/followers",
    "following_url": "https://api.github.com/users/xmudrii/following{/other_user}",
    "gists_url": "https://api.github.com/users/xmudrii/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/xmudrii",
    "id": 18719127,
    "login": "xmudrii",
    "node_id": "MDQ6VXNlcjE4NzE5MTI3",
    "organizations_url": "https://api.github.com/users/xmudrii/orgs",
    "received_events_url": "https://api.github.com/users/xmudrii/received_events",
    "repos_url": "https://api.github.com/users/xmudrii/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/xmudrii/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/xmudrii/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/xmudrii"
  }
}