{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/419322?v=4",
    "events_url": "https://api.github.com/users/robscott/events{/privacy}",
    "followers_url": "https://api.github.com/users/robscott/followers",
    "following_url": "https://api.github.com/users/robscott/following{/other_user}",
    "gists_url": "https://api.github.com/users/robscott/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/robscott",
    "id": 419322,
    "login": "robscott",
    "node_id": "MDQ6VXNlcjQxOTMyMg==",
    "organizations_url": "https://api.github.com/users/robscott/orgs",
    "received_events_url": "https://api.github.com/users/robscott/received_events",
    "repos_url": "https://api.github.com/users/robscott/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/robscott/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/robscott/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/robscott"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/419322?v=4",
      "events_url": "https://api.github.com/users/robscott/events{/privacy}",
      "followers_url": "https://api.github.com/users/robscott/followers",
      "following_url": "https://api.github.com/users/robscott/following{/other_user}",
      "gists_url": "https://api.github.com/users/robscott/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/robscott",
      "id": 419322,
      "login": "robscott",
      "node_id": "MDQ6VXNlcjQxOTMyMg==",
      "organizations_url": "https://api.github.com/users/robscott/orgs",
      "received_events_url": "https://api.github.com/users/robscott/received_events",
      "repos_url": "https://api.github.com/users/robscott/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/robscott/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robscott/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/robscott"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**What happened**:\r\n\r\nIn the PMEM-CSI CI, we rapidly deploy and remove a custom resources which then owns all objects created for that resource. Deletion of those objects is handled through ownership references, i.e. deleting the CR is expected to cascade to all objects. This worked fine up to Kubernetes 1.17.\r\n\r\nWhen starting to test with 1.18.2, we pretty reliably get into a state where the CR and the service objects owned by it are marked for deletion, but don't go away.\r\n\r\nDebugging with the garbage collector's dependency graph (see https://kubernetes.slack.com/archives/C0EG7JC6T/p1589547091345700?thread_ts=1589546899.344300&cid=C0EG7JC6T) showed that endpointslices were blocking the deletion of the services and thus the CR. In the graph dump (= a snaphot in time), they were not even marked for deletion.\r\n\r\nA closer look showed that endpointslices for the services were getting created and deleted continuously for over 15 minutes. Eventually, the garbage collector won and managed to delete endpointslices and services before new endpointslices were created.\r\n\r\n**What you expected to happen**:\r\n\r\nThere seems to be a missing check in https://github.com/kubernetes/kubernetes/blob/master/pkg/controller/endpointslice/endpointslice_controller.go: if the service is marked for deletion (i.e. has a deletionTimestamp), then the controller should not create new endpointslices.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nI tried to boil it down to a script, but it just ran fine. The \"easiest\" way to reproduce it is to run PMEM-CSI's E2E testing, which is probably not easy enough :disappointed: \r\n\r\n**Anything else we need to know?**:\r\n\r\nDisabling the EndpointSlice feature makes the problem go away.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.18.2\r\n- Cloud provider or hardware configuration: QEMU virtual machines\r\n- OS (e.g: `cat /etc/os-release`): Fedora\r\n- Install tools: kubeadm\r\n\r\n/sig network",
  "closed_at": "2020-07-01T23:22:01Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 8,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/91287/comments",
  "created_at": "2020-05-20T12:11:44Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/91287/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/91287",
  "id": 621710661,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/91287/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MjE3MTA2NjE=",
  "number": 91287,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "endpointslice creation and garbage collection are racy",
  "updated_at": "2020-07-01T23:22:01Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/91287",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/22076?v=4",
    "events_url": "https://api.github.com/users/pohly/events{/privacy}",
    "followers_url": "https://api.github.com/users/pohly/followers",
    "following_url": "https://api.github.com/users/pohly/following{/other_user}",
    "gists_url": "https://api.github.com/users/pohly/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/pohly",
    "id": 22076,
    "login": "pohly",
    "node_id": "MDQ6VXNlcjIyMDc2",
    "organizations_url": "https://api.github.com/users/pohly/orgs",
    "received_events_url": "https://api.github.com/users/pohly/received_events",
    "repos_url": "https://api.github.com/users/pohly/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/pohly/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pohly/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/pohly"
  }
}