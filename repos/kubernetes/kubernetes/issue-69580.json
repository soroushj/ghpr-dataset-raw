{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- This form is for bug reports and feature requests ONLY!\r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/.\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n/kind bug\r\n\r\n**What happened**:\r\nUsing the StorageOS volume driver, the VolumeMount() api method is called after the volume driver has already performed the mount.  This means that the api is unable to reject the k8s mount request if prerequisites fail (e.g. it has been mounted elsewhere or the volume has been disabled).\r\n\r\nIn addition, no api call is made to attach the StorageOS device prior to the mount operation.  This does not currently cause a problem as with StorageOS all devices are available on all cluster nodes, but validation should still be done in the Attach phase so that any errors are raised in the correct phase.  This is done correctly in the StorageOS CSI driver and should be back-ported to the volume driver.\r\n\r\n**What you expected to happen**:\r\nPVC mount should fail if StorageOS VolumeMount() API call fails.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n1. Create a PVC using the StorageOS Volume Driver.\r\n2. Mount the volume using external tools (`storageos volume mount volname /mnt` on any node)\r\n3. Reference the PVC in a Pod.  The PVC will get mounted, even though StorageOS knows it is mounted elsewhere.\r\n\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.8+ (incl. 1.12.0)\r\n- Cloud provider or hardware configuration: any\r\n- OS (e.g. from /etc/os-release): any linux (incl. Ubuntu 18.04)\r\n- Kernel (e.g. `uname -a`): any linux (incl. 4.15.0-33-generic)\r\n- Install tools: any (incl. minikube)\r\n- Others:\r\n\r\n/sig storage\r\n/cc @darkowlzz",
  "closed_at": "2019-02-20T20:51:58Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69580/comments",
  "created_at": "2018-10-09T16:31:56Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69580/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/69580",
  "id": 368296515,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Storage.",
      "id": 169428334,
      "name": "sig/storage",
      "node_id": "MDU6TGFiZWwxNjk0MjgzMzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/storage"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69580/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNjgyOTY1MTU=",
  "number": 69580,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "StorageOS volume mount succeeds even if request to mount via api fails",
  "updated_at": "2019-02-20T20:51:58Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69580",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/211994?v=4",
    "events_url": "https://api.github.com/users/croomes/events{/privacy}",
    "followers_url": "https://api.github.com/users/croomes/followers",
    "following_url": "https://api.github.com/users/croomes/following{/other_user}",
    "gists_url": "https://api.github.com/users/croomes/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/croomes",
    "id": 211994,
    "login": "croomes",
    "node_id": "MDQ6VXNlcjIxMTk5NA==",
    "organizations_url": "https://api.github.com/users/croomes/orgs",
    "received_events_url": "https://api.github.com/users/croomes/received_events",
    "repos_url": "https://api.github.com/users/croomes/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/croomes/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/croomes/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/croomes"
  }
}