{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "/kind bug\r\n\r\n**What happened**:\r\n\r\nOn a large cluster with enough pods, endpoints take as long as 10 minutes to show up after their associated pods and service are created. We believe that this is because every pod change results in an update of the addresses within the endpoint since they refer to a pod via a `TargetRef` whose `ResourceVersion` changes every time a pod change is observed. All these non-update updates eventually overwhelm the endpoint controller's queue rate limit and the queue starts to grow.  While an increase in the queue's rate limit can alleviate the problem, an admin can keep a much lower limit if the non-update updates are dropped rather than processed.\r\n\r\n**What you expected to happen**:\r\n\r\nWhen a pod related to an endpoint is updated, I would expect the endpoint to update only if there is a change in the pod that relates to the endpoint, such as a change in the pod's IP address.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n1. Create a pod and associated service:\r\n```\r\nkubectl create -f https://raw.githubusercontent.com/openshift-qe/v3-testfiles/master/networking/list_for_pods.json\r\n```\r\n2. Watch the endpoint for changes:\r\n```\r\nkubectl get endpoint -o yaml --watch test-service\r\n```\r\n3. Leave the watch running, and in another session, edit a pod to add a label:\r\n```\r\nkubectl get pods\r\nkubectl edit pod <podname>\r\n```\r\nThen add another label on the line after the `name:` label, such as `foo: bar`\r\n4. Notice that the watched endpoint changed despite there not being any meaningful change to the fields the endpoint cares about.\r\n\r\n**Anything else we need to know?**:\r\n\r\nThe PR #50934 addresses this issue.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"8+\", GitVersion:\"v1.8.0-alpha.2.2169+683f09c65e5a79\", GitCommit:\"683f09c65e5a7954a272e6640876b357bbdaf2e4\", GitTreeState:\"clean\", BuildDate:\"2017-08-18T21:54:52Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"8+\", GitVersion:\"v1.8.0-alpha.2.2167+683f09c65e5a79\", GitCommit:\"683f09c65e5a7954a272e6640876b357bbdaf2e4\", GitTreeState:\"clean\", BuildDate:\"2017-08-18T22:57:06Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```",
  "closed_at": "2017-08-22T01:11:19Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/50936/comments",
  "created_at": "2017-08-18T23:00:04Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/50936/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/50936",
  "id": 251377679,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scalability.",
      "id": 125010198,
      "name": "sig/scalability",
      "node_id": "MDU6TGFiZWwxMjUwMTAxOTg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scalability"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/50936/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNTEzNzc2Nzk=",
  "number": 50936,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "No-op endpoint updates clog up endpoint controller's queue",
  "updated_at": "2017-08-22T01:11:19Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/50936",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/329907?v=4",
    "events_url": "https://api.github.com/users/joelsmith/events{/privacy}",
    "followers_url": "https://api.github.com/users/joelsmith/followers",
    "following_url": "https://api.github.com/users/joelsmith/following{/other_user}",
    "gists_url": "https://api.github.com/users/joelsmith/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/joelsmith",
    "id": 329907,
    "login": "joelsmith",
    "node_id": "MDQ6VXNlcjMyOTkwNw==",
    "organizations_url": "https://api.github.com/users/joelsmith/orgs",
    "received_events_url": "https://api.github.com/users/joelsmith/received_events",
    "repos_url": "https://api.github.com/users/joelsmith/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/joelsmith/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/joelsmith/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/joelsmith"
  }
}