{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/32884155?v=4",
    "events_url": "https://api.github.com/users/yliaog/events{/privacy}",
    "followers_url": "https://api.github.com/users/yliaog/followers",
    "following_url": "https://api.github.com/users/yliaog/following{/other_user}",
    "gists_url": "https://api.github.com/users/yliaog/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/yliaog",
    "id": 32884155,
    "login": "yliaog",
    "node_id": "MDQ6VXNlcjMyODg0MTU1",
    "organizations_url": "https://api.github.com/users/yliaog/orgs",
    "received_events_url": "https://api.github.com/users/yliaog/received_events",
    "repos_url": "https://api.github.com/users/yliaog/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/yliaog/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yliaog/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/yliaog"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/32884155?v=4",
      "events_url": "https://api.github.com/users/yliaog/events{/privacy}",
      "followers_url": "https://api.github.com/users/yliaog/followers",
      "following_url": "https://api.github.com/users/yliaog/following{/other_user}",
      "gists_url": "https://api.github.com/users/yliaog/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/yliaog",
      "id": 32884155,
      "login": "yliaog",
      "node_id": "MDQ6VXNlcjMyODg0MTU1",
      "organizations_url": "https://api.github.com/users/yliaog/orgs",
      "received_events_url": "https://api.github.com/users/yliaog/received_events",
      "repos_url": "https://api.github.com/users/yliaog/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/yliaog/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yliaog/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/yliaog"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "\r\n**What happened**:\r\n\r\nWhen apiserver is using apiservice and service EXTERNAL-IP to access the external http service(a sample metric service),the \"http request header Host\" is still the apiserver's Host, causing the external http proxy services are failed to forward the request normally.\r\n\r\nThe requested link is like this\uff0c **client  ->  apiserver  ->  external http proxy service  ->  real http service(metric service)**\r\n\r\n\r\n**What you expected to happen**:\r\nMany http proxy servers handle request forwarding through the http request header Host, such as nginx\u3002if the aggregator accesses an external http service, the original request header HOST should be request.URL.Host\r\n\r\n\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n1.create apiservice and ExternalName service\r\n2.create a http proxy server(eg.nginx) and print the \"HTTP HEADER HOST\" to nginx accesslog\r\n3.try to change test-ext-adaptor.dailyevn.net DNS IP to the proxy server ip\r\n4.access https://127.0.0.1:6443/apis/power.metrics.extender/v1alpha1/nodes\r\n5.see nginx access log,the \"HTTP HEADER HOST\" is '127.0.0.1:6443' but not  test-ext-adaptor.dailyevn.net:443\r\n\r\n**The following is the configuration\uff1a**\r\n\r\n> [root@8c00516de625 ~]# kubectl get svc\r\nNAME            TYPE           CLUSTER-IP   EXTERNAL-IP                          PORT(S)   AGE\r\nkubernetes      ClusterIP      10.254.0.1   <none>                               443/TCP   2d\r\npower-metrics   ExternalName   <none>       test-ext-adaptor.dailyevn.net   <none>    2d\r\n\r\n> [root@8c00516de625 ~]# kubectl describe apiservices v1alpha1.power.metrics.extender\r\nName:         v1alpha1.power.metrics.extenderiservices v1alpha1.power.metrics.extender\r\nNamespace:\r\nLabels:       <none>\r\nAnnotations:  <none>\r\nAPI Version:  apiregistration.k8s.io/v1\r\nKind:         APIService\r\nMetadata:\r\n  Creation Timestamp:  2018-11-30T07:54:23Z\r\n  Resource Version:    38765\r\n  Self Link:           /apis/apiregistration.k8s.io/v1/apiservices/v1alpha1.power.metrics.extender\r\n  UID:                 2702bed7-f475-11e8-a76f-02427ea09f19\r\nSpec:\r\n  Group:                     power.metrics.extender\r\n  Group Priority Minimum:    1000\r\n  Insecure Skip TLS Verify:  true\r\n  Service:\r\n    Name:            power-metrics\r\n    Namespace:       default\r\n  Version:           v1alpha1\r\n  Version Priority:  15\r\nStatus:\r\n  Conditions:\r\n    Last Transition Time:  2018-12-03T05:51:12Z\r\n    Message:               all checks passed\r\n    Reason:                Passed\r\n    Status:                True\r\n    Type:                  Available\r\nEvents:                    <none>\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): \r\nClient Version: version.Info{Major:\"1\", Minor:\"11\", GitVersion:\"v1.11.1\", GitCommit:\"b1b29978270dc22fecc592ac55d903350454310a\", GitTreeState:\"clean\", BuildDate:\"2018-11-30T07:43:21Z\", GoVersion:\"go1.10.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"12+\", GitVersion:\"v1.12.0-alpha.0.2304+d08e68e75974eb\", GitCommit:\"d08e68e75974eb31fd65422c969b352ed8397edc\", GitTreeState:\"clean\", BuildDate:\"2018-11-30T16:20:19Z\", GoVersion:\"go1.10.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n- Cloud provider or hardware configuration:\r\n- OS (e.g. from /etc/os-release):\r\nNAME=\"CentOS Linux\"\r\nVERSION=\"7 (Core)\"\r\nID=\"centos\"\r\nID_LIKE=\"rhel fedora\"\r\nVERSION_ID=\"7\"\r\nPRETTY_NAME=\"CentOS Linux 7 (Core)\"\r\nANSI_COLOR=\"0;31\"\r\nCPE_NAME=\"cpe:/o:centos:centos:7\"\r\nHOME_URL=\"https://www.centos.org/\"\r\nBUG_REPORT_URL=\"https://bugs.centos.org/\"\r\nCENTOS_MANTISBT_PROJECT=\"CentOS-7\"\r\nCENTOS_MANTISBT_PROJECT_VERSION=\"7\"\r\nREDHAT_SUPPORT_PRODUCT=\"centos\"\r\nREDHAT_SUPPORT_PRODUCT_VERSION=\"7\"\r\n- Kernel (e.g. `uname -a`):\r\nLinux 2a9cd2f00c15 4.9.87-linuxkit-aufs #1 SMP Wed Mar 14 15:12:16 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n- Install tools:\r\n- Others:\r\n\r\n<!-- DO NOT EDIT BELOW THIS LINE -->\r\n/kind bug",
  "closed_at": "2019-01-29T14:57:18Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 10,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71784/comments",
  "created_at": "2018-12-06T09:24:02Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71784/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/71784",
  "id": 388123814,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG API Machinery.",
      "id": 173493835,
      "name": "sig/api-machinery",
      "node_id": "MDU6TGFiZWwxNzM0OTM4MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/api-machinery"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71784/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzODgxMjM4MTQ=",
  "number": 71784,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "apiserver aggregator can not change the request.Host when access the external http service",
  "updated_at": "2019-01-29T14:57:18Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71784",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/17960355?v=4",
    "events_url": "https://api.github.com/users/KevinKingKong/events{/privacy}",
    "followers_url": "https://api.github.com/users/KevinKingKong/followers",
    "following_url": "https://api.github.com/users/KevinKingKong/following{/other_user}",
    "gists_url": "https://api.github.com/users/KevinKingKong/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/KevinKingKong",
    "id": 17960355,
    "login": "KevinKingKong",
    "node_id": "MDQ6VXNlcjE3OTYwMzU1",
    "organizations_url": "https://api.github.com/users/KevinKingKong/orgs",
    "received_events_url": "https://api.github.com/users/KevinKingKong/received_events",
    "repos_url": "https://api.github.com/users/KevinKingKong/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/KevinKingKong/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KevinKingKong/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/KevinKingKong"
  }
}