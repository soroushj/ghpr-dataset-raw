{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n\r\n**Is this a request for help?**: No\r\n\r\n\r\n**What keywords did you search in Kubernetes issues before filing this one?** : is:issue is:open in:title event \r\n\r\nOriginal report: #45818\r\n\r\n---\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?** (choose one): Bug report\r\n\r\n**Kubernetes version** (use `kubectl version`):\r\n\r\nLatest master, although same bug is in released versions\r\n\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"7+\", GitVersion:\"v1.7.0-alpha.3.625+b353700bfc1ee9-dirty\", GitCommit:\"b353700bfc1ee95b8f9f827c9cc818cf2ab3f943\", GitTreeState:\"dirty\", BuildDate:\"2017-05-17T15:22:37Z\", GoVersion:\"go1.8.1\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"7+\", GitVersion:\"v1.7.0-alpha.3.625+b353700bfc1ee9-dirty\", GitCommit:\"b353700bfc1ee95b8f9f827c9cc818cf2ab3f943\", GitTreeState:\"dirty\", BuildDate:\"2017-05-17T15:16:24Z\", GoVersion:\"go1.8.1\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**: local, with `hack/local-up-cluster.sh`\r\n- **OS** (e.g. from /etc/os-release): Ubuntu 17.04\r\n- **Kernel** (e.g. `uname -a`): 4.10.0-20-generic\r\n- **Install tools**:\r\n- **Others**:\r\n\r\n\r\n**What happened**:\r\n\r\nEvents are currently correlated in a strange way: if too many identical events are produced, a *new* event is created with a message of `(events with common reason combined)`\r\n\r\nFrom the [design proposal](https://github.com/kubernetes/community/blob/master/contributors/design-proposals/event_compression.md), this was intentional:\r\n\r\n> If the EventAggregator observes a similar event produced 10 times in a 10 minute window, it drops the event that was provided as input and creates a new event that differs only on the message. The message denotes that this event is used to group similar events that matched on reason. This aggregated Event is then used in the event processing sequence.\r\n\r\nIt's possible that event TTL's weren't considered when this decision was made, because the original event may drop off and expire, leaving the new event to be continually bumped/modified with its `count` incrementing.  This isn't just a temporary scenario, the event that keeps getting bumped can effectively stay around forever because it keeps getting updated, whereas the original event that contains the actual message text will eventually expire.\r\n\r\nThis can be easily reproduced by launching kube-apiserver with a low TTL (like `--event-ttl=1m0s`) and launching a crashing pod.  The real reason for the crashing eventually goes away:\r\n\r\n```\r\n  FirstSeen\tLastSeen\tCount\tFrom\t\t\tSubObjectPath\t\t\tType\t\tReason\t\tMessage\r\n  ---------\t--------\t-----\t----\t\t\t-------------\t\t\t--------\t------\t\t-------\r\n...\r\n  59s\t\t59s\t\t1\tkubelet, 127.0.0.1\t\t\t\t\tWarning\t\tFailedSync\tError syncing pod, skipping: failed to \"StartContainer\" for \"lifecycler\" with rpc error: code = 2 desc = failed to start container \"4669ec0a8e1fa478466466b5b161665204472293991aa47b36604f480bd7e16d\": Error response from daemon: {\"message\":\"oci runtime error: container_linux.go:247: starting container process caused \\\"exec: \\\\\\\"doesnotexist\\\\\\\": executable file not found in $PATH\\\"\\n\"}: \"Start Container Failed\"\r\n```\r\n\r\nturns into:\r\n\r\n```\r\n  FirstSeen\tLastSeen\tCount\tFrom\t\t\tSubObjectPath\t\t\tType\t\tReason\t\tMessage\r\n  ---------\t--------\t-----\t----\t\t\t-------------\t\t\t--------\t------\t\t-------\r\n...\r\n  36m\t\t4s\t\t279\tkubelet, 127.0.0.1\t\t\t\t\tWarning\t\tFailedSync\t(events with common reason combined)\r\n```\r\n\r\nwith the original event gone.\r\n\r\nThe original PR that brought that behavior in is here: https://github.com/kubernetes/kubernetes/pull/16798\r\n\r\nQuestion I have for @derekwaynecarr or anyone else who can shed light here: Why is a new event created as an aggregation point, rather than just bumping the count and updating the message of the original one?  I don't want to pull too far on this thread here because I think there's some broad agreement that events need an overhaul, but I was wondering if you had thoughts here.",
  "closed_at": "2017-06-03T04:42:41Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45971/comments",
  "created_at": "2017-05-17T16:29:11Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45971/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/45971",
  "id": 229414564,
  "labels": [
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45971/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMjk0MTQ1NjQ=",
  "number": 45971,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Aggregated events can outlive the events they duplicate",
  "updated_at": "2017-06-03T04:42:41Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45971",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/378280?v=4",
    "events_url": "https://api.github.com/users/kensimon/events{/privacy}",
    "followers_url": "https://api.github.com/users/kensimon/followers",
    "following_url": "https://api.github.com/users/kensimon/following{/other_user}",
    "gists_url": "https://api.github.com/users/kensimon/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/kensimon",
    "id": 378280,
    "login": "kensimon",
    "node_id": "MDQ6VXNlcjM3ODI4MA==",
    "organizations_url": "https://api.github.com/users/kensimon/orgs",
    "received_events_url": "https://api.github.com/users/kensimon/received_events",
    "repos_url": "https://api.github.com/users/kensimon/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/kensimon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kensimon/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/kensimon"
  }
}