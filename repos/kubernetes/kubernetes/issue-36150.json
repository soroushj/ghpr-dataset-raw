{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n\r\n**What keywords did you search in Kubernetes issues before filing this one?**\r\ncontroller /etc/ssl/certs\r\nkubeadm /etc/ssl/certs\r\n\r\n---\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?** (choose one): BUG REPORT\r\n\r\n<!--\r\nIf this is a BUG REPORT, please:\r\n  - Fill in as much of the template below as you can.  If you leave out\r\n    information, we can't help you as well.\r\n\r\nIf this is a FEATURE REQUEST, please:\r\n  - Describe *in detail* the feature/behavior/change you'd like to see.\r\n\r\nIn both cases, be ready for followup questions, and please respond in a timely\r\nmanner.  If we can't reproduce a bug or think a feature already exists, we\r\nmight close your issue.  If we're wrong, PLEASE feel free to reopen it and\r\nexplain why.\r\n-->\r\n\r\n**Kubernetes version** (use `kubectl version`):\r\n1.5 custom built master\r\nI also use a custom built hyperkube image instead of the single app images for apiserver, controller, ...\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**: azure\r\n- **OS** (e.g. from /etc/os-release): CentOS 7.2\r\n- **Kernel** (e.g. `uname -a`): Linux ma-kub8ms0 3.10.0-327.36.3.el7.x86_64 #1 SMP Mon Oct 24 16:09:20 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n- **Install tools**: kubeadm\r\n- **Others**: deployed with Azure RM template and ansible\r\n\r\n\r\n**What happened**:\r\ncontroller is not able to do https, including calls to the Azure RM API\r\n\r\n\r\n**What you expected to happen**:\r\nhttps should work as usual\r\n\r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\nUse kubeadm to install kubernetes on CentOS\r\nexec into the controller and try \"curl https://google.com\"\r\n\r\n**Anything else do we need to know**:\r\nIt looks like https://github.com/kubernetes/kubernetes/pull/33681 caused this issue. On CentOS, I see these files on the host OS:\r\n```\r\n[devops@ma-kub8ms0 ~]$ ls -lah /etc/ssl/certs/\r\ntotal 12K\r\ndrwxr-xr-x. 2 root root  112 Oct 26 20:48 .\r\ndrwxr-xr-x. 5 root root   76 Oct 26 20:47 ..\r\nlrwxrwxrwx. 1 root root   49 Oct 26 20:47 ca-bundle.crt -> /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem\r\nlrwxrwxrwx. 1 root root   55 Oct 26 20:47 ca-bundle.trust.crt -> /etc/pki/ca-trust/extracted/openssl/ca-bundle.trust.crt\r\n-rwxr-xr-x. 1 root root  610 Sep 27 13:40 make-dummy-cert\r\n-rw-r--r--. 1 root root 2.4K Sep 27 13:40 Makefile\r\n-rwxr-xr-x. 1 root root  829 Sep 27 13:40 renew-dummy-cert\r\n```\r\nI suspect the symlinks to /etc/pki/... being the problem here, as they are not available inside the hyperkube Debian image. \r\n\r\nI also tried to verify this with gcr.io/google_containers/kube-controller-manager-amd64:v1.4.4. It seems to not be based on Debian and thus gives a different error:\r\n\r\n```\r\n[devops@ma-kub8ms0 ~]$ docker run -ti --rm -v /etc/ssl/certs:/etc/ssl/certs gcr.io/google_containers/kube-controller-manager-amd64:v1.4.4 sh\r\n/ # wget https://google.de\r\nConnecting to google.de (172.217.21.227:443)\r\nwget: can't execute 'ssl_helper': No such file or directory\r\nwget: error getting response: Connection reset by peer\r\n```\r\n\r\nI see 2 possible solutions:\r\n1. Instead of host mounting /etc/ssl/certs into the controller pod, the ca certificates could be installed into the image. This is already done for hyperkube and would work out of the box when the host mount would be omitted.\r\n2. kubeadm could try to figure out if /etc/pki should also be host mounted and add this to the controller manifest if required.\r\n\r\nI'd be happy to provide a fix by myself, I just need to know which solution you would prefer.\r\n",
  "closed_at": "2016-11-22T17:43:56Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1787169?v=4",
    "events_url": "https://api.github.com/users/mikedanese/events{/privacy}",
    "followers_url": "https://api.github.com/users/mikedanese/followers",
    "following_url": "https://api.github.com/users/mikedanese/following{/other_user}",
    "gists_url": "https://api.github.com/users/mikedanese/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mikedanese",
    "id": 1787169,
    "login": "mikedanese",
    "node_id": "MDQ6VXNlcjE3ODcxNjk=",
    "organizations_url": "https://api.github.com/users/mikedanese/orgs",
    "received_events_url": "https://api.github.com/users/mikedanese/received_events",
    "repos_url": "https://api.github.com/users/mikedanese/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mikedanese/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mikedanese/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mikedanese"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36150/comments",
  "created_at": "2016-11-03T10:52:03Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36150/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/36150",
  "id": 187027417,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 451459590,
      "name": "area/kubeadm",
      "node_id": "MDU6TGFiZWw0NTE0NTk1OTA=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/kubeadm"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36150/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxODcwMjc0MTc=",
  "number": 36150,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kubeadm on CentOS mounts incompatible /etc/ssl/certs into controller",
  "updated_at": "2016-11-22T17:43:56Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/36150",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1884269?v=4",
    "events_url": "https://api.github.com/users/codablock/events{/privacy}",
    "followers_url": "https://api.github.com/users/codablock/followers",
    "following_url": "https://api.github.com/users/codablock/following{/other_user}",
    "gists_url": "https://api.github.com/users/codablock/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/codablock",
    "id": 1884269,
    "login": "codablock",
    "node_id": "MDQ6VXNlcjE4ODQyNjk=",
    "organizations_url": "https://api.github.com/users/codablock/orgs",
    "received_events_url": "https://api.github.com/users/codablock/received_events",
    "repos_url": "https://api.github.com/users/codablock/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/codablock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codablock/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/codablock"
  }
}