{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!-->\r\n\r\n\r\n**What happened**:\r\nResync period for HorizontalPodAutoscaler controller is set to 15 seconds in order to update HPAs every 15 seconds. Sometimes updates are skipped and period between two updates is 30 seconds.\r\n\r\n**What you expected to happen**:\r\nHPA should be updated every 15 seconds.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nAdd debugs to HPA controller showing how often HPAs are processed. Create HPA.\r\n**Anything else we need to know?**:\r\nHPA controller uses rate RateLimitingQueue:\r\nhttps://github.com/kubernetes/kubernetes/blob/bb7973a34c209f74af398354fb0247598aa20766/pkg/controller/podautoscaler/horizontal.go#L120\r\nNew requests are always added with 15 seconds delay:\r\nhttps://github.com/kubernetes/kubernetes/blob/bb7973a34c209f74af398354fb0247598aa20766/pkg/controller/podautoscaler/horizontal.go#L183\r\nIf request for  the given HPA is in the queue then newly added request is skipped. Requests are added and removed from the queue at the same moment so there is a race condition. See following scenario:\r\n00:00:00 - Resync adds request to queue to be executed at 00:00:15\r\n00:00:15 - Resync adds next request to queue to be executed at 00:00:30 but it is skipped because previous request is still in the queue\r\n00:00:15 - Request added at 00:00:00 is executed\r\n00:00:30 - Resync adds next request to queue to be executed at 00:00:45\r\n00:00:45 - Request added at 00:00:30 is executed\r\nIn above scenario HPA wasn't updated between 00:00:15 and 00:00:45.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): HEAD\r\n- Cloud provider or hardware configuration: GKE\r\n\r\n<!-- DO NOT EDIT BELOW THIS LINE -->\r\n/kind bug",
  "closed_at": "2019-01-04T19:09:01Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/72372/comments",
  "created_at": "2018-12-27T16:00:35Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/72372/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/72372",
  "id": 394430159,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Autoscaling.",
      "id": 238245616,
      "name": "sig/autoscaling",
      "node_id": "MDU6TGFiZWwyMzgyNDU2MTY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/autoscaling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/72372/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzOTQ0MzAxNTk=",
  "number": 72372,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "HorizontalPodAutoscalers are not processed every ",
  "updated_at": "2019-01-04T19:09:01Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/72372",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/29974120?v=4",
    "events_url": "https://api.github.com/users/krzysztof-jastrzebski/events{/privacy}",
    "followers_url": "https://api.github.com/users/krzysztof-jastrzebski/followers",
    "following_url": "https://api.github.com/users/krzysztof-jastrzebski/following{/other_user}",
    "gists_url": "https://api.github.com/users/krzysztof-jastrzebski/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/krzysztof-jastrzebski",
    "id": 29974120,
    "login": "krzysztof-jastrzebski",
    "node_id": "MDQ6VXNlcjI5OTc0MTIw",
    "organizations_url": "https://api.github.com/users/krzysztof-jastrzebski/orgs",
    "received_events_url": "https://api.github.com/users/krzysztof-jastrzebski/received_events",
    "repos_url": "https://api.github.com/users/krzysztof-jastrzebski/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/krzysztof-jastrzebski/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/krzysztof-jastrzebski/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/krzysztof-jastrzebski"
  }
}