{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4178417?v=4",
    "events_url": "https://api.github.com/users/andyzhangx/events{/privacy}",
    "followers_url": "https://api.github.com/users/andyzhangx/followers",
    "following_url": "https://api.github.com/users/andyzhangx/following{/other_user}",
    "gists_url": "https://api.github.com/users/andyzhangx/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/andyzhangx",
    "id": 4178417,
    "login": "andyzhangx",
    "node_id": "MDQ6VXNlcjQxNzg0MTc=",
    "organizations_url": "https://api.github.com/users/andyzhangx/orgs",
    "received_events_url": "https://api.github.com/users/andyzhangx/received_events",
    "repos_url": "https://api.github.com/users/andyzhangx/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/andyzhangx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/andyzhangx/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/andyzhangx"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/4178417?v=4",
      "events_url": "https://api.github.com/users/andyzhangx/events{/privacy}",
      "followers_url": "https://api.github.com/users/andyzhangx/followers",
      "following_url": "https://api.github.com/users/andyzhangx/following{/other_user}",
      "gists_url": "https://api.github.com/users/andyzhangx/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/andyzhangx",
      "id": 4178417,
      "login": "andyzhangx",
      "node_id": "MDQ6VXNlcjQxNzg0MTc=",
      "organizations_url": "https://api.github.com/users/andyzhangx/orgs",
      "received_events_url": "https://api.github.com/users/andyzhangx/received_events",
      "repos_url": "https://api.github.com/users/andyzhangx/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/andyzhangx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andyzhangx/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/andyzhangx"
    }
  ],
  "author_association": "NONE",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n> Uncomment only one, leave it on its own line: \r\n>\r\n/kind bug\r\n> /kind feature\r\n\r\n\r\n**What happened**:\r\n\r\nI'm running a Redis pod with a PV provisioned as an Azure Managed Disk. It's got an exec readiness probe that calls `redis-cli ping` in the container. \r\n\r\nAt some point it receives a SIGTERM.\r\n\r\nThe kubelet then tries to sync the pod and restart the container, but it panics in [azure_dd/azure_mounter.go](https://github.com/kubernetes/kubernetes/blob/v1.7.4/pkg/volume/azure_dd/azure_mounter.go#L47) (looking over the `azure_dd` code, that's the only place where the error from `getVolumeSource()` is ignored)\r\n\r\nAs a result, the pod hangs in a `Ready: False` state, since the readiness probe cannot be ran in a non existing container. \r\n\r\n```\r\nNAME                         READY     STATUS    RESTARTS   AGE\r\nredis-redis-31901399-7300v   0/1       Running   0          5d\r\n```\r\n\r\n```\r\nOct 17 13:06:21 k8s-agent-29113125-1 docker[1607]: E1017 13:06:21.364939    1819 remote_runtime.go:309] ExecSync 5c6a156a5061204acd204666ec32dc2542764b7d6ee91756d5b8b9cbc46a3f04 'redis-cli ping' from runtime service failed: rpc error: code = 2 desc = container not running (5c6a156a5061204acd204666ec32dc2542764b7d6ee91756d5b8b9cbc46a3f04)\r\nOct 17 13:06:21 k8s-agent-29113125-1 docker[1607]: E1017 13:06:21.366852    1819 remote_runtime.go:309] ExecSync 5c6a156a5061204acd204666ec32dc2542764b7d6ee91756d5b8b9cbc46a3f04 'redis-cli ping' from runtime service failed: rpc error: code = 2 desc = container not running (5c6a156a5061204acd204666ec32dc2542764b7d6ee91756d5b8b9cbc46a3f04)\r\nOct 17 13:06:21 k8s-agent-29113125-1 docker[1607]: E1017 13:06:21.368843    1819 remote_runtime.go:309] ExecSync 5c6a156a5061204acd204666ec32dc2542764b7d6ee91756d5b8b9cbc46a3f04 'redis-cli ping' from runtime service failed: rpc error: code = 2 desc = container not running (5c6a156a5061204acd204666ec32dc2542764b7d6ee91756d5b8b9cbc46a3f04)\r\nOct 17 13:06:21 k8s-agent-29113125-1 docker[1607]: W1017 13:06:21.368893    1819 prober.go:98] No ref for container \"docker://5c6a156a5061204acd204666ec32dc2542764b7d6ee91756d5b8b9cbc46a3f04\" (redis-redis-31901399-7300v_default(72313440-b018-11e7-a0b8-000d3a2bd19b):redis-redis)\r\nOct 17 13:06:21 k8s-agent-29113125-1 docker[1607]: I1017 13:06:21.368906    1819 prober.go:101] Readiness probe for \"redis-redis-31901399-7300v_default(72313440-b018-11e7-a0b8-000d3a2bd19b):redis-redis\" errored: rpc error: code = 2 desc = container not running (5c6a156a5061204acd204666ec32dc2542764b7d6ee91756d5b8b9cbc46a3f04)\r\n\r\n```\r\n\r\n```\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: E1017 13:01:40.059686    1819 runtime.go:66] Observed a panic: \"invalid memory address or nil pointer dereference\" (runtime error: invalid memory address or nil pointer dereference)\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:72\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:65\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:51\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /usr/local/go/src/runtime/asm_amd64.s:514\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /usr/local/go/src/runtime/panic.go:489\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /usr/local/go/src/runtime/panic.go:63\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /usr/local/go/src/runtime/signal_unix.go:290\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/volume/azure_dd/azure_mounter.go:47\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/kubelet_pods.go:133\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/kubelet_pods.go:333\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/kuberuntime/kuberuntime_container.go:161\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/kuberuntime/kuberuntime_container.go:102\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/kuberuntime/kuberuntime_manager.go:716\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/kubelet.go:1629\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/kubelet.go:767\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/pod_workers.go:173\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/pod_workers.go:176\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /go/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/pod_workers.go:220\r\nOct 17 13:01:40 k8s-agent-29113125-1 docker[1607]: /usr/local/go/src/runtime/asm_amd64.s:2197\r\n```\r\n\r\n\r\n```\r\nName:           redis-redis-31901399-7300v\r\n...\r\nStatus:         Running\r\n...\r\nContainers:\r\n  redis-redis:\r\n    Container ID:       docker://5c6a156a5061204acd204666ec32dc2542764b7d6ee91756d5b8b9cbc46a3f04\r\n    Image:              bitnami/redis:3.2.9-r2\r\n    Image ID:           docker-pullable://bitnami/redis@sha256:9ecc1c48d6c74a1a8ec9798dd28e5a1ad91d1defa4048039235a8b2be40cda62\r\n    Port:               6379/TCP\r\n    State:              Running\r\n      Started:          Fri, 13 Oct 2017 16:14:36 +0300\r\n    Ready:              False\r\n    Restart Count:      0\r\n    Requests:\r\n      cpu:      100m\r\n      memory:   256Mi\r\n    Liveness:   exec [redis-cli ping] delay=30s timeout=5s period=10s #success=1 #failure=3\r\n    Readiness:  exec [redis-cli ping] delay=5s timeout=1s period=10s #success=1 #failure=3\r\nConditions:\r\n  Type          Status\r\n  Initialized   True \r\n  Ready         False \r\n  PodScheduled  True \r\nVolumes:\r\n  redis-data:\r\n    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)\r\n    ClaimName:  redis-data\r\n    ReadOnly:   false\r\n```\r\n\r\n\r\n**What you expected to happen**:\r\n\r\nThe container would successfully restart.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nIt's the 2nd time it happens but I haven't yet figured out the conditions to reproduce.\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"6\", GitVersion:\"v1.6.2\", GitCommit:\"477efc3cbe6a7effca06bd1452fa356e2201e1ee\", GitTreeState:\"clean\", BuildDate:\"2017-04-19T20:33:11Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.4\", GitCommit:\"793658f2d7ca7f064d2bdf606519f9fe1229c381\", GitTreeState:\"clean\", BuildDate:\"2017-08-17T08:30:51Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\n- Cloud provider or hardware configuration**:\r\nAzure w/ Managed Disks\r\n\r\n- OS (e.g. from /etc/os-release):\r\n```\r\nNAME=\"Ubuntu\"\r\nVERSION=\"16.04.2 LTS (Xenial Xerus)\"\r\nID=ubuntu\r\nID_LIKE=debian\r\nPRETTY_NAME=\"Ubuntu 16.04.2 LTS\"\r\nVERSION_ID=\"16.04\"\r\nHOME_URL=\"http://www.ubuntu.com/\"\r\nSUPPORT_URL=\"http://help.ubuntu.com/\"\r\nBUG_REPORT_URL=\"http://bugs.launchpad.net/ubuntu/\"\r\nVERSION_CODENAME=xenial\r\nUBUNTU_CODENAME=xenial\r\n```\r\n- Kernel (e.g. `uname -a`):\r\n`Linux k8s-agent-29113125-0 4.4.0-93-generic #116-Ubuntu SMP Fri Aug 11 21:17:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux`\r\n- Install tools:\r\n`acs-engine`\r\n- Others:\r\n",
  "closed_at": "2017-10-26T18:13:36Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 9,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/54149/comments",
  "created_at": "2017-10-18T15:42:13Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/54149/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/54149",
  "id": 266542074,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/54149/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNjY1NDIwNzQ=",
  "number": 54149,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Panic in azure_dd/azure_mounter.go when syncing pod",
  "updated_at": "2017-10-26T18:36:33Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/54149",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/2016345?v=4",
    "events_url": "https://api.github.com/users/valer-cara/events{/privacy}",
    "followers_url": "https://api.github.com/users/valer-cara/followers",
    "following_url": "https://api.github.com/users/valer-cara/following{/other_user}",
    "gists_url": "https://api.github.com/users/valer-cara/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/valer-cara",
    "id": 2016345,
    "login": "valer-cara",
    "node_id": "MDQ6VXNlcjIwMTYzNDU=",
    "organizations_url": "https://api.github.com/users/valer-cara/orgs",
    "received_events_url": "https://api.github.com/users/valer-cara/received_events",
    "repos_url": "https://api.github.com/users/valer-cara/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/valer-cara/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/valer-cara/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/valer-cara"
  }
}