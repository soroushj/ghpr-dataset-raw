{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1286651?v=4",
    "events_url": "https://api.github.com/users/bertinatto/events{/privacy}",
    "followers_url": "https://api.github.com/users/bertinatto/followers",
    "following_url": "https://api.github.com/users/bertinatto/following{/other_user}",
    "gists_url": "https://api.github.com/users/bertinatto/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bertinatto",
    "id": 1286651,
    "login": "bertinatto",
    "node_id": "MDQ6VXNlcjEyODY2NTE=",
    "organizations_url": "https://api.github.com/users/bertinatto/orgs",
    "received_events_url": "https://api.github.com/users/bertinatto/received_events",
    "repos_url": "https://api.github.com/users/bertinatto/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bertinatto/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bertinatto/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bertinatto"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/1286651?v=4",
      "events_url": "https://api.github.com/users/bertinatto/events{/privacy}",
      "followers_url": "https://api.github.com/users/bertinatto/followers",
      "following_url": "https://api.github.com/users/bertinatto/following{/other_user}",
      "gists_url": "https://api.github.com/users/bertinatto/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/bertinatto",
      "id": 1286651,
      "login": "bertinatto",
      "node_id": "MDQ6VXNlcjEyODY2NTE=",
      "organizations_url": "https://api.github.com/users/bertinatto/orgs",
      "received_events_url": "https://api.github.com/users/bertinatto/received_events",
      "repos_url": "https://api.github.com/users/bertinatto/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/bertinatto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bertinatto/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/bertinatto"
    }
  ],
  "author_association": "MEMBER",
  "body": "**What happened**:\r\n\r\n1. Started a single-node Kubernetes cluster with the `CSINodeInfo` feature gate disabled (default)\r\n2. Tried to create a pod that uses a claim that uses a storage class with `volumeBindingMode: WaitForFirstConsumer`\r\n3. Got this message (`kubectl describe pod/mypod`):\r\n\r\n```\r\n  Warning  FailedScheduling    25s   default-scheduler        pod has unbound immediate PersistentVolumeClaims\r\n  Normal   Scheduled           21s   default-scheduler        Successfully assigned default/app to ip-172-18-15-56.ec2.internal\r\n  Warning  FailedAttachVolume  20s   attachdetach-controller  AttachVolume.Attach failed for volume \"pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\" : rpc error: code = Internal desc = Could not attach volume \"vol-0feca9e2e21660115\" to node \"i-0a647985e4981fee6\": could not attach volume \"vol-0feca9e2e21660115\" to node \"i-0a647985e4981fee6\": IncorrectState: vol-0feca9e2e21660115 is not 'available'.\r\n\t\t   status code: 400, request id: 96e5c6cf-79dd-4273-889f-1bc526f5f280\r\n  Warning  FailedAttachVolume  20s  attachdetach-controller  AttachVolume.Attach failed for volume \"pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\" : rpc error: code = Internal desc = Could not attach volume \"vol-0feca9e2e21660115\" to node \"i-0a647985e4981fee6\": could not attach volume \"vol-0feca9e2e21660115\" to node \"i-0a647985e4981fee6\": IncorrectState: vol-0feca9e2e21660115 is not 'available'.\r\n\t\t   status code: 400, request id: 5a8a4553-5c0c-446e-8e51-04dee0c1d807\r\n  Warning  FailedAttachVolume  19s  attachdetach-controller  AttachVolume.Attach failed for volume \"pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\" : rpc error: code = Internal desc = Could not attach volume \"vol-0feca9e2e21660115\" to node \"i-0a647985e4981fee6\": could not attach volume \"vol-0feca9e2e21660115\" to node \"i-0a647985e4981fee6\": IncorrectState: vol-0feca9e2e21660115 is not 'available'.\r\n\t\t   status code: 400, request id: d2a05dbe-6673-456c-95ad-fd8582e923cb\r\n  Warning  FailedAttachVolume  17s  attachdetach-controller  AttachVolume.Attach failed for volume \"pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\" : rpc error: code = Internal desc = Could not attach volume \"vol-0feca9e2e21660115\" to node \"i-0a647985e4981fee6\": could not attach volume \"vol-0feca9e2e21660115\" to node \"i-0a647985e4981fee6\": IncorrectState: vol-0feca9e2e21660115 is not 'available'.\r\n\t\t   status code: 400, request id: 28a9ca4e-6305-471f-b744-36535bd2cada\r\n  Normal   SuccessfulAttachVolume  13s               attachdetach-controller                AttachVolume.Attach succeeded for volume \"pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\"\r\n  Warning  FailedMount             3s (x25 over 5s)  kubelet, ip-172-18-15-56.ec2.internal  MountVolume.NodeAffinity check failed for volume \"pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\" : No matching NodeSelectorTerms\r\n```\r\n\r\nThe `MountVolume.NodeAffinity` check failed because of a missing label in the node (i.e., `com.amazon.aws.csi.ebs/zone=us-east-1d`). This happened because of #69869.\r\n\r\nHowever, the scheduler shouldn't have scheduled the pod because any node matched the PV requirements.\r\n\r\n**What you expected to happen**:\r\n\r\nThe scheduler shouldn't schedule the pod and a proper message is emitted.\r\n\r\n**Anything else we need to know?**:\r\n\r\nPV:\r\n\r\n```\r\n# Please edit the object below. Lines beginning with a '#' will be ignored,\r\n# and an empty file will abort the edit. If an error occurs while saving this file will be\r\n# reopened with the relevant failures.\r\n#\r\napiVersion: v1\r\nkind: PersistentVolume\r\nmetadata:\r\n  annotations:\r\n    pv.kubernetes.io/provisioned-by: com.amazon.aws.csi.ebs\r\n  creationTimestamp: \"2018-10-17T07:52:30Z\"\r\n  finalizers:\r\n  - kubernetes.io/pv-protection\r\n  - external-attacher/com-amazon-aws-csi-ebs\r\n  name: pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\r\n  resourceVersion: \"639\"\r\n  selfLink: /api/v1/persistentvolumes/pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\r\n  uid: 995153d2-d1e1-11e8-a49a-0ecfa83a9ab2\r\nspec:\r\n  accessModes:\r\n  - ReadWriteOnce\r\n  capacity:\r\n    storage: 4Gi\r\n  claimRef:\r\n    apiVersion: v1\r\n    kind: PersistentVolumeClaim\r\n    name: claim1\r\n    namespace: default\r\n    resourceVersion: \"625\"\r\n    uid: 970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\r\n  csi:\r\n    driver: com.amazon.aws.csi.ebs\r\n    fsType: ext4\r\n    volumeAttributes:\r\n      storage.kubernetes.io/csiProvisionerIdentity: 1539762711928-8081-com.amazon.aws.csi.ebs\r\n    volumeHandle: vol-0feca9e2e21660115\r\n  nodeAffinity:\r\n    required:\r\n      nodeSelectorTerms:\r\n      - matchExpressions:\r\n        - key: com.amazon.aws.csi.ebs/zone\r\n          operator: In\r\n          values:\r\n          - us-east-1d\r\n  persistentVolumeReclaimPolicy: Delete\r\n  storageClassName: slow\r\nstatus:\r\n  phase: Bound\r\n```\r\n\r\nStorage class:\r\n\r\n```\r\n# Please edit the object below. Lines beginning with a '#' will be ignored,\r\n# and an empty file will abort the edit. If an error occurs while saving this file will be\r\n# reopened with the relevant failures.\r\n#\r\napiVersion: v1\r\nkind: PersistentVolume\r\nmetadata:\r\n  annotations:\r\n    pv.kubernetes.io/provisioned-by: com.amazon.aws.csi.ebs\r\n  creationTimestamp: \"2018-10-17T07:52:30Z\"\r\n  finalizers:\r\n  - kubernetes.io/pv-protection\r\n  - external-attacher/com-amazon-aws-csi-ebs\r\n  name: pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\r\n  resourceVersion: \"639\"\r\n  selfLink: /api/v1/persistentvolumes/pvc-970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\r\n  uid: 995153d2-d1e1-11e8-a49a-0ecfa83a9ab2\r\nspec:\r\n  accessModes:\r\n  - ReadWriteOnce\r\n  capacity:\r\n    storage: 4Gi\r\n  claimRef:\r\n    apiVersion: v1\r\n    kind: PersistentVolumeClaim\r\n    name: claim1\r\n    namespace: default\r\n    resourceVersion: \"625\"\r\n    uid: 970102a5-d1e1-11e8-a49a-0ecfa83a9ab2\r\n  csi:\r\n    driver: com.amazon.aws.csi.ebs\r\n    fsType: ext4\r\n    volumeAttributes:\r\n      storage.kubernetes.io/csiProvisionerIdentity: 1539762711928-8081-com.amazon.aws.csi.ebs\r\n    volumeHandle: vol-0feca9e2e21660115\r\n  nodeAffinity:\r\n    required:\r\n      nodeSelectorTerms:\r\n      - matchExpressions:\r\n        - key: com.amazon.aws.csi.ebs/zone\r\n          operator: In\r\n          values:\r\n          - us-east-1d\r\n  persistentVolumeReclaimPolicy: Delete\r\n  storageClassName: slow\r\nstatus:\r\n  phase: Bound\r\n\r\n```\r\n\r\n/kind bug\r\n/sig storage\r\n/sig scheduling\r\nCC @msau42 ",
  "closed_at": "2019-01-07T11:46:22Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 5,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69928/comments",
  "created_at": "2018-10-17T12:23:27Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69928/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/69928",
  "id": 371045752,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Storage.",
      "id": 169428334,
      "name": "sig/storage",
      "node_id": "MDU6TGFiZWwxNjk0MjgzMzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/storage"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69928/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNzEwNDU3NTI=",
  "number": 69928,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Pod scheduled in node without considering PV requirements",
  "updated_at": "2019-01-07T11:46:22Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69928",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1286651?v=4",
    "events_url": "https://api.github.com/users/bertinatto/events{/privacy}",
    "followers_url": "https://api.github.com/users/bertinatto/followers",
    "following_url": "https://api.github.com/users/bertinatto/following{/other_user}",
    "gists_url": "https://api.github.com/users/bertinatto/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bertinatto",
    "id": 1286651,
    "login": "bertinatto",
    "node_id": "MDQ6VXNlcjEyODY2NTE=",
    "organizations_url": "https://api.github.com/users/bertinatto/orgs",
    "received_events_url": "https://api.github.com/users/bertinatto/received_events",
    "repos_url": "https://api.github.com/users/bertinatto/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bertinatto/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bertinatto/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bertinatto"
  }
}