{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1787169?v=4",
    "events_url": "https://api.github.com/users/mikedanese/events{/privacy}",
    "followers_url": "https://api.github.com/users/mikedanese/followers",
    "following_url": "https://api.github.com/users/mikedanese/following{/other_user}",
    "gists_url": "https://api.github.com/users/mikedanese/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mikedanese",
    "id": 1787169,
    "login": "mikedanese",
    "node_id": "MDQ6VXNlcjE3ODcxNjk=",
    "organizations_url": "https://api.github.com/users/mikedanese/orgs",
    "received_events_url": "https://api.github.com/users/mikedanese/received_events",
    "repos_url": "https://api.github.com/users/mikedanese/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mikedanese/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mikedanese/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mikedanese"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/1787169?v=4",
      "events_url": "https://api.github.com/users/mikedanese/events{/privacy}",
      "followers_url": "https://api.github.com/users/mikedanese/followers",
      "following_url": "https://api.github.com/users/mikedanese/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikedanese/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mikedanese",
      "id": 1787169,
      "login": "mikedanese",
      "node_id": "MDQ6VXNlcjE3ODcxNjk=",
      "organizations_url": "https://api.github.com/users/mikedanese/orgs",
      "received_events_url": "https://api.github.com/users/mikedanese/received_events",
      "repos_url": "https://api.github.com/users/mikedanese/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mikedanese/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikedanese/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mikedanese"
    }
  ],
  "author_association": "NONE",
  "body": "We've got our master pods in a state where they appear to be functional, however they are all stuck in \"Terminating\" state, and appear to be not receiving DELETE calls anymore when the master node is deleted.\n\nThis is how they've been for about 19 hours now:\n\n```\n$ kubectl --server=... get pods\nNAME                                     READY     STATUS        RESTARTS   AGE\nkube-apiserver-sea5m1kmaster1            1/1       Terminating   1          18h\nkube-apiserver-sea5m1kmaster2            1/1       Terminating   1          18h\nkube-controller-manager-sea5m1kmaster1   1/1       Terminating   2          6d\nkube-podmaster-sea5m1kmaster1            2/2       Terminating   0          18h\nkube-podmaster-sea5m1kmaster2            2/2       Terminating   0          18h\nkube-scheduler-sea5m1kmaster1            1/1       Terminating   2          6d\n```\n\nMining the logs, I see that it started during a stress test I ran, where I performed our restart scenario 10 times in a row, while debugging a different issue. Here's our restart scenario:\n\n```\nkubectl --server=https://10.1.4.41:6443 --kubeconfig=... delete node sea5m1kmaster1\nnode \"sea5m1kmaster1\" deleted\n\nkubectl --server=https://10.1.4.41:6443 --kubeconfig=... delete node sea5m1kmaster2\nnode \"sea5m1kmaster2\" deleted\n\n# generate fresh yamls for apiserver / podmaster / scheduler / controller manager\n# restart hyperkube\n\nkubectl --server=https://10.1.4.41:6443 --kubeconfig=... patch node sea5m1kmaster1 -p {\\\"spec\\\":{\\\"unschedulable\\\":true}}\n\"sea5m1kmaster1\" patched\n\nkubectl --server=https://10.1.4.41:6443 --kubeconfig=... patch node sea5m1kmaster2 -p {\\\"spec\\\":{\\\"unschedulable\\\":true}}\n\"sea5m1kmaster2\" patched\n```\n\nFor the first 5 restarts, I see that every time we delete the master nodes, the master pods are deleted as well:\n\n```\nI0225 04:44:55.836146 DELETE /api/v1/nodes/sea5m1kmaster2 -> 200\nI0225 04:44:56.412127 DELETE /api/v1/nodes/sea5m1kmaster1 -> 200\nI0225 04:44:56.501860 DELETE /api/v1/namespaces/default/pods/kube-apiserver-sea5m1kmaster2 -> 200\nI0225 04:44:56.550051 DELETE /api/v1/namespaces/default/pods/kube-podmaster-sea5m1kmaster2 -> 200\nI0225 04:44:56.593235 DELETE /api/v1/namespaces/default/pods/kube-apiserver-sea5m1kmaster2 -> 200\nI0225 04:44:56.624981 DELETE /api/v1/namespaces/default/pods/kube-apiserver-sea5m1kmaster2 -> 404\nI0225 04:44:56.680119 DELETE /api/v1/namespaces/default/pods/kube-podmaster-sea5m1kmaster2 -> 200\nI0225 04:44:56.708637 DELETE /api/v1/namespaces/default/pods/kube-apiserver-sea5m1kmaster2 -> 404\nI0225 04:44:56.711982 DELETE /api/v1/namespaces/default/pods/kube-podmaster-sea5m1kmaster2 -> 404\nI0225 04:45:03.939329 DELETE /api/v1/namespaces/default/pods/kube-apiserver-sea5m1kmaster1 -> 200\nI0225 04:45:04.372131 DELETE /api/v1/namespaces/default/pods/kube-podmaster-sea5m1kmaster1 -> 200\n```\n\nHowever, on the 6th restart, we only see this:\n\n```\nI0225 04:45:17.914927 DELETE /api/v1/nodes/sea5m1kmaster2 -> 200\nI0225 04:45:18.213183 DELETE /api/v1/nodes/sea5m1kmaster1 -> 200\nI0225 04:45:23.709177 DELETE /api/v1/namespaces/default/pods/kube-apiserver-sea5m1kmaster2 -> 200\nI0225 04:45:24.766486 DELETE /api/v1/namespaces/default/pods/kube-podmaster-sea5m1kmaster2 -> 200\n```\n\n...and on every subsequent restart now, all we see is this:\n\n```\nI0225 04:45:35.430470 DELETE /api/v1/nodes/sea5m1kmaster2 -> 200\nI0225 04:45:36.834926 DELETE /api/v1/nodes/sea5m1kmaster1 -> 200\n```\n\nAre there any additional steps we should take upon restart / upgrade in order to ensure clean behavior?\n\n**Version Info:**\n\n```\n$ kubectl --server=https://10.1.4.41:6443 --... version\nClient Version: version.Info{Major:\"1\", Minor:\"1\", GitVersion:\"v1.1.3\", GitCommit:\"6a81b50c7e97bbe0ade075de55ab4fa34f049dc2\", GitTreeState:\"clean\"}\nServer Version: version.Info{Major:\"1\", Minor:\"1\", GitVersion:\"v1.1.3\", GitCommit:\"6a81b50c7e97bbe0ade075de55ab4fa34f049dc2\", GitTreeState:\"clean\"}\n```\n",
  "closed_at": "2016-03-03T22:44:52Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1787169?v=4",
    "events_url": "https://api.github.com/users/mikedanese/events{/privacy}",
    "followers_url": "https://api.github.com/users/mikedanese/followers",
    "following_url": "https://api.github.com/users/mikedanese/following{/other_user}",
    "gists_url": "https://api.github.com/users/mikedanese/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mikedanese",
    "id": 1787169,
    "login": "mikedanese",
    "node_id": "MDQ6VXNlcjE3ODcxNjk=",
    "organizations_url": "https://api.github.com/users/mikedanese/orgs",
    "received_events_url": "https://api.github.com/users/mikedanese/received_events",
    "repos_url": "https://api.github.com/users/mikedanese/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mikedanese/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mikedanese/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mikedanese"
  },
  "comments": 10,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/22025/comments",
  "created_at": "2016-02-25T23:26:46Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/22025/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/22025",
  "id": 136544882,
  "labels": [
    {
      "color": "eb6420",
      "default": false,
      "description": "Must be staffed and worked on either currently, or very soon, ideally in time for the next release.",
      "id": 114528223,
      "name": "priority/important-soon",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyMjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/important-soon"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/22025/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxMzY1NDQ4ODI=",
  "number": 22025,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Master pods in a permanent \"Terminating\" status after restarting multiple times in a row",
  "updated_at": "2016-03-03T22:44:52Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/22025",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1418951?v=4",
    "events_url": "https://api.github.com/users/DreadPirateShawn/events{/privacy}",
    "followers_url": "https://api.github.com/users/DreadPirateShawn/followers",
    "following_url": "https://api.github.com/users/DreadPirateShawn/following{/other_user}",
    "gists_url": "https://api.github.com/users/DreadPirateShawn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/DreadPirateShawn",
    "id": 1418951,
    "login": "DreadPirateShawn",
    "node_id": "MDQ6VXNlcjE0MTg5NTE=",
    "organizations_url": "https://api.github.com/users/DreadPirateShawn/orgs",
    "received_events_url": "https://api.github.com/users/DreadPirateShawn/received_events",
    "repos_url": "https://api.github.com/users/DreadPirateShawn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/DreadPirateShawn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DreadPirateShawn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/DreadPirateShawn"
  }
}