{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/917931?v=4",
    "events_url": "https://api.github.com/users/BenTheElder/events{/privacy}",
    "followers_url": "https://api.github.com/users/BenTheElder/followers",
    "following_url": "https://api.github.com/users/BenTheElder/following{/other_user}",
    "gists_url": "https://api.github.com/users/BenTheElder/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/BenTheElder",
    "id": 917931,
    "login": "BenTheElder",
    "node_id": "MDQ6VXNlcjkxNzkzMQ==",
    "organizations_url": "https://api.github.com/users/BenTheElder/orgs",
    "received_events_url": "https://api.github.com/users/BenTheElder/received_events",
    "repos_url": "https://api.github.com/users/BenTheElder/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/BenTheElder/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/BenTheElder/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/BenTheElder"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/917931?v=4",
      "events_url": "https://api.github.com/users/BenTheElder/events{/privacy}",
      "followers_url": "https://api.github.com/users/BenTheElder/followers",
      "following_url": "https://api.github.com/users/BenTheElder/following{/other_user}",
      "gists_url": "https://api.github.com/users/BenTheElder/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BenTheElder",
      "id": 917931,
      "login": "BenTheElder",
      "node_id": "MDQ6VXNlcjkxNzkzMQ==",
      "organizations_url": "https://api.github.com/users/BenTheElder/orgs",
      "received_events_url": "https://api.github.com/users/BenTheElder/received_events",
      "repos_url": "https://api.github.com/users/BenTheElder/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BenTheElder/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BenTheElder/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BenTheElder"
    },
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/940341?v=4",
      "events_url": "https://api.github.com/users/fejta/events{/privacy}",
      "followers_url": "https://api.github.com/users/fejta/followers",
      "following_url": "https://api.github.com/users/fejta/following{/other_user}",
      "gists_url": "https://api.github.com/users/fejta/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/fejta",
      "id": 940341,
      "login": "fejta",
      "node_id": "MDQ6VXNlcjk0MDM0MQ==",
      "organizations_url": "https://api.github.com/users/fejta/orgs",
      "received_events_url": "https://api.github.com/users/fejta/received_events",
      "repos_url": "https://api.github.com/users/fejta/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/fejta/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fejta/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/fejta"
    }
  ],
  "author_association": "MEMBER",
  "body": "**What this PR does / why we need it**: my initial intent was to simply update to rules_go 0.12.1 and gazelle 0.12.0.\r\n\r\nA few internal changes / deprecations meant that I finally needed to clean up some technical debt. This also fixes #64122.\r\nI've attempted to keep the steps as separate commits to make it easier to review:\r\n\r\n1. Disable gazelle proto rule generation; legacy proto rules are deprecated, and we don't (currently) build protos at build time anyway, instead generating them with `hack/update-generated-protobuf.sh` and then checking them in. We can revisit this in the future if we'd like.\r\n2. Remove the legacy `go_default_library_protos` filegroups using [buildozer](https://github.com/bazelbuild/buildtools/tree/master/buildozer). We don't use these, anyway.\r\n3. Update the rules_go bazel workspace dependency to 0.12.1.\r\n4. Vendor gazelle 0.12.0 and update BUILD files with `hack/update-bazel.sh`. This causes a lot of diffs, because `select()`s are no longer used in `srcs` attributes, external tests are folded into non-external tests, and vendored targets get an `importmap` attribute.\r\n5. Set `gazelle:prefix` on `staging/src/BUILD` to make gazelle treat these correctly(ish). This allows us to remove the sed rewrite hack in `hack/update-bazel.sh`.\r\n6. Explicitly set `# gazelle:importmap_prefix k8s.io/kubernetes/vendor` on `vendor/`, so that all vendored dependencies get the right importmap. gazelle 0.12.0 uses the bazel workspace name + `vendor/` as a prefix, which doesn't work with native go. Newer gazelle will use the go prefix (https://github.com/bazelbuild/bazel-gazelle/pull/207), but it's not released yet. Setting this correctly now also fixes later `BUILD` churn.\r\n7. Re-run `hack/update-bazel.sh`. This causes a bunch of diffs, since anything under `staging/src` now uses the `staging/src/` path instead of `vendor/`. (Both would work for bazel, but gazelle uses the former, since `vendor/` uses symlinks.) Also `importmap`s under `vendor/` are fixed.\r\n8. Reformat a few files (using [buildifier](https://github.com/bazelbuild/buildtools/tree/master/buildifier)) to make later diffs easier to read.\r\n9. Rework the `go_genrule` rules to use the new `go_genrule` from https://github.com/kubernetes/repo-infra/pull/72, which is more bazely, since it uses the rules_go `go_path` rule instead of lots of shell.\r\n10. Remove the deprecated `go_prefix` rule from the root BUILD.bazel file.\r\n11. Set `# gazelle:importmap_prefix k8s.io/kubernetes/vendor` on `staging/src` as well, which ensures that these repos are treated as vendored dependencies. (It's basically the bazel-y way of doing the `vendor/k8s.io` symlinks.)\r\n12. Run `hack/update-bazel.sh` one last time to fix all of the `importmap`s under `staging/src`.\r\n\r\nNote re: point 6 above - we're pretty much ignoring the `vendor/k8s.io` symlinks entirely now under bazel. Using the `gazelle:prefix` directive ensures these get mapped into the right go importpath, and the `go_path` rule installs these correctly now too.\r\n\r\n**Special notes for your reviewer**: this should not be submitted before https://github.com/kubernetes/repo-infra/pull/72, obviously.\r\n\r\n**Release note**:\r\n<!--  Write your release note:\r\n1. Enter your extended release note in the below block. If the PR requires additional action from users switching to the new release, include the string \"action required\".\r\n2. If no release note is required, just write \"NONE\".\r\n-->\r\n```release-note\r\nNONE\r\n```\r\n\r\n/assign @BenTheElder @fejta @thockin \r\ncc @cblecker @jayconrod",
  "closed_at": "2018-06-23T02:03:13Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 20,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/64122/comments",
  "created_at": "2018-05-21T22:16:06Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/64122/events",
  "html_url": "https://github.com/kubernetes/kubernetes/pull/64122",
  "id": 325077271,
  "labels": [
    {
      "color": "0ffa16",
      "default": false,
      "description": "Indicates a PR has been approved by an approver from all required OWNERS files.",
      "id": 414883982,
      "name": "approved",
      "node_id": "MDU6TGFiZWw0MTQ4ODM5ODI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/approved"
    },
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 451459590,
      "name": "area/kubeadm",
      "node_id": "MDU6TGFiZWw0NTE0NTk1OTA=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/kubeadm"
    },
    {
      "color": "bfe5bf",
      "default": false,
      "description": "Indicates the PR's author has signed the CNCF CLA.",
      "id": 477397086,
      "name": "cncf-cla: yes",
      "node_id": "MDU6TGFiZWw0NzczOTcwODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/cncf-cla:%20yes"
    },
    {
      "color": "15dd18",
      "default": false,
      "description": "Indicates that a PR is ready to be merged.",
      "id": 148225179,
      "name": "lgtm",
      "node_id": "MDU6TGFiZWwxNDgyMjUxNzk=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/lgtm"
    },
    {
      "color": "c2e0c6",
      "default": false,
      "description": "Denotes a PR that doesn't merit a release note.",
      "id": 349530249,
      "name": "release-note-none",
      "node_id": "MDU6TGFiZWwzNDk1MzAyNDk=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/release-note-none"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Cluster Lifecycle.",
      "id": 173494222,
      "name": "sig/cluster-lifecycle",
      "node_id": "MDU6TGFiZWwxNzM0OTQyMjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cluster-lifecycle"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    },
    {
      "color": "eebb00",
      "default": false,
      "description": "Denotes a PR that changes 30-99 lines, ignoring generated files.",
      "id": 253450934,
      "name": "size/M",
      "node_id": "MDU6TGFiZWwyNTM0NTA5MzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/size/M"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/64122/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTg5NTAyMTEz",
  "number": 64122,
  "performed_via_github_app": null,
  "pull_request": {
    "diff_url": "https://github.com/kubernetes/kubernetes/pull/64122.diff",
    "html_url": "https://github.com/kubernetes/kubernetes/pull/64122",
    "patch_url": "https://github.com/kubernetes/kubernetes/pull/64122.patch",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/pulls/64122"
  },
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Update to rules_go 0.12.1 and gazelle 0.12.0 and perform related cleanups",
  "updated_at": "2018-06-23T02:03:13Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/64122",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/8061296?v=4",
    "events_url": "https://api.github.com/users/ixdy/events{/privacy}",
    "followers_url": "https://api.github.com/users/ixdy/followers",
    "following_url": "https://api.github.com/users/ixdy/following{/other_user}",
    "gists_url": "https://api.github.com/users/ixdy/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ixdy",
    "id": 8061296,
    "login": "ixdy",
    "node_id": "MDQ6VXNlcjgwNjEyOTY=",
    "organizations_url": "https://api.github.com/users/ixdy/orgs",
    "received_events_url": "https://api.github.com/users/ixdy/received_events",
    "repos_url": "https://api.github.com/users/ixdy/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ixdy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ixdy/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ixdy"
  }
}