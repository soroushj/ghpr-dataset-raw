{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/6450081?v=4",
    "events_url": "https://api.github.com/users/aojea/events{/privacy}",
    "followers_url": "https://api.github.com/users/aojea/followers",
    "following_url": "https://api.github.com/users/aojea/following{/other_user}",
    "gists_url": "https://api.github.com/users/aojea/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/aojea",
    "id": 6450081,
    "login": "aojea",
    "node_id": "MDQ6VXNlcjY0NTAwODE=",
    "organizations_url": "https://api.github.com/users/aojea/orgs",
    "received_events_url": "https://api.github.com/users/aojea/received_events",
    "repos_url": "https://api.github.com/users/aojea/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/aojea/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aojea/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/aojea"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/6450081?v=4",
      "events_url": "https://api.github.com/users/aojea/events{/privacy}",
      "followers_url": "https://api.github.com/users/aojea/followers",
      "following_url": "https://api.github.com/users/aojea/following{/other_user}",
      "gists_url": "https://api.github.com/users/aojea/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/aojea",
      "id": 6450081,
      "login": "aojea",
      "node_id": "MDQ6VXNlcjY0NTAwODE=",
      "organizations_url": "https://api.github.com/users/aojea/orgs",
      "received_events_url": "https://api.github.com/users/aojea/received_events",
      "repos_url": "https://api.github.com/users/aojea/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/aojea/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aojea/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/aojea"
    },
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/10683203?v=4",
      "events_url": "https://api.github.com/users/khenidak/events{/privacy}",
      "followers_url": "https://api.github.com/users/khenidak/followers",
      "following_url": "https://api.github.com/users/khenidak/following{/other_user}",
      "gists_url": "https://api.github.com/users/khenidak/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/khenidak",
      "id": 10683203,
      "login": "khenidak",
      "node_id": "MDQ6VXNlcjEwNjgzMjAz",
      "organizations_url": "https://api.github.com/users/khenidak/orgs",
      "received_events_url": "https://api.github.com/users/khenidak/received_events",
      "repos_url": "https://api.github.com/users/khenidak/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/khenidak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/khenidak/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/khenidak"
    }
  ],
  "author_association": "NONE",
  "body": "**What happened**:\r\n\r\nI have a node with a CIDR allocated using k8s ipam:\r\n```\r\n$ kubectl get nodes -o yaml\r\n\r\n<...>\r\n\r\nspec:\r\n    podCIDR: 10.47.128.0/24\r\n    podCIDRs:\r\n    - 10.47.128.0/24\r\n\r\n<...>\r\n```\r\nbut kubenet cannot allocate addresses for pods. Here is how kubenet configures host-local ipam:\r\n\r\n```\r\nI1029 22:10:21.832778    7477 kubenet_linux.go:284] CNI network config set to {\r\n  \"cniVersion\": \"0.1.0\",\r\n  \"name\": \"kubenet\",\r\n  \"type\": \"bridge\",\r\n  \"bridge\": \"cbr0\",\r\n  \"mtu\": 1500,\r\n  \"addIf\": \"eth0\",\r\n  \"isGateway\": true,\r\n  \"ipMasq\": false,\r\n  \"hairpinMode\": false,\r\n  \"ipam\": {\r\n    \"type\": \"host-local\",\r\n    \"ranges\": [\r\n[{\r\n\"subnet\": \"10.47.128.1/24\",\r\n\"gateway\": \"10.47.128.1\"\r\n}]],\r\n    \"routes\": [{\"dst\": \"0.0.0.0/0\"}]\r\n  }\r\n}\r\n```\r\n\r\nnote, that `subnet` field is 10.47.128.1/24, not 10.47.128.0/24\r\n\r\nThe error is like that:\r\n```\r\nE1029 22:59:09.005667   18180 remote_runtime.go:105] RunPodSandbox from runtime service failed: rpc error: code = Unknown desc = failed to set up sandbox container \"95c4515535cff7239dc99e5880689a5537aaf3c5ea146264d4a57ef46e2ce592\" network for pod \"kube-dns-autoscaler-7b6ddcc6f9-ltc8j\": networkPlugin kubenet failed to set up pod \"kube-dns-autoscaler-7b6ddcc6f9-ltc8j_kube-system\" network: error adding container to network: invalid range set 0: Network has host bits set. For a subnet mask of length 24 the network address is 10.47.128.0\r\n```\r\n\r\n**What you expected to happen**:\r\n\r\nPods are expected to run in the node\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n**Anything else we need to know?**:\r\n\r\non 1.15 [the behavior is different](https://github.com/kubernetes/kubernetes/blob/v1.15.5/pkg/kubelet/dockershim/network/kubenet/kubenet_linux.go#L248), 10.47.128.0/24 would be configured by kubenet for `CNI`. The [new behaviour](https://github.com/kubernetes/kubernetes/blob/v1.16.2/pkg/kubelet/dockershim/network/kubenet/kubenet_linux.go#L276) was introduced with [dualstack support](https://github.com/kubernetes/kubernetes/commit/dba434c4ba0bf39275f25b3833fcc5f6eefa9379). It looks like this behaviour may have been introduced by a mistake, but I'm not sure.\r\n\r\nCNI plugin [check](https://github.com/containernetworking/plugins/blob/v0.8.2/plugins/ipam/host-local/backend/allocator/range.go#L46) fails for such subnets, since it treats CIDR parsing to `IPNet` [a bit different](https://github.com/containernetworking/cni/blob/master/pkg/types/types.go#L36) from the standard `net` package.\r\n\r\n**Environment**:\r\n- Kubernetes version:\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.2\", GitCommit:\"c97fe5036ef3df2967d086711e6c0c405941e14b\", GitTreeState:\"clean\", BuildDate:\"2019-10-15T19:18:23Z\", GoVersion:\"go1.12.10\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.2\", GitCommit:\"c97fe5036ef3df2967d086711e6c0c405941e14b\", GitTreeState:\"clean\", BuildDate:\"2019-10-15T19:09:08Z\", GoVersion:\"go1.12.10\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n- Cloud provider or hardware configuration:\r\nyandex cloud (cloud.yandex.com)\r\n- OS (e.g: `cat /etc/os-release`):\r\nNAME=\"Ubuntu\"\r\nVERSION=\"18.04.1 LTS (Bionic Beaver)\"\r\nID=ubuntu\r\nID_LIKE=debian\r\nPRETTY_NAME=\"Ubuntu 18.04.1 LTS\"\r\nVERSION_ID=\"18.04\"\r\nHOME_URL=\"https://www.ubuntu.com/\"\r\nSUPPORT_URL=\"https://help.ubuntu.com/\"\r\nBUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\"\r\nPRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\"\r\nVERSION_CODENAME=bionic\r\nUBUNTU_CODENAME=bionic\r\n\r\n- Kernel (e.g. `uname -a`):\r\nLinux amcb4hb9dd7b6djtgjro-ovav 4.15.0-29-generic #31-Ubuntu SMP Tue Jul 17 15:39:52 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n- Install tools:\r\nn/a\r\n- Network plugin and version (if this is a network-related bug):\r\nkubenet, CNI plugins 0.8.2\r\n- Others:\r\n```\r\nKUBELET_OPTS=\"--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubeconfig.conf --cert-dir=/var/lib/kubelet/pki/ --cloud-provider=external --cni-bin-dir=/home/kubernetes/cni/bin --config=/home/kubernetes/kubelet-config.yaml --experimental-kernel-memcg-notification=true --feature-gates=CSINodeInfo=true,CSIDriverRegistry=true --kubeconfig=/etc/kubernetes/kubelet-kubeconfig.conf --network-plugin=kubenet --node-labels=yandex.cloud/node-group-id=c49s9oshfcqoovjp6m04,yandex.cloud/preemptible=false --node-status-max-images=25 --pod-infra-container-image=k8s.gcr.io/pause:3.1 --resolv-conf=/run/systemd/resolve/resolv.conf --v=5\"\r\n```",
  "closed_at": "2020-01-10T04:13:05Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84541/comments",
  "created_at": "2019-10-29T23:55:43Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84541/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/84541",
  "id": 514304076,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    },
    {
      "color": "d455d0",
      "default": false,
      "description": "Indicates an issue that can not or will not be resolved.",
      "id": 862108765,
      "name": "triage/unresolved",
      "node_id": "MDU6TGFiZWw4NjIxMDg3NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/triage/unresolved"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84541/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MTQzMDQwNzY=",
  "number": 84541,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Kubenet not working with pod CIDRs from node spec in 1.16",
  "updated_at": "2020-01-10T04:13:05Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84541",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/444371?v=4",
    "events_url": "https://api.github.com/users/baranov1ch/events{/privacy}",
    "followers_url": "https://api.github.com/users/baranov1ch/followers",
    "following_url": "https://api.github.com/users/baranov1ch/following{/other_user}",
    "gists_url": "https://api.github.com/users/baranov1ch/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/baranov1ch",
    "id": 444371,
    "login": "baranov1ch",
    "node_id": "MDQ6VXNlcjQ0NDM3MQ==",
    "organizations_url": "https://api.github.com/users/baranov1ch/orgs",
    "received_events_url": "https://api.github.com/users/baranov1ch/received_events",
    "repos_url": "https://api.github.com/users/baranov1ch/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/baranov1ch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/baranov1ch/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/baranov1ch"
  }
}