{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- Please only use this template for submitting enhancement requests -->\r\n\r\n**What would you like to be added**:\r\nI suggest moving execution of permit plugins and the creation of a waiting pod to the scheduling cycle, right after reservation, but keep waiting on a waiting pod's channel in the binding cycle.\r\n\r\n- This way permit plugins will be executed sequentially and result of a previous permit plugin execution will be visible during a next execution.\r\n- With this change it will be easier to reason about waiting pods and implementations of the permit plugins will be simpler and less buggy. For example this will make features like gang scheduling much easier to implement correctly. \r\n- It will also potentially allow to use `SnapshotSharedLister()` in the permit plugin.\r\n- I suspect that execution of the permit plugin will not be very expensive in the most scenarios, so it is okay to move it to the scheduling cycle.\r\n\r\n**Why is this needed**:\r\nThere are potential races when running a permit plugin that makes them hard to use, e.g.\r\n\r\n1. permit plugin for pod A returns \"Wait\"\r\n2. permit plugin for pod B reads currently waiting pods and allow some of them and return \"Allowed\"\r\n3. pod A is added to the waiting pods and is never allowed\r\n\r\nIn general, the issue is that there is no way to know when a pod will become \"waiting pod\" after returning \"Wait\" from the plugin. This leads to races where some pods are allowed and then waiting pod arrives and is potentially never allowed.\r\n\r\n/sig scheduling",
  "closed_at": "2020-02-18T19:24:25Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 13,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/88179/comments",
  "created_at": "2020-02-14T23:03:12Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/88179/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/88179",
  "id": 565598021,
  "labels": [
    {
      "color": "c7def8",
      "default": false,
      "description": "Categorizes issue or PR as related to a new feature.",
      "id": 267761362,
      "name": "kind/feature",
      "node_id": "MDU6TGFiZWwyNjc3NjEzNjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/feature"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/88179/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1NjU1OTgwMjE=",
  "number": 88179,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Move scheduler's framework permit API to the scheduling cycle and wait in the binding cycle",
  "updated_at": "2020-02-18T19:24:25Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/88179",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1050702?v=4",
    "events_url": "https://api.github.com/users/mateuszlitwin/events{/privacy}",
    "followers_url": "https://api.github.com/users/mateuszlitwin/followers",
    "following_url": "https://api.github.com/users/mateuszlitwin/following{/other_user}",
    "gists_url": "https://api.github.com/users/mateuszlitwin/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mateuszlitwin",
    "id": 1050702,
    "login": "mateuszlitwin",
    "node_id": "MDQ6VXNlcjEwNTA3MDI=",
    "organizations_url": "https://api.github.com/users/mateuszlitwin/orgs",
    "received_events_url": "https://api.github.com/users/mateuszlitwin/received_events",
    "repos_url": "https://api.github.com/users/mateuszlitwin/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mateuszlitwin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mateuszlitwin/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mateuszlitwin"
  }
}