{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- This form is for bug reports and feature requests ONLY!\r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/.\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n> /kind bug\r\n\r\n\r\n**What happened**:\r\n\r\nI am using Persistent Local Volumes. The mountpoints for it are set up with 0700 permissions. When running a pod with a user other than root, and with fsGroup to allow access to the volume, the permissions are wrong and the pod cannot use the volume. The permissions are changed from 0700 to 2760.\r\n\r\n**What you expected to happen**:\r\n\r\nfsGroup makes the volume usable for the group by setting the permissions to 2770.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nYou need a cluster with local volumes whose permissions are set to 0700.\r\n\r\npv-permission-bug.yaml:\r\n\r\n```yaml\r\napiVersion: v1\r\nkind: PersistentVolumeClaim\r\nmetadata:\r\n  name: pv-permission-bug\r\nspec:\r\n  accessModes:\r\n  - ReadWriteOnce\r\n  resources:\r\n    requests:\r\n      storage: 1Gi\r\n\r\n---\r\n\r\nkind: Pod\r\napiVersion: v1\r\nmetadata:\r\n  name: pv-permission-bug\r\nspec:\r\n  volumes:\r\n  - name: test\r\n    persistentVolumeClaim:\r\n      claimName: pv-permission-bug\r\n  containers:\r\n  - name: pv-permission-bug\r\n    image: nginx\r\n    volumeMounts:\r\n    - mountPath: \"/usr/share/nginx/html\"\r\n      name: test\r\n  securityContext:\r\n    fsGroup: 2000\r\n```\r\n\r\n```\r\n$ kubectl apply  -f pv-permission-bug.yaml\r\n$ kubectl exec -n provid-mag-pv-permission-bug pv-permission-bug -it -- stat /usr/share/nginx/html\r\n  File: /usr/share/nginx/html\r\n  Size: 4096      \tBlocks: 8          IO Block: 4096   directory\r\nDevice: fd03h/64771d\tInode: 2           Links: 2\r\nAccess: (2760/drwxrwS---)  Uid: (    0/    root)   Gid: ( 2000/ UNKNOWN)\r\nAccess: 2018-08-24 09:22:43.084058182 +0000\r\nModify: 2018-08-23 16:09:52.330157563 +0000\r\nChange: 2018-08-24 09:22:43.084058182 +0000\r\n Birth: -\r\n```\r\n\r\nAs you can see, the permissions are 2760. Since the execute bit is missing for the group, the directory cannot be used. \r\n\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): v1.11.2\r\n- Cloud provider or hardware configuration: libvirt/QEMU\r\n- OS (e.g. from /etc/os-release): CentOS Linux release 7.5.1804 (Core)\r\n- Kernel (e.g. `uname -a`): 3.10.0-862.11.6.el7.x86_64 #1 SMP Tue Aug 14 21:49:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n- Install tools: kubeadm\r\n- Others:\r\n",
  "closed_at": "2019-02-07T04:03:02Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 6,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/67814/comments",
  "created_at": "2018-08-24T10:02:23Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/67814/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/67814",
  "id": 353721737,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "604460",
      "default": false,
      "description": "Denotes an issue or PR that has aged beyond stale and will be auto-closed.",
      "id": 778118402,
      "name": "lifecycle/rotten",
      "node_id": "MDU6TGFiZWw3NzgxMTg0MDI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/lifecycle/rotten"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Storage.",
      "id": 169428334,
      "name": "sig/storage",
      "node_id": "MDU6TGFiZWwxNjk0MjgzMzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/storage"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/67814/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNTM3MjE3Mzc=",
  "number": 67814,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Kubelet sets incomplete group permissions when using fsGroup",
  "updated_at": "2019-02-07T04:03:02Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/67814",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/128020?v=4",
    "events_url": "https://api.github.com/users/mxey/events{/privacy}",
    "followers_url": "https://api.github.com/users/mxey/followers",
    "following_url": "https://api.github.com/users/mxey/following{/other_user}",
    "gists_url": "https://api.github.com/users/mxey/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mxey",
    "id": 128020,
    "login": "mxey",
    "node_id": "MDQ6VXNlcjEyODAyMA==",
    "organizations_url": "https://api.github.com/users/mxey/orgs",
    "received_events_url": "https://api.github.com/users/mxey/received_events",
    "repos_url": "https://api.github.com/users/mxey/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mxey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mxey/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mxey"
  }
}