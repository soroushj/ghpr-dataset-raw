{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "**What happened**:\r\nService Load balancer may not be cleaned up on type change if below sequence happen:\r\n1. Service type changes from `LoadBalancer` to `ClusterIP`\r\n2. Service controller restarts/crashes before it gets a chance to process the update from 1.\r\n3. Service controller starts up again and sees the service doesn't want load balancer, hence skips it.\r\n4. The load balancer resource sticks around even if it is no longer needed by the service.\r\n\r\nNote that this is a different issue than https://github.com/kubernetes/kubernetes/issues/53451, as load balancer resource will still be cleaned up when the service object is deleted, just not when the type change happens.\r\n\r\n**Anything else we need to know?**:\r\nThis is a corner case that is not covered by the initial service load balancer finalizer implementation (https://github.com/kubernetes/kubernetes/pull/78262).\r\n\r\nThis can probably be fixed in a trivial way --- make sure the `addFunc` handler takes in service with non-LoadBalancer type but has finalizer attached:\r\nhttps://github.com/kubernetes/kubernetes/blob/aa3f81d657c1d4b7c789352af7179c08508adc3c/pkg/controller/service/service_controller.go#L140-L145\r\n\r\nI will put more thoughts later.\r\n\r\ncc @bowei @andrewsykim ",
  "closed_at": "2019-06-27T04:13:20Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 9,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/78954/comments",
  "created_at": "2019-06-13T00:38:49Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/78954/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/78954",
  "id": 455483839,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/78954/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NTU0ODM4Mzk=",
  "number": 78954,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Service Load balancer may not be cleaned up on type change",
  "updated_at": "2019-06-27T04:13:20Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/78954",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/8681801?v=4",
    "events_url": "https://api.github.com/users/MrHohn/events{/privacy}",
    "followers_url": "https://api.github.com/users/MrHohn/followers",
    "following_url": "https://api.github.com/users/MrHohn/following{/other_user}",
    "gists_url": "https://api.github.com/users/MrHohn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/MrHohn",
    "id": 8681801,
    "login": "MrHohn",
    "node_id": "MDQ6VXNlcjg2ODE4MDE=",
    "organizations_url": "https://api.github.com/users/MrHohn/orgs",
    "received_events_url": "https://api.github.com/users/MrHohn/received_events",
    "repos_url": "https://api.github.com/users/MrHohn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/MrHohn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MrHohn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/MrHohn"
  }
}