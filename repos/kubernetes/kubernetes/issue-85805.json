{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/17228799?v=4",
    "events_url": "https://api.github.com/users/levimm/events{/privacy}",
    "followers_url": "https://api.github.com/users/levimm/followers",
    "following_url": "https://api.github.com/users/levimm/following{/other_user}",
    "gists_url": "https://api.github.com/users/levimm/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/levimm",
    "id": 17228799,
    "login": "levimm",
    "node_id": "MDQ6VXNlcjE3MjI4Nzk5",
    "organizations_url": "https://api.github.com/users/levimm/orgs",
    "received_events_url": "https://api.github.com/users/levimm/received_events",
    "repos_url": "https://api.github.com/users/levimm/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/levimm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/levimm/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/levimm"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/17228799?v=4",
      "events_url": "https://api.github.com/users/levimm/events{/privacy}",
      "followers_url": "https://api.github.com/users/levimm/followers",
      "following_url": "https://api.github.com/users/levimm/following{/other_user}",
      "gists_url": "https://api.github.com/users/levimm/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/levimm",
      "id": 17228799,
      "login": "levimm",
      "node_id": "MDQ6VXNlcjE3MjI4Nzk5",
      "organizations_url": "https://api.github.com/users/levimm/orgs",
      "received_events_url": "https://api.github.com/users/levimm/received_events",
      "repos_url": "https://api.github.com/users/levimm/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/levimm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/levimm/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/levimm"
    }
  ],
  "author_association": "NONE",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\nI have an Azure Kubernetes cluster (v1.16.3) and I want to make use of an existing load balancer which is located in another resource group as the other cluster resources.\r\n \r\nI use the in-tree k8s cloud-controller-manager and configured it with the following flags:\r\n```\r\n/hyperkube cloud-controller-manager\r\n  --cloud-provider=azure\r\n  --cloud-config=<path-to-cloud-provider-config>\r\n  ...\r\n```\r\n\r\nThe passed cloud provider config contains the following fields:\r\n```\r\ncloud: AZUREPUBLICCLOUD\r\naadClientId: \"<client-id>\"\r\naadClientSecret: \"<client-secret>\"\r\ntenantId: \"<tenant-id>\"\r\nsubscriptionId: \"<subscription-id>\"\r\nlocation: \"westeurope\"\r\nresourceGroup: \"<cluster-resource-group>\"\r\nloadBalancerSku: \"standard\"\r\nloadBalancerName: \"testlb\"\r\nloadBalancerResourceGroup: \"<external-resource-group>\"\r\n...\r\n```\r\n\r\nThe existing load balancer has `standard` sku and is deployed into the same subscription and region as the other cluster resources. The load balancer has one frontend ip configuration assigned and no backend pool configured. The nodes of the cluster are plane machines (no vmss, not assigned to an availability set) and distributed accross availability zones. The configured user has the sufficient privileges to access the resource group which contains the load balancer.\r\n\r\nIf I create a service of type `LoadBalancer` in this cluster, the public ip creation stay in `pending` state forever.\r\nThe logs of the cloud-controller-manager contain this log entry  with code `InvalidResourceReference` for the service creation. It seems that azure-provider does not react correctly on the value of `loadBalancerResourceGroup` in the cloud provider config.\r\n\r\nThis is the log entry of the cloud controller manager:\r\n```\r\nE1202 15:09:32.896802       1 service_controller.go:255] error processing service <namespace>/<lb-service-name> (will retry): failed to ensure load balancer: Code=\"InvalidResourceReference\" Message=\"Resource /subscriptions/<subscription-id>/resourceGroups/<CLUSTER-RESOURCE-GROUP>/providers/Microsoft.Network/loadBalancers/TESTLB referenced by resource /subscriptions/<subscription-id>/resourceGroups/<external-resource-group>/providers/Microsoft.Network/loadBalancers/testlb was not found. Please make sure that the referenced resource exists, and that both resources are in the same region.\" Details=[{\"code\":\"NotFound\",\"message\":\"Resource /subscriptions/<subscription-id>/resourceGroups/<CLUSTER-RESOURCE-GROUP>/providers/Microsoft.Network/loadBalancers/TESTLB not found.\"}]\r\n```\r\n\r\nIf I pass an existing load balancer in the cluster resource group it seems to work.\r\n\r\n**What you expected to happen**:\r\nAzure cloud provider lookup existing load balancer in the correct resource group.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): `v1.16.3`\r\n- Cloud provider or hardware configuration: azure\r\n\r\n/sig cloud-provider\r\n/area provider/azure",
  "closed_at": "2019-12-22T13:59:34Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85805/comments",
  "created_at": "2019-12-02T15:35:31Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85805/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/85805",
  "id": 531207157,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to azure provider",
      "id": 852130786,
      "name": "area/provider/azure",
      "node_id": "MDU6TGFiZWw4NTIxMzA3ODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/azure"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Cloud Provider.",
      "id": 958178286,
      "name": "sig/cloud-provider",
      "node_id": "MDU6TGFiZWw5NTgxNzgyODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cloud-provider"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85805/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MzEyMDcxNTc=",
  "number": 85805,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Azure: Existing load balancer is not looked up correctly",
  "updated_at": "2019-12-22T13:59:34Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85805",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/4513134?v=4",
    "events_url": "https://api.github.com/users/dkistner/events{/privacy}",
    "followers_url": "https://api.github.com/users/dkistner/followers",
    "following_url": "https://api.github.com/users/dkistner/following{/other_user}",
    "gists_url": "https://api.github.com/users/dkistner/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dkistner",
    "id": 4513134,
    "login": "dkistner",
    "node_id": "MDQ6VXNlcjQ1MTMxMzQ=",
    "organizations_url": "https://api.github.com/users/dkistner/orgs",
    "received_events_url": "https://api.github.com/users/dkistner/received_events",
    "repos_url": "https://api.github.com/users/dkistner/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dkistner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dkistner/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dkistner"
  }
}