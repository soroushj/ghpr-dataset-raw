{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/576341?v=4",
    "events_url": "https://api.github.com/users/soltysh/events{/privacy}",
    "followers_url": "https://api.github.com/users/soltysh/followers",
    "following_url": "https://api.github.com/users/soltysh/following{/other_user}",
    "gists_url": "https://api.github.com/users/soltysh/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/soltysh",
    "id": 576341,
    "login": "soltysh",
    "node_id": "MDQ6VXNlcjU3NjM0MQ==",
    "organizations_url": "https://api.github.com/users/soltysh/orgs",
    "received_events_url": "https://api.github.com/users/soltysh/received_events",
    "repos_url": "https://api.github.com/users/soltysh/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/soltysh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/soltysh/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/soltysh"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/576341?v=4",
      "events_url": "https://api.github.com/users/soltysh/events{/privacy}",
      "followers_url": "https://api.github.com/users/soltysh/followers",
      "following_url": "https://api.github.com/users/soltysh/following{/other_user}",
      "gists_url": "https://api.github.com/users/soltysh/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/soltysh",
      "id": 576341,
      "login": "soltysh",
      "node_id": "MDQ6VXNlcjU3NjM0MQ==",
      "organizations_url": "https://api.github.com/users/soltysh/orgs",
      "received_events_url": "https://api.github.com/users/soltysh/received_events",
      "repos_url": "https://api.github.com/users/soltysh/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/soltysh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/soltysh/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/soltysh"
    },
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/6233452?v=4",
      "events_url": "https://api.github.com/users/derekwaynecarr/events{/privacy}",
      "followers_url": "https://api.github.com/users/derekwaynecarr/followers",
      "following_url": "https://api.github.com/users/derekwaynecarr/following{/other_user}",
      "gists_url": "https://api.github.com/users/derekwaynecarr/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/derekwaynecarr",
      "id": 6233452,
      "login": "derekwaynecarr",
      "node_id": "MDQ6VXNlcjYyMzM0NTI=",
      "organizations_url": "https://api.github.com/users/derekwaynecarr/orgs",
      "received_events_url": "https://api.github.com/users/derekwaynecarr/received_events",
      "repos_url": "https://api.github.com/users/derekwaynecarr/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/derekwaynecarr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/derekwaynecarr/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/derekwaynecarr"
    }
  ],
  "author_association": "NONE",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n**What keywords did you search in Kubernetes issues before filing this one?**\r\nJob, resourcequota, scheduler\r\n\r\n- **Kubernetes version** (use `kubectl version`):\r\n\r\n    Client Version: version.Info{Major:\"1\", Minor:\"6\", GitVersion:\"v1.6.1\", GitCommit:\"b0b7a323cc5a4a2019b2e9520c21c7830b7f708e\", GitTreeState:\"clean\", BuildDate:\"2017-04-03T20:44:38Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n    Server Version: version.Info{Major:\"1\", Minor:\"5\", GitVersion:\"v1.5.2\", GitCommit:\"a55267932d501b9fbd6d73e5ded47d79b5763ce5\", GitTreeState:\"clean\", BuildDate:\"2017-04-14T13:36:25Z\", GoVersion:\"go1.7.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n- **Environment**: CentOS bare metal (https://kubernetes.io/docs/getting-started-guides/centos/centos_manual_config/)\r\n- **Cloud provider or hardware configuration**: -\r\n- **OS** (e.g. from /etc/os-release): CentOS 7\r\n- **Kernel** (e.g. `uname -a`): Linux <server name> 3.10.0-514.2.2.el7.x86_64 #1 SMP Tue Dec 6 23:06:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n- **Install tools**: -\r\n- **Others**: -\r\n\r\n**What happened**:\r\nHaving created a resourcequota (e.g. 400M) and creating enough memory-limited jobs to go over that quota (e.g. 4 x 200M limit jobs), at first, two jobs are created and executed as expected, and two jobs fail at first due to memory quota:\r\n\r\n    Events:\r\n      FirstSeen\tLastSeen\tCount\tFrom\t\tSubObjectPath\tType\t\tReason\t\tMessage\r\n      ---------\t--------\t-----\t----\t\t-------------\t--------\t------\t\t-------\r\n      4s\t\t4s\t\t1\tjob-controller\t\t\tWarning\t\tFailedCreate\tError creating: pods \"memhog-y152c55u-\" is forbidden: exceeded quota: memoryquota, requested: memory=200Mi, used: memory=400Mi, limited: memory=400Mi\r\n\r\nAfter the first two jobs have been completed, instead of starting the remaining jobs as soon as possible, the remaining two jobs stay unstarted in this state for many, many hours until they finally start and complete.\r\n\r\nFirst job: Start Time:\tFri, 28 Apr 2017 15:00:08 +0300\r\nOne of the remaining 2 jobs: Start Time:\tSat, 29 Apr 2017 07:13:34 +0300\r\n\r\n**What you expected to happen**:\r\n\r\nI'm expecting the two waiting jobs to start executing as soon as the resources they need are available, e.g. as soon as the first jobs are completed.\r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\n\r\nBring up a kubernetes cluster, then execute these commands:\r\n\r\n    $ kubectl create quota memoryquota --hard=memory=400Mi\r\n    $ echo kubectl run memhog-'$(cat /dev/urandom | tr -dc 'a-z0-9' | fold -w 8 | head -n 1)' --replicas=1 --restart=OnFailure --image-pull-policy=IfNotPresent --limits=memory='$1'Mi,cpu=100m --record --image=derekwaynecarr/memhog --command -- memhog -r100 '$2'm > run-memhog.sh\r\n    $ chmod +x run-memhog.sh\r\n    $ for i in {1..4}; do ./run-memhog.sh 200 100; done\r\n    job \"memhog-0ju2eiuy\" created\r\n    job \"memhog-t8qyt5sj\" created\r\n    job \"memhog-ljaqz4ek\" created\r\n    job \"memhog-eb8q8kr3\" created\r\n\r\nWait for around 30 seconds and the first jobs should be complete:\r\n    \r\n    $ kubectl get jobs\r\n    NAME              DESIRED   SUCCESSFUL   AGE \r\n    memhog-0ju2eiuy   1         1            43s\r\n    memhog-eb8q8kr3   1         0            42s\r\n    memhog-ljaqz4ek   1         0            43s\r\n    memhog-t8qyt5sj   1         1            43s\r\n    $ kubectl describe jobs\r\n    ....\r\n\r\nHowever, the remaining jobs don't start at all as shown by:\r\n\r\n    $ kubectl describe job memhog-ljaqz4ek\r\n    Name:   memhog-ljaqz4ek\r\n    Namespace:  test\r\n    Selector: controller-uid=dd6fb770-2f00-11e7-8766-52c84ff43b2b\r\n    Labels:   run=memhog-ljaqz4ek\r\n    Annotations:  kubernetes.io/change-cause=kubectl run memhog-ljaqz4ek memhog -r100 100m --replicas=1 --restart=OnFailure --image-pull-policy=IfNotPresent --limits=memory=200Mi,cpu=100m --record=true --image=derekway...\r\n    Parallelism:  1\r\n    Completions:  1\r\n    Pods Statuses:  0 Running / 0 Succeeded / 0 Failed\r\n    Pod Template:\r\n      Labels: controller-uid=dd6fb770-2f00-11e7-8766-52c84ff43b2b\r\n        job-name=memhog-ljaqz4ek\r\n        run=memhog-ljaqz4ek\r\n      Containers:\r\n       memhog-ljaqz4ek:\r\n        Image:  derekwaynecarr/memhog\r\n        Port: \r\n        Command:\r\n          memhog\r\n          -r100\r\n          100m\r\n        Limits:\r\n          cpu:    100m\r\n          memory:   200Mi\r\n        Environment:  <none>\r\n        Mounts:   <none>\r\n      Volumes:    <none>\r\n    Events:\r\n      FirstSeen LastSeen  Count From    SubObjectPath Type    Reason    Message\r\n      --------- --------  ----- ----    ------------- --------  ------    -------\r\n      3m    3m    1 job-controller      Warning   FailedCreate  Error creating: pods \"memhog-ljaqz4ek-\" is forbidden: exceeded quota: memoryquota, requested: memory=200Mi, used: memory=400Mi, limited: memory=400Mi    \r\n\r\nFurthermore, pods related to the remaining jobs aren't even created and only the completed pods are shown:\r\n\r\n    $ kubectl get pods -a\r\n    NAME                    READY     STATUS      RESTARTS   AGE\r\n    memhog-0ju2eiuy-bz0zm   0/1       Completed   0          7m\r\n    memhog-t8qyt5sj-q9msw   0/1       Completed   0          7m    \r\n\r\n**Anything else we need to know**:\r\n\r\nI've also created a stackoverflow question about this (http://stackoverflow.com/questions/43654683/resourcequota-multiple-memory-limited-jobs-restarting-pending-jobs-takes-for), and asked about this in the kubernetes slack, where I was urged to create a bug report.",
  "closed_at": "2017-05-16T04:08:48Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 10,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45213/comments",
  "created_at": "2017-05-02T06:41:55Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45213/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/45213",
  "id": 225603459,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 136892195,
      "name": "area/batch",
      "node_id": "MDU6TGFiZWwxMzY4OTIxOTU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/batch"
    },
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 483268648,
      "name": "area/workload-api/job",
      "node_id": "MDU6TGFiZWw0ODMyNjg2NDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/workload-api/job"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Apps.",
      "id": 404091735,
      "name": "sig/apps",
      "node_id": "MDU6TGFiZWw0MDQwOTE3MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/apps"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45213/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMjU2MDM0NTk=",
  "number": 45213,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "BUG: Memory-limited jobs with a resource quota that initially don't have enough resources stay in queue almost forever",
  "updated_at": "2017-05-16T04:08:48Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/45213",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/3648442?v=4",
    "events_url": "https://api.github.com/users/murhum1/events{/privacy}",
    "followers_url": "https://api.github.com/users/murhum1/followers",
    "following_url": "https://api.github.com/users/murhum1/following{/other_user}",
    "gists_url": "https://api.github.com/users/murhum1/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/murhum1",
    "id": 3648442,
    "login": "murhum1",
    "node_id": "MDQ6VXNlcjM2NDg0NDI=",
    "organizations_url": "https://api.github.com/users/murhum1/orgs",
    "received_events_url": "https://api.github.com/users/murhum1/received_events",
    "repos_url": "https://api.github.com/users/murhum1/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/murhum1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/murhum1/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/murhum1"
  }
}