{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\n\r\nPod with container with failed `StartupProbe` stays in `Ready: false`.\r\n\r\n**What you expected to happen**:\r\n\r\nPod/container should be killed and restarted and eventually enter `CrashLoopBackOff`.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nStart cluster with feature gate `StartupProbe=true`.\r\n\r\nDeploy pod:\r\n```yaml\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: startup-probe-pod\r\nspec:\r\n  containers:\r\n    - image: fedora\r\n      command:\r\n        - sleep\r\n        - inf\r\n      name: example1\r\n      readinessProbe:\r\n        exec:\r\n          command:\r\n            - \"true\"\r\n        failureThreshold: 2\r\n        periodSeconds: 2\r\n      livenessProbe:\r\n        exec:\r\n          command:\r\n            - \"true\"\r\n        failureThreshold: 2\r\n        periodSeconds: 2\r\n      startupProbe:\r\n        httpGet:\r\n          path: /healthz\r\n          port: 8080\r\n        failureThreshold: 2\r\n        periodSeconds: 2\r\n```\r\n\r\nWatch output:\r\n\r\n\r\n```\r\n> kubectl get pod\r\nNAME                READY   STATUS    RESTARTS   AGE\r\nstartup-probe-pod   0/1     Running   0          3m28s\r\n> kubectl describe pod\r\nName:         startup-probe-pod                                                                                                                                             \r\nNamespace:    default                                                                                                                                                       \r\nPriority:     0                                                                                                                                                             \r\nNode:         kind-control-plane/172.17.0.2                                                                                                                                 \r\nStart Time:   Tue, 22 Oct 2019 09:54:33 +0200                                                                                                                               \r\nLabels:       <none>                                                                                                                                                        \r\nAnnotations:  kubectl.kubernetes.io/last-applied-configuration:                                                                                                             \r\n                {\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{},\"name\":\"startup-probe-pod\",\"namespace\":\"default\"},\"spec\":{\"containers\":[{\"com...               \r\nStatus:       Running                                                                                                                                                       \r\nIP:           10.244.0.2                                                                                                                                                    \r\nIPs:                                                                                                                                                                        \r\n  IP:  10.244.0.2                                                                                                                                                           \r\nContainers:                                                                                                                                                                 \r\n  example1:                                                                                                                                                                 \r\n    Container ID:  containerd://8451c1b089635e2fde65e59a8b00813db728cb7ad8942bf1a81ab0279496b4d9                                                                            \r\n    Image:         fedora                                                                                                                                                   \r\n    Image ID:      docker.io/library/fedora@sha256:8a91dbd4b9d283ca1edc2de5dbeef9267b68bb5dae2335ef64d2db77ddf3aa68                                                         \r\n    Port:          <none>                                                                                                                                                   \r\n    Host Port:     <none>                                                                                                                                                   \r\n    Command:                                                                                                                                                                \r\n      sleep\r\n      inf\r\n    State:          Running\r\n      Started:      Tue, 22 Oct 2019 09:54:54 +0200\r\n    Ready:          False\r\n    Restart Count:  0\r\n    Liveness:       exec [true] delay=0s timeout=1s period=2s #success=1 #failure=2\r\n    Readiness:      exec [true] delay=0s timeout=1s period=2s #success=1 #failure=2\r\n    Startup:        http-get http://:8080/healthz delay=0s timeout=1s period=2s #success=1 #failure=2\r\n    Environment:    <none>\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-s8pdb (ro)\r\nConditions:\r\n  Type              Status\r\n  Initialized       True \r\n  Ready             False \r\n  ContainersReady   False \r\n  PodScheduled      True \r\nVolumes:\r\n  default-token-s8pdb:\r\n    Type:        Secret (a volume populated by a Secret)\r\n    SecretName:  default-token-s8pdb\r\n    Optional:    false\r\nQoS Class:       BestEffort\r\nNode-Selectors:  <none>\r\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\r\n                 node.kubernetes.io/unreachable:NoExecute for 300s\r\nEvents:\r\n  Type     Reason            Age                    From                         Message\r\n  ----     ------            ----                   ----                         -------\r\n  Warning  FailedScheduling  <unknown>              default-scheduler            0/1 nodes are available: 1 node(s) had taints that the pod didn't tolerate.\r\n  Normal   Scheduled         <unknown>              default-scheduler            Successfully assigned default/startup-probe-pod to kind-control-plane\r\n  Normal   Pulling           3m54s                  kubelet, kind-control-plane  Pulling image \"fedora\"\r\n  Normal   Pulled            3m36s                  kubelet, kind-control-plane  Successfully pulled image \"fedora\"\r\n  Normal   Created           3m33s                  kubelet, kind-control-plane  Created container example1\r\n  Normal   Started           3m33s                  kubelet, kind-control-plane  Started container example1\r\n  Warning  Unhealthy         3m30s (x2 over 3m32s)  kubelet, kind-control-plane  Startup probe failed: Get http://10.244.0.2:8080/healthz: dial tcp 10.244.0.2:8080: connect\r\n: connection refused\r\n\r\n```\r\n\r\n**Anything else we need to know?**:\r\n\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"17+\", GitVersion:\"v1.17.0-alpha.1\", GitCommit:\"0960c74c3788b1724bd7e7b9933bc49c7e5b5afa\", GitTreeState:\"clean\", BuildDate:\"20\r\n19-10-02T23:24:03Z\", GoVersion:\"go1.12.10\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.2\", GitCommit:\"c97fe5036ef3df2967d086711e6c0c405941e14b\", GitTreeState:\"clean\", BuildDate:\"2019-10-16T\r\n07:13:29Z\", GoVersion:\"go1.12.10\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n- Cloud provider or hardware configuration: `kind`\r\n- OS (e.g: `cat /etc/os-release`): `Arch linux\r\n- Kernel (e.g. `uname -a`): `Linux xps13 5.3.7-arch1-1-ARCH #1 SMP PREEMPT Fri Oct 18 00:17:03 UTC 2019 x86_64 GNU/Linux`\r\n- Install tools: `kind`\r\n```yaml\r\n# this config file contains all config fields with comments\r\nkind: Cluster\r\napiVersion: kind.sigs.k8s.io/v1alpha3\r\n# patch the generated kubeadm config with some extra settings\r\nkubeadmConfigPatches:\r\n- |\r\n  apiVersion: kubeadm.k8s.io/v1beta2\r\n  kind: ClusterConfiguration\r\n  metadata:\r\n    name: config\r\n  apiServer:\r\n    extraArgs:\r\n      \"feature-gates\": \"StartupProbe=true\"\r\n  scheduler:\r\n    extraArgs:\r\n      \"feature-gates\": \"StartupProbe=true\"\r\n  controllerManager:\r\n    extraArgs:\r\n      \"feature-gates\": \"StartupProbe=true\"\r\n- |\r\n  apiVersion: kubeadm.k8s.io/v1beta2\r\n  kind: InitConfiguration\r\n  metadata:\r\n    name: config\r\n  nodeRegistration:\r\n    kubeletExtraArgs:\r\n      \"feature-gates\": \"StartupProbe=true\"\r\n# 1 control plane node and 3 workers\r\nnodes:\r\n- role: control-plane\r\n```\r\n- Network plugin and version (if this is a network-related bug): \r\n- Others:\r\n",
  "closed_at": "2019-11-13T21:01:55Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 8,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84178/comments",
  "created_at": "2019-10-22T08:01:10Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84178/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/84178",
  "id": 510491166,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84178/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MTA0OTExNjY=",
  "number": 84178,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Pod with container with failed StartupProbe stays in Ready: false.",
  "updated_at": "2019-11-13T21:01:55Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/84178",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1467188?v=4",
    "events_url": "https://api.github.com/users/odinuge/events{/privacy}",
    "followers_url": "https://api.github.com/users/odinuge/followers",
    "following_url": "https://api.github.com/users/odinuge/following{/other_user}",
    "gists_url": "https://api.github.com/users/odinuge/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/odinuge",
    "id": 1467188,
    "login": "odinuge",
    "node_id": "MDQ6VXNlcjE0NjcxODg=",
    "organizations_url": "https://api.github.com/users/odinuge/orgs",
    "received_events_url": "https://api.github.com/users/odinuge/received_events",
    "repos_url": "https://api.github.com/users/odinuge/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/odinuge/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/odinuge/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/odinuge"
  }
}