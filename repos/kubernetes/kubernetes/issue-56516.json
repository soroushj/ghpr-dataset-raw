{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind bug\r\n\r\nI've been working on updating our `rules_go` dependency to be able to build our \"static\" binaries with cgo disabled to match the output from the non-bazel build.\r\n\r\nIt almost works, but `//cmd/kubeadm` is failing to build because it's trying to link in an empty library:\r\n```\r\nERROR: .../code/kubernetes/src/k8s.io/kubernetes/vendor/github.com/google/cadvisor/container/raw/BUILD:3:1: GoCompile vendor/github.com/google/cadvisor/container/raw/linux_amd64_pure_stripped/go_default_library~/github.com/google/cadvisor/container/raw.a failed (Exit 1): compile failed: error executing command\r\n  (cd .../.cache/bazel/_bazel_jgrafton/75e5737b0f848bf1b7c3ab3303c8bf72/execroot/__main__ && \\\r\n  exec env - \\\r\n  bazel-out/host/bin/external/io_bazel_rules_go/go/tools/builders/compile -go bazel-out/host/bin/external/go_stdlib_linux_amd64_pure/bin/go -root_file bazel-out/host/bin/external/go_stdlib_linux_amd64_pure/ROOT -goos linux -goarch amd64 '-cgo=0' -package_list external/go_sdk/packages.txt -src vendor/github.com/google/cadvisor/container/raw/factory.go -src vendor/github.com/google/cadvisor/container/raw/handler.go -dep github.com/golang/glog -dep github.com/google/cadvisor/container -dep github.com/google/cadvisor/container/common -dep github.com/google/cadvisor/container/libcontainer -dep github.com/google/cadvisor/fs -dep github.com/google/cadvisor/info/v1 -dep github.com/google/cadvisor/machine -dep github.com/google/cadvisor/manager/watcher -dep github.com/opencontainers/runc/libcontainer/cgroups -dep github.com/opencontainers/runc/libcontainer/cgroups/fs -dep github.com/opencontainers/runc/libcontainer/configs -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/golang/glog/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/google/cadvisor/container/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/google/cadvisor/container/common/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/google/cadvisor/container/libcontainer/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/google/cadvisor/fs/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/google/cadvisor/info/v1/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/google/cadvisor/machine/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/google/cadvisor/manager/watcher/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/opencontainers/runc/libcontainer/cgroups/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/opencontainers/runc/libcontainer/cgroups/fs/linux_amd64_pure_stripped/go_default_library~/' -I 'bazel-out/k8-fastbuild/bin/vendor/github.com/opencontainers/runc/libcontainer/configs/linux_amd64_pure_stripped/go_default_library~/' -o 'bazel-out/k8-fastbuild/bin/vendor/github.com/google/cadvisor/container/raw/linux_amd64_pure_stripped/go_default_library~/github.com/google/cadvisor/container/raw.a' -trimpath . -I . -- -p github.com/google/cadvisor/container/raw)\r\n\r\nUse --sandbox_debug to see verbose messages from the sandbox\r\nvendor/github.com/google/cadvisor/container/raw/factory.go:23:2: import .../.cache/bazel/_bazel_jgrafton/75e5737b0f848bf1b7c3ab3303c8bf72/bazel-sandbox/4839007188253519489/execroot/__main__/bazel-out/k8-fastbuild/bin/vendor/github.com/google/cadvisor/container/libcontainer/linux_amd64_pure_stripped/go_default_library~/github.com/google/cadvisor/container/libcontainer.a: reading input: EOF\r\n2017/11/28 15:05:07 error running compiler: exit status 1\r\nTarget //cmd/kubeadm:kubeadm failed to build\r\n```\r\n\r\nThe issue seems to be that `cmd/kubeadm` depends on `pkg/kubelet/apis/kubeletconfig/validation`, which in turn depends on `pkg/kubelet/cm` for a few constants.\r\n\r\n`pkg/kubelet/cm` is a fairly large package, and it has has build-tag controlled cgo and !cgo variants. The cgo variant depends on cadvisor, libcontainer, and other such cgo-heavy libraries, whereas the !cgo variants do not.\r\n\r\n`go build` is pretty lazy about compiling dependencies, so it never builds cadvisor, libcontainer, etc in pure mode. Bazel doesn't have this ability, however, and so it tries to build these libraries in pure mode and fails.\r\n\r\nTrying to get these end libraries to build in pure mode seems futile, especially since nobody would ever use them that way. A more viable fix is to break out the constants needed by `pkg/kubelet/apis/kubeletconfig/validation` into a separate package, which simplifies the build and prevents us from ever depending on these cgo-heavy libraries.\r\n\r\nI'm not sure if there's precedence for this sort of refactoring, or where exactly the constants should go.\r\n\r\n/area build-release",
  "closed_at": "2017-12-16T13:46:35Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 9,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56516/comments",
  "created_at": "2017-11-28T23:36:37Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56516/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/56516",
  "id": 277577300,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 125299793,
      "name": "area/build-release",
      "node_id": "MDU6TGFiZWwxMjUyOTk3OTM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/build-release"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56516/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNzc1NzczMDA=",
  "number": 56516,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "//cmd/kubeadm fails to build in pure Go mode under Bazel due to cadvisor dependencies",
  "updated_at": "2017-12-16T13:46:35Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56516",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/8061296?v=4",
    "events_url": "https://api.github.com/users/ixdy/events{/privacy}",
    "followers_url": "https://api.github.com/users/ixdy/followers",
    "following_url": "https://api.github.com/users/ixdy/following{/other_user}",
    "gists_url": "https://api.github.com/users/ixdy/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ixdy",
    "id": 8061296,
    "login": "ixdy",
    "node_id": "MDQ6VXNlcjgwNjEyOTY=",
    "organizations_url": "https://api.github.com/users/ixdy/orgs",
    "received_events_url": "https://api.github.com/users/ixdy/received_events",
    "repos_url": "https://api.github.com/users/ixdy/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ixdy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ixdy/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ixdy"
  }
}