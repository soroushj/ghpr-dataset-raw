{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/30171?v=4",
    "events_url": "https://api.github.com/users/dougm/events{/privacy}",
    "followers_url": "https://api.github.com/users/dougm/followers",
    "following_url": "https://api.github.com/users/dougm/following{/other_user}",
    "gists_url": "https://api.github.com/users/dougm/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dougm",
    "id": 30171,
    "login": "dougm",
    "node_id": "MDQ6VXNlcjMwMTcx",
    "organizations_url": "https://api.github.com/users/dougm/orgs",
    "received_events_url": "https://api.github.com/users/dougm/received_events",
    "repos_url": "https://api.github.com/users/dougm/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dougm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dougm/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dougm"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/30171?v=4",
      "events_url": "https://api.github.com/users/dougm/events{/privacy}",
      "followers_url": "https://api.github.com/users/dougm/followers",
      "following_url": "https://api.github.com/users/dougm/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougm/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dougm",
      "id": 30171,
      "login": "dougm",
      "node_id": "MDQ6VXNlcjMwMTcx",
      "organizations_url": "https://api.github.com/users/dougm/orgs",
      "received_events_url": "https://api.github.com/users/dougm/received_events",
      "repos_url": "https://api.github.com/users/dougm/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dougm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougm/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dougm"
    }
  ],
  "author_association": "NONE",
  "body": "**What happened**:\r\nThe in-tree vpshere cloud provider does not support SAML auth tokens for the tag-based node labeling.   The provider relies on the [`withTagsClient` function](https://github.com/kubernetes/kubernetes/blob/master/pkg/cloudprovider/providers/vsphere/vsphere.go#L1435) to authenticate with the vapi rest endpoints.  This function assumes that the `username` and `password` fields are set to a username and password.  In the case of SAML auth, these fields must be set to a cert and key, respectively.  The SAML auth setup is described here:  https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/saml-token-authentication.html\r\n\r\nThe vSphere cloud provider when not fetching tags uses a different auth handler which does properly handle SAML auth - https://github.com/kubernetes/kubernetes/blob/master/pkg/cloudprovider/providers/vsphere/vclib/connection.go#L91\r\n\r\nSo when using SAML auth tokens, the cloud provider is able to authenticate with the vSphere API to do things like identifying the vm from the uuid, but not able to authenticate with the vSphere API when fetching tags because it tries to use the cert and key as a basic auth username and password.\r\n\r\n**What you expected to happen**:\r\nThe kubelet is able to acquire the tag-based labels for the node object using SAML token auth.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nSet up SAML token authentication as described in the official docs: https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/saml-token-authentication.html\r\n\r\nThe kubelet logs indicate that zone info (from vm tags) cannot be retrieved due to an auth issue:\r\n```\r\nMar 20 10:48:34 ul-lin-mast-8k kubelet[11752]: E0320 10:48:34.326226   11752 vsphere.go:1528] Get zone for node ul-lin-mast-8k: POST https://vcenterdo.arlington.predictivetechnologies.com:443/rest/com/vmware/cis/session: 401 Unauthorized\r\n```\r\n\r\n**Anything else we need to know?**:\r\nSupport for SSO in the govmomi vAPI was implemented here: https://github.com/vmware/govmomi/commit/54a181af415d37e446e71a07c93fb09fe2942720\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n1.14.0-beta.1\r\n- Cloud provider or hardware configuration:\r\nvSphere\r\n- OS (e.g: `cat /etc/os-release`):\r\nubuntu 18.04",
  "closed_at": "2019-03-26T19:34:19Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/75511/comments",
  "created_at": "2019-03-20T15:08:25Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/75511/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/75511",
  "id": 423305326,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to vmware provider",
      "id": 874113778,
      "name": "area/provider/vmware",
      "node_id": "MDU6TGFiZWw4NzQxMTM3Nzg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/vmware"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/75511/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MjMzMDUzMjY=",
  "number": 75511,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "vSphere Cloud Provider does not support SAML auth tokens for tag-based node labeling",
  "updated_at": "2019-03-26T19:34:19Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/75511",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4368090?v=4",
    "events_url": "https://api.github.com/users/rhockenbury/events{/privacy}",
    "followers_url": "https://api.github.com/users/rhockenbury/followers",
    "following_url": "https://api.github.com/users/rhockenbury/following{/other_user}",
    "gists_url": "https://api.github.com/users/rhockenbury/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/rhockenbury",
    "id": 4368090,
    "login": "rhockenbury",
    "node_id": "MDQ6VXNlcjQzNjgwOTA=",
    "organizations_url": "https://api.github.com/users/rhockenbury/orgs",
    "received_events_url": "https://api.github.com/users/rhockenbury/received_events",
    "repos_url": "https://api.github.com/users/rhockenbury/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/rhockenbury/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rhockenbury/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/rhockenbury"
  }
}