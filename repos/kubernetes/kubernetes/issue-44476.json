{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/7154008?v=4",
    "events_url": "https://api.github.com/users/cjcullen/events{/privacy}",
    "followers_url": "https://api.github.com/users/cjcullen/followers",
    "following_url": "https://api.github.com/users/cjcullen/following{/other_user}",
    "gists_url": "https://api.github.com/users/cjcullen/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/cjcullen",
    "id": 7154008,
    "login": "cjcullen",
    "node_id": "MDQ6VXNlcjcxNTQwMDg=",
    "organizations_url": "https://api.github.com/users/cjcullen/orgs",
    "received_events_url": "https://api.github.com/users/cjcullen/received_events",
    "repos_url": "https://api.github.com/users/cjcullen/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/cjcullen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cjcullen/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/cjcullen"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/7154008?v=4",
      "events_url": "https://api.github.com/users/cjcullen/events{/privacy}",
      "followers_url": "https://api.github.com/users/cjcullen/followers",
      "following_url": "https://api.github.com/users/cjcullen/following{/other_user}",
      "gists_url": "https://api.github.com/users/cjcullen/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/cjcullen",
      "id": 7154008,
      "login": "cjcullen",
      "node_id": "MDQ6VXNlcjcxNTQwMDg=",
      "organizations_url": "https://api.github.com/users/cjcullen/orgs",
      "received_events_url": "https://api.github.com/users/cjcullen/received_events",
      "repos_url": "https://api.github.com/users/cjcullen/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/cjcullen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cjcullen/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/cjcullen"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "\r\n**What keywords did you search in Kubernetes issues before filing this one?** (If you have found any duplicates, you should instead reply there.):\r\n\r\nkubectl token\r\n\r\n\r\nBUG REPORT\r\n\r\n**Kubernetes version** (use `kubectl version`):\r\nkubectl version\r\nClient Version: version.Info{Major:\"1\", Minor:\"6\", GitVersion:\"v1.6.0\", GitCommit:\"fff5156092b56e6bd60fff75aad4dc9de6b6ef37\", GitTreeState:\"clean\", BuildDate:\"2017-03-28T16:36:33Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"6\", GitVersion:\"v1.6.1\", GitCommit:\"b0b7a323cc5a4a2019b2e9520c21c7830b7f708e\", GitTreeState:\"clean\", BuildDate:\"2017-04-03T20:33:27Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**:\r\nGKE\r\n\r\n- **OS** (e.g. from /etc/os-release):\r\nmacOS Sierra 10.12.4\r\n\r\n- **Kernel** (e.g. `uname -a`):\r\n\u279c  uname  -a\r\nDarwin jacobsimpson-macbookpro.roam.corp.google.com 16.5.0 Darwin Kernel Version 16.5.0: Fri Mar  3 16:52:33 PST 2017; root:xnu-3789.51.2~3/RELEASE_X86_64 x86_64\r\n\r\n- **Install tools**:\r\n- **Others**:\r\n\r\n\r\n**What happened**:\r\nI set up a second user, then I use `kubectl --token` to authenticate as the second user. The `--token` parameter is ignored and the authentication token from the `~/.kube/config` file is used instead, so I'm authenticated as the user configured in the config file, not as the user set on the command line parameters.\r\n\r\nI further verified this by commenting out the section in the config file with the authentication token and then the `--token` parameter starts to work as expected.\r\n\r\n**What you expected to happen**:\r\nI expect the command line parameters, when present, to override the config file settings.\r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\n```\r\ngcloud container clusters create test-cluster --cluster-version=1.6.1\r\nprimary_account=$(gcloud auth list 2>&1 | grep ACTIVE | sed 's/.*- \\([^ ]*\\) .*/\\1/')\r\nadmin_token=\"$(gcloud auth print-access-token --account=$primary_account)\"\r\ngcloud iam service-accounts create user-1 --display-name=user-1\r\nuser_account=$(gcloud iam service-accounts list --format='value(email)' --filter='displayName:user-1')\r\ngcloud iam service-accounts keys create --iam-account $user_account user_key.json\r\ngcloud auth activate-service-account $user_account --key-file=user_key.json\r\nuser_token=\"$(gcloud auth print-access-token --account=$user_account)\"\r\nkubectl --token=\"$admin_token\" get nodes\r\n```\r\n\r\nAt this point, the error message should be indicating kubectl tried to authenticate with the `user-1` account. Something like this:\r\n\r\n```sh\r\n\u279c  kubectl --token=\"$admin_token\" get nodes\r\nError from server (Forbidden): User \"user-1@project-name.iam.gserviceaccount.com\" cannot list nodes at the cluster scope.: \"No policy matched.\\nRequired \\\"container.nodes.list\\\" permission.\" (get nodes)\r\n```\r\n\r\nNow edit `~/.kube/config`, search for the `auth-provider:` section for your cluster and comment out the whole section for the test cluster.\r\n\r\n```yaml\r\n- name: test-cluster\r\n  user:\r\n    #auth-provider:\r\n    #  config:\r\n    #    access-token: ya29.xxxxx\r\n    #    cmd-args: config config-helper --format=json\r\n    #    cmd-path: /.../gcloud\r\n    #    expiry: 2017-04-11T21:06:25Z\r\n    #    expiry-key: '{.credential.token_expiry}'\r\n    #    token-key: '{.credential.access_token}'\r\n    #  name: gcp\r\n```\r\n\r\nNow it should be possible to run these two commands. The one using the $admin_token will succeed, the one using the $user_token will fail with the error message indicating the user name.\r\n\r\n```sh\r\nkubectl --token=\"$admin_token\" get nodes\r\nkubectl --token=\"$user_token\" get nodes\r\n```\r\n\r\n\r\n**Anything else we need to know**:\r\n\r\n",
  "closed_at": "2017-06-09T06:47:04Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 6,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44476/comments",
  "created_at": "2017-04-13T23:28:25Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44476/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/44476",
  "id": 221707796,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Auth.",
      "id": 357119284,
      "name": "sig/auth",
      "node_id": "MDU6TGFiZWwzNTcxMTkyODQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/auth"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG CLI.",
      "id": 450823910,
      "name": "sig/cli",
      "node_id": "MDU6TGFiZWw0NTA4MjM5MTA=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cli"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44476/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:22:37Z",
    "closed_issues": 1514,
    "created_at": "2017-01-19T17:41:27Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/7882754?v=4",
      "events_url": "https://api.github.com/users/pwittrock/events{/privacy}",
      "followers_url": "https://api.github.com/users/pwittrock/followers",
      "following_url": "https://api.github.com/users/pwittrock/following{/other_user}",
      "gists_url": "https://api.github.com/users/pwittrock/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/pwittrock",
      "id": 7882754,
      "login": "pwittrock",
      "node_id": "MDQ6VXNlcjc4ODI3NTQ=",
      "organizations_url": "https://api.github.com/users/pwittrock/orgs",
      "received_events_url": "https://api.github.com/users/pwittrock/received_events",
      "repos_url": "https://api.github.com/users/pwittrock/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/pwittrock/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pwittrock/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/pwittrock"
    },
    "description": "",
    "due_on": "2017-06-28T07:00:00Z",
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/32",
    "id": 2264750,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/32/labels",
    "node_id": "MDk6TWlsZXN0b25lMjI2NDc1MA==",
    "number": 32,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.7",
    "updated_at": "2019-08-26T17:22:37Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/32"
  },
  "node_id": "MDU6SXNzdWUyMjE3MDc3OTY=",
  "number": 44476,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kubectl --token is not honored when ~/.kube/config has an authentication token",
  "updated_at": "2017-06-09T06:47:04Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44476",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/20646565?v=4",
    "events_url": "https://api.github.com/users/jcbsmpsn/events{/privacy}",
    "followers_url": "https://api.github.com/users/jcbsmpsn/followers",
    "following_url": "https://api.github.com/users/jcbsmpsn/following{/other_user}",
    "gists_url": "https://api.github.com/users/jcbsmpsn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jcbsmpsn",
    "id": 20646565,
    "login": "jcbsmpsn",
    "node_id": "MDQ6VXNlcjIwNjQ2NTY1",
    "organizations_url": "https://api.github.com/users/jcbsmpsn/orgs",
    "received_events_url": "https://api.github.com/users/jcbsmpsn/received_events",
    "repos_url": "https://api.github.com/users/jcbsmpsn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jcbsmpsn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jcbsmpsn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jcbsmpsn"
  }
}