{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
    "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
    "followers_url": "https://api.github.com/users/liggitt/followers",
    "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
    "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/liggitt",
    "id": 980082,
    "login": "liggitt",
    "node_id": "MDQ6VXNlcjk4MDA4Mg==",
    "organizations_url": "https://api.github.com/users/liggitt/orgs",
    "received_events_url": "https://api.github.com/users/liggitt/received_events",
    "repos_url": "https://api.github.com/users/liggitt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/liggitt"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
      "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
      "followers_url": "https://api.github.com/users/liggitt/followers",
      "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
      "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/liggitt",
      "id": 980082,
      "login": "liggitt",
      "node_id": "MDQ6VXNlcjk4MDA4Mg==",
      "organizations_url": "https://api.github.com/users/liggitt/orgs",
      "received_events_url": "https://api.github.com/users/liggitt/received_events",
      "repos_url": "https://api.github.com/users/liggitt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/liggitt"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!-->\r\n\r\n\r\n**What happened**:\r\nOne of our customers has a workload that makes a lot of api calls using serviceaccount tokens.  They have seen periods of increasingly slow responses eventually leading to many requests failing due to a 1 minute timeout in the apiserver. Requests using other authentication mechanisms (certificate, OIDC tokens) at the same time see no slowdown or timeouts.\r\n\r\n**What you expected to happen**:\r\nAPI calls using serviceaccount tokens should have similar performance as other calls.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n**Anything else we need to know?**:\r\nAt apiserver verbosity (-v)=4, we saw log entries like:\r\n```\r\nGET:https://127.0.0.1:2040/api/v1/namespace\r\ns/81b54524bfa349828fae6a546b5808bc/serviceaccounts/compose\r\nI1205 23:11:19.509645       1 request.go:530] Throttling request took 3.049260372s, request: GET:https://127.0.0.1:2040/api/v1/namespace\r\ns/be7e995326144ec9a6a65c21c79e04fa/secrets/compose-token-z225g\r\nI1205 23:11:19.529665       1 request.go:530] Throttling request took 3.040583457s, request: GET:https://127.0.0.1:2040/api/v1/namespaces/kube-system/secrets/kube-dns-token-kl8s6\r\n```\r\nThe log sample those are from spanned 5m 45 sec, and contains 5698 of those Throttling entries.\r\nThey appear to be coming from a go-client in the apiserver calling back into the apiserver.\r\n\r\nFurther investigation suggested this was due to rate limiting within the go-client used by the tokenauthenticator to validate the tokens - check that the service account and secret associated with the token still exist.\r\n\r\nWe saw throttling times over 1 minute.  At 30 seconds, the total time to perform just the serviceaccount and secret lookup would be sufficient to cause the request to timeout.\r\n\r\nWe didn't find any way to change the rate limiting configuration, but we did find the `--service-account-lookup` apiserver option.  After setting that to false, API calls were consistently fast.  So it seems that token validation is the culprit and we can circumvent it at the risk of allowing clients to use tokens that have since been deleted.\r\n\r\nSome thoughts suggested here:\r\n- Provide a knob to control this throttling\r\n- Disable throttling in the go-client used by token authentication\r\n- We think there is a cache mechanism with a 10 minute TTL.  We can't tell from our logs how often there is a cache miss and why (not in the cache, expired...), but the TTL might be replaced by watches that could invalidate entries as SAs and secrets are deleted.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.11.5\r\n- Cloud provider or hardware configuration: IBM Kubernetes Service\r\n- OS (e.g. from /etc/os-release): Ubuntu 16.04.5 LTS\r\n- Kernel (e.g. `uname -a`): Linux REDACTED 4.4.0-78-generic #99-Ubuntu SMP Thu Apr 27 15:29:09 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n- Install tools:\r\n- Others:\r\n\r\n<!-- DO NOT EDIT BELOW THIS LINE -->\r\n/kind bug",
  "closed_at": "2019-01-01T05:18:56Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 11,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71811/comments",
  "created_at": "2018-12-06T18:36:43Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71811/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/71811",
  "id": 388343406,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Auth.",
      "id": 357119284,
      "name": "sig/auth",
      "node_id": "MDU6TGFiZWwzNTcxMTkyODQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/auth"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scalability.",
      "id": 125010198,
      "name": "sig/scalability",
      "node_id": "MDU6TGFiZWwxMjUwMTAxOTg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scalability"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71811/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzODgzNDM0MDY=",
  "number": 71811,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "api timeouts when using token authentication",
  "updated_at": "2019-02-19T20:49:04Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71811",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/11507505?v=4",
    "events_url": "https://api.github.com/users/jmcmeek/events{/privacy}",
    "followers_url": "https://api.github.com/users/jmcmeek/followers",
    "following_url": "https://api.github.com/users/jmcmeek/following{/other_user}",
    "gists_url": "https://api.github.com/users/jmcmeek/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jmcmeek",
    "id": 11507505,
    "login": "jmcmeek",
    "node_id": "MDQ6VXNlcjExNTA3NTA1",
    "organizations_url": "https://api.github.com/users/jmcmeek/orgs",
    "received_events_url": "https://api.github.com/users/jmcmeek/received_events",
    "repos_url": "https://api.github.com/users/jmcmeek/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jmcmeek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jmcmeek/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jmcmeek"
  }
}