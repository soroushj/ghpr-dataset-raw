{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**: FEATURE REQUEST\r\n/kind feature\r\n\r\n\r\n**What happened**:\r\nOpenstack's config drive is used as source of truth for instance metadata. Config drive gets out of date pretty quick (as soon as the instance name is updated for example), this will result in an error when trying to start the kubelet service cause the name on the metadata (outdated now) won't match the openstack instance list.\r\n\r\n**What you expected to happen**:\r\nAllow the user to disable the use of openstack's config drive as sole source of truth. In other words force a search on the metadata service. \r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n1. Configure kubelet service to use openstack as the cloud provider\r\n3. `nova boot --config-drive true --flavor ... --image ... --security-groups \"...\" --key-name \"...\" --nic net-id=... currentname`\r\n2. `nova update --name newname currentname`\r\n3. Restart kubelet service\r\n\r\n**Anything else we need to know?**:\r\nThe restriction is on the order of these calls: https://github.com/kubernetes/kubernetes/blob/master/pkg/cloudprovider/providers/openstack/metadata.go#L146\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n`Client Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.4\", GitCommit:\"793658f2d7ca7f064d2bdf606519f9fe1229c381\", GitTreeState:\"clean\", BuildDate:\"2017-08-17T17:03:43Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.1\", GitCommit:\"1dc5c66f5dd61da08412a74221ecc79208c2165b\", GitTreeState:\"clean\", BuildDate:\"2017-07-14T01:48:01Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}`\r\n- Cloud provider or hardware configuration**:\r\nOpenstack\r\n- OS (e.g. from /etc/os-release):\r\n`NAME=\"Ubuntu\"\r\nVERSION=\"14.04.5 LTS, Trusty Tahr\"`\r\n- Kernel (e.g. `uname -a`):\r\n`Linux 1b24f0b2-c15a-4c67-aef2-be6a0fe378fe 4.4.0-83-generic #106~14.04.1-Ubuntu SMP Mon Jun 26 18:10:19 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux`",
  "closed_at": "2017-09-28T05:54:15Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 13,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/52378/comments",
  "created_at": "2017-09-13T01:54:07Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/52378/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/52378",
  "id": 257233841,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to openstack provider",
      "id": 239914558,
      "name": "area/provider/openstack",
      "node_id": "MDU6TGFiZWwyMzk5MTQ1NTg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/openstack"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "c7def8",
      "default": false,
      "description": "Categorizes issue or PR as related to a new feature.",
      "id": 267761362,
      "name": "kind/feature",
      "node_id": "MDU6TGFiZWwyNjc3NjEzNjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/feature"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/52378/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNTcyMzM4NDE=",
  "number": 52378,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Openstack config drive as source of truth for instance metadata",
  "updated_at": "2017-11-27T06:11:42Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/52378",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/3293997?v=4",
    "events_url": "https://api.github.com/users/richardalberto/events{/privacy}",
    "followers_url": "https://api.github.com/users/richardalberto/followers",
    "following_url": "https://api.github.com/users/richardalberto/following{/other_user}",
    "gists_url": "https://api.github.com/users/richardalberto/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/richardalberto",
    "id": 3293997,
    "login": "richardalberto",
    "node_id": "MDQ6VXNlcjMyOTM5OTc=",
    "organizations_url": "https://api.github.com/users/richardalberto/orgs",
    "received_events_url": "https://api.github.com/users/richardalberto/received_events",
    "repos_url": "https://api.github.com/users/richardalberto/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/richardalberto/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/richardalberto/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/richardalberto"
  }
}