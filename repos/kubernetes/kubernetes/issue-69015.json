{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind bug\r\nThis is more of an enhancement.\r\n\r\n**What happened**:\r\nThe Plugin Watcher is setup to trigger on file activities when they occur in the subdirectory that it scans. During startup, the Watcher is passed (from within the Kubelet) the Kubelet's root plugin directory as a location to scan for newly added plugins - https://github.com/kubernetes/kubernetes/blob/8346631860ca5d7253198415cf67b56183c33b49/pkg/kubelet/kubelet.go#L789  \r\n\r\nBecause the kubelet's plugins subdirectory is also used by existing in-tree drivers (including csi) as a location to store plugins artifacts, the Plugin Watcher is getting triggered by directory/file activities occurring in that subdirectory that has nothing to do with plugin registration as shown in the output below:\r\n\r\n```\r\n> cat kubelog.txt | grep \"plugin_watcher\"\r\nE0921 18:41:49.164687   81286 plugin_watcher.go:115] error dial failed at socket /var/lib/kubelet/plugins/csi-hostpath/csi.sock, err: failed to dial socket /var/lib/kubelet/plugins/csi-hostpath/csi.sock, err: context deadline exceeded when handling create event: \"/var/lib/kubelet/plugins/csi-hostpath/csi.sock\": CREATE\r\nE0921 18:42:12.126656   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/csi-hostpath/csi.sock when handling delete event: \"/var/lib/kubelet/plugins/csi-hostpath/csi.sock\": REMOVE\r\nE0921 18:42:12.127706   81286 plugin_watcher.go:115] error failed to get plugin info using RPC GetInfo at socket /var/lib/kubelet/plugins/csi-hostpath/csi.sock, err: rpc error: code = Unimplemented desc = unknown service pluginregistration.Registration when handling create event: \"/var/lib/kubelet/plugins/csi-hostpath/csi.sock\": CREATE\r\nE0921 18:42:20.988913   81286 plugin_watcher.go:115] error error accessing path: /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 error: lstat /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8: no such file or directory when handling create event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": CREATE\r\nE0921 18:42:20.989211   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:21.495810   81286 plugin_watcher.go:115] error failed to watch /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8, err: no such file or directory when handling create event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": CREATE\r\nE0921 18:42:21.495960   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:22.512498   81286 plugin_watcher.go:115] error failed to watch /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8, err: no such file or directory when handling create event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": CREATE\r\nE0921 18:42:22.512767   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:24.539679   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount\": REMOVE\r\nE0921 18:42:24.539725   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:24.539743   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/vol_data.json when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/vol_data.json\": REMOVE\r\nE0921 18:42:24.539780   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:24.539612   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount\": REMOVE\r\nE0921 18:42:28.592695   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount\": REMOVE\r\nE0921 18:42:28.592728   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount\": REMOVE\r\nE0921 18:42:28.592752   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:28.592767   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/vol_data.json when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/vol_data.json\": REMOVE\r\nE0921 18:42:28.592967   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:36.611609   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/vol_data.json when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/vol_data.json\": REMOVE\r\nE0921 18:42:36.611485   81286 plugin_watcher.go:115] error error accessing path: /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount error: lstat /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8/globalmount: no such file or directory when handling create event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": CREATE\r\nE0921 18:42:36.611575   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:36.611699   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:52.623501   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\nE0921 18:42:52.623535   81286 plugin_watcher.go:115] error stat file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 failed: stat /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8: no such file or directory when handling create event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": CREATE\r\nE0921 18:43:24.698730   81286 plugin_watcher.go:120] error could not find plugin for deleted file /var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8 when handling delete event: \"/var/lib/kubelet/plugins/kubernetes.io/csi/pv/pvc-8ff803a4bdef11e8\": REMOVE\r\n```\r\n**What you expected to happen**:\r\nThe Plugin Watcher should not be getting triggered by file/directory activities not related to plugin registration/unregistration.  One possibility is to have the Watcher scan one directory below plugins like `/var/lib/kubelet/plugins/registration` or something similar\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nRun plugin watcher with a CSI driver.\r\n\r\ncc @RenaudWasTaken @vikaschoudhary16 ",
  "closed_at": "2018-11-17T06:46:43Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 30,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69015/comments",
  "created_at": "2018-09-25T00:53:41Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69015/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/69015",
  "id": 363371499,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": "Must be staffed and worked on either currently, or very soon, ideally in time for the next release.",
      "id": 114528223,
      "name": "priority/important-soon",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyMjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/important-soon"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69015/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2020-08-23T05:01:14Z",
    "closed_issues": 462,
    "created_at": "2017-11-15T06:32:59Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/5595220?v=4",
      "events_url": "https://api.github.com/users/thockin/events{/privacy}",
      "followers_url": "https://api.github.com/users/thockin/followers",
      "following_url": "https://api.github.com/users/thockin/following{/other_user}",
      "gists_url": "https://api.github.com/users/thockin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/thockin",
      "id": 5595220,
      "login": "thockin",
      "node_id": "MDQ6VXNlcjU1OTUyMjA=",
      "organizations_url": "https://api.github.com/users/thockin/orgs",
      "received_events_url": "https://api.github.com/users/thockin/received_events",
      "repos_url": "https://api.github.com/users/thockin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/thockin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thockin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/thockin"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/40",
    "id": 2913713,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/40/labels",
    "node_id": "MDk6TWlsZXN0b25lMjkxMzcxMw==",
    "number": 40,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.13",
    "updated_at": "2020-08-23T05:01:14Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/40"
  },
  "node_id": "MDU6SXNzdWUzNjMzNzE0OTk=",
  "number": 69015,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Plugin watcher getting notified of every Kubelet directory event",
  "updated_at": "2018-11-17T06:46:43Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/69015",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/309126?v=4",
    "events_url": "https://api.github.com/users/vladimirvivien/events{/privacy}",
    "followers_url": "https://api.github.com/users/vladimirvivien/followers",
    "following_url": "https://api.github.com/users/vladimirvivien/following{/other_user}",
    "gists_url": "https://api.github.com/users/vladimirvivien/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/vladimirvivien",
    "id": 309126,
    "login": "vladimirvivien",
    "node_id": "MDQ6VXNlcjMwOTEyNg==",
    "organizations_url": "https://api.github.com/users/vladimirvivien/orgs",
    "received_events_url": "https://api.github.com/users/vladimirvivien/received_events",
    "repos_url": "https://api.github.com/users/vladimirvivien/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/vladimirvivien/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vladimirvivien/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/vladimirvivien"
  }
}