{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/12049380?v=4",
    "events_url": "https://api.github.com/users/yue9944882/events{/privacy}",
    "followers_url": "https://api.github.com/users/yue9944882/followers",
    "following_url": "https://api.github.com/users/yue9944882/following{/other_user}",
    "gists_url": "https://api.github.com/users/yue9944882/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/yue9944882",
    "id": 12049380,
    "login": "yue9944882",
    "node_id": "MDQ6VXNlcjEyMDQ5Mzgw",
    "organizations_url": "https://api.github.com/users/yue9944882/orgs",
    "received_events_url": "https://api.github.com/users/yue9944882/received_events",
    "repos_url": "https://api.github.com/users/yue9944882/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/yue9944882/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yue9944882/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/yue9944882"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/12049380?v=4",
      "events_url": "https://api.github.com/users/yue9944882/events{/privacy}",
      "followers_url": "https://api.github.com/users/yue9944882/followers",
      "following_url": "https://api.github.com/users/yue9944882/following{/other_user}",
      "gists_url": "https://api.github.com/users/yue9944882/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/yue9944882",
      "id": 12049380,
      "login": "yue9944882",
      "node_id": "MDQ6VXNlcjEyMDQ5Mzgw",
      "organizations_url": "https://api.github.com/users/yue9944882/orgs",
      "received_events_url": "https://api.github.com/users/yue9944882/received_events",
      "repos_url": "https://api.github.com/users/yue9944882/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/yue9944882/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yue9944882/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/yue9944882"
    }
  ],
  "author_association": "NONE",
  "body": "/kind bug\r\n\r\n**What happened**:\r\nWe have noticed that one of the node-exporters is down. It turned out that service has \"old\" endpoint still. After digging deeper i see following errors in controller manager\r\n\r\n```\r\nI0727 12:41:59.942556       1 endpoints_controller.go:375] Error syncing endpoints for service \"kube-system/node-exporter\": Endpoints \"node-exporter\" is invalid: [subsets[0].addresses[1].nodeName: Forbidden: Cannot change NodeName for 172.23.0.122 to worker-g5t48-5497c6d6-8rtc8, subsets[0].addresses[3].nodeName: Forbidden: Cannot change NodeName for 172.23.0.178 to worker-63nev-69566fdb54-5xc7l]\r\n```\r\n\r\nTurns out controller manager can not update endpoints for node-exporter service, because of this error. In endpoint list is see right IPs for worker nodes, but wrong IP for master node (that's why we detected the problem).\r\n\r\nContext:\r\n- two worker nodes were recreated with **new hostnames** (generated randomly), but they use *same ip address*\r\n- one master node were recreated with **new hostname** and **new ip**\r\n\r\nI've tried to manually update hostname and got same error, seems nodeName is not updatable field.\r\n\r\n```\r\nsubsets:\r\n- addresses:\r\n  - ip: 172.23.0.122 <=== IP stayed the same\r\n    nodeName: worker-63nev-69566fdb54-k6jrc <=== still old host name, that basically breaks reconciliation.\r\n    targetRef:\r\n      kind: Pod\r\n      name: node-exporter-bsl62\r\n      namespace: kube-system\r\n      resourceVersion: \"11812304\"\r\n      uid: d60d9a17-52a6-11e8-b36e-deadbe40d32e\r\n  - ip: 172.23.0.166 <=== still old IP\r\n    nodeName: master-0ufqh-85fcf4ffd-rcd5t <=== still old host name\r\n    targetRef:\r\n      kind: Pod\r\n      name: node-exporter-t9w84\r\n      namespace: kube-system\r\n      resourceVersion: \"11811791\"\r\n      uid: f50bd59c-5111-11e8-8479-deadbe40d32e\r\n  - ip: 172.23.0.178 <=== IP stayed the same\r\n    nodeName: worker-g5t48-5497c6d6-sj22v <=== still old host name\r\n    targetRef:\r\n      kind: Pod\r\n      name: node-exporter-p6njg\r\n      namespace: kube-system\r\n      resourceVersion: \"11812640\"\r\n      uid: e7169993-52c7-11e8-b36e-deadbe40d32e\r\n```\r\n\r\nIt also affects all other endpoints, we were forced to recreated all pods (so they will change IPs) to be able to fix endpoints reconciliation.\r\n\r\n**What you expected to happen**:\r\ncontroller manager successfully update endpoints after node recreated with same IP, but different hostname.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n1. cluster 1 master, 1 worker, service that points to pods with host network.\r\n2. shutdown k8s API service (keep it shut down)\r\n3. recreate worker node with same IP and different host name\r\n4. try to recreate pod on worker and in controller manager should appear error above.\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**: \r\n- Kubernetes version (use `kubectl version`): 1.10.1\r\n- Cloud provider or hardware configuration: baremetal\r\n- OS (e.g. from /etc/os-release): CoreOS 1688.5.3\r\n- Kernel (e.g. `uname -a`): 4.14.32-coreos \r\n- Install tools: own tool ([kvm-operator](https://github.com/giantswarm/kvm-operator))\r\n- Others:\r\n",
  "closed_at": "2018-09-25T21:41:01Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 8,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66720/comments",
  "created_at": "2018-07-27T13:01:36Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66720/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/66720",
  "id": 345217391,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "c7def8",
      "default": false,
      "description": "Categorizes issue or PR as related to a new feature.",
      "id": 267761362,
      "name": "kind/feature",
      "node_id": "MDU6TGFiZWwyNjc3NjEzNjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/feature"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG API Machinery.",
      "id": 173493835,
      "name": "sig/api-machinery",
      "node_id": "MDU6TGFiZWwxNzM0OTM4MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/api-machinery"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66720/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNDUyMTczOTE=",
  "number": 66720,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "controller manager fails to update endpoints of host network services when nodeName has changed",
  "updated_at": "2018-09-25T21:41:01Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66720",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1277504?v=4",
    "events_url": "https://api.github.com/users/r7vme/events{/privacy}",
    "followers_url": "https://api.github.com/users/r7vme/followers",
    "following_url": "https://api.github.com/users/r7vme/following{/other_user}",
    "gists_url": "https://api.github.com/users/r7vme/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/r7vme",
    "id": 1277504,
    "login": "r7vme",
    "node_id": "MDQ6VXNlcjEyNzc1MDQ=",
    "organizations_url": "https://api.github.com/users/r7vme/orgs",
    "received_events_url": "https://api.github.com/users/r7vme/received_events",
    "repos_url": "https://api.github.com/users/r7vme/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/r7vme/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/r7vme/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/r7vme"
  }
}