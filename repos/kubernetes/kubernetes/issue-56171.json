{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/903617?v=4",
    "events_url": "https://api.github.com/users/mtaufen/events{/privacy}",
    "followers_url": "https://api.github.com/users/mtaufen/followers",
    "following_url": "https://api.github.com/users/mtaufen/following{/other_user}",
    "gists_url": "https://api.github.com/users/mtaufen/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mtaufen",
    "id": 903617,
    "login": "mtaufen",
    "node_id": "MDQ6VXNlcjkwMzYxNw==",
    "organizations_url": "https://api.github.com/users/mtaufen/orgs",
    "received_events_url": "https://api.github.com/users/mtaufen/received_events",
    "repos_url": "https://api.github.com/users/mtaufen/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mtaufen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mtaufen/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mtaufen"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/903617?v=4",
      "events_url": "https://api.github.com/users/mtaufen/events{/privacy}",
      "followers_url": "https://api.github.com/users/mtaufen/followers",
      "following_url": "https://api.github.com/users/mtaufen/following{/other_user}",
      "gists_url": "https://api.github.com/users/mtaufen/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mtaufen",
      "id": 903617,
      "login": "mtaufen",
      "node_id": "MDQ6VXNlcjkwMzYxNw==",
      "organizations_url": "https://api.github.com/users/mtaufen/orgs",
      "received_events_url": "https://api.github.com/users/mtaufen/received_events",
      "repos_url": "https://api.github.com/users/mtaufen/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mtaufen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mtaufen/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mtaufen"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "See https://docs.google.com/document/d/18-MsChpTkrMGCSqAQN9QGgWuuFoK90SznBbwVkfZryo/ for details.\r\n\r\nDoc reprinted here, with worse formatting:\r\n\r\n<html><head><meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\"></head><body class=\"c31\"><p class=\"c18 title\" id=\"h.ulrt23q582vb\"><span class=\"c7 c22 c29\">Graduating KubeletFlags subfields to KubeletConfiguration</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c2\">Author: @mtaufen</span></p><p class=\"c4\"><span class=\"c2\">Last updated: 11-17-2017</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><h1 class=\"c25\" id=\"h.2616nvrhto7a\"><span class=\"c7 c19\">Background</span></h1><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>We are close to graduating the KubeletConfiguration type to beta. We are close to graduating the ability to load kubelet configuration from a file-based representation of this type. Dynamic Kubelet Configuration is also coming down the pipe, but not quite as near term as file-based configuration.</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c2\">Flags in the Kubelet target either KubeletFlags or KubeletConfiguration. When the KubeletConfiguration goes beta, all flags targeting the KubeletConfiguration will be deprecated and eventually removed. The standard way to load this subset of configuration will be from a file.</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c2\">The eventual goal is to have as few flags as possible. Many fields have been left in KubeletFlags, because we aren&#39;t exactly sure whether they should remain in the Kubelet, and it&#39;s easier to deprecate command-line flags than KubeletConfiguration fields (the latter carries longer-term compatibility guarantees, because files and ConfigMaps are long-lived objects). </span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>It is </span><span class=\"c28\">highly likely</span><span class=\"c2\">&nbsp;that we will want to lift fields from KubeletFlags into KubeletConfiguration. Thus far, we&#39;ve assumed this would be fine because the API guidelines allow adding new fields to existing API objects.</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c2\">The purpose of a lot of this configuration work is to decouple configuration from binaries. Unfortunately, the precedence order of flags, files, and configuration in today&#39;s Kubelet will require configuration rollouts to be coordinated with binary rollouts every time a field moves from KubeletFlags to KubeletConfiguration.</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>This is because in today&#39;s Kubelet, file-based and remote (ConfigMap) configurations completely override command-line flags that target KubeletConfiguration -- including default values for omitted keys. This was intentional: we wanted users to be able to look at a </span><span class=\"c28\">single</span><span class=\"c2\">&nbsp;source to know their configuration. Mentally merging multiple sources is complex and error prone.</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c2\">Again, this works fine for an an API object that evolves in a conventional way. It is more complicated when transitioning command-line flags into that API object, as we&#39;ll see below.</span></p><h1 class=\"c25\" id=\"h.5ty3od4nmnvg\"><span class=\"c7 c19\">Precedence in today&#39;s Kubelet</span></h1><p class=\"c4\"><span class=\"c2\">Precedence in today&#39;s Kubelet looks like this. Higher-numbered layers take precedence</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.08336f99c3ed32719302eff0f762dc63399ccd5c\"></a><a id=\"t.0\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">Layer</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">3 (remote)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c2\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">Completely overrides KubeletConfiguration in lower layers</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">2 (file)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c2\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">Completely overrides KubeletConfiguration in lower layers</span></p></td></tr><tr class=\"c26\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">1 (CLI)</span></p></td><td class=\"c30\" colspan=\"2\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">Only provided CLI flags override lower layers</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">0 (defaults)</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">KubeletFlags defaults</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">KubeletConfiguration defaults</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>For example, let&#39;s say we have two Kubelet versions, K</span><span class=\"c14\">1</span><span>&nbsp;and K</span><span class=\"c14\">2</span><span class=\"c2\">. </span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>The fields in K</span><span class=\"c14\">1</span><span class=\"c2\">&nbsp;are distributed as follows:</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.8c5aca40b272b4aaea68c413c4111d5a17b8875e\"></a><a id=\"t.1\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c7 c6\">1</span></p></td><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>In K</span><span class=\"c14\">2</span><span>, f</span><span class=\"c14\">1</span><span>&nbsp;moves from KubeletFlags to KubeletConfiguration. The associated CLI flag name is retargeted from KubeletFlags.f</span><span class=\"c14\">1</span><span>&nbsp;to KubeletConfiguration.f</span><span class=\"c14\">1</span><span class=\"c2\">:</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.bcc56eda915b0b19590713fff603f2f6b2f64765\"></a><a id=\"t.2\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c20 c21\" colspan=\"1\" rowspan=\"1\"><p class=\"c0 c5\"><span class=\"c7 c6\"></span></p></td><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span></p><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>Let there be remote and file-based configurations that both specify f</span><span class=\"c14\">2</span><span>, and let f</span><span class=\"c14\">1</span><span class=\"c2\">&nbsp;be specified on the command-line.</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c8\">K</span><span class=\"c14 c8\">1</span><span class=\"c16 c8\">&nbsp;interpretes the configuration layers like this:</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.b68839a57845fe7965ed544ebba305b2ec480d26\"></a><a id=\"t.3\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">Layer</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">3 (remote)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c17 c22\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">remote</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">2 (file)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c6\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">file</span></p></td></tr><tr class=\"c26\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">1 (CLI)</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span></p></td><td class=\"c12 c21\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c22 c17\"></span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">0 (defaults)</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c1\">default</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">default</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>With this end result: </span><span class=\"c17\">(f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span><span class=\"c17\">, f</span><span class=\"c6\">2</span><span class=\"c17 c24\">remote</span><span class=\"c17\">)</span></p><p class=\"c4\"><span>Or this end result if the remote config did not exist: </span><span class=\"c17\">(f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span><span class=\"c17\">, f</span><span class=\"c6\">2</span><span class=\"c24 c17\">file</span><span class=\"c7 c22 c17\">)</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c8\">But K</span><span class=\"c14 c8\">2</span><span class=\"c16 c8\">&nbsp;interpretes the configuration layers like this:</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.5f6bf5ecfa043d92dde5bd83d4932dbd75614f26\"></a><a id=\"t.4\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">Layer</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">3 (remote)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c27 c22\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c24 c17\">default (field not specified)</span></p><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">remote</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">2 (file)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c14 c27\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c24 c17\">default (field not specified)</span></p><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">file</span></p></td></tr><tr class=\"c26\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">1 (CLI)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c22 c27\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">0 (defaults)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c27 c24\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c24 c17\">default</span></p><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">default</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>With this end result: </span><span class=\"c17\">(f</span><span class=\"c6\">1</span><span class=\"c24 c17\">default</span><span class=\"c17\">, f</span><span class=\"c6\">2</span><span class=\"c24 c17\">remote</span><span class=\"c7 c22 c17\">)</span></p><p class=\"c4\"><span>Or this end result if the remote config did not exist: </span><span class=\"c17\">(f</span><span class=\"c6\">1</span><span class=\"c24 c17\">default</span><span class=\"c17\">, f</span><span class=\"c6\">2</span><span class=\"c24 c17\">file</span><span class=\"c17\">)</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c8\">Changing the kubelet binary should not change the values of the configuration! This is bad!</span></p><p class=\"c4 c5\"><span class=\"c16 c8\"></span></p><h1 class=\"c25\" id=\"h.jdixug7iqbi1\"><span class=\"c7 c19\">Proposed precedence</span></h1><p class=\"c4\"><span class=\"c2\">I propose we make flags take precedence over all else. This makes the tradeoff of preventing you from dynamically configuring a KubeletConfiguration field that was lifted from KubeletFlags in a new Kubelet until you remove the flag, with the benefit of preserving behavior across Kubelet binary changes, which I believe is the correct solution.</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.bb5b47ccafdfea4f5c91f669b9f6891c0fa5cbf7\"></a><a id=\"t.5\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">Layer</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">3 (CLI)</span></p></td><td class=\"c30\" colspan=\"2\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">Only provided CLI flags override lower layers</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">2 (remote)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c2\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">Completely overrides KubeletConfiguration in lower layers</span></p></td></tr><tr class=\"c26\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">1 (file)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c2\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">Completely overrides KubeletConfiguration in lower layers</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">0 (defaults)</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">KubeletFlags defaults</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c2\">KubeletConfiguration defaults</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>For example, let&#39;s say we have two Kubelet versions, K</span><span class=\"c14\">1</span><span>&nbsp;and K</span><span class=\"c14\">2</span><span class=\"c2\">. </span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>The fields in K</span><span class=\"c14\">1</span><span class=\"c2\">&nbsp;are distributed as follows:</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.8c5aca40b272b4aaea68c413c4111d5a17b8875e\"></a><a id=\"t.6\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c8 c16\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c7 c6\">1</span></p></td><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>In K</span><span class=\"c14\">2</span><span>, f</span><span class=\"c14\">1</span><span>&nbsp;moves from KubeletFlags to KubeletConfiguration. The associated CLI flag name is retargeted from KubeletFlags.f</span><span class=\"c14\">1</span><span>&nbsp;to KubeletConfiguration.f</span><span class=\"c14\">1</span><span class=\"c2\">:</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.bcc56eda915b0b19590713fff603f2f6b2f64765\"></a><a id=\"t.7\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c20 c21\" colspan=\"1\" rowspan=\"1\"><p class=\"c0 c5\"><span class=\"c6 c7\"></span></p></td><td class=\"c20\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span></p><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>Let there be remote and file-based configurations that both specify f</span><span class=\"c14\">2</span><span>, and let f</span><span class=\"c14\">1</span><span class=\"c2\">&nbsp;be specified on the command-line.</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c8\">K</span><span class=\"c14 c8\">1</span><span class=\"c16 c8\">&nbsp;interpretes the configuration layers like this:</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.255952b21423126e6e98febd79d255beb56d35e8\"></a><a id=\"t.8\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">Layer</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">3 (CLI)</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span></p></td><td class=\"c12 c21\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c22 c17\"></span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">2 (remote)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c22 c17\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">remote</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">1 (file)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c6\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">file</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">0 (defaults)</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c1\">default</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">default</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>With this end result: </span><span class=\"c17\">(f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span><span class=\"c17\">, f</span><span class=\"c6\">2</span><span class=\"c24 c17\">remote</span><span class=\"c7 c22 c17\">)</span></p><p class=\"c4\"><span>Or this end result if the remote config did not exist: </span><span class=\"c17\">(f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span><span class=\"c17\">, f</span><span class=\"c6\">2</span><span class=\"c24 c17\">file</span><span class=\"c7 c22 c17\">)</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c8\">K</span><span class=\"c14 c8\">2</span><span class=\"c16 c8\">&nbsp;interpretes the configuration layers like this:</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><a id=\"t.a9c1cf3ee3c6c4532c5746329fe6ed5030d65a53\"></a><a id=\"t.9\"></a><table class=\"c9\"><tbody><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">Layer</span></p></td><td class=\"c23\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletFlags</span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c16 c8\">KubeletConfiguration</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">3 (CLI)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c27 c22\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">2 (remote)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c27 c22\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c1\">default (field not specified)</span></p><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">remote</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">1 (file)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c14 c27\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c24 c17\">default (field not specified)</span></p><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">file</span></p></td></tr><tr class=\"c11\"><td class=\"c15\" colspan=\"1\" rowspan=\"1\"><p class=\"c0\"><span class=\"c16 c8\">0 (defaults)</span></p></td><td class=\"c10\" colspan=\"1\" rowspan=\"1\"><p class=\"c3\"><span class=\"c7 c27 c24\"></span></p></td><td class=\"c12\" colspan=\"1\" rowspan=\"1\"><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">1</span><span class=\"c24 c17\">default</span></p><p class=\"c13\"><span class=\"c17\">f</span><span class=\"c6\">2</span><span class=\"c1\">default</span></p></td></tr></tbody></table><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span>With this end result: </span><span class=\"c17\">(f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span><span class=\"c17\">, f</span><span class=\"c6\">2</span><span class=\"c24 c17\">remote</span><span class=\"c7 c22 c17\">)</span></p><p class=\"c4\"><span>Or this end result if the remote config did not exist: </span><span class=\"c17\">(f</span><span class=\"c6\">1</span><span class=\"c24 c17\">CLI</span><span class=\"c17\">, f</span><span class=\"c6\">2</span><span class=\"c24 c17\">file</span><span class=\"c17\">)</span></p><p class=\"c4 c5\"><span class=\"c2\"></span></p><p class=\"c4\"><span class=\"c8\">There is no change in values between K</span><span class=\"c14 c8\">1</span><span class=\"c8\">&nbsp;and K</span><span class=\"c14 c8\">2</span><span class=\"c16 c8\">. This is safe.</span></p><p class=\"c4 c5\"><span class=\"c16 c8\"></span></p><p class=\"c4\"><span class=\"c16 c8\">It should be ok to require people to remove the flag override in order to dynamically configure the field or specify it in a config file. The flag will be marked deprecated as part of the transition, so users will eventually have to remove the flag no matter what.</span></p><p class=\"c4 c5\"><span class=\"c16 c8\"></span></p><p class=\"c4\"><span class=\"c8\">The </span><span class=\"c8 c28\">annoying</span><span class=\"c8\">&nbsp;piece of all this is that several of our node-e2e tests rely on the remote configuration taking precedence over the command line flags so that they can create test-specific environments by providing remote configuration. We can get around this issue by migrating the node-e2e tests to load configuration from a file instead of CLI, but it means the changes we need to make aren&#39;t </span><span class=\"c8 c28\">quite</span><span class=\"c8\">&nbsp;as trivial as just changing the precedence order.</span></p></body></html>",
  "closed_at": "2018-01-29T20:37:34Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56171/comments",
  "created_at": "2017-11-21T21:05:29Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56171/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/56171",
  "id": 275859420,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 116719829,
      "name": "area/kubelet",
      "node_id": "MDU6TGFiZWwxMTY3MTk4Mjk=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/kubelet"
    },
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 134645591,
      "name": "area/kubelet-api",
      "node_id": "MDU6TGFiZWwxMzQ2NDU1OTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/kubelet-api"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56171/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:23:39Z",
    "closed_issues": 641,
    "created_at": "2017-07-24T18:50:54Z",
    "creator": {
      "avatar_url": "https://avatars1.githubusercontent.com/u/903617?v=4",
      "events_url": "https://api.github.com/users/mtaufen/events{/privacy}",
      "followers_url": "https://api.github.com/users/mtaufen/followers",
      "following_url": "https://api.github.com/users/mtaufen/following{/other_user}",
      "gists_url": "https://api.github.com/users/mtaufen/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mtaufen",
      "id": 903617,
      "login": "mtaufen",
      "node_id": "MDQ6VXNlcjkwMzYxNw==",
      "organizations_url": "https://api.github.com/users/mtaufen/orgs",
      "received_events_url": "https://api.github.com/users/mtaufen/received_events",
      "repos_url": "https://api.github.com/users/mtaufen/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mtaufen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mtaufen/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mtaufen"
    },
    "description": "",
    "due_on": "2018-03-26T07:00:00Z",
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/37",
    "id": 2659046,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/37/labels",
    "node_id": "MDk6TWlsZXN0b25lMjY1OTA0Ng==",
    "number": 37,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.10",
    "updated_at": "2019-08-26T17:23:39Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/37"
  },
  "node_id": "MDU6SXNzdWUyNzU4NTk0MjA=",
  "number": 56171,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Kubelet flag precedence order vs files/ConfigMaps is dangerous",
  "updated_at": "2018-01-29T20:37:34Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/56171",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/903617?v=4",
    "events_url": "https://api.github.com/users/mtaufen/events{/privacy}",
    "followers_url": "https://api.github.com/users/mtaufen/followers",
    "following_url": "https://api.github.com/users/mtaufen/following{/other_user}",
    "gists_url": "https://api.github.com/users/mtaufen/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mtaufen",
    "id": 903617,
    "login": "mtaufen",
    "node_id": "MDQ6VXNlcjkwMzYxNw==",
    "organizations_url": "https://api.github.com/users/mtaufen/orgs",
    "received_events_url": "https://api.github.com/users/mtaufen/received_events",
    "repos_url": "https://api.github.com/users/mtaufen/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mtaufen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mtaufen/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mtaufen"
  }
}