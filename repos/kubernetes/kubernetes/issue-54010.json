{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n/kind bug\r\n\r\n**What happened**:\r\nRunning `kubectl apply -f manifest.yaml` multiple times (without changing the manifest) will cause kubectl to send empty patch requests. This is particularly problematic because the addon manager runs apply on the addon manifest directory regularly, and the result spams the audit log with empty requests.\r\n\r\n**What you expected to happen**:\r\nKubectl should not send empty patch requests (unless an overriding flag is specified, e.g. `--force`).\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n```shell\r\n$ cat > pod.yaml <<EOF\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name:   pause\r\nspec:\r\n  containers:\r\n    - name:    pause\r\n      image: gcr.io/google_containers/pause\r\nEOF\r\n# create the pod\r\n$ kubectl apply -f ~/tmp/pod.yaml\r\n# Reapplying the file sends a patch\r\n$ kubectl apply -v=9 -f ~/tmp/pod.yaml |& grep PATCH\r\nI1016 14:04:51.965444  119266 round_trippers.go:386] curl -k -v -XPATCH  -H \"Accept: application/json\" -H \"Content-Type: application/strategic-merge-patch+json\" -H \"User-Agent: kubectl/v1.7.5 (linux/amd64) kubernetes/17d7182\" https://104.155.171.61/api/v1/namespaces/default/pods/pause\r\nI1016 14:04:52.006809  119266 round_trippers.go:405] PATCH https://104.155.171.61/api/v1/namespaces/default/pods/pause 200 OK in 41 milliseconds\r\n# Look at the audit log for the patch content.\r\n```\r\n\r\n/cc @crassirostris ",
  "closed_at": "2017-11-08T20:49:05Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
    "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
    "followers_url": "https://api.github.com/users/liggitt/followers",
    "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
    "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/liggitt",
    "id": 980082,
    "login": "liggitt",
    "node_id": "MDQ6VXNlcjk4MDA4Mg==",
    "organizations_url": "https://api.github.com/users/liggitt/orgs",
    "received_events_url": "https://api.github.com/users/liggitt/received_events",
    "repos_url": "https://api.github.com/users/liggitt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/liggitt"
  },
  "comments": 5,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/54010/comments",
  "created_at": "2017-10-16T21:06:53Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/54010/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/54010",
  "id": 265916770,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 138247961,
      "name": "area/kubectl",
      "node_id": "MDU6TGFiZWwxMzgyNDc5NjE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/kubectl"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": "Must be staffed and worked on either currently, or very soon, ideally in time for the next release.",
      "id": 114528223,
      "name": "priority/important-soon",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyMjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/important-soon"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG CLI.",
      "id": 450823910,
      "name": "sig/cli",
      "node_id": "MDU6TGFiZWw0NTA4MjM5MTA=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cli"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Cluster Lifecycle.",
      "id": 173494222,
      "name": "sig/cluster-lifecycle",
      "node_id": "MDU6TGFiZWwxNzM0OTQyMjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cluster-lifecycle"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/54010/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNjU5MTY3NzA=",
  "number": 54010,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Rerunning kubectl apply on the same file should not send an empty patch request",
  "updated_at": "2017-11-09T02:19:48Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/54010",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/29742491?v=4",
    "events_url": "https://api.github.com/users/tallclair/events{/privacy}",
    "followers_url": "https://api.github.com/users/tallclair/followers",
    "following_url": "https://api.github.com/users/tallclair/following{/other_user}",
    "gists_url": "https://api.github.com/users/tallclair/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tallclair",
    "id": 29742491,
    "login": "tallclair",
    "node_id": "MDQ6VXNlcjI5NzQyNDkx",
    "organizations_url": "https://api.github.com/users/tallclair/orgs",
    "received_events_url": "https://api.github.com/users/tallclair/received_events",
    "repos_url": "https://api.github.com/users/tallclair/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tallclair/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tallclair/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tallclair"
  }
}