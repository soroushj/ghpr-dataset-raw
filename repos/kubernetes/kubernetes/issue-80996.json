{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1918646?v=4",
    "events_url": "https://api.github.com/users/kireledan/events{/privacy}",
    "followers_url": "https://api.github.com/users/kireledan/followers",
    "following_url": "https://api.github.com/users/kireledan/following{/other_user}",
    "gists_url": "https://api.github.com/users/kireledan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/kireledan",
    "id": 1918646,
    "login": "kireledan",
    "node_id": "MDQ6VXNlcjE5MTg2NDY=",
    "organizations_url": "https://api.github.com/users/kireledan/orgs",
    "received_events_url": "https://api.github.com/users/kireledan/received_events",
    "repos_url": "https://api.github.com/users/kireledan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/kireledan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kireledan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/kireledan"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/1918646?v=4",
      "events_url": "https://api.github.com/users/kireledan/events{/privacy}",
      "followers_url": "https://api.github.com/users/kireledan/followers",
      "following_url": "https://api.github.com/users/kireledan/following{/other_user}",
      "gists_url": "https://api.github.com/users/kireledan/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/kireledan",
      "id": 1918646,
      "login": "kireledan",
      "node_id": "MDQ6VXNlcjE5MTg2NDY=",
      "organizations_url": "https://api.github.com/users/kireledan/orgs",
      "received_events_url": "https://api.github.com/users/kireledan/received_events",
      "repos_url": "https://api.github.com/users/kireledan/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/kireledan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kireledan/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/kireledan"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**What happened**:\r\n\r\nI had an NLB Service object (in AWS naturally) where we decided we needed the source IP address and so changed the ExternalTrafficPolicy from Cluster to Local, but didn't delete the Service object - and didn't want to, because that would break Route53 DNS entries.\r\n\r\nThe Service started throwing Warning and 400 errors from the AWS API and did not self-heal.\r\n```\r\n  Warning  CreatingLoadBalancerFailed  9m17s               service-controller  Error creating load balancer (will retry): failed to ensure load balancer for service XXX/YYY: Error modifying target group health check: \"InvalidConfigurationRequest: You cannot change the health check protocol for a target group with the TCP protocol\\n\\tstatus code: 400, request id: f8e9446d-b7d3-11e9-886c-3f71b1696d69\"\r\n```\r\n\r\n**What you expected to happen**:\r\nThe controller should delete out the invalid target group and recreate it in order to configure the NLB as requested.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n* Create a LoadBalancer Service annotated as an NLB with default ExternalTrafficPolicy, backed by some running pods.\r\n* Wait for the NLB to be fully provisioned.\r\n* Change the service to have ExternalTrafficPolicy Local.\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.13 (eks latest version)\r\n- Cloud provider or hardware configuration: AWS\r\n- OS (e.g: `cat /etc/os-release`): unknown - eks control plane\r\n- Kernel (e.g. `uname -a`): unknown - eks control plane\r\n- Install tools: eksctl\r\n- Network plugin and version (if this is a network-related bug): unknown - eks control plane\r\n- Others:\r\n",
  "closed_at": "2020-09-23T21:36:20Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 22,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80996/comments",
  "created_at": "2019-08-05T23:09:33Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80996/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/80996",
  "id": 477095581,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to aws provider",
      "id": 852130657,
      "name": "area/provider/aws",
      "node_id": "MDU6TGFiZWw4NTIxMzA2NTc=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/aws"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Cloud Provider.",
      "id": 958178286,
      "name": "sig/cloud-provider",
      "node_id": "MDU6TGFiZWw5NTgxNzgyODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cloud-provider"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80996/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NzcwOTU1ODE=",
  "number": 80996,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Changing an NLB service from externalTrafficPolicy Cluster to Local results in a stuck Service",
  "updated_at": "2020-09-24T08:21:13Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80996",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/499678?v=4",
    "events_url": "https://api.github.com/users/rbtcollins/events{/privacy}",
    "followers_url": "https://api.github.com/users/rbtcollins/followers",
    "following_url": "https://api.github.com/users/rbtcollins/following{/other_user}",
    "gists_url": "https://api.github.com/users/rbtcollins/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/rbtcollins",
    "id": 499678,
    "login": "rbtcollins",
    "node_id": "MDQ6VXNlcjQ5OTY3OA==",
    "organizations_url": "https://api.github.com/users/rbtcollins/orgs",
    "received_events_url": "https://api.github.com/users/rbtcollins/received_events",
    "repos_url": "https://api.github.com/users/rbtcollins/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/rbtcollins/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rbtcollins/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/rbtcollins"
  }
}