{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/8268873?v=4",
    "events_url": "https://api.github.com/users/RainbowMango/events{/privacy}",
    "followers_url": "https://api.github.com/users/RainbowMango/followers",
    "following_url": "https://api.github.com/users/RainbowMango/following{/other_user}",
    "gists_url": "https://api.github.com/users/RainbowMango/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/RainbowMango",
    "id": 8268873,
    "login": "RainbowMango",
    "node_id": "MDQ6VXNlcjgyNjg4NzM=",
    "organizations_url": "https://api.github.com/users/RainbowMango/orgs",
    "received_events_url": "https://api.github.com/users/RainbowMango/received_events",
    "repos_url": "https://api.github.com/users/RainbowMango/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/RainbowMango/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RainbowMango/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/RainbowMango"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/419322?v=4",
      "events_url": "https://api.github.com/users/robscott/events{/privacy}",
      "followers_url": "https://api.github.com/users/robscott/followers",
      "following_url": "https://api.github.com/users/robscott/following{/other_user}",
      "gists_url": "https://api.github.com/users/robscott/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/robscott",
      "id": 419322,
      "login": "robscott",
      "node_id": "MDQ6VXNlcjQxOTMyMg==",
      "organizations_url": "https://api.github.com/users/robscott/orgs",
      "received_events_url": "https://api.github.com/users/robscott/received_events",
      "repos_url": "https://api.github.com/users/robscott/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/robscott/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robscott/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/robscott"
    },
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/8268873?v=4",
      "events_url": "https://api.github.com/users/RainbowMango/events{/privacy}",
      "followers_url": "https://api.github.com/users/RainbowMango/followers",
      "following_url": "https://api.github.com/users/RainbowMango/following{/other_user}",
      "gists_url": "https://api.github.com/users/RainbowMango/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/RainbowMango",
      "id": 8268873,
      "login": "RainbowMango",
      "node_id": "MDQ6VXNlcjgyNjg4NzM=",
      "organizations_url": "https://api.github.com/users/RainbowMango/orgs",
      "received_events_url": "https://api.github.com/users/RainbowMango/received_events",
      "repos_url": "https://api.github.com/users/RainbowMango/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/RainbowMango/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RainbowMango/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/RainbowMango"
    }
  ],
  "author_association": "MEMBER",
  "body": "**What happened**:\r\nkube-controller-manager panic for `fatal error: concurrent map iteration and map write`\r\n\r\n```\r\nfatal error: concurrent map iteration and map write\r\n\r\ngoroutine 2522 [running]:\r\nruntime.throw(0x41213ed, 0x26)\r\n\tGOROOT/src/runtime/panic.go:774 +0x72 fp=0xc0015eaf50 sp=0xc0015eaf20 pc=0x42fc82\r\nruntime.mapiternext(0xc0015eb210)\r\n\tGOROOT/src/runtime/map.go:858 +0x579 fp=0xc0015eafd8 sp=0xc0015eaf50 pc=0x40fb79\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/apis/meta/v1.(*ObjectMeta).Size(0xc00c171e20, 0x7)\r\n\tstaging/src/k8s.io/apimachinery/pkg/apis/meta/v1/generated.pb.go:3818 +0x984 fp=0xc0015eb280 sp=0xc0015eafd8 pc=0x8f1b44\r\nk8s.io/kubernetes/vendor/k8s.io/api/core/v1.(*Service).Size(0xc00c171e00, 0x4775000)\r\n\tstaging/src/k8s.io/api/core/v1/generated.pb.go:22853 +0x3c fp=0xc0015eb2d0 sp=0xc0015eb280 pc=0x9d997c\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/runtime/serializer/protobuf.(*Serializer).doEncode(0xc0000b4f00, 0x4775000, 0xc00c171e00, 0x4761ce0, 0xc0085ea210, 0x0, 0x40a07e4)\r\n\tstaging/src/k8s.io/apimachinery/pkg/runtime/serializer/protobuf/protobuf.go:199 +0x2b3 fp=0xc0015eb480 sp=0xc0015eb2d0 pc=0xfdba13\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/runtime/serializer/protobuf.(*Serializer).Encode(0xc0000b4f00, 0x4775000, 0xc00c171e00, 0x4761ce0, 0xc0085ea210, 0x32babe7, 0x7)\r\n\tstaging/src/k8s.io/apimachinery/pkg/runtime/serializer/protobuf/protobuf.go:167 +0x14d fp=0xc0015eb4e0 sp=0xc0015eb480 pc=0xfdb72d\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/runtime.WithVersionEncoder.Encode(0x477d400, 0xc00011d3c0, 0x7f7f605272a8, 0xc0000b4f00, 0x4776dc0, 0xc0001babd0, 0x4775000, 0xc00c171e00, 0x4761ce0, 0xc0085ea210, ...)\r\n\tstaging/src/k8s.io/apimachinery/pkg/runtime/helper.go:240 +0x26e fp=0xc0015eb610 sp=0xc0015eb4e0 pc=0x87970e\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/runtime.(*WithVersionEncoder).Encode(0xc0085ea1e0, 0x4775000, 0xc00c171e00, 0x4761ce0, 0xc0085ea210, 0x0, 0x0)\r\n\t<autogenerated>:1 +0xc3 fp=0xc0015eb6b0 sp=0xc0015eb610 pc=0x885493\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/runtime.Encode(0x477d300, 0xc0085ea1e0, 0x4775000, 0xc00c171e00, 0x477d300, 0xc0085ea1e0, 0x0, 0x0, 0xc00c121b30)\r\n\tstaging/src/k8s.io/apimachinery/pkg/runtime/codec.go:50 +0x74 fp=0xc0015eb700 sp=0xc0015eb6b0 pc=0x866e34\r\nk8s.io/kubernetes/vendor/k8s.io/client-go/rest.(*Request).Body(0xc00c121b30, 0x406be00, 0xc00c171e00, 0xc00c121b30)\r\n\tstaging/src/k8s.io/client-go/rest/request.go:427 +0x2d5 fp=0xc0015eb7e8 sp=0xc0015eb700 pc=0x1025b55\r\nk8s.io/kubernetes/vendor/k8s.io/client-go/kubernetes/typed/core/v1.(*services).Update(0xc00569fb40, 0xc00c171e00, 0xd, 0x482f440, 0xc00569fb40)\r\n\tstaging/src/k8s.io/client-go/kubernetes/typed/core/v1/service.go:129 +0xfc fp=0xc0015eb8c0 sp=0xc0015eb7e8 pc=0x105205c\r\nk8s.io/kubernetes/pkg/controller/endpointslice.(*Controller).ensureSetupManagedByAnnotation(0xc0009bc4e0, 0xc00c171e00, 0xc00569faa0, 0x0)\r\n\tpkg/controller/endpointslice/endpointslice_controller.go:414 +0x4ba fp=0xc0015ebac8 sp=0xc0015eb8c0 pc=0x245d99a\r\nk8s.io/kubernetes/pkg/controller/endpointslice.(*Controller).syncService(0xc0009bc4e0, 0xc00c1b1bf0, 0x21, 0x0, 0x0)\r\n\tpkg/controller/endpointslice/endpointslice_controller.go:314 +0x507 fp=0xc0015ebda8 sp=0xc0015ebac8 pc=0x245c617\r\nk8s.io/kubernetes/pkg/controller/endpointslice.(*Controller).processNextWorkItem(0xc0009bc4e0, 0x0)\r\n\tpkg/controller/endpointslice/endpointslice_controller.go:240 +0x100 fp=0xc0015ebe38 sp=0xc0015ebda8 pc=0x245bdc0\r\nk8s.io/kubernetes/pkg/controller/endpointslice.(*Controller).worker(0xc0009bc4e0)\r\n\tpkg/controller/endpointslice/endpointslice_controller.go:229 +0x2b fp=0xc0015ebe58 sp=0xc0015ebe38 pc=0x245bc9b\r\nk8s.io/kubernetes/pkg/controller/endpointslice.(*Controller).worker-fm()\r\n\tpkg/controller/endpointslice/endpointslice_controller.go:228 +0x2a fp=0xc0015ebe70 sp=0xc0015ebe58 pc=0x246437a\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil.func1(0xc001a99ef0)\r\n\tstaging/src/k8s.io/apimachinery/pkg/util/wait/wait.go:152 +0x5e fp=0xc0015ebee0 sp=0xc0015ebe70 pc=0x754bde\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil(0xc001a99ef0, 0x3b9aca00, 0x0, 0x1, 0xc00018a4e0)\r\n\tstaging/src/k8s.io/apimachinery/pkg/util/wait/wait.go:153 +0xf8 fp=0xc0015ebf90 sp=0xc0015ebee0 pc=0x753ce8\r\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.Until(0xc001a99ef0, 0x3b9aca00, 0xc00018a4e0)\r\n\tstaging/src/k8s.io/apimachinery/pkg/util/wait/wait.go:88 +0x4d fp=0xc0015ebfc8 sp=0xc0015ebf90 pc=0x753b7d\r\nruntime.goexit()\r\n\tsrc/runtime/asm_amd64.s:1357 +0x1 fp=0xc0015ebfd0 sp=0xc0015ebfc8 pc=0x45f881\r\ncreated by k8s.io/kubernetes/pkg/controller/endpointslice.(*Controller).Run\r\n\tpkg/controller/endpointslice/endpointslice_controller.go:214 +0x213\r\n```\r\n\r\n**What you expected to happen**:\r\nno panic.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nNo idea.  I guess it's hard to reproduce.\r\n\r\n**Anything else we need to know?**:\r\nFound from here:\r\nhttps://github.com/kubernetes/kubernetes/pull/83837#issuecomment-553715114\r\n\r\n`pkg/controller/endpointslice/endpointslice_controller.go:414 +0x4ba fp=0xc0015ebac8 sp=0xc0015eb8c0 pc=0x245d99a`\r\nhttps://github.com/kubernetes/kubernetes/blob/ded6ee953c68f8333ee6291e0bcb7e58604fac00/pkg/controller/endpointslice/endpointslice_controller.go#L395-L415\r\n\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n- Cloud provider or hardware configuration:\r\n- OS (e.g: `cat /etc/os-release`):\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools:\r\n- Network plugin and version (if this is a network-related bug):\r\n- Others:\r\n\r\n/assign\r\ncc @robscott \r\n- Should we do something for v1.17? (v1.17 code freeze now, but still have the opportunity to fix)\r\n- `ensureSetupManagedByAnnotation` can be removed safely in v1.18, right?",
  "closed_at": "2019-11-15T21:58:58Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 9,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85331/comments",
  "created_at": "2019-11-15T08:17:30Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85331/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/85331",
  "id": 523321015,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Highest priority. Must be actively worked on as someone's top priority right now.",
      "id": 114528068,
      "name": "priority/critical-urgent",
      "node_id": "MDU6TGFiZWwxMTQ1MjgwNjg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/critical-urgent"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    },
    {
      "color": "d455d0",
      "default": false,
      "description": "Indicates an issue that can not or will not be resolved.",
      "id": 862108765,
      "name": "triage/unresolved",
      "node_id": "MDU6TGFiZWw4NjIxMDg3NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/triage/unresolved"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85331/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": null,
    "closed_issues": 1674,
    "created_at": "2019-01-21T20:12:05Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
      "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
      "followers_url": "https://api.github.com/users/liggitt/followers",
      "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
      "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/liggitt",
      "id": 980082,
      "login": "liggitt",
      "node_id": "MDQ6VXNlcjk4MDA4Mg==",
      "organizations_url": "https://api.github.com/users/liggitt/orgs",
      "received_events_url": "https://api.github.com/users/liggitt/received_events",
      "repos_url": "https://api.github.com/users/liggitt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/liggitt"
    },
    "description": null,
    "due_on": null,
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/43",
    "id": 3990944,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/43/labels",
    "node_id": "MDk6TWlsZXN0b25lMzk5MDk0NA==",
    "number": 43,
    "open_issues": 17,
    "state": "open",
    "title": "v1.17",
    "updated_at": "2020-10-27T18:45:51Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/43"
  },
  "node_id": "MDU6SXNzdWU1MjMzMjEwMTU=",
  "number": 85331,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kube-controller-manager panic when setting LabelManagedBy label to endpointSlice",
  "updated_at": "2019-11-15T21:58:58Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/85331",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/8268873?v=4",
    "events_url": "https://api.github.com/users/RainbowMango/events{/privacy}",
    "followers_url": "https://api.github.com/users/RainbowMango/followers",
    "following_url": "https://api.github.com/users/RainbowMango/following{/other_user}",
    "gists_url": "https://api.github.com/users/RainbowMango/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/RainbowMango",
    "id": 8268873,
    "login": "RainbowMango",
    "node_id": "MDQ6VXNlcjgyNjg4NzM=",
    "organizations_url": "https://api.github.com/users/RainbowMango/orgs",
    "received_events_url": "https://api.github.com/users/RainbowMango/received_events",
    "repos_url": "https://api.github.com/users/RainbowMango/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/RainbowMango/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RainbowMango/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/RainbowMango"
  }
}