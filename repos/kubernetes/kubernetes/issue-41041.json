{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n\r\n**Is this a request for help?** (If yes, you should use our troubleshooting guide and community support channels, see http://kubernetes.io/docs/troubleshooting/.): No\r\n\r\n\r\n**What keywords did you search in Kubernetes issues before filing this one?** (If you have found any duplicates, you should instead reply there.): iscsi session logout\r\n\r\n---\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?** (choose one): BUG REPORT\r\n\r\n<!--\r\nIf this is a BUG REPORT, please:\r\n  - Fill in as much of the template below as you can.  If you leave out\r\n    information, we can't help you as well.\r\n\r\nIf this is a FEATURE REQUEST, please:\r\n  - Describe *in detail* the feature/behavior/change you'd like to see.\r\n\r\nIn both cases, be ready for followup questions, and please respond in a timely\r\nmanner.  If we can't reproduce a bug or think a feature already exists, we\r\nmight close your issue.  If we're wrong, PLEASE feel free to reopen it and\r\nexplain why.\r\n-->\r\n\r\n**Kubernetes version** (use `kubectl version`): \r\n> Client Version: version.Info{Major:\"1\", Minor:\"5\", GitVersion:\"v1.5.2\", GitCommit:\"08e099554f3c31f6e6f07b448ab3ed78d0520507\", GitTreeState:\"clean\", BuildDate:\"2017-01-12T04:57:25Z\", GoVersion:\"go1.7.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n> Server Version: version.Info{Major:\"1\", Minor:\"5\", GitVersion:\"v1.5.2\", GitCommit:\"08e099554f3c31f6e6f07b448ab3ed78d0520507\", GitTreeState:\"clean\", BuildDate:\"2017-01-12T04:52:34Z\", GoVersion:\"go1.7.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**: Libvirt qemu VM, 4 CPU, 8Gig RAM\r\n- **OS** (e.g. from /etc/os-release): Ubuntu 16.04.1 LTS (Xenial Xerus)\r\n- **Kernel** (e.g. `uname -a`): Linux localhost 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n- **Install tools**: kubeadm\r\n- **Others**:\r\n\r\n\r\n**What happened**:\r\n\r\nIf you have multiple pods on the same node using PVCs that are backed by iSCSI LUNs on the same external system over a single iSCSI session (same IQN but different LUN numbers), then deleting one of the pods causes the iSCSI session to terminate for all pods on that node that are using it.\r\n\r\nFor example, here `pod1` and `pod2` are nginx pods each connected to a different PVC, which are backed by LUNs residing on the same NetApp storage system.  These share a single iSCSI session, differing only by LUN number.  Once pod2 is deleted, all the connected LUNs are no longer available.\r\n\r\n`user@localhost:~$ kubectl get pod`\r\n> NAME                       READY     STATUS             RESTARTS   AGE\r\n> kube-flannel-ds-glct5      2/2       Running            0          59m\r\n> pod1                       1/1       Running            0          2m\r\n> pod2                       1/1       Running            0          1m\r\n\r\n`user@localhost:~$ lsscsi`\r\n> [6:0:0:0]    disk    NETAPP   LUN C-Mode       8300  /dev/sdb\r\n>[6:0:0:1]    disk    NETAPP   LUN C-Mode       8300  /dev/sdc\r\n\r\n`user@localhost:~$ kubectl delete pod pod2`\r\n> pod \"pod2\" deleted\r\n\r\n`user@localhost:~$ kubectl get pod`\r\n> NAME                       READY     STATUS             RESTARTS   AGE\r\n> kube-flannel-ds-glct5      2/2       Running            0          1h\r\n> pod1                       1/1       Running            0          2m\r\n\r\n`user@localhost:~$ lsscsi`\r\n`user@localhost:~$`\r\n\r\n\r\n**What you expected to happen**:\r\n\r\nI expect that in-use iSCSI sessions are not terminated\r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\n\r\n1. Create 2 PVs and PVCs that are backed by a single storage system that aggrates iSCSI connections into a single session.\r\n2. Create 2 pods that consume those PVCs\r\n3. Delete one of the pods\r\n\r\n\r\n**Anything else we need to know**:\r\n",
  "closed_at": "2017-02-15T12:11:56Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 9,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/41041/comments",
  "created_at": "2017-02-06T21:05:41Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/41041/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/41041",
  "id": 205707583,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Storage.",
      "id": 169428334,
      "name": "sig/storage",
      "node_id": "MDU6TGFiZWwxNjk0MjgzMzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/storage"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/41041/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMDU3MDc1ODM=",
  "number": 41041,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Deleting a pod will logout an iscsi session even if that session is in use by other pods",
  "updated_at": "2017-02-15T12:11:56Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/41041",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/6106766?v=4",
    "events_url": "https://api.github.com/users/adkerr/events{/privacy}",
    "followers_url": "https://api.github.com/users/adkerr/followers",
    "following_url": "https://api.github.com/users/adkerr/following{/other_user}",
    "gists_url": "https://api.github.com/users/adkerr/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/adkerr",
    "id": 6106766,
    "login": "adkerr",
    "node_id": "MDQ6VXNlcjYxMDY3NjY=",
    "organizations_url": "https://api.github.com/users/adkerr/orgs",
    "received_events_url": "https://api.github.com/users/adkerr/received_events",
    "repos_url": "https://api.github.com/users/adkerr/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/adkerr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adkerr/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/adkerr"
  }
}