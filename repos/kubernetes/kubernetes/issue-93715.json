{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "https://prow.k8s.io/view/gs/kubernetes-jenkins/pr-logs/pull/93605/pull-kubernetes-bazel-test/1290329488629960704\r\n```\r\n=== RUN   TestUpdateNodeStatusWithLease\r\nI0803 17:08:37.155082      23 plugin_manager.go:114] Starting Kubelet Plugin Manager\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c00066d938 by goroutine 106:\r\n  k8s.io/kubernetes/pkg/kubelet/cadvisor.CapacityFromMachineInfo()\r\n      pkg/kubelet/cadvisor/util.go:44 +0x1d5\r\n  k8s.io/kubernetes/pkg/kubelet/nodestatus.MachineInfo.func1()\r\n      pkg/kubelet/nodestatus/setters.go:287 +0x19dc\r\n  k8s.io/kubernetes/pkg/kubelet.(*Kubelet).setNodeStatus()\r\n      pkg/kubelet/kubelet_node_status.go:559 +0x154\r\n  k8s.io/kubernetes/pkg/kubelet.(*Kubelet).initialNode()\r\n      pkg/kubelet/kubelet_node_status.go:409 +0xdcf\r\n  k8s.io/kubernetes/pkg/kubelet.(*Kubelet).GetNode()\r\n      pkg/kubelet/kubelet_getters.go:236 +0x14a\r\n  k8s.io/kubernetes/pkg/kubelet/server/stats.(*summaryProviderImpl).Get()\r\n      pkg/kubelet/server/stats/summary.go:70 +0x7e\r\n  k8s.io/kubernetes/pkg/kubelet/server/stats.(*resourceAnalyzer).Get()\r\n      <autogenerated>:1 +0x74\r\n  k8s.io/kubernetes/pkg/kubelet/eviction.(*managerImpl).synchronize()\r\n      pkg/kubelet/eviction/eviction_manager.go:258 +0x14b\r\n  k8s.io/kubernetes/pkg/kubelet/eviction.(*managerImpl).Start.func2()\r\n      pkg/kubelet/eviction/eviction_manager.go:203 +0x66\r\n\r\nPrevious write at 0x00c00066d938 by goroutine 104:\r\n  [failed to restore the stack]\r\n\r\nGoroutine 106 (running) created at:\r\n  k8s.io/kubernetes/pkg/kubelet/eviction.(*managerImpl).Start()\r\n      pkg/kubelet/eviction/eviction_manager.go:201 +0x304\r\n  k8s.io/kubernetes/pkg/kubelet.(*Kubelet).initializeRuntimeDependentModules()\r\n      pkg/kubelet/kubelet.go:1296 +0x656\r\n  k8s.io/kubernetes/pkg/kubelet.(*Kubelet).initializeRuntimeDependentModules-fm()\r\n      pkg/kubelet/kubelet.go:1274 +0x44\r\n  sync.(*Once).doSlow()\r\n      GOROOT/src/sync/once.go:66 +0x109\r\n  sync.(*Once).Do()\r\n      GOROOT/src/sync/once.go:57 +0x68\r\n  k8s.io/kubernetes/pkg/kubelet.(*Kubelet).updateRuntimeUp()\r\n      pkg/kubelet/kubelet.go:2116 +0x652\r\n  k8s.io/kubernetes/pkg/kubelet.TestUpdateNodeStatusWithLease()\r\n      pkg/kubelet/kubelet_node_status_test.go:904 +0x2739\r\n  testing.tRunner()\r\n      GOROOT/src/testing/testing.go:1108 +0x202\r\n\r\nGoroutine 104 (running) created at:\r\n  testing.(*T).Run()\r\n      GOROOT/src/testing/testing.go:1159 +0x796\r\n  testing.runTests.func1()\r\n      GOROOT/src/testing/testing.go:1430 +0xa6\r\n  testing.tRunner()\r\n      GOROOT/src/testing/testing.go:1108 +0x202\r\n  testing.runTests()\r\n      GOROOT/src/testing/testing.go:1428 +0x5aa\r\n  testing.(*M).Run()\r\n      GOROOT/src/testing/testing.go:1338 +0x4eb\r\n  main.main()\r\n      bazel-out/k8-fastbuild/bin/pkg/kubelet/linux_amd64_race_stripped/go_default_test%/testmain.go:266 +0x304\r\n  runtime.main()\r\n      GOROOT/src/runtime/proc.go:204 +0x208\r\n  k8s.io/kubernetes/vendor/github.com/cilium/ebpf.init()\r\n      vendor/github.com/cilium/ebpf/prog.go:362 +0x3f8\r\n  k8s.io/kubernetes/vendor/github.com/cilium/ebpf.init()\r\n      vendor/github.com/cilium/ebpf/syscalls.go:392 +0x38b\r\n  k8s.io/kubernetes/vendor/github.com/cilium/ebpf.init()\r\n      vendor/github.com/cilium/ebpf/syscalls.go:216 +0x31d\r\n  k8s.io/kubernetes/vendor/github.com/cilium/ebpf.init()\r\n      vendor/github.com/cilium/ebpf/syscalls.go:188 +0x2b0\r\n  runtime.doInit()\r\n      GOROOT/src/runtime/proc.go:5590 +0x89\r\n  k8s.io/kubernetes/vendor/github.com/cilium/ebpf/internal/btf.init()\r\n      vendor/github.com/cilium/ebpf/internal/btf/btf.go:656 +0x18f\r\n==================\r\nE0803 17:08:37.174713      23 eviction_manager.go:260] eviction manager: failed to get summary stats: failed to get root cgroup stats: failed to get cgroup stats for \"/\": unexpected number of containers: 0\r\nI0803 17:08:37.178686      23 kubelet_network.go:77] Setting Pod CIDR:  -> 10.0.0.0/24,2000::/10\r\n    testing.go:1023: race detected during execution of test\r\n--- FAIL: TestUpdateNodeStatusWithLease (0.04s)\r\n```\r\n\r\nthe test sets `kubelet.machineInfo.MemoryCapacity` in an unprotected way that races with the background eviction manager goroutine, which calls GetCachedMachineInfo, also in an unprotected way\r\n\r\n_Originally posted by @liggitt in https://github.com/kubernetes/kubernetes/pull/93605#issuecomment-668141263_\r\n\r\n/sig node\r\n/kind flake\r\n/cc @dashpole",
  "closed_at": "2020-08-06T23:16:20Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/93715/comments",
  "created_at": "2020-08-05T13:32:17Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/93715/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/93715",
  "id": 673543318,
  "labels": [
    {
      "color": "f7c6c7",
      "default": false,
      "description": "Categorizes issue or PR as related to a flaky test.",
      "id": 264749912,
      "name": "kind/flake",
      "node_id": "MDU6TGFiZWwyNjQ3NDk5MTI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/flake"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/93715/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2NzM1NDMzMTg=",
  "number": 93715,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "data race in TestUpdateNodeStatusWithLease",
  "updated_at": "2020-08-06T23:16:20Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/93715",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
    "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
    "followers_url": "https://api.github.com/users/liggitt/followers",
    "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
    "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/liggitt",
    "id": 980082,
    "login": "liggitt",
    "node_id": "MDQ6VXNlcjk4MDA4Mg==",
    "organizations_url": "https://api.github.com/users/liggitt/orgs",
    "received_events_url": "https://api.github.com/users/liggitt/received_events",
    "repos_url": "https://api.github.com/users/liggitt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/liggitt"
  }
}