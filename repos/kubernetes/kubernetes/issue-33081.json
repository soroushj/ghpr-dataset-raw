{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/10927820?v=4",
    "events_url": "https://api.github.com/users/bprashanth/events{/privacy}",
    "followers_url": "https://api.github.com/users/bprashanth/followers",
    "following_url": "https://api.github.com/users/bprashanth/following{/other_user}",
    "gists_url": "https://api.github.com/users/bprashanth/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bprashanth",
    "id": 10927820,
    "login": "bprashanth",
    "node_id": "MDQ6VXNlcjEwOTI3ODIw",
    "organizations_url": "https://api.github.com/users/bprashanth/orgs",
    "received_events_url": "https://api.github.com/users/bprashanth/received_events",
    "repos_url": "https://api.github.com/users/bprashanth/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bprashanth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bprashanth/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bprashanth"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/10927820?v=4",
      "events_url": "https://api.github.com/users/bprashanth/events{/privacy}",
      "followers_url": "https://api.github.com/users/bprashanth/followers",
      "following_url": "https://api.github.com/users/bprashanth/following{/other_user}",
      "gists_url": "https://api.github.com/users/bprashanth/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/bprashanth",
      "id": 10927820,
      "login": "bprashanth",
      "node_id": "MDQ6VXNlcjEwOTI3ODIw",
      "organizations_url": "https://api.github.com/users/bprashanth/orgs",
      "received_events_url": "https://api.github.com/users/bprashanth/received_events",
      "repos_url": "https://api.github.com/users/bprashanth/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/bprashanth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bprashanth/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/bprashanth"
    },
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/19715963?v=4",
      "events_url": "https://api.github.com/users/matchstick/events{/privacy}",
      "followers_url": "https://api.github.com/users/matchstick/followers",
      "following_url": "https://api.github.com/users/matchstick/following{/other_user}",
      "gists_url": "https://api.github.com/users/matchstick/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/matchstick",
      "id": 19715963,
      "login": "matchstick",
      "node_id": "MDQ6VXNlcjE5NzE1OTYz",
      "organizations_url": "https://api.github.com/users/matchstick/orgs",
      "received_events_url": "https://api.github.com/users/matchstick/received_events",
      "repos_url": "https://api.github.com/users/matchstick/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/matchstick/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matchstick/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/matchstick"
    }
  ],
  "author_association": "NONE",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\n\n**Is this a request for help?** (If yes, you should use our troubleshooting guide and community support channels, see http://kubernetes.io/docs/troubleshooting/.):\n\n**What keywords did you search in Kubernetes issues before filing this one?** (If you have found any duplicates, you should instead reply there.):\n\n---\n\n**Is this a BUG REPORT or FEATURE REQUEST?** (choose one):\n\n<!--\nIf this is a BUG REPORT, please:\n  - Fill in as much of the template below as you can.  If you leave out\n    information, we can't help you as well.\n\nIf this is a FEATURE REQUEST, please:\n  - Describe *in detail* the feature/behavior/change you'd like to see.\n\nIn both cases, be ready for followup questions, and please respond in a timely\nmanner.  If we can't reproduce a bug or think a feature already exists, we\nmight close your issue.  If we're wrong, PLEASE feel free to reopen it and\nexplain why.\n-->\n\n**Kubernetes version** (use `kubectl version`): \n\n```\nClient Version: version.Info{Major:\"1\", Minor:\"4+\", GitVersion:\"v1.4.0-beta.8\", GitCommit:\"3040f87c570a772ce94349b379f41f329494a4f7\", GitTreeState:\"clean\", BuildDate:\"2016-09-18T21:06:37Z\", GoVersion:\"go1.6.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\nServer Version: version.Info{Major:\"1\", Minor:\"4+\", GitVersion:\"v1.4.0-beta.8\", GitCommit:\"3040f87c570a772ce94349b379f41f329494a4f7\", GitTreeState:\"clean\", BuildDate:\"2016-09-18T21:00:36Z\", GoVersion:\"go1.6.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\n```\n\n**Environment**:\n- **Cloud provider or hardware configuration**: GCE+CoreOS+custom k8s\n- **OS** (e.g. from /etc/os-release): CoreOS\n- **Kernel** (e.g. `uname -a`): 4.6.3-coreos\n- **Install tools**: \n- **Others**:\n\n**What happened**:\nCould not access service via external LB from a kubernetes pod on the node that does not host a pod for that service.\n\n**What you expected to happen**:\nTraffic should have gone to the external LB which would pick the node that is running a pod for that service.\n\n**TL;DR** External load balancer kube-proxy iptable rules should only match on traffic originating from outside the cluster/pod networks i.e. from the external load balancer. \nOtherwise traffic originating from within k8s cluster to external load balanced ip addresses can get blackholed. \n\nWe are having an other issue with `OnlyLocal`.\nI have a service with the following definition\n\n```\n{\n   \"apiVersion\": \"v1\",\n   \"kind\": \"Service\",\n   \"metadata\": {\n      \"annotations\": {\n         \"service.alpha.kubernetes.io/external-traffic\": \"OnlyLocal\"\n      },\n      \"labels\": {\n         \"k8s-app\": \"my-app\",\n         \"kubernetes.io/cluster-service\": \"true\"\n      },\n      \"name\": \"my-app\",\n      \"namespace\": \"default\"\n   },\n   \"spec\": {\n      \"loadBalancerIP\": \"1.2.3.4\",\n      \"ports\": [\n         {\n            \"name\": \"http\",\n            \"port\": 80,\n            \"targetPort\": 80\n         }\n      ],\n      \"selector\": {\n         \"k8s-app\": \"my-app\"\n      },\n      \"type\": \"LoadBalancer\"\n   }\n}\n```\n\nIf I run\n\n```\ncurl http://1.2.3.4/test \n```\n\nFrom my local box that is outside of the k8s cluster I get a response.\n\nWhen I run the same command from a k8s node that is not the node that is hosting the pod for `my-app` I get no response.\n\n```\ncurl http://1.2.3.4/test -v\n*   Trying 1.2.3.4\n\n```\n\nChecking the iptables rules. Some stuff truncated:\n\n```\n-A KUBE-SERVICES -d 1.2.3.4/32 -p tcp -m comment --comment \"default/my-app:http loadbalancer IP\" -m tcp --dport 80 -j KUBE-FW-ABZR2FBH2NLOJM2K\n-A KUBE-FW-ABZR2FBH2NLOJM2K -m comment --comment \"default/my-app:http loadbalancer IP\" -j KUBE-XLB-ABZR2FBH2NLOJM2K\n-A KUBE-XLB-ABZR2FBH2NLOJM2K -m comment --comment \"default/my-app:http has no local endpoints\" -j KUBE-MARK-DROP\n```\n\nSo it looks like the traffic gets dropped by the `kube-proxy`.\nThe `KUBE-SERVICES` seems to match packets that originate from pods on this machine and not only external traffic. This means that if a pod on this machine wants to call a service through the external LB\n(e.g. when using external DNS registrations of services) the traffic will be blackholed if the given node does not have a pod in question.\nProposed solution would be to augment the `KUBE-SERVICES` rule to filter out traffic originating from clusters/pods private network.\n\nThis is related to https://github.com/kubernetes/kubernetes/pull/29409\n@girishkalele\n",
  "closed_at": "2016-10-01T05:26:49Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 7,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/33081/comments",
  "created_at": "2016-09-20T11:08:23Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/33081/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/33081",
  "id": 178030816,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 138247961,
      "name": "area/kubectl",
      "node_id": "MDU6TGFiZWwxMzgyNDc5NjE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/kubectl"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/33081/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxNzgwMzA4MTY=",
  "number": 33081,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Networking: external LB in 1.4.0-beta.8 blackholes external ip traffic",
  "updated_at": "2016-10-01T05:26:49Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/33081",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/4558851?v=4",
    "events_url": "https://api.github.com/users/kdima/events{/privacy}",
    "followers_url": "https://api.github.com/users/kdima/followers",
    "following_url": "https://api.github.com/users/kdima/following{/other_user}",
    "gists_url": "https://api.github.com/users/kdima/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/kdima",
    "id": 4558851,
    "login": "kdima",
    "node_id": "MDQ6VXNlcjQ1NTg4NTE=",
    "organizations_url": "https://api.github.com/users/kdima/orgs",
    "received_events_url": "https://api.github.com/users/kdima/received_events",
    "repos_url": "https://api.github.com/users/kdima/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/kdima/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kdima/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/kdima"
  }
}