{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/3262098?v=4",
    "events_url": "https://api.github.com/users/dashpole/events{/privacy}",
    "followers_url": "https://api.github.com/users/dashpole/followers",
    "following_url": "https://api.github.com/users/dashpole/following{/other_user}",
    "gists_url": "https://api.github.com/users/dashpole/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dashpole",
    "id": 3262098,
    "login": "dashpole",
    "node_id": "MDQ6VXNlcjMyNjIwOTg=",
    "organizations_url": "https://api.github.com/users/dashpole/orgs",
    "received_events_url": "https://api.github.com/users/dashpole/received_events",
    "repos_url": "https://api.github.com/users/dashpole/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dashpole/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dashpole/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dashpole"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/3262098?v=4",
      "events_url": "https://api.github.com/users/dashpole/events{/privacy}",
      "followers_url": "https://api.github.com/users/dashpole/followers",
      "following_url": "https://api.github.com/users/dashpole/following{/other_user}",
      "gists_url": "https://api.github.com/users/dashpole/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dashpole",
      "id": 3262098,
      "login": "dashpole",
      "node_id": "MDQ6VXNlcjMyNjIwOTg=",
      "organizations_url": "https://api.github.com/users/dashpole/orgs",
      "received_events_url": "https://api.github.com/users/dashpole/received_events",
      "repos_url": "https://api.github.com/users/dashpole/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dashpole/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dashpole/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dashpole"
    },
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/4333971?v=4",
      "events_url": "https://api.github.com/users/shyamjvs/events{/privacy}",
      "followers_url": "https://api.github.com/users/shyamjvs/followers",
      "following_url": "https://api.github.com/users/shyamjvs/following{/other_user}",
      "gists_url": "https://api.github.com/users/shyamjvs/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/shyamjvs",
      "id": 4333971,
      "login": "shyamjvs",
      "node_id": "MDQ6VXNlcjQzMzM5NzE=",
      "organizations_url": "https://api.github.com/users/shyamjvs/orgs",
      "received_events_url": "https://api.github.com/users/shyamjvs/received_events",
      "repos_url": "https://api.github.com/users/shyamjvs/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/shyamjvs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shyamjvs/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/shyamjvs"
    }
  ],
  "author_association": "MEMBER",
  "body": "Updated issue description with latest findings:\r\n\r\n#50350 introduced a change to kubelet pod deletion that results in `delete pod` API calls from kubelets being concentrated immediately after container garbage collection.\r\n\r\nWhen performing a deletion of large numbers (thousands) of pods across large numbers (hundreds) of nodes, the resulting concentrated delete calls from the kubelets cause increased latency of `delete pods` API calls above the target threshold:\r\n```\r\nSep 27 14:34:14.484: INFO: WARNING Top latency metric: {Resource:pods Subresource: Verb:DELETE Latency:{Perc50:4.551ms Perc90:10.216ms Perc99:1.403002s Perc100:0s} Count:122966}\r\n```\r\n\r\nSeen on https://k8s-gubernator.appspot.com/builds/kubernetes-jenkins/logs/ci-kubernetes-e2e-gce-scale-performance/\r\n\r\nNot seen on https://k8s-gubernator.appspot.com/builds/kubernetes-jenkins/logs/ci-kubernetes-kubemark-gce-scale/\r\n\r\nhoisted details from https://github.com/kubernetes/kubernetes/issues/51899#issuecomment-332868313 into description:\r\nGraphs over a three minute window (both latency in ms and distribution of delete calls per second):\r\n\r\nthe delete calls from the gc controller merely set deletionTimestamp on the pod (which the kubelets observe and start shutting down the pods). the delete calls from the kubelet actually delete from etcd.\r\n\r\n![screen shot 2017-09-28 at 11 47 18 am](https://user-images.githubusercontent.com/980082/30976458-d3f6ab28-a442-11e7-96d3-79511f8a6455.png)\r\n\r\n![screen shot 2017-09-28 at 12 05 18 pm](https://user-images.githubusercontent.com/980082/30977371-58d87824-a445-11e7-9dac-a78063701a82.png)\r\n\r\nthere were multiple spikes throughout the run (corresponding to deletions of 3000-pod replication controllers). here's a graph of delete calls that took more than one second throughout the whole run:\r\n![screen shot 2017-09-28 at 11 24 22 am](https://user-images.githubusercontent.com/980082/30975188-a1bbd8fc-a43f-11e7-9922-484eef42be97.png)\r\n\r\nSeems like a kubelet-induced thundering herd, when deleting massive numbers of pods across massive numbers of nodes. kubemark's gc is stubbed since there are no real containers, so this isn't observed there\r\n\r\n\r\nOriginal issue description follows:\r\n\r\nFrom 5k-node density test run (no. 26) on last friday:\r\n\r\n```\r\nI0901 10:11:29.395] Sep  1 10:11:29.395: INFO: WARNING Top latency metric: {Resource:pods Subresource: Verb:LIST Latency:{Perc50:66.805ms Perc90:375.804ms Perc99:8.111217s Perc100:0s} Count:11911}\r\nI0901 10:11:29.396] Sep  1 10:11:29.395: INFO: Top latency metric: {Resource:nodes Subresource: Verb:LIST Latency:{Perc50:417.103ms Perc90:1.090847s Perc99:2.336106s Perc100:0s} Count:1261}\r\nI0901 10:11:29.396] Sep  1 10:11:29.395: INFO: WARNING Top latency metric: {Resource:nodes Subresource:status Verb:PATCH Latency:{Perc50:5.633ms Perc90:279.15ms Perc99:1.04109s Perc100:0s} Count:5543730}\r\nI0901 10:11:29.396] Sep  1 10:11:29.395: INFO: Top latency metric: {Resource:pods Subresource:binding Verb:POST Latency:{Perc50:1.442ms Perc90:15.171ms Perc99:921.523ms Perc100:0s} Count:155096}\r\nI0901 10:11:29.396] Sep  1 10:11:29.395: INFO: Top latency metric: {Resource:replicationcontrollers Subresource: Verb:POST Latency:{Perc50:3.13ms Perc90:218.472ms Perc99:886.065ms Perc100:0s} Count:5049}\r\n```\r\n\r\nAnd from the last healthy run (no. 23) of the test:\r\n\r\n```\r\nI0826 03:49:44.301] Aug 26 03:49:44.301: INFO: Top latency metric: {Resource:pods Subresource: Verb:LIST Latency:{Perc50:830.411ms Perc90:1.468316s Perc99:2.627309s Perc100:0s} Count:10615}\r\nI0826 03:49:44.302] Aug 26 03:49:44.301: INFO: Top latency metric: {Resource:nodes Subresource: Verb:LIST Latency:{Perc50:337.423ms Perc90:427.443ms Perc99:998.426ms Perc100:0s} Count:1800}\r\nI0826 03:49:44.302] Aug 26 03:49:44.301: INFO: Top latency metric: {Resource:apiservices Subresource: Verb:PUT Latency:{Perc50:954\u00c2\u00b5s Perc90:5.726ms Perc99:138.528ms Perc100:0s} Count:840}\r\nI0826 03:49:44.302] Aug 26 03:49:44.301: INFO: Top latency metric: {Resource:namespaces Subresource: Verb:GET Latency:{Perc50:445\u00c2\u00b5s Perc90:2.641ms Perc99:83.57ms Perc100:0s} Count:1608}\r\nI0826 03:49:44.302] Aug 26 03:49:44.301: INFO: Top latency metric: {Resource:nodes Subresource:status Verb:PATCH Latency:{Perc50:3.22ms Perc90:9.449ms Perc99:55.588ms Perc100:0s} Count:7033941}\r\n```\r\n\r\nThis is a huge increase we're seeing:\r\nLIST pods : 2.6s -> 8.1s\r\nLIST nodes: 1s -> 2.3s\r\nPATCH node-status: 56ms -> 1s\r\n...\r\n\r\ncc @kubernetes/sig-api-machinery-bugs @kubernetes/sig-scalability-misc @smarterclayton @wojtek-t @gmarek \r\n",
  "closed_at": "2017-10-05T22:46:37Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 142,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/51899/comments",
  "created_at": "2017-09-04T12:39:04Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/51899/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/51899",
  "id": 255030243,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "ededed",
      "default": false,
      "description": null,
      "id": 711852621,
      "name": "milestone/needs-approval",
      "node_id": "MDU6TGFiZWw3MTE4NTI2MjE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/milestone/needs-approval"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Highest priority. Must be actively worked on as someone's top priority right now.",
      "id": 114528068,
      "name": "priority/critical-urgent",
      "node_id": "MDU6TGFiZWwxMTQ1MjgwNjg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/critical-urgent"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG API Machinery.",
      "id": 173493835,
      "name": "sig/api-machinery",
      "node_id": "MDU6TGFiZWwxNzM0OTM4MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/api-machinery"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scalability.",
      "id": 125010198,
      "name": "sig/scalability",
      "node_id": "MDU6TGFiZWwxMjUwMTAxOTg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scalability"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/51899/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:23:22Z",
    "closed_issues": 632,
    "created_at": "2017-03-30T14:12:39Z",
    "creator": {
      "avatar_url": "https://avatars1.githubusercontent.com/u/903617?v=4",
      "events_url": "https://api.github.com/users/mtaufen/events{/privacy}",
      "followers_url": "https://api.github.com/users/mtaufen/followers",
      "following_url": "https://api.github.com/users/mtaufen/following{/other_user}",
      "gists_url": "https://api.github.com/users/mtaufen/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mtaufen",
      "id": 903617,
      "login": "mtaufen",
      "node_id": "MDQ6VXNlcjkwMzYxNw==",
      "organizations_url": "https://api.github.com/users/mtaufen/orgs",
      "received_events_url": "https://api.github.com/users/mtaufen/received_events",
      "repos_url": "https://api.github.com/users/mtaufen/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mtaufen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mtaufen/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mtaufen"
    },
    "description": "",
    "due_on": "2017-12-13T08:00:00Z",
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/35",
    "id": 2422217,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/35/labels",
    "node_id": "MDk6TWlsZXN0b25lMjQyMjIxNw==",
    "number": 35,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.9",
    "updated_at": "2019-08-26T17:23:22Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/35"
  },
  "node_id": "MDU6SXNzdWUyNTUwMzAyNDM=",
  "number": 51899,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "`delete pods` API call latencies shot up on large cluster tests",
  "updated_at": "2017-10-05T22:46:50Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/51899",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/4333971?v=4",
    "events_url": "https://api.github.com/users/shyamjvs/events{/privacy}",
    "followers_url": "https://api.github.com/users/shyamjvs/followers",
    "following_url": "https://api.github.com/users/shyamjvs/following{/other_user}",
    "gists_url": "https://api.github.com/users/shyamjvs/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/shyamjvs",
    "id": 4333971,
    "login": "shyamjvs",
    "node_id": "MDQ6VXNlcjQzMzM5NzE=",
    "organizations_url": "https://api.github.com/users/shyamjvs/orgs",
    "received_events_url": "https://api.github.com/users/shyamjvs/received_events",
    "repos_url": "https://api.github.com/users/shyamjvs/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/shyamjvs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shyamjvs/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/shyamjvs"
  }
}