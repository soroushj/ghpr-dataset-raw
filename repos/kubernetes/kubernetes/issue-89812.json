{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/235188?v=4",
    "events_url": "https://api.github.com/users/tedyu/events{/privacy}",
    "followers_url": "https://api.github.com/users/tedyu/followers",
    "following_url": "https://api.github.com/users/tedyu/following{/other_user}",
    "gists_url": "https://api.github.com/users/tedyu/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tedyu",
    "id": 235188,
    "login": "tedyu",
    "node_id": "MDQ6VXNlcjIzNTE4OA==",
    "organizations_url": "https://api.github.com/users/tedyu/orgs",
    "received_events_url": "https://api.github.com/users/tedyu/received_events",
    "repos_url": "https://api.github.com/users/tedyu/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tedyu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tedyu/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tedyu"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/235188?v=4",
      "events_url": "https://api.github.com/users/tedyu/events{/privacy}",
      "followers_url": "https://api.github.com/users/tedyu/followers",
      "following_url": "https://api.github.com/users/tedyu/following{/other_user}",
      "gists_url": "https://api.github.com/users/tedyu/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/tedyu",
      "id": 235188,
      "login": "tedyu",
      "node_id": "MDQ6VXNlcjIzNTE4OA==",
      "organizations_url": "https://api.github.com/users/tedyu/orgs",
      "received_events_url": "https://api.github.com/users/tedyu/received_events",
      "repos_url": "https://api.github.com/users/tedyu/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/tedyu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tedyu/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/tedyu"
    }
  ],
  "author_association": "NONE",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\nWhen joining a new control plane node with stacked `etcd`, while the local `etcd` server starts and joins the `etcd` cluster, `kube-apiserver` can't connect to it and panics:\r\n\r\n```\r\nFlag --insecure-port has been deprecated, This flag will be removed in a future version.\r\nI0403 08:27:40.218701       1 server.go:656] external host was not specified, using [redacted]\r\nI0403 08:27:40.219327       1 server.go:153] Version: v1.18.0\r\nI0403 08:27:41.143488       1 plugins.go:158] Loaded 12 mutating admission controller(s) successfully in the follo\r\nwing order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTo\r\nlerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,RuntimeClass,DefaultIngressClass,MutatingAdmissio\r\nnWebhook.\r\nI0403 08:27:41.143585       1 plugins.go:161] Loaded 10 validating admission controller(s) successfully in the fol\r\nlowing order: LimitRanger,ServiceAccount,Priority,PersistentVolumeClaimResize,RuntimeClass,CertificateApproval,Cer\r\ntificateSigning,CertificateSubjectRestriction,ValidatingAdmissionWebhook,ResourceQuota.\r\nI0403 08:27:41.144636       1 plugins.go:158] Loaded 12 mutating admission controller(s) successfully in the follo\r\nwing order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTo\r\nlerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,RuntimeClass,DefaultIngressClass,MutatingAdmissio\r\nnWebhook.\r\nI0403 08:27:41.144703       1 plugins.go:161] Loaded 10 validating admission controller(s) successfully in the fol\r\nlowing order: LimitRanger,ServiceAccount,Priority,PersistentVolumeClaimResize,RuntimeClass,CertificateApproval,Cer\r\ntificateSigning,CertificateSubjectRestriction,ValidatingAdmissionWebhook,ResourceQuota.\r\nI0403 08:27:41.149740       1 client.go:361] parsed scheme: \"endpoint\"\r\nI0403 08:27:41.149836       1 endpoint.go:68] ccResolverWrapper: sending new addresses to cc: [{https://127.0.0.1:\r\n2379  <nil> 0 <nil>}]\r\nW0403 08:27:41.150357       1 clientconn.go:1208] grpc: addrConn.createTransport failed to connect to {https://127\r\n.0.0.1:2379  <nil> 0 <nil>}. Err :connection error: desc = \"transport: Error while dialing dial tcp 127.0.0.1:2379\r\n: connect: connection refused\". Reconnecting...\r\nI0403 08:27:42.141845       1 client.go:361] parsed scheme: \"endpoint\"\r\nI0403 08:27:42.141909       1 endpoint.go:68] ccResolverWrapper: sending new addresses to cc: [{https://127.0.0.1:\r\n2379  <nil> 0 <nil>}]\r\nW0403 08:27:42.142281       1 clientconn.go:1208] grpc: addrConn.createTransport failed to connect to {https://127\r\n.0.0.1:2379  <nil> 0 <nil>}. Err :connection error: desc = \"transport: Error while dialing dial tcp 127.0.0.1:2379\r\n: connect: connection refused\". Reconnecting...\r\nW0403 08:27:42.150845       1 clientconn.go:1208] grpc: addrConn.createTransport failed to connect to {https://127\r\n.0.0.1:2379  <nil> 0 <nil>}. Err :connection error: desc = \"transport: Error while dialing dial tcp 127.0.0.1:2379\r\n: connect: connection refused\". Reconnecting...\r\n[...repeated multiple times...]\r\npanic: context deadline exceeded\r\n\r\ngoroutine 1 [running]:\r\nk8s.io/kubernetes/vendor/k8s.io/apiextensions-apiserver/pkg/registry/customresourcedefinition.NewREST(0xc000126e70, 0x50df5c0, 0xc000379320, 0xc0001c0c48)\r\n        /workspace/anago-v1.18.0-rc.1.21+8be33caaf953ac/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apiextensions-apiserver/pkg/registry/customresourcedefinition/etcd.go:56 +0x3e7\r\nk8s.io/kubernetes/vendor/k8s.io/apiextensions-apiserver/pkg/apiserver.completedConfig.New(0xc000d30fc0, 0xc00043eb88, 0x519de20, 0x773a7d8, 0x10, 0x0, 0x0)\r\n        /workspace/anago-v1.18.0-rc.1.21+8be33caaf953ac/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apiextensions-apiserver/pkg/apiserver/apiserver.go:145 +0x14ef\r\nk8s.io/kubernetes/cmd/kube-apiserver/app.createAPIExtensionsServer(0xc00043eb80, 0x519de20, 0x773a7d8, 0x0, 0x50df180, 0xc000c5fac0)\r\n        /workspace/anago-v1.18.0-rc.1.21+8be33caaf953ac/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/cmd/kube-apiserver/app/apiextensions.go:102 +0x59\r\nk8s.io/kubernetes/cmd/kube-apiserver/app.CreateServerChain(0xc0009e78c0, 0xc0000a6720, 0x4558d31, 0xc, 0xc000b57c48)\r\n        /workspace/anago-v1.18.0-rc.1.21+8be33caaf953ac/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/cmd/kube-apiserver/app/server.go:186 +0x2b8\r\nk8s.io/kubernetes/cmd/kube-apiserver/app.Run(0xc0009e78c0, 0xc0000a6720, 0x0, 0x0)\r\n        /workspace/anago-v1.18.0-rc.1.21+8be33caaf953ac/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/cmd/kube-apiserver/app/server.go:155 +0x101\r\nk8s.io/kubernetes/cmd/kube-apiserver/app.NewAPIServerCommand.func1(0xc000303180, 0xc0001d28c0, 0x0, 0x1b, 0x0, 0x0)\r\n        /workspace/anago-v1.18.0-rc.1.21+8be33caaf953ac/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/cmd/kube-apiserver/app/server.go:122 +0x104\r\nk8s.io/kubernetes/vendor/github.com/spf13/cobra.(*Command).execute(0xc000303180, 0xc0000ca010, 0x1b, 0x1b, 0xc000303180, 0xc0000ca010)\r\n        /workspace/anago-v1.18.0-rc.1.21+8be33caaf953ac/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/spf13/cobra/command.go:826 +0x460\r\nk8s.io/kubernetes/vendor/github.com/spf13/cobra.(*Command).ExecuteC(0xc000303180, 0x160241e295ac89d4, 0x771c600, 0xc000066750)\r\n        /workspace/anago-v1.18.0-rc.1.21+8be33caaf953ac/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/spf13/cobra/command.go:914 +0x2fb\r\nk8s.io/kubernetes/vendor/github.com/spf13/cobra.(*Command).Execute(...)\r\n        /workspace/anago-v1.18.0-rc.1.21+8be33caaf953ac/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/github.com/spf13/cobra/command.go:864\r\nmain.main()\r\n        _output/dockerized/go/src/k8s.io/kubernetes/cmd/kube-apiserver/apiserver.go:43 +0xcd\r\n```\r\n\r\n**What you expected to happen**:\r\nNot sure if this is a bug per se, because in the end the `kube-apiserver` static pod restarts and starts successfully after the `etcd` server joins the cluster, but that panic should probably be gracefully handled.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nJoin a new control plane node.\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): **1.18.0**\r\n- Cloud provider or hardware configuration: **Hetzner VPS**\r\n- OS (e.g: `cat /etc/os-release`): **Ubuntu 18.04.4 LTS**\r\n- Kernel (e.g. `uname -a`): **5.3.0-45-generic (Ubuntu's default HWE kernel)**\r\n- Install tools: **kubeadm**\r\n- Network plugin and version (if this is a network-related bug):\r\n- Others:\r\n",
  "closed_at": "2020-04-06T20:48:14Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/89812/comments",
  "created_at": "2020-04-03T08:47:48Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/89812/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/89812",
  "id": 593222996,
  "labels": [
    {
      "color": "c7def8",
      "default": false,
      "description": "Categorizes issue or PR as related to cleaning up code, process, or technical debt.",
      "id": 122775691,
      "name": "kind/cleanup",
      "node_id": "MDU6TGFiZWwxMjI3NzU2OTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/cleanup"
    },
    {
      "color": "fbca04",
      "default": false,
      "description": "Higher priority than priority/awaiting-more-evidence.",
      "id": 114528273,
      "name": "priority/backlog",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyNzM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/backlog"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG API Machinery.",
      "id": 173493835,
      "name": "sig/api-machinery",
      "node_id": "MDU6TGFiZWwxNzM0OTM4MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/api-machinery"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/89812/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1OTMyMjI5OTY=",
  "number": 89812,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kube-apiserver exits with panic instead of error if not able to connect to etcd",
  "updated_at": "2020-04-06T20:48:14Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/89812",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/2083930?v=4",
    "events_url": "https://api.github.com/users/lbogdan/events{/privacy}",
    "followers_url": "https://api.github.com/users/lbogdan/followers",
    "following_url": "https://api.github.com/users/lbogdan/following{/other_user}",
    "gists_url": "https://api.github.com/users/lbogdan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/lbogdan",
    "id": 2083930,
    "login": "lbogdan",
    "node_id": "MDQ6VXNlcjIwODM5MzA=",
    "organizations_url": "https://api.github.com/users/lbogdan/orgs",
    "received_events_url": "https://api.github.com/users/lbogdan/received_events",
    "repos_url": "https://api.github.com/users/lbogdan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/lbogdan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lbogdan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/lbogdan"
  }
}