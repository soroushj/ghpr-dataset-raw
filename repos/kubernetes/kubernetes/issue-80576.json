{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\nscheduler doesn't assign pod because 'not enough resource: hugepages-1Gi',but the node info show it has enough resource.\r\n```\r\n[root@worker-04 ~]# kubectl get pod |grep p-storage\r\np-storage                            0/1     OutOfhugepages-1Gi   0          31m\r\n[root@worker-04 ~]# kubectl describe pod p-storage |grep -A 5 Events\r\nEvents:\r\n  Type     Reason                 Age   From                Message\r\n  ----     ------                 ----  ----                -------\r\n  Warning  OutOfhugepages-1Gi     31m   kubelet, worker-04  Node didn't have enough resource: hugepages-1Gi, requested: 34359738368, used: 17179869184, capacity: 38654705664\r\n  Normal   SuccessfulMountVolume  31m   kubelet, worker-04  MapVolume.MapDevice succeeded for volume \"worker-04-block-vdd-pvc\" globalMapPath \"/var/lib/kubelet/plugins/kubernetes.io~local-volume/volumeDevices/worker-04-block-vdd-pvc\"\r\n  Normal   SuccessfulMountVolume  31m   kubelet, worker-04  MapVolume.MapDevice succeeded for volume \"worker-04-block-vdd-pvc\" volumeMapPath \"/var/lib/kubelet/pods/336f64a1-aed1-11e9-84ef-00163e08718b/volumeDevices/kubernetes.io~local-volume\"\r\n```\r\ndescribe node \r\n```\r\n[root@worker-04 ~]# kubectl describe node worker-04|grep -A 20 Capacity\r\nCapacity:\r\n cpu:                            12\r\n devices.kubevirt.io/kvm:        110\r\n devices.kubevirt.io/tun:        110\r\n devices.kubevirt.io/vhost-net:  110\r\n ephemeral-storage:              41147472Ki\r\n hugepages-1Gi:                  36Gi\r\n memory:                         49293224Ki\r\n pods:                           250\r\nAllocatable:\r\n cpu:                            10\r\n devices.kubevirt.io/kvm:        0\r\n devices.kubevirt.io/tun:        110\r\n devices.kubevirt.io/vhost-net:  110\r\n ephemeral-storage:              37921510133\r\n hugepages-1Gi:                  36Gi\r\n memory:                         9488963Ki\r\n pods:                           250\r\nSystem Info:\r\n Machine ID:                 311936e2303b034fe7ef70182235b8cb\r\n System UUID:                47DFA8EC-03AA-4643-99F2-E89A628B6412\r\n```\r\n**What you expected to happen**:\r\nthe pod was in normal status like pending and running\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n**Anything else we need to know?**:\r\nIt was change default hugepage size to 1Gi and hugepages=36\r\n```\r\n[root@worker-04 ~]# cat /etc/default/grub\r\nGRUB_TIMEOUT=1\r\nGRUB_DISTRIBUTOR=\"$(sed 's, release .*$,,g' /etc/system-release)\"\r\nGRUB_DEFAULT=saved\r\nGRUB_DISABLE_SUBMENU=true\r\nGRUB_TERMINAL_OUTPUT=\"console\"\r\nGRUB_CMDLINE_LINUX=\"crashkernel=auto default_hugepagesz=1GB hugepagesz=1G hugepages=36 rhgb quiet idle=halt biosdevname=0 net.ifnames=0 console=tty0 console=ttyS0,115200n8 noibrs\"\r\nGRUB_DISABLE_RECOVERY=\"true\"\r\n``` \r\nnumastat was show there has enough hugepage\r\n```\r\n[root@worker-04 ~]# numastat -m\r\n\r\nPer-node system memory usage (in MBs):\r\n                          Node 0           Total\r\n                 --------------- ---------------\r\nMemTotal                49151.45        49151.45\r\nMemFree                  8492.67         8492.67\r\nMemUsed                 40658.77        40658.77\r\nActive                   1319.52         1319.52\r\nInactive                  890.01          890.01\r\nActive(anon)              688.30          688.30\r\nInactive(anon)              1.24            1.24\r\nActive(file)              631.22          631.22\r\nInactive(file)            888.77          888.77\r\nUnevictable                13.59           13.59\r\nMlocked                    13.59           13.59\r\nDirty                       0.84            0.84\r\nWriteback                   0.00            0.00\r\nFilePages                1526.27         1526.27\r\nMapped                    269.54          269.54\r\nAnonPages                 696.90          696.90\r\nShmem                       2.30            2.30\r\nKernelStack                24.19           24.19\r\nPageTables                 15.88           15.88\r\nNFS_Unstable                0.00            0.00\r\nBounce                      0.00            0.00\r\nWritebackTmp                0.00            0.00\r\nSlab                      144.80          144.80\r\nSReclaimable               73.74           73.74\r\nSUnreclaim                 71.06           71.06\r\nAnonHugePages             350.00          350.00\r\nHugePages_Total         36864.00        36864.00\r\nHugePages_Free          36864.00        36864.00\r\nHugePages_Surp              0.00            0.00\r\n```\r\nalso proc/meminfo was show there has enough resource\r\n```\r\n[root@worker-04 ~]# cat /proc/meminfo\r\nMemTotal:       49293224 kB\r\nMemFree:         8692084 kB\r\nMemAvailable:   10052464 kB\r\nBuffers:           92288 kB\r\nCached:          1472256 kB\r\nSwapCached:            0 kB\r\nActive:          1354460 kB\r\nInactive:         911680 kB\r\nActive(anon):     706752 kB\r\nInactive(anon):     1272 kB\r\nActive(file):     647708 kB\r\nInactive(file):   910408 kB\r\nUnevictable:       13912 kB\r\nMlocked:           13912 kB\r\nSwapTotal:             0 kB\r\nSwapFree:              0 kB\r\nDirty:               444 kB\r\nWriteback:             0 kB\r\nAnonPages:        715644 kB\r\nMapped:           276640 kB\r\nShmem:              2352 kB\r\nSlab:             148256 kB\r\nSReclaimable:      75352 kB\r\nSUnreclaim:        72904 kB\r\nKernelStack:       24704 kB\r\nPageTables:        16172 kB\r\nNFS_Unstable:          0 kB\r\nBounce:                0 kB\r\nWritebackTmp:          0 kB\r\nCommitLimit:     5772244 kB\r\nCommitted_AS:    8341908 kB\r\nVmallocTotal:   34359738367 kB\r\nVmallocUsed:      121572 kB\r\nVmallocChunk:   34359517224 kB\r\nHardwareCorrupted:     0 kB\r\nAnonHugePages:    360448 kB\r\nCmaTotal:              0 kB\r\nCmaFree:               0 kB\r\nHugePages_Total:      36\r\nHugePages_Free:       36\r\nHugePages_Rsvd:        0\r\nHugePages_Surp:        0\r\nHugepagesize:    1048576 kB\r\nDirectMap4k:      251728 kB\r\nDirectMap2M:     9185280 kB\r\nDirectMap1G:    42991616 kB\r\n```\r\nother info\r\n```\r\n[root@worker-04 ~]# cat /sys/kernel/mm/hugepages/hugepages-*/nr_hugepages\r\n36\r\n[root@worker-04 ~]# ls /sys/kernel/mm/hugepages\r\nhugepages-1048576kB\r\n```\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n```\r\n[root@worker-04 ~]# kubectl version\r\nClient Version: version.Info{Major:\"1\", Minor:\"14\", GitVersion:\"v1.14.0\", GitCommit:\"641856db18352033a0d96dbc99153fa3b27298e5\", GitTreeState:\"clean\", BuildDate:\"2019-03-25T15:53:57Z\", GoVersion:\"go1.12.1\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"14\", GitVersion:\"v1.14.3\", GitCommit:\"5e53fd6bc17c0dec8434817e69b04a25d8ae0ff0\", GitTreeState:\"clean\", BuildDate:\"2019-06-06T01:36:19Z\", GoVersion:\"go1.12.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n- Cloud provider or hardware configuration:\r\n```\r\naliyun\r\n```\r\n- OS (e.g: `cat /etc/os-release`):\r\n```\r\n[root@worker-04 ~]# cat /etc/os-release\r\nNAME=\"CentOS Linux\"\r\nVERSION=\"7 (Core)\"\r\nID=\"centos\"\r\nID_LIKE=\"rhel fedora\"\r\nVERSION_ID=\"7\"\r\nPRETTY_NAME=\"CentOS Linux 7 (Core)\"\r\nANSI_COLOR=\"0;31\"\r\nCPE_NAME=\"cpe:/o:centos:centos:7\"\r\nHOME_URL=\"https://www.centos.org/\"\r\nBUG_REPORT_URL=\"https://bugs.centos.org/\"\r\n\r\nCENTOS_MANTISBT_PROJECT=\"CentOS-7\"\r\nCENTOS_MANTISBT_PROJECT_VERSION=\"7\"\r\nREDHAT_SUPPORT_PRODUCT=\"centos\"\r\nREDHAT_SUPPORT_PRODUCT_VERSION=\"7\"\r\n```\r\n- Kernel (e.g. `uname -a`):\r\n```\r\n[root@worker-04 ~]# uname -a\r\nLinux worker-04 3.10.0-957.21.3.el7.x86_64 #1 SMP Tue Jun 18 16:35:19 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n- Install tools:\r\n```\r\nrancher rke\r\n```\r\n- Network plugin and version (if this is a network-related bug):\r\n```\r\ncanal\r\n```\r\n- Others:\r\n",
  "closed_at": "2019-07-25T14:39:15Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/18078924?v=4",
    "events_url": "https://api.github.com/users/DeepLJH0001/events{/privacy}",
    "followers_url": "https://api.github.com/users/DeepLJH0001/followers",
    "following_url": "https://api.github.com/users/DeepLJH0001/following{/other_user}",
    "gists_url": "https://api.github.com/users/DeepLJH0001/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/DeepLJH0001",
    "id": 18078924,
    "login": "DeepLJH0001",
    "node_id": "MDQ6VXNlcjE4MDc4OTI0",
    "organizations_url": "https://api.github.com/users/DeepLJH0001/orgs",
    "received_events_url": "https://api.github.com/users/DeepLJH0001/received_events",
    "repos_url": "https://api.github.com/users/DeepLJH0001/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/DeepLJH0001/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DeepLJH0001/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/DeepLJH0001"
  },
  "comments": 6,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80576/comments",
  "created_at": "2019-07-25T12:21:51Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80576/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/80576",
  "id": 472834381,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80576/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NzI4MzQzODE=",
  "number": 80576,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Scheduler doesn't assign pod because 'not enough resource: hugepages-1Gi',but the node info show it has enough resource.",
  "updated_at": "2019-07-25T14:44:10Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/80576",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/18078924?v=4",
    "events_url": "https://api.github.com/users/DeepLJH0001/events{/privacy}",
    "followers_url": "https://api.github.com/users/DeepLJH0001/followers",
    "following_url": "https://api.github.com/users/DeepLJH0001/following{/other_user}",
    "gists_url": "https://api.github.com/users/DeepLJH0001/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/DeepLJH0001",
    "id": 18078924,
    "login": "DeepLJH0001",
    "node_id": "MDQ6VXNlcjE4MDc4OTI0",
    "organizations_url": "https://api.github.com/users/DeepLJH0001/orgs",
    "received_events_url": "https://api.github.com/users/DeepLJH0001/received_events",
    "repos_url": "https://api.github.com/users/DeepLJH0001/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/DeepLJH0001/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DeepLJH0001/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/DeepLJH0001"
  }
}