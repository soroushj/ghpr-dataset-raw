{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4178417?v=4",
    "events_url": "https://api.github.com/users/andyzhangx/events{/privacy}",
    "followers_url": "https://api.github.com/users/andyzhangx/followers",
    "following_url": "https://api.github.com/users/andyzhangx/following{/other_user}",
    "gists_url": "https://api.github.com/users/andyzhangx/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/andyzhangx",
    "id": 4178417,
    "login": "andyzhangx",
    "node_id": "MDQ6VXNlcjQxNzg0MTc=",
    "organizations_url": "https://api.github.com/users/andyzhangx/orgs",
    "received_events_url": "https://api.github.com/users/andyzhangx/received_events",
    "repos_url": "https://api.github.com/users/andyzhangx/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/andyzhangx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/andyzhangx/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/andyzhangx"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/4178417?v=4",
      "events_url": "https://api.github.com/users/andyzhangx/events{/privacy}",
      "followers_url": "https://api.github.com/users/andyzhangx/followers",
      "following_url": "https://api.github.com/users/andyzhangx/following{/other_user}",
      "gists_url": "https://api.github.com/users/andyzhangx/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/andyzhangx",
      "id": 4178417,
      "login": "andyzhangx",
      "node_id": "MDQ6VXNlcjQxNzg0MTc=",
      "organizations_url": "https://api.github.com/users/andyzhangx/orgs",
      "received_events_url": "https://api.github.com/users/andyzhangx/received_events",
      "repos_url": "https://api.github.com/users/andyzhangx/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/andyzhangx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andyzhangx/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/andyzhangx"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**What happened**:\r\n\r\nAfter running a rolling-update on a StatefulSet that uses Azure Disks, part of the replicas remain in a `ContainerCreating` state _forever_, exhibiting the following events:\r\n\r\n```\r\nEvents:\r\n  Type     Reason                  Age                From                                           Message\r\n  ----     ------                  ----               ----                                           -------\r\n  Warning  FailedMount             34m (x92 over 4h)  kubelet, k8s-xyz-123-vmss000001  Unable to mount volumes for pod \"solr-0_default(e81d49a2-ee1f-11e8-9bb4-000d3a43da60)\": timeout expired waiting for volumes to attach or mount for pod \"default\"/\"solr-0\". list of unmounted volumes=[solrhome]. list of unattached volumes=[solrhome]\r\n```\r\n\r\nRestarting the `controller-manager` occasionally unblocks the situation:\r\n\r\n```\r\nI1122 10:30:51.712314       1 reconciler.go:281] attacherDetacher.AttachVolume started for volume \"pvc-xyz-123\" (UniqueName: \"kubernetes.io/azure-disk//subscriptions/78f9affd-62e8-4720-a4c2-d433dbfdefe8/resourceGroups/cn1vqys6-refparts25-d1/providers/Microsoft.Compute/disks/k8s-mstr-xyz-123-ku-pv-xyz-123\") from node \"k8s-xyz-123\" \r\nI1122 10:30:52.135191       1 operation_generator.go:332] AttachVolume.Attach succeeded for volume \"pvc-xyz-123\" (UniqueName: \"kubernetes.io/azure-disk//subscriptions/78f9affd-62e8-4720-a4c2-d433dbfdefe8/resourceGroups/cn1vqys6-refparts25-d1/providers/Microsoft.Compute/disks/k8s-mstr-xyz-123-ku-pvc-xyz-123\") from node \"k8s-xyz-123\"\r\nI1122 10:30:52.135517       1 event.go:218] Event(v1.ObjectReference{Kind:\"Pod\", Namespace:\"default\", Name:\"solr-0\", UID:\"e81d49a2-ee1f-11e8-9bb4-000d3a43da60\", APIVersion:\"v1\", ResourceVersion:\"2949400\", FieldPath:\"\"}): type: 'Normal' reason: 'SuccessfulAttachVolume' AttachVolume.Attach succeeded for volume \"pvc-xyz-123\"\r\n```\r\n\r\n**What you expected to happen**:\r\n\r\nAttach/detach operations succeed consistently.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nHere is a copy of the manifest of the affected StatefulSet:\r\n\r\n<details>\r\n<summary>solr-sts.yaml</summary>\r\n\r\n```yaml\r\napiVersion: apps/v1\r\nkind: StatefulSet\r\nmetadata:\r\n  creationTimestamp: 2018-11-05T16:08:37Z\r\n  generation: 13\r\n  labels:\r\n    app.kubernetes.io/component: search\r\n    app.kubernetes.io/name: solr\r\n  name: solr\r\n  namespace: default\r\n  resourceVersion: \"2981863\"\r\n  selfLink: /apis/apps/v1/namespaces/default/statefulsets/solr\r\n  uid: 0ddfec77-e115-11e8-b645-000d3a43da60\r\nspec:\r\n  podManagementPolicy: Parallel\r\n  replicas: 2\r\n  revisionHistoryLimit: 10\r\n  selector:\r\n    matchLabels:\r\n      app.kubernetes.io/component: search\r\n      app.kubernetes.io/name: solr\r\n  serviceName: solr\r\n  template:\r\n    metadata:\r\n      creationTimestamp: null\r\n      labels:\r\n        app.kubernetes.io/component: search\r\n        app.kubernetes.io/name: solr\r\n    spec:\r\n      containers:\r\n      - image: solr\r\n        imagePullPolicy: IfNotPresent\r\n        name: solr\r\n        ports:\r\n        - containerPort: 8983\r\n          name: http\r\n          protocol: TCP\r\n        resources:\r\n          requests:\r\n            cpu: \"1\"\r\n            memory: 1Gi\r\n        terminationMessagePath: /dev/termination-log\r\n        terminationMessagePolicy: File\r\n        volumeMounts:\r\n        - mountPath: /var/solr\r\n          name: solrhome\r\n      dnsPolicy: ClusterFirst\r\n      restartPolicy: Always\r\n      schedulerName: default-scheduler\r\n      terminationGracePeriodSeconds: 30\r\n  updateStrategy:\r\n    type: RollingUpdate\r\n  volumeClaimTemplates:\r\n  - metadata:\r\n      creationTimestamp: null\r\n      name: solrhome\r\n    spec:\r\n      accessModes:\r\n      - ReadWriteOnce\r\n      resources:\r\n        requests:\r\n          storage: 5Gi\r\n    status:\r\n      phase: Pending\r\nstatus:\r\n  collisionCount: 0\r\n  currentReplicas: 2\r\n  currentRevision: solr-74d956b6d8\r\n  observedGeneration: 13\r\n  readyReplicas: 2\r\n  replicas: 2\r\n  updateRevision: solr-74d956b6d8\r\n```\r\n\r\n</details></br>\r\n\r\nAnd the default StorageClass:\r\n\r\n<details>\r\n<summary>sc.yaml</summary>\r\n\r\n```yaml\r\napiVersion: storage.k8s.io/v1\r\nkind: StorageClass\r\nmetadata:\r\n  annotations:\r\n    kubectl.kubernetes.io/last-applied-configuration: |\r\n      {\"apiVersion\":\"storage.k8s.io/v1beta1\",\"kind\":\"StorageClass\",\"metadata\":{\"annotations\":{\"storageclass.beta.kubernetes.io/is-default-class\":\"true\"},\"labels\":{\"kubernetes.io/cluster-service\":\"true\"},\"name\":\"default\",\"namespace\":\"\"},\"parameters\":{\"cachingmode\":\"None\",\"kind\":\"Managed\",\"storageaccounttype\":\"Standard_LRS\"},\"provisioner\":\"kubernetes.io/azure-disk\"}\r\n    storageclass.beta.kubernetes.io/is-default-class: \"true\"\r\n  creationTimestamp: 2018-11-05T14:58:55Z\r\n  labels:\r\n    kubernetes.io/cluster-service: \"true\"\r\n  name: default\r\n  resourceVersion: \"265\"\r\n  selfLink: /apis/storage.k8s.io/v1/storageclasses/default\r\n  uid: 51307313-e10b-11e8-b9f3-000d3a43da60\r\nparameters:\r\n  cachingmode: None\r\n  kind: Managed\r\n  storageaccounttype: Standard_LRS\r\nprovisioner: kubernetes.io/azure-disk\r\nreclaimPolicy: Delete\r\nvolumeBindingMode: Immediate\r\n```\r\n\r\n</details></br>\r\n\r\n**Extra information:**\r\n\r\n* Two other kind of Pod events that are regularly associated with the error above:\r\n\r\n```\r\n  Disk '/subscriptions/xyz-123/resourceGroups/mycluster/providers/Microsoft.Compute/disks/k8s-mstr-mycluster-kub--pvc-xyz-123' cannot be attached as the disk is already owned by VM '/subscriptions/xyz-123/resourceGroups/mycluster/providers/Microsoft.Compute/virtualMachineScaleSets/k8s-myscaleset2-vmss/virtualMachines/k8s-myscaleset2-vmss_1'.\r\n```\r\n\r\n```\r\n  Warning  FailedMount             7m (x72 over 2h)   kubelet, k8s-mycluster-vmss00000x  MountVolume.WaitForAttach failed for volume \"pvc-xyz-123\" : azureDisk - WaitForAttach failed within timeout node (k8s-mycluster-vmss00000x) diskId:(mycluster-kub-pvc-xyz-123) lun:(2)\r\n```\r\n\r\n* kubelet logs of a node where attaching the volume is failing\r\n\r\n\ud83d\uddd2 [kubelet.log](https://github.com/kubernetes/kubernetes/files/2607870/kubelet.log)\r\n\r\n* kube-controller-manager logs in an environment where attaching the volume is failing\r\n\r\n\ud83d\uddd2 [kube-controller-manager.log](https://github.com/kubernetes/kubernetes/files/2608040/kube-controller-manager.log)\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): v1.10.10\r\n- Cloud provider or hardware configuration: Azure (westeurope)\r\n- OS (e.g. from /etc/os-release): 16.04.4 LTS\r\n- Kernel (e.g. `uname -a`): 4.13.0-1018-azure\r\n- Install tools: ACS-Engine\r\n- Others:\r\n\r\n/kind bug\r\n/sig storage\r\n/sig azure\r\n\r\n@andyzhangx @khenidak this might be of interest for you, since you were involved in #70002, which was supposed to fix attach/detach issues in Azure.",
  "closed_at": "2018-11-23T16:18:12Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 11,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71344/comments",
  "created_at": "2018-11-22T11:04:18Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71344/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/71344",
  "id": 383485493,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Storage.",
      "id": 169428334,
      "name": "sig/storage",
      "node_id": "MDU6TGFiZWwxNjk0MjgzMzQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/storage"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71344/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzODM0ODU0OTM=",
  "number": 71344,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Azure Disks volume attach still times out on Kubernetes 1.10",
  "updated_at": "2018-11-28T10:17:26Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/71344",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/3299086?v=4",
    "events_url": "https://api.github.com/users/antoineco/events{/privacy}",
    "followers_url": "https://api.github.com/users/antoineco/followers",
    "following_url": "https://api.github.com/users/antoineco/following{/other_user}",
    "gists_url": "https://api.github.com/users/antoineco/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/antoineco",
    "id": 3299086,
    "login": "antoineco",
    "node_id": "MDQ6VXNlcjMyOTkwODY=",
    "organizations_url": "https://api.github.com/users/antoineco/orgs",
    "received_events_url": "https://api.github.com/users/antoineco/received_events",
    "repos_url": "https://api.github.com/users/antoineco/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/antoineco/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/antoineco/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/antoineco"
  }
}