{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "Currently, kubelet mounts hosts file for [non-hostNetwork](https://github.com/kubernetes/kubernetes/blob/48b3fb84abdc0fee12299eed262da287d48110de/pkg/kubelet/kubelet_pods.go#L112-L118) pods. For hostNetwork pods, the behavior is different and instead, kubelet relies on docker (or whatever container runtime) to [mount](\r\nhttps://github.com/kubernetes/kubernetes/issues/43632#issuecomment-304376441) the host's hosts file.\r\n\r\nWe should have kubelet handle hosts file for hostNetwork pods. This would have several benefits:\r\n\r\n1. better control over hosts file in case the container runtime does something [unexpected](https://github.com/moby/moby/issues/17190)\r\n2. more consistent behavior between hostNetwork and non-hostNetwork pods\r\n3. ensure consistent behavior between different container runtimes\r\n4. kubelet-managed hosts file enables features like [HostAliases](https://github.com/kubernetes/kubernetes/pull/45148) to be used for hostNetwork pods\r\n\r\nImplementation would require:\r\n1. make kubelet's [hostsFileContent](https://github.com/kubernetes/kubernetes/blob/48b3fb84abdc0fee12299eed262da287d48110de/pkg/kubelet/kubelet_pods.go#L233) or its caller output different content based on hostNetwork.\r\n  i. If it's not hostNetwork, use existing behavior.\r\n  ii. If it's using hostNetwork, read the content from the host's hosts file.\r\n2. remove hostNetwork constraint in deciding whether to mount the file\r\n\r\nOpen Questions:\r\n1. how do we treat changes to the host's hosts file? should the file's content be static between container restarts of the same Pod? or should every container restart pick up the latest content of the hosts file? the former seems better for consistency, but letter might be more in line with other features that use host resources like host volumes.\r\n2. the condition to manage hosts file also excludes windows even though windows also [support](https://support.rackspace.com/how-to/modify-your-hosts-file/) the use of hosts file and the same format. seems like this should be supported also.\r\n3. before windows-support ships, should it have validation against windows platform? the tricky bit is the client, API, and minions' kubelet may be running on different platforms, and currently, there's no precedence to platform validation.\r\n\r\n/kind feature\r\n/sig node\r\n\r\n@yujuhong @hongchaodeng @thockin",
  "closed_at": "2017-08-14T19:15:05Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/48397/comments",
  "created_at": "2017-07-02T12:00:44Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/48397/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/48397",
  "id": 240006184,
  "labels": [
    {
      "color": "c7def8",
      "default": false,
      "description": "Categorizes issue or PR as related to a new feature.",
      "id": 267761362,
      "name": "kind/feature",
      "node_id": "MDU6TGFiZWwyNjc3NjEzNjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/feature"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/48397/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:23:28Z",
    "closed_issues": 1061,
    "created_at": "2017-05-26T17:18:43Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/169553?v=4",
      "events_url": "https://api.github.com/users/timothysc/events{/privacy}",
      "followers_url": "https://api.github.com/users/timothysc/followers",
      "following_url": "https://api.github.com/users/timothysc/following{/other_user}",
      "gists_url": "https://api.github.com/users/timothysc/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/timothysc",
      "id": 169553,
      "login": "timothysc",
      "node_id": "MDQ6VXNlcjE2OTU1Mw==",
      "organizations_url": "https://api.github.com/users/timothysc/orgs",
      "received_events_url": "https://api.github.com/users/timothysc/received_events",
      "repos_url": "https://api.github.com/users/timothysc/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/timothysc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/timothysc/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/timothysc"
    },
    "description": "",
    "due_on": "2017-09-27T07:00:00Z",
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/36",
    "id": 2545392,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/36/labels",
    "node_id": "MDk6TWlsZXN0b25lMjU0NTM5Mg==",
    "number": 36,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.8",
    "updated_at": "2019-08-26T17:23:28Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/36"
  },
  "node_id": "MDU6SXNzdWUyNDAwMDYxODQ=",
  "number": 48397,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Kubelet should manage hosts file for HostNetwork Pods instead of Docker",
  "updated_at": "2017-08-14T19:15:05Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/48397",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1469579?v=4",
    "events_url": "https://api.github.com/users/rickypai/events{/privacy}",
    "followers_url": "https://api.github.com/users/rickypai/followers",
    "following_url": "https://api.github.com/users/rickypai/following{/other_user}",
    "gists_url": "https://api.github.com/users/rickypai/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/rickypai",
    "id": 1469579,
    "login": "rickypai",
    "node_id": "MDQ6VXNlcjE0Njk1Nzk=",
    "organizations_url": "https://api.github.com/users/rickypai/orgs",
    "received_events_url": "https://api.github.com/users/rickypai/received_events",
    "repos_url": "https://api.github.com/users/rickypai/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/rickypai/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rickypai/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/rickypai"
  }
}