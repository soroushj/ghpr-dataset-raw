{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/676637?v=4",
    "events_url": "https://api.github.com/users/feiskyer/events{/privacy}",
    "followers_url": "https://api.github.com/users/feiskyer/followers",
    "following_url": "https://api.github.com/users/feiskyer/following{/other_user}",
    "gists_url": "https://api.github.com/users/feiskyer/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/feiskyer",
    "id": 676637,
    "login": "feiskyer",
    "node_id": "MDQ6VXNlcjY3NjYzNw==",
    "organizations_url": "https://api.github.com/users/feiskyer/orgs",
    "received_events_url": "https://api.github.com/users/feiskyer/received_events",
    "repos_url": "https://api.github.com/users/feiskyer/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/feiskyer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/feiskyer/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/feiskyer"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/676637?v=4",
      "events_url": "https://api.github.com/users/feiskyer/events{/privacy}",
      "followers_url": "https://api.github.com/users/feiskyer/followers",
      "following_url": "https://api.github.com/users/feiskyer/following{/other_user}",
      "gists_url": "https://api.github.com/users/feiskyer/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/feiskyer",
      "id": 676637,
      "login": "feiskyer",
      "node_id": "MDQ6VXNlcjY3NjYzNw==",
      "organizations_url": "https://api.github.com/users/feiskyer/orgs",
      "received_events_url": "https://api.github.com/users/feiskyer/received_events",
      "repos_url": "https://api.github.com/users/feiskyer/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/feiskyer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/feiskyer/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/feiskyer"
    }
  ],
  "author_association": "MEMBER",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!-->\r\n\r\n**What happened**:\r\n\r\nWhen something unexpected happened (e.g. hitting Azure API throttling) , Azure cloud provider would retry with a configurable exponential backoff.  While this seems work for processing various unexpected errors, it's actually sending too much requests to Azure API.\r\n\r\nThe reason is Azure Go SDK also includes an internal backoff, e.g. [here](https://github.com/Azure/go-autorest/blob/master/autorest/azure/rp.go#L28) and [here](https://github.com/Azure/go-autorest/blob/master/autorest/azure/async.go#L184). The SDK would retry 3 attempts for compute APIs and 5 attempts for storage APIs when following HTTP response are got:\r\n\r\n- http.StatusRequestTimeout,      // 408\r\n\r\n- http.StatusTooManyRequests,     // 429\r\n- http.StatusInternalServerError, // 500\r\n- http.StatusBadGateway,          // 502\r\n- http.StatusServiceUnavailable,  // 503\r\n- http.StatusGatewayTimeout,      // 504\r\n\r\nThat means every failed `AttachDisk` operation would invoke `(1+6)*3 = 21` API calls (suppose cloudProviderBackoffRetries is set 6 in cloud config).\r\n\r\nWe should really avoid those two-layer backoff retries by \r\n\r\n- (1) either disable SDK's backoff and only keep cloud provider's backoff retry\r\n- (2) or, remove cloud provider's backoff and only use SDK's backoff instead\r\n\r\nAccording to [Throttling Resource Manager requests](https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-request-limits#waiting-before-sending-next-request), when the request limits are reached, clients should honor **Retry-After** value in the response header:\r\n\r\n> When you reach the request limit, Resource Manager returns the **429** HTTP status code and a **Retry-After** value in the header. The **Retry-After** value specifies the number of seconds your application should wait (or sleep) before sending the next request. If you send a request before the retry value has elapsed, your request isn't processed and a new retry value is returned.\r\n\r\nSince this header has already been handled within SDK's backoff retries, (2) is our preferred way to reduce the API calls.\r\n\r\n**What you expected to happen**:\r\n\r\n\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n\r\n- Kubernetes version (use `kubectl version`):\r\n- Cloud provider or hardware configuration: Azure\r\n- OS (e.g. from /etc/os-release):\r\n- Kernel (e.g. `uname -a`):\r\n- Install tools:\r\n- Others:\r\n\r\n<!-- DO NOT EDIT BELOW THIS LINE -->\r\n/kind bug\r\n/sig azure\r\n/assign",
  "closed_at": "2018-12-21T03:24:15Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/70865/comments",
  "created_at": "2018-11-09T12:34:50Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/70865/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/70865",
  "id": 379144951,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/70865/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNzkxNDQ5NTE=",
  "number": 70865,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Azure cloud provider is retrying too aggressive",
  "updated_at": "2018-12-21T03:24:15Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/70865",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/676637?v=4",
    "events_url": "https://api.github.com/users/feiskyer/events{/privacy}",
    "followers_url": "https://api.github.com/users/feiskyer/followers",
    "following_url": "https://api.github.com/users/feiskyer/following{/other_user}",
    "gists_url": "https://api.github.com/users/feiskyer/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/feiskyer",
    "id": 676637,
    "login": "feiskyer",
    "node_id": "MDQ6VXNlcjY3NjYzNw==",
    "organizations_url": "https://api.github.com/users/feiskyer/orgs",
    "received_events_url": "https://api.github.com/users/feiskyer/received_events",
    "repos_url": "https://api.github.com/users/feiskyer/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/feiskyer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/feiskyer/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/feiskyer"
  }
}