{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n\r\n**What keywords did you search in Kubernetes issues before filing this one?** (If you have found any duplicates, you should instead reply there.):\r\n\r\n- failed to get node address from cloud provider that matches ip\r\n- aws cloud provider multiple ip \r\n\r\n---\r\n\r\n**Kubernetes version**\r\n1.5.2\r\n\r\n**Feature Request**\r\n\r\nHi, I am trying configure a cluster on AWS where my kubelets are running on EC2 instances with multiple interfaces.\r\n\r\nI want to force the kubelets to report a specific IP so I am using the `node-ip` flag when starting my kubelets. For example, on a node with 2 interfaces `eth0: IP0` and `eth1: IP1`, I set my kubelet `node-ip: IP1`. I would expect my kubelet to come up but instead, I get:\r\n\r\n```\r\nfailed to get node address from cloud provider that matches ip: <IP1>\r\n```\r\n\r\nrunning `aws ec2 describe-instances ...` shows me that the `PrivateIP` field on the instance object is actually `IP0` but the instance has multiple active network interfaces and `IP1` is present in one of the interfaces.\r\n\r\nDigging through the code, it looks like the `node status` reporting already handle multiple ip addresses correctly so this seems enhancement in this file: https://github.com/kubernetes/kubernetes/blob/master/pkg/cloudprovider/providers/aws/aws.go#L963\r\n\r\nThere is already a TODO for supporting multiple IP addresses, would it be a reasonable change to iterate through the `network interfaces` returned on the `instance` and report additional active interfaces?\r\n\r\n```\r\n          \"NetworkInterfaces\": [\r\n                        {\r\n                            \"Status\": \"in-use\",\r\n                            \"MacAddress\": \"redacted\",\r\n                            \"SourceDestCheck\": true,\r\n                            \"VpcId\": \"redacted\",\r\n                            \"Description\": \"\",\r\n                            \"NetworkInterfaceId\": \"redacted\",\r\n                            \"PrivateIpAddresses\": [\r\n                                {\r\n                                    \"PrivateDnsName\": \"ip-10-0-15-49.ec2.internal\",\r\n                                    \"Primary\": true,\r\n                                    \"PrivateIpAddress\": \"10.0.15.49\"\r\n                                }\r\n                            ],\r\n                            \"PrivateDnsName\": \"ip-10-0-15-49.ec2.internal\",\r\n                            \"Attachment\": {\r\n                                \"Status\": \"attached\",\r\n                                \"DeviceIndex\": 0,\r\n                                \"DeleteOnTermination\": true,\r\n                                \"AttachmentId\": \"redacted\",\r\n                                \"AttachTime\": \"2017-04-19T19:26:13.000Z\"\r\n                            },\r\n                            \"Groups\": [\r\n                                {\r\n                                    \"GroupName\": \"k8s-master\",\r\n                                    \"GroupId\": \"redacted\"\r\n                                }\r\n                            ],\r\n                            \"SubnetId\": \"redacted\",\r\n                            \"OwnerId\": \"redacted\",\r\n                            \"PrivateIpAddress\": \"10.0.15.49\"\r\n                        },\r\n...\r\n```\r\n\r\n",
  "closed_at": "2017-09-03T06:50:03Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44686/comments",
  "created_at": "2017-04-19T20:43:14Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44686/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/44686",
  "id": 222865594,
  "labels": [
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44686/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMjI4NjU1OTQ=",
  "number": 44686,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "handle multiple internal IPs from aws cloud provider",
  "updated_at": "2017-09-03T06:50:03Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/44686",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1727691?v=4",
    "events_url": "https://api.github.com/users/jlzhao27/events{/privacy}",
    "followers_url": "https://api.github.com/users/jlzhao27/followers",
    "following_url": "https://api.github.com/users/jlzhao27/following{/other_user}",
    "gists_url": "https://api.github.com/users/jlzhao27/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jlzhao27",
    "id": 1727691,
    "login": "jlzhao27",
    "node_id": "MDQ6VXNlcjE3Mjc2OTE=",
    "organizations_url": "https://api.github.com/users/jlzhao27/orgs",
    "received_events_url": "https://api.github.com/users/jlzhao27/received_events",
    "repos_url": "https://api.github.com/users/jlzhao27/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jlzhao27/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jlzhao27/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jlzhao27"
  }
}