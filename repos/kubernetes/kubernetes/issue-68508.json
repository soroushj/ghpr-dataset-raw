{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/6629765?v=4",
    "events_url": "https://api.github.com/users/roycaihw/events{/privacy}",
    "followers_url": "https://api.github.com/users/roycaihw/followers",
    "following_url": "https://api.github.com/users/roycaihw/following{/other_user}",
    "gists_url": "https://api.github.com/users/roycaihw/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/roycaihw",
    "id": 6629765,
    "login": "roycaihw",
    "node_id": "MDQ6VXNlcjY2Mjk3NjU=",
    "organizations_url": "https://api.github.com/users/roycaihw/orgs",
    "received_events_url": "https://api.github.com/users/roycaihw/received_events",
    "repos_url": "https://api.github.com/users/roycaihw/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/roycaihw/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roycaihw/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/roycaihw"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
      "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
      "followers_url": "https://api.github.com/users/liggitt/followers",
      "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
      "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/liggitt",
      "id": 980082,
      "login": "liggitt",
      "node_id": "MDQ6VXNlcjk4MDA4Mg==",
      "organizations_url": "https://api.github.com/users/liggitt/orgs",
      "received_events_url": "https://api.github.com/users/liggitt/received_events",
      "repos_url": "https://api.github.com/users/liggitt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/liggitt"
    },
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/6629765?v=4",
      "events_url": "https://api.github.com/users/roycaihw/events{/privacy}",
      "followers_url": "https://api.github.com/users/roycaihw/followers",
      "following_url": "https://api.github.com/users/roycaihw/following{/other_user}",
      "gists_url": "https://api.github.com/users/roycaihw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/roycaihw",
      "id": 6629765,
      "login": "roycaihw",
      "node_id": "MDQ6VXNlcjY2Mjk3NjU=",
      "organizations_url": "https://api.github.com/users/roycaihw/orgs",
      "received_events_url": "https://api.github.com/users/roycaihw/received_events",
      "repos_url": "https://api.github.com/users/roycaihw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/roycaihw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roycaihw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/roycaihw"
    }
  ],
  "author_association": "MEMBER",
  "body": "/kind bug\r\n/sig api-machinery\r\n\r\nanother bug uncovered by #68405. in the extension server, we are removing old CR's storage when some significant changes (spec, some status) land in the corresponding CRD with the help of CRD informer. but when we're destroying the old CRD's storage, there are might be some remaining requests invoking etcd client from the old storage. so a racing happens when the CRD's informer trying to delete/close the old storage together with the old etcd client and the running handler trying to call REST interface via that client. as a result, the handler will fail with a `context canceled` or `grpc: the client connection is closing` which is the reason #68405 is flaky. \r\n\r\nin a word, __updating CRD will fail all processing CR requests__. \r\n\r\n@sttts proposes to make use of the [apimachinery WaitGroup](https://github.com/kubernetes/kubernetes/pull/54849) for the storage and we only delete a storage when the all the running handler's finished. but we might left some problem with that:\r\n\r\n- do we count the `WaitGroup` only in the handler ignoring other etcd client references like compactor?  \r\n- ~how will this impact server's performance?~\r\n- does it have to be a `WaitGroup`?\r\n- what about some long running handlers? `watch` has a timeout itself tho, what about infinite handlers like `proxyport`?\r\n\r\notoh, we can add a cooldown period (minute-ish?) for older cr storage to postpone the actual deletion for that storage. surely, it's not stable but a cooldown will at least keep most of short-running handler from failing.\r\n\r\n@deads2k @stttts\r\n ",
  "closed_at": "2019-05-14T12:31:15Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 14,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68508/comments",
  "created_at": "2018-09-11T12:39:56Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68508/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/68508",
  "id": 359028587,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 556590057,
      "name": "area/custom-resources",
      "node_id": "MDU6TGFiZWw1NTY1OTAwNTc=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/custom-resources"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG API Machinery.",
      "id": 173493835,
      "name": "sig/api-machinery",
      "node_id": "MDU6TGFiZWwxNzM0OTM4MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/api-machinery"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68508/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNTkwMjg1ODc=",
  "number": 68508,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Should support graceful deletion for CR storage ",
  "updated_at": "2019-05-14T12:31:15Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68508",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/12049380?v=4",
    "events_url": "https://api.github.com/users/yue9944882/events{/privacy}",
    "followers_url": "https://api.github.com/users/yue9944882/followers",
    "following_url": "https://api.github.com/users/yue9944882/following{/other_user}",
    "gists_url": "https://api.github.com/users/yue9944882/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/yue9944882",
    "id": 12049380,
    "login": "yue9944882",
    "node_id": "MDQ6VXNlcjEyMDQ5Mzgw",
    "organizations_url": "https://api.github.com/users/yue9944882/orgs",
    "received_events_url": "https://api.github.com/users/yue9944882/received_events",
    "repos_url": "https://api.github.com/users/yue9944882/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/yue9944882/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yue9944882/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/yue9944882"
  }
}