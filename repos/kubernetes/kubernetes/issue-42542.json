{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**Kubernetes version**\r\nClient Version: version.Info{Major:\"1\", Minor:\"5\", GitVersion:\"v1.5.3\", GitCommit:\"029c3a408176b55c30846f0faedf56aae5992e9b\", GitTreeState:\"clean\", BuildDate:\"2017-02-15T06:40:50Z\", GoVersion:\"go1.7.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"5\", GitVersion:\"v1.5.3\", GitCommit:\"029c3a408176b55c30846f0faedf56aae5992e9b\", GitTreeState:\"clean\", BuildDate:\"2017-02-15T06:34:56Z\", GoVersion:\"go1.7.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n**Environment**:\r\n3.10.0-327.36.3.el7.x86_64\r\nCentOS Linux release 7.2.1511 (Core) \r\n\r\n**cluster information**\r\nNAME                                 STATUS    AGE\r\nkube2master1.yatra.com   Ready      41d\r\nkube2node1.yatra.com      Ready      41d\r\nkube2node2.yatra.com     Ready       41d\r\n\r\n**kubelet is running with option --resolv-conf to include custmize resolv.conf file** \r\nroot     28235     1  3 09:44 ?        00:00:04 /usr/bin/kubelet --address=0.0.0.0 --port=10250 --pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest --kubeconfig=/etc/kubernetes/kubeadminconfig --require-kubeconfig=true --pod-manifest-path=/etc/kubernetes/manifests --logtostderr=true --v=0 --allow-privileged=true --resolv-conf=/etc/kube-resolv.conf\r\n\r\n**content of /etc/kube-resolv.conf**\r\noptions timeout:1\r\noptions ndots:5\r\nnameserver 100.64.0.10\r\nnameserver 172.16.1.246\r\nnameserver 172.16.1.247\r\n\r\nkubelet remove options define in above /etc/kube-resolv.conf file, it only pickup nameserver and search keyword, does not look for options keyword, it should look for it also.\r\n~]# kubectl exec -t busybox -- cat /etc/resolv.conf \r\nnameserver 100.64.0.10\r\nnameserver 172.16.1.246\r\nnameserver 172.16.1.247\r\noptions ndots:5\r\n\r\n** cluster dns is working fine\r\n~]# kubectl get svc\r\nNAME         CLUSTER-IP     EXTERNAL-IP   PORT(S)         AGE\r\nkubernetes   100.64.0.1       <none>         443/TCP            41d\r\nnginx             100.67.5.184   <nodes>       80:30010/TCP   4d\r\n\r\n~]# kubectl exec -t busybox -- nslookup nginx.default.svc.kubernetes\r\nServer:    100.64.0.10\r\nAddress 1: 100.64.0.10 kube-dns.kube-system.svc.kubernetes\r\n\r\nName:      nginx.default.svc.kubernetes\r\nAddress 1: 100.67.5.184 nginx.default.svc.kubernetes\r\n\r\n** issue **\r\nsince kube-dns only resolv service related svr records but if there an entry which it does not have then it go for next nameservers and there is 5 second timeout between nameserver. although dnsmasq is there for caching records but 5 second timeout is very high for our app setup.\r\nwe want to add below options timeout:1 so that if entry o not find in first nameserver it should not wait for 5 second to resolve entry, default is 5 sec in resolv.conf, want to keep only 1 second. I think kubelet should look for options keyword also in resolv.conf file, as of now it is looking for nameserver and search field as define in function parseResolvConf(kubelet_network.go)\r\n\r\n207 // parseResolveConf reads a resolv.conf file from the given reader, and parses\r\n208 // it into nameservers and searches, possibly returning an error.\r\n209 // TODO: move to utility package\r\n210 func (kl *Kubelet) parseResolvConf(reader io.Reader) (nameservers []string, searches []string, err error) {\r\n211         file, err := ioutil.ReadAll(reader)\r\n212         if err != nil {\r\n213                 return nil, nil, err\r\n214         }\r\n215 \r\n216         // Lines of the form \"nameserver 1.2.3.4\" accumulate.\r\n217         nameservers = []string{}\r\n218 \r\n219         // Lines of the form \"search example.com\" overrule - last one wins.\r\n220         searches = []string{}\r\n221 \r\n222         lines := strings.Split(string(file), \"\\n\")\r\n223         for l := range lines {\r\n224                 trimmed := strings.TrimSpace(lines[l])\r\n225                 if strings.HasPrefix(trimmed, \"#\") {\r\n226                         continue\r\n227                 }\r\n228                 fields := strings.Fields(trimmed)\r\n229                 if len(fields) == 0 {\r\n230                         continue\r\n231                 }\r\n232                 if fields[0] == \"nameserver\" {\r\n233                         nameservers = append(nameservers, fields[1:]...)\r\n234                 }\r\n235                 if fields[0] == \"search\" {\r\n236                         searches = fields[1:]\r\n237                 }\r\n238         }\r\n239 \r\n240         // There used to be code here to scrub DNS for each cloud, but doesn't\r\n241         // make sense anymore since cloudproviders are being factored out.\r\n242         // contact @thockin or @wlan0 for more information\r\n243 \r\n244         return nameservers, searches, nil\r\n245 }\r\n\r\nI did not find a way to set timeout 1 second for pods resolv.conf, if anyone have please help.",
  "closed_at": "2017-11-09T06:08:24Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/42542/comments",
  "created_at": "2017-03-05T05:14:55Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/42542/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/42542",
  "id": 211931076,
  "labels": [
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/42542/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMTE5MzEwNzY=",
  "number": 42542,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "[kubelet] ignore keyword \"options\" define in /etc/resolv.conf, only look for nameserver and search",
  "updated_at": "2017-11-09T13:01:06Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/42542",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/20416881?v=4",
    "events_url": "https://api.github.com/users/pawankkamboj/events{/privacy}",
    "followers_url": "https://api.github.com/users/pawankkamboj/followers",
    "following_url": "https://api.github.com/users/pawankkamboj/following{/other_user}",
    "gists_url": "https://api.github.com/users/pawankkamboj/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/pawankkamboj",
    "id": 20416881,
    "login": "pawankkamboj",
    "node_id": "MDQ6VXNlcjIwNDE2ODgx",
    "organizations_url": "https://api.github.com/users/pawankkamboj/orgs",
    "received_events_url": "https://api.github.com/users/pawankkamboj/received_events",
    "repos_url": "https://api.github.com/users/pawankkamboj/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/pawankkamboj/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pawankkamboj/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/pawankkamboj"
  }
}