{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind bug\r\n\r\n**What's happening:**\r\n\r\nCurrently, the `container_*` metrics use the label \"pod_name\" to refer to the name of the pod in a timeseries and \"container_name\" to refer to container names within that pod.\r\n\r\nkube-state-metrics, however, uses \"pod\" to refer to the names of pods and \"container\" to refer to names of containers. \r\n\r\nThis difference makes it difficult to do joins on KSM metrics and cadvisor metrics, leading me to write queries like this one (which calculates the percentage of real utilization of quota per container -- namespace and podname templated in Grafana):\r\n\r\n```\r\nsum(irate(container_cpu_usage_seconds_total{namespace=\"$namespace\",pod_name=\"$podname\",container_name!=\"POD\"}[1m])) by (container_name) / sum(label_join(kube_pod_container_resource_requests_cpu_cores{namespace=\"$namespace\",pod=\"$podname\"}, \"container_name\", \"\", \"container\")) by (container_name)\r\n```\r\n\r\nWith normalized labels I could just write\r\n\r\n```\r\nsum(irate(container_cpu_usage_seconds_total{namespace=\"$namespace\",pod=\"$podname\",container!=\"POD\"}[1m])) by (container) / sum(kube_pod_container_resource_requests_cpu_cores{namespace=\"$namespace\",pod=\"$podname\"}) by (container)\r\n```\r\n\r\nHence, I propose renaming the \"pod_name\" labels to \"pod\" and \"container_name\" labels to \"container\" to normalize between the two data sources. I can attempt to write a patch for this.\r\n\r\n**Why propose this here rather than telling KSM to match the cadvisor metrics?**\r\n\r\nI reported this against KSM first: https://github.com/kubernetes/kube-state-metrics/issues/501\r\n\r\nThe [current Kubernetes instrumentation guidelines](https://github.com/kubernetes/community/blob/afcc37186a32cc92b24e99e27089d10ae48ed0cf/contributors/devel/instrumentation.md#resource-referencing) indicate the usage of \"container\" (vs. container_name), \"pod\" (vs. pod_name), etc.:\r\n\r\n> An object is referenced by its unique name in a label named after the resource itself (i.e. `pod`/`deployment`/... and not `pod_name`/`deployment_name`) and the namespace it belongs to in the `namespace` label.\r\n\r\nFixing this would ensure the cadvisor metrics conform with the community guidelines.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):  1.8.7-21 with internal patches \r\n- Kube-state-metrics image version: 1.2.0",
  "closed_at": "2019-02-22T22:56:02Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 7,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66790/comments",
  "created_at": "2018-07-30T17:36:44Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66790/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/66790",
  "id": 345858905,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Instrumentation.",
      "id": 482207917,
      "name": "sig/instrumentation",
      "node_id": "MDU6TGFiZWw0ODIyMDc5MTc=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/instrumentation"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66790/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNDU4NTg5MDU=",
  "number": 66790,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Consider renaming \"pod_name\" labels to \"pod\" and \"container_name\" labels to \"container\" for cAdvisor metrics",
  "updated_at": "2019-02-22T22:56:02Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/66790",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/4706131?v=4",
    "events_url": "https://api.github.com/users/ehashman/events{/privacy}",
    "followers_url": "https://api.github.com/users/ehashman/followers",
    "following_url": "https://api.github.com/users/ehashman/following{/other_user}",
    "gists_url": "https://api.github.com/users/ehashman/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ehashman",
    "id": 4706131,
    "login": "ehashman",
    "node_id": "MDQ6VXNlcjQ3MDYxMzE=",
    "organizations_url": "https://api.github.com/users/ehashman/orgs",
    "received_events_url": "https://api.github.com/users/ehashman/received_events",
    "repos_url": "https://api.github.com/users/ehashman/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ehashman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ehashman/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ehashman"
  }
}