{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "Merging https://github.com/kubernetes/kubernetes/pull/64097 has broken e2e tests: https://k8s-testgrid.appspot.com/sig-autoscaling-hpa#gci-gce-autoscaling-hpa. Based on the logs it seems that HPA can no longer retrieve custom metrics provided by adapter (it still works for external metrics though).\r\n\r\nQuickly looking through the code it looks like #64097 updated https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/metrics/pkg/client/custom_metrics/client.go#L115 to use Custom Metrics v1beta2 API. Since v1beta2 is not backward compatible with v1beta1 and there is no fallback to old API, I suspect HPA will no longer work with any pre-existing adapter implementing v1beta1 API (like the stackdriver adapter we use in tests). \r\n\r\nIf my suspicion is correct I think this would be a huge regression - all existing adapters will stop working in 1.12. As per https://kubernetes.io/docs/reference/using-api/deprecation-policy/ we can't just drop support for v1beta1 - we need to support it for 9 months / 3 releases after officially deprecating it.\r\n\r\n/kind bug\r\n/priority critical-urgent\r\n/sig autoscaling\r\n\r\ncc: @kubernetes/sig-autoscaling-bugs @mwielgus @DirectXMan12 @damemi @kawych @piosz ",
  "closed_at": "2018-09-19T18:35:03Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 17,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68011/comments",
  "created_at": "2018-08-29T14:06:31Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68011/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/68011",
  "id": 355177723,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Highest priority. Must be actively worked on as someone's top priority right now.",
      "id": 114528068,
      "name": "priority/critical-urgent",
      "node_id": "MDU6TGFiZWwxMTQ1MjgwNjg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/critical-urgent"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Autoscaling.",
      "id": 238245616,
      "name": "sig/autoscaling",
      "node_id": "MDU6TGFiZWwyMzgyNDU2MTY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/autoscaling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68011/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:22:28Z",
    "closed_issues": 442,
    "created_at": "2017-11-15T06:32:51Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/5595220?v=4",
      "events_url": "https://api.github.com/users/thockin/events{/privacy}",
      "followers_url": "https://api.github.com/users/thockin/followers",
      "following_url": "https://api.github.com/users/thockin/following{/other_user}",
      "gists_url": "https://api.github.com/users/thockin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/thockin",
      "id": 5595220,
      "login": "thockin",
      "node_id": "MDQ6VXNlcjU1OTUyMjA=",
      "organizations_url": "https://api.github.com/users/thockin/orgs",
      "received_events_url": "https://api.github.com/users/thockin/received_events",
      "repos_url": "https://api.github.com/users/thockin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/thockin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thockin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/thockin"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/39",
    "id": 2913712,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/39/labels",
    "node_id": "MDk6TWlsZXN0b25lMjkxMzcxMg==",
    "number": 39,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.12",
    "updated_at": "2019-08-26T17:22:28Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/39"
  },
  "node_id": "MDU6SXNzdWUzNTUxNzc3MjM=",
  "number": 68011,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "HPA no longer works with adapters exposing Custom Metrics v1beta1 API",
  "updated_at": "2018-09-19T18:35:03Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68011",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/7901030?v=4",
    "events_url": "https://api.github.com/users/MaciekPytel/events{/privacy}",
    "followers_url": "https://api.github.com/users/MaciekPytel/followers",
    "following_url": "https://api.github.com/users/MaciekPytel/following{/other_user}",
    "gists_url": "https://api.github.com/users/MaciekPytel/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/MaciekPytel",
    "id": 7901030,
    "login": "MaciekPytel",
    "node_id": "MDQ6VXNlcjc5MDEwMzA=",
    "organizations_url": "https://api.github.com/users/MaciekPytel/orgs",
    "received_events_url": "https://api.github.com/users/MaciekPytel/received_events",
    "repos_url": "https://api.github.com/users/MaciekPytel/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/MaciekPytel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MaciekPytel/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/MaciekPytel"
  }
}