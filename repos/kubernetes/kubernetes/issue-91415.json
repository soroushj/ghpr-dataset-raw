{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5071689?v=4",
    "events_url": "https://api.github.com/users/gongguan/events{/privacy}",
    "followers_url": "https://api.github.com/users/gongguan/followers",
    "following_url": "https://api.github.com/users/gongguan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gongguan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/gongguan",
    "id": 5071689,
    "login": "gongguan",
    "node_id": "MDQ6VXNlcjUwNzE2ODk=",
    "organizations_url": "https://api.github.com/users/gongguan/orgs",
    "received_events_url": "https://api.github.com/users/gongguan/received_events",
    "repos_url": "https://api.github.com/users/gongguan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/gongguan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gongguan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/gongguan"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/5071689?v=4",
      "events_url": "https://api.github.com/users/gongguan/events{/privacy}",
      "followers_url": "https://api.github.com/users/gongguan/followers",
      "following_url": "https://api.github.com/users/gongguan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gongguan/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/gongguan",
      "id": 5071689,
      "login": "gongguan",
      "node_id": "MDQ6VXNlcjUwNzE2ODk=",
      "organizations_url": "https://api.github.com/users/gongguan/orgs",
      "received_events_url": "https://api.github.com/users/gongguan/received_events",
      "repos_url": "https://api.github.com/users/gongguan/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/gongguan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gongguan/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/gongguan"
    },
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/10743879?v=4",
      "events_url": "https://api.github.com/users/wojtek-t/events{/privacy}",
      "followers_url": "https://api.github.com/users/wojtek-t/followers",
      "following_url": "https://api.github.com/users/wojtek-t/following{/other_user}",
      "gists_url": "https://api.github.com/users/wojtek-t/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/wojtek-t",
      "id": 10743879,
      "login": "wojtek-t",
      "node_id": "MDQ6VXNlcjEwNzQzODc5",
      "organizations_url": "https://api.github.com/users/wojtek-t/orgs",
      "received_events_url": "https://api.github.com/users/wojtek-t/received_events",
      "repos_url": "https://api.github.com/users/wojtek-t/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/wojtek-t/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wojtek-t/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/wojtek-t"
    }
  ],
  "author_association": "MEMBER",
  "body": "Opening as an follow up analysis from https://github.com/kubernetes/kubernetes/issues/91367\r\n\r\nMerging #91260 unexpectedly resulted in a huge flakiness of at least one of the apimachinery tests: https://github.com/kubernetes/kubernetes/issues/91367 \r\nThat is definitely unexpected, because that PR only changes the size of watchcache, which no e2e tests should rely on.\r\n\r\nSo I started digging deeper into it and indeed that PR also uncovered the bug that was introduced earlier.\r\n\r\nHere is what is happening:\r\n- https://github.com/kubernetes/kubernetes/pull/90091 made the watch cache size dynamic\r\n- however, there was a place in watch cache that relied on the following invariant:\r\n \"when watchache becomes full, it is full until the next relist\"\r\n that place is this one:\r\nhttps://github.com/kubernetes/kubernetes/blob/6249f287e1d3d9fb63b60961c8625a82d7db360e/staging/src/k8s.io/apiserver/pkg/storage/cacher/watch_cache.go#L537-L544\r\n\r\n- with the change that made watchcache size dynamic, it may no longer be true, i.e.:\r\n (a) watch cache was full\r\n (b) we are increasing its size\r\n (c) it is no longer full, but we no longer can't serve (at least not always) everything since listResourceVersion\r\n\r\nThis is exactly what was happening in the failed tests:\r\n- the service was updated well back in the past\r\n- the watchcache initially rotated couple times (no need to increase it) [which pulled our change out of it]\r\n- the its size was increased\r\n- that resulted in cache becoming not full\r\n- so the incoming watch should have returned \"too old\", but was accepting it (due to the listResourceVersion > 0 condition being true), but in fact wasn't able to serve it\r\n\r\n\r\nBonus point: in \"kind\" tests we were observing tests taking 30+ minutes - this seem to be a bug in kube-apiserver configuration, because the watch in the test doesn't set TimeoutSeconds, and:\r\n(a) in GCE it is default in kube-apiserver to sth random from [5m, 30m]: https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apiserver/pkg/endpoints/handlers/get.go#L248-L250\r\n(b) in kind apparently it isn't...\r\n\r\n\r\n/kind bug\r\n/sig apimachinery\r\n\r\n/assign @gongguan @wojtek-t \r\n\r\n@liggitt @hasheddan @jpbetz - FYI",
  "closed_at": "2020-05-26T20:38:12Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 8,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/91415/comments",
  "created_at": "2020-05-25T18:23:22Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/91415/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/91415",
  "id": 624432987,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "ededed",
      "default": false,
      "description": "Indicates an issue or PR lacks a `sig/foo` label and requires one.",
      "id": 617149945,
      "name": "needs-sig",
      "node_id": "MDU6TGFiZWw2MTcxNDk5NDU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/needs-sig"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": "Must be staffed and worked on either currently, or very soon, ideally in time for the next release.",
      "id": 114528223,
      "name": "priority/important-soon",
      "node_id": "MDU6TGFiZWwxMTQ1MjgyMjM=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/important-soon"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/91415/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": null,
    "closed_issues": 1941,
    "created_at": "2019-08-26T17:08:39Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/567897?v=4",
      "events_url": "https://api.github.com/users/justaugustus/events{/privacy}",
      "followers_url": "https://api.github.com/users/justaugustus/followers",
      "following_url": "https://api.github.com/users/justaugustus/following{/other_user}",
      "gists_url": "https://api.github.com/users/justaugustus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/justaugustus",
      "id": 567897,
      "login": "justaugustus",
      "node_id": "MDQ6VXNlcjU2Nzg5Nw==",
      "organizations_url": "https://api.github.com/users/justaugustus/orgs",
      "received_events_url": "https://api.github.com/users/justaugustus/received_events",
      "repos_url": "https://api.github.com/users/justaugustus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/justaugustus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/justaugustus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/justaugustus"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/46",
    "id": 4604497,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/46/labels",
    "node_id": "MDk6TWlsZXN0b25lNDYwNDQ5Nw==",
    "number": 46,
    "open_issues": 13,
    "state": "open",
    "title": "v1.19",
    "updated_at": "2020-10-27T18:35:01Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/46"
  },
  "node_id": "MDU6SXNzdWU2MjQ0MzI5ODc=",
  "number": 91415,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "WatchCache may accept watches that it should not",
  "updated_at": "2020-05-26T20:38:12Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/91415",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/10743879?v=4",
    "events_url": "https://api.github.com/users/wojtek-t/events{/privacy}",
    "followers_url": "https://api.github.com/users/wojtek-t/followers",
    "following_url": "https://api.github.com/users/wojtek-t/following{/other_user}",
    "gists_url": "https://api.github.com/users/wojtek-t/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/wojtek-t",
    "id": 10743879,
    "login": "wojtek-t",
    "node_id": "MDQ6VXNlcjEwNzQzODc5",
    "organizations_url": "https://api.github.com/users/wojtek-t/orgs",
    "received_events_url": "https://api.github.com/users/wojtek-t/received_events",
    "repos_url": "https://api.github.com/users/wojtek-t/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/wojtek-t/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wojtek-t/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/wojtek-t"
  }
}