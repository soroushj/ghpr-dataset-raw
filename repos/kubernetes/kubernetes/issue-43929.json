{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- Thanks for filing an issue! Before hitting the button, please answer these questions.-->\r\n\r\n**Is this a request for help?** (If yes, you should use our troubleshooting guide and community support channels, see http://kubernetes.io/docs/troubleshooting/.):\r\n\r\n\r\n**What keywords did you search in Kubernetes issues before filing this one?** (If you have found any duplicates, you should instead reply there.):\r\n\r\n---\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?** (choose one):\r\nBUG\r\n<!--\r\nIf this is a BUG REPORT, please:\r\n  - Fill in as much of the template below as you can.  If you leave out\r\n    information, we can't help you as well.\r\n\r\nIf this is a FEATURE REQUEST, please:\r\n  - Describe *in detail* the feature/behavior/change you'd like to see.\r\n\r\nIn both cases, be ready for followup questions, and please respond in a timely\r\nmanner.  If we can't reproduce a bug or think a feature already exists, we\r\nmight close your issue.  If we're wrong, PLEASE feel free to reopen it and\r\nexplain why.\r\n-->\r\n\r\n**Kubernetes version** (use `kubectl version`):\r\nClient Version: version.Info{Major:\"1\", Minor:\"6+\", GitVersion:\"v1.6.0-beta.4\", GitCommit:\"b202120be3a97e5f8a5e20da51d0b6f5a1eebd31\", GitTreeState:\"clean\", BuildDate:\"2017-03-17T17:54:01Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"6\", GitVersion:\"v1.6.0+coreos.0\", GitCommit:\"8031716957d697332f9234ddf85febb07ac6c3e3\", GitTreeState:\"clean\", BuildDate:\"2017-03-29T04:33:09Z\", GoVersion:\"go1.7.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**:\r\n- **OS** (e.g. from /etc/os-release):CoreOS\r\n- **Kernel** (e.g. `uname -a`):\r\n- **Install tools**:\r\n- **Others**:\r\n\r\n\r\n**What happened**: Im createing sc:\r\n```\r\n---\r\napiVersion: storage.k8s.io/v1\r\nkind: StorageClass\r\nmetadata:\r\n  name: storage\r\n  annotations:\r\n    storageclass.beta.kubernetes.io/is-default-class: \"true\"\r\n    storageclass.kubernetes.io/is-default-class: \"true\"\r\nprovisioner: kubernetes.io/glusterfs\r\nparameters:\r\n  resturl: \"http://1.1.1.1:8080\"\r\n  restauthenabled: \"false\"\r\n```\r\nWhen create pvc:\r\n```\r\n---\r\nkind: PersistentVolumeClaim\r\napiVersion: v1\r\nmetadata:\r\n  name: pvc\r\n  annotations:\r\n    volume.beta.kubernetes.io/storage-class: \"storage\"\r\nspec:\r\n  storageClassName: storage\r\n  accessModes:\r\n    - ReadWriteOnce\r\n  resources:\r\n    requests:\r\n      storage: 1Gi\r\n\r\n```\r\nIt's ok. pvc work fine. But... if try delete it:\r\n`E0331 21:41:05.571085       1 goroutinemap.go:164] Operation for \"delete-pvc-445baf6f-1658-11e7-b0dd-005056ab5e09[47add018-1658-11e7-b0dd-005056ab5e09]\" failed. No retries permitted until 2017-03-31 21:43:05.571044995 +0000 UTC (durationBeforeRetry 2m0s). Error: Volume has no class annotation`\r\n\r\nThis was due to the fact that:\r\n1. https://github.com/kubernetes/kubernetes/pull/35051 \r\n`\r\nclassName, found := pv.Annotations[\"volume.beta.kubernetes.io/storage-class\"]\r\nif !found {\r\nreturn nil, fmt.Errorf(\"Volume has no class annotation\")\r\n}\r\n`\r\n2. controller-manager create pv:\r\n```\r\nName:           pvc-f3a7ac9b-1563-11e7-88b3-005056ab5e09\r\nLabels:         <none>\r\nAnnotations:    pv.beta.kubernetes.io/gid=5000\r\n                pv.kubernetes.io/bound-by-controller=yes\r\n                pv.kubernetes.io/provisioned-by=kubernetes.io/glusterfs\r\nStorageClass:   storage\r\nStatus:         Bound\r\nClaim:          kube-system/pvc\r\nReclaim Policy: Delete\r\nAccess Modes:   RWO\r\nCapacity:       1Gi\r\nMessage:\r\nSource:\r\n    Type:               Glusterfs (a Glusterfs mount on the host that shares a pod's lifetime)\r\n    EndpointsName:      glusterfs-dynamic-pvc\r\n    Path:               vol_649c33c97b1926d6952aa78568d8becf\r\n    ReadOnly:           false\r\nEvents:                 <none>\r\n```\r\nAs you can see, there is no annotation:\r\n`volume.beta.kubernetes.io/storage-class: \"storage\"`\r\nIf I add annotation to the created pv, then deletion ends with success\r\n\r\n",
  "closed_at": "2017-04-03T15:35:32Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43929/comments",
  "created_at": "2017-03-31T22:31:46Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43929/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/43929",
  "id": 218632995,
  "labels": [],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43929/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMTg2MzI5OTU=",
  "number": 43929,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Error when deleting pvc (Error: Volume has no class annotation)",
  "updated_at": "2017-04-05T16:23:56Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43929",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/14557581?v=4",
    "events_url": "https://api.github.com/users/z1oy/events{/privacy}",
    "followers_url": "https://api.github.com/users/z1oy/followers",
    "following_url": "https://api.github.com/users/z1oy/following{/other_user}",
    "gists_url": "https://api.github.com/users/z1oy/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/z1oy",
    "id": 14557581,
    "login": "z1oy",
    "node_id": "MDQ6VXNlcjE0NTU3NTgx",
    "organizations_url": "https://api.github.com/users/z1oy/orgs",
    "received_events_url": "https://api.github.com/users/z1oy/received_events",
    "repos_url": "https://api.github.com/users/z1oy/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/z1oy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/z1oy/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/z1oy"
  }
}