{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind feature\r\n@kubernetes/sig-aws-feature-requests\r\n/sig aws\r\n\r\n**What happened**:\r\nIn k8s 1.7, when creating a service of type LoadBalancer, K8S creates the ELB and a Security Group for it. For these resources, it adds a tag, constructed dynamically, containing the cluster id: \"kubernetes.io/cluster/${cluster_id}\" with the value \"true\" \r\n\r\n**What you expected to happen**:\r\nWe'd like to have also a statically named tag , as it was in 1.5 (\"KubernetesCluster\") with the value of the cluster id.  \r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nRunning on AWS cloud provider, create a service of type LoadBalancer.\r\n\r\n**Anything else we need to know?**:\r\nThe reason for what we expect is that we have tight security constraints that require us to fine tune the IAM policies for the Instance profiles that the controllers use.   \r\nWith a statically named tag we were able, in 1.5, to restrict the permissions in the IAM policy to act only on the k8s managed resources (ELBs, security groups). Here is the relevant part of the IAM policy:\r\n```\r\n         - Action:\r\n            - ec2:AuthorizeSecurityGroupIngress\r\n            - ec2:DeleteSecurityGroup\r\n            - ec2:RevokeSecurityGroupIngress\r\n            Effect: Allow\r\n            Resource:\r\n            - \"*\"\r\n            Condition:\r\n              StringLike:\r\n                ec2:ResourceTag/KubernetesCluster: \"*\"\r\n```\r\nWith a dynamically named tag we are not able to do this any more as AWS IAM doesn't support something like:\r\n```\r\nCondition:\r\n  StringLike:\r\n     kubernetes.io/cluster/*: \"*\"\r\n``` \r\nWe are sharing the Instance Profiles among different k8s clusters, hence the \"*\" in the value of the tag.\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n``` \r\nClient Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.5\", GitCommit:\"17d7182a7ccbb167074be7a87f0a68bd00d58d97\", GitTreeState:\"clean\", BuildDate:\"2017-08-31T09:14:02Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.4+coreos.0\", GitCommit:\"4bb697e04f7c356347aee6ffaa91640b428976d5\", GitTreeState:\"clean\", BuildDate:\"2017-08-22T08:43:47Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n- Cloud provider or hardware configuration**: AWS\r\n- OS (e.g. from /etc/os-release):\r\n```\r\nNAME=\"Container Linux by CoreOS\"\r\nID=coreos\r\nVERSION=1465.8.0\r\nVERSION_ID=1465.8.0\r\nBUILD_ID=2017-09-20-2237\r\nPRETTY_NAME=\"Container Linux by CoreOS 1465.8.0 (Ladybug)\"\r\nANSI_COLOR=\"38;5;75\"\r\nHOME_URL=\"https://coreos.com/\"\r\nBUG_REPORT_URL=\"https://issues.coreos.com\"\r\nCOREOS_BOARD=\"amd64-usr\"\r\n```\r\n- Kernel (e.g. `uname -a`):\r\n```Linux ip-xxxxxxxxx.eu-west-1.compute.internal 4.12.14-coreos #1 SMP Wed Sep 20 22:20:05 UTC 2017 x86_64 Intel(R) Xeon(R) CPU E5-2666 v3 @ 2.90GHz GenuineIntel GNU/Linux```\r\n- Install tools: kube-aws\r\n- Others:\r\n",
  "closed_at": "2018-02-25T19:59:53Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 7,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53489/comments",
  "created_at": "2017-10-05T11:06:55Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53489/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/53489",
  "id": 263085138,
  "labels": [
    {
      "color": "c7def8",
      "default": false,
      "description": "Categorizes issue or PR as related to a new feature.",
      "id": 267761362,
      "name": "kind/feature",
      "node_id": "MDU6TGFiZWwyNjc3NjEzNjI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/feature"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53489/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNjMwODUxMzg=",
  "number": 53489,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "AWS: Tagging the security group of ELB created for LoadBalancer or Ingress",
  "updated_at": "2018-02-25T19:59:53Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/53489",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/8848332?v=4",
    "events_url": "https://api.github.com/users/sbuliarca/events{/privacy}",
    "followers_url": "https://api.github.com/users/sbuliarca/followers",
    "following_url": "https://api.github.com/users/sbuliarca/following{/other_user}",
    "gists_url": "https://api.github.com/users/sbuliarca/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/sbuliarca",
    "id": 8848332,
    "login": "sbuliarca",
    "node_id": "MDQ6VXNlcjg4NDgzMzI=",
    "organizations_url": "https://api.github.com/users/sbuliarca/orgs",
    "received_events_url": "https://api.github.com/users/sbuliarca/received_events",
    "repos_url": "https://api.github.com/users/sbuliarca/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/sbuliarca/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sbuliarca/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/sbuliarca"
  }
}