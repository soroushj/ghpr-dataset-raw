{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "The pr rever-revert \"Fix the race between configuring cbr0 and restarting static pods\", also\n- add iptables rule for MASQUERADE for egress\n- make sure mtu=1460 for cbr0\n\nWith this pr, the new cluster I brought up, I checked both master and minion on network configurations:\n\nOn master node:\n\n```\nroot@kubernetes-master:/var/log# iptables-save | grep MASQUERADE\n-A POSTROUTING ! -d 10.0.0.0/8 -o eth0 -j MASQUERADE\n\n# ip addr show\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1460 qdisc pfifo_fast state UP qlen 1000\n    link/ether 42:01:0a:f0:9c:cf brd ff:ff:ff:ff:ff:ff\n    inet 10.240.156.207/32 brd 10.240.156.207 scope global eth0\n       valid_lft forever preferred_lft forever\n4: cbr0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1460 qdisc noqueue state UNKNOWN \n    link/ether f6:1f:bd:10:27:48 brd ff:ff:ff:ff:ff:ff\n    inet 10.246.0.1/24 scope global cbr0\n       valid_lft forever preferred_lft forever\n```\n\nOn Minion node\n\n```\nroot@kubernetes-minion-fptt:/var/log# iptables-save | grep MASQUERADE\n-A POSTROUTING ! -d 10.0.0.0/8 -o eth0 -j MASQUERADE\n\nroot@kubernetes-minion-fptt:/var/log# ip addr show\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1460 qdisc pfifo_fast state UP qlen 1000\n    link/ether 42:01:0a:f0:4d:8c brd ff:ff:ff:ff:ff:ff\n    inet 10.240.77.140/32 brd 10.240.77.140 scope global eth0\n       valid_lft forever preferred_lft forever\n4: cbr0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1460 qdisc noqueue state UP \n    link/ether 4a:83:23:02:49:e6 brd ff:ff:ff:ff:ff:ff\n    inet 10.244.0.1/24 scope global cbr0\n       valid_lft forever preferred_lft forever\n6: vethe9346d5: <BROADCAST,UP,LOWER_UP> mtu 1460 qdisc noqueue master cbr0 state UP \n    link/ether 4a:83:23:02:49:e6 brd ff:ff:ff:ff:ff:ff\n```\n\nI did manual tests to verify internet connection from inside of container too;\n\n```\n# docker ps\nCONTAINER ID        IMAGE                                      COMMAND                CREATED             STATUS              PORTS               NAMES\n15157eba242a        redis:latest                               \"/entrypoint.sh redi   33 seconds ago      Up 32 seconds                           k8s_master.718e46d0_redis-master-mhbst_default_7e7c1eae-1ac3-11e5-8010-42010af09ccf_163b0101                                        \n0753208fa688        gcr.io/google_containers/pause:0.8.0       \"/pause\"               44 seconds ago      Up 43 seconds                           k8s_POD.49eee8c2_redis-master-mhbst_default_7e7c1eae-1ac3-11e5-8010-42010af09ccf_9ab956a2                                           \n\n# docker exec -t -i 15157eba242a sh\n# ping google.com\nPING google.com (74.125.70.100): 48 data bytes\n56 bytes from 74.125.70.100: icmp_seq=0 ttl=50 time=0.954 ms\n56 bytes from 74.125.70.100: icmp_seq=1 ttl=50 time=0.809 ms\n56 bytes from 74.125.70.100: icmp_seq=2 ttl=50 time=0.815 ms\n...\n```\n\nFix #10122 and #9822\n",
  "closed_at": "2015-06-25T00:59:51Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1170062?v=4",
    "events_url": "https://api.github.com/users/mbforbes/events{/privacy}",
    "followers_url": "https://api.github.com/users/mbforbes/followers",
    "following_url": "https://api.github.com/users/mbforbes/following{/other_user}",
    "gists_url": "https://api.github.com/users/mbforbes/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mbforbes",
    "id": 1170062,
    "login": "mbforbes",
    "node_id": "MDQ6VXNlcjExNzAwNjI=",
    "organizations_url": "https://api.github.com/users/mbforbes/orgs",
    "received_events_url": "https://api.github.com/users/mbforbes/received_events",
    "repos_url": "https://api.github.com/users/mbforbes/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mbforbes/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mbforbes/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mbforbes"
  },
  "comments": 30,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/10312/comments",
  "created_at": "2015-06-24T21:27:10Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/10312/events",
  "html_url": "https://github.com/kubernetes/kubernetes/pull/10312",
  "id": 90783809,
  "labels": [
    {
      "color": "15dd18",
      "default": false,
      "description": "Indicates that a PR is ready to be merged.",
      "id": 148225179,
      "name": "lgtm",
      "node_id": "MDU6TGFiZWwxNDgyMjUxNzk=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/lgtm"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/10312/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDExOlB1bGxSZXF1ZXN0Mzg0ODk1OTI=",
  "number": 10312,
  "performed_via_github_app": null,
  "pull_request": {
    "diff_url": "https://github.com/kubernetes/kubernetes/pull/10312.diff",
    "html_url": "https://github.com/kubernetes/kubernetes/pull/10312",
    "patch_url": "https://github.com/kubernetes/kubernetes/pull/10312.patch",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/pulls/10312"
  },
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Take 2: Fix the race between configuring cbr0 and restarting static pods",
  "updated_at": "2015-08-12T17:36:10Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/10312",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/7740897?v=4",
    "events_url": "https://api.github.com/users/dchen1107/events{/privacy}",
    "followers_url": "https://api.github.com/users/dchen1107/followers",
    "following_url": "https://api.github.com/users/dchen1107/following{/other_user}",
    "gists_url": "https://api.github.com/users/dchen1107/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dchen1107",
    "id": 7740897,
    "login": "dchen1107",
    "node_id": "MDQ6VXNlcjc3NDA4OTc=",
    "organizations_url": "https://api.github.com/users/dchen1107/orgs",
    "received_events_url": "https://api.github.com/users/dchen1107/received_events",
    "repos_url": "https://api.github.com/users/dchen1107/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dchen1107/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dchen1107/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dchen1107"
  }
}