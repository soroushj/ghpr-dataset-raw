{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
    "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
    "followers_url": "https://api.github.com/users/liggitt/followers",
    "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
    "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/liggitt",
    "id": 980082,
    "login": "liggitt",
    "node_id": "MDQ6VXNlcjk4MDA4Mg==",
    "organizations_url": "https://api.github.com/users/liggitt/orgs",
    "received_events_url": "https://api.github.com/users/liggitt/received_events",
    "repos_url": "https://api.github.com/users/liggitt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/liggitt"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/980082?v=4",
      "events_url": "https://api.github.com/users/liggitt/events{/privacy}",
      "followers_url": "https://api.github.com/users/liggitt/followers",
      "following_url": "https://api.github.com/users/liggitt/following{/other_user}",
      "gists_url": "https://api.github.com/users/liggitt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/liggitt",
      "id": 980082,
      "login": "liggitt",
      "node_id": "MDQ6VXNlcjk4MDA4Mg==",
      "organizations_url": "https://api.github.com/users/liggitt/orgs",
      "received_events_url": "https://api.github.com/users/liggitt/received_events",
      "repos_url": "https://api.github.com/users/liggitt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/liggitt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/liggitt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/liggitt"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**What happened**:\r\n\r\nI configured my API server with a Webhook token authentication server by way of the \"authentication-token-webhook-config-file\" command-line flag, and confirmed that the API server does pass bearer tokens through, issuing HTTP POST requests with a JSON-encoded `TokenReview` body.\r\n\r\nWhen my Webhook server indicates authentication failure, it responds with HTTP status code 200 and a JSON-encoded `TokenReview` in the body, this time with the `TokenReviewStatus` object's \"Error\" field populated. Here's an example:\r\n```json\r\n{\r\n  \"metadata\": {\r\n    \"creationTimestamp\": \"2019-01-31T14:07:06Z\"\r\n  },\r\n  \"spec\": {},\r\n  \"status\": {\r\n    \"user\": {},\r\n    \"error\": \"Something went wrong!\"\r\n  }\r\n}\r\n```\r\nWhen the API server receives this response, it refuses the original motivating request with an HTTP status code 401 response, but the API server writes the following into its log file:\r\n> E0131 14:06:40.549602       1 authentication.go:65] Unable to authenticate the request due to an error: [invalid bearer token, [invalid bearer token, invalid bearer token]]\r\n\r\nThis use of this default error message is due to an omission in file _plugin/pkg/authenticator/token/webhook/webhook.go_, where [the `(*WebhookTokenAuthenticator).AuthenticateToken` method ignores the `TokenReviewStatus` \"Error\" field](https://sourcegraph.com/github.com/kubernetes/apiserver@master/-/blob/plugin/pkg/authenticator/token/webhook/webhook.go#L121-123), and [only pays attention to an HTTP-level communication failure](https://sourcegraph.com/github.com/kubernetes/apiserver@master/-/blob/plugin/pkg/authenticator/token/webhook/webhook.go#L104-108).\r\n\r\n**What you expected to happen**:\r\n\r\nThe API server should instead log a message that includes the value from [the `TokenReviewStatus` object's \"Error\" field](https://sourcegraph.com/github.com/kubernetes/api@master/-/blob/authentication/v1beta1/types.go#L79-81).\r\n\r\nPer a brief discussion with @liggitt [in the \"sig-auth\" channel of the \"Kubernetes\" Slack team](https://kubernetes.slack.com/archives/C0EN96KUY/p1548944406313400), he agreed that the API server log message should include such an error message from the Webhook server, provided it's present and nonempty.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\n- Configure an API server to delegate to a Webhook token authentication server.\r\n- Force that Webhook server to respond \"successfully\" with an HTTP 200 response, but with the \"Authenticated\" field set to false (or omitted) and with a particular error message in the `TokenReviewStatus` \"Error\" field.\r\n- Make an HTTP request of the API server with an HTTP \"Authentication\" header with a value starting with the string \"Bearer \" followed by at least one more character.\r\n- Inspect the logs from the API server, looking for a message that begins with \"Unable to authenticate the request due to an error.\"\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"13\", GitVersion:\"v1.13.2\", GitCommit:\"cff46ab41ff0bb44d8584413b598ad8360ec1def\", GitTreeState:\"clean\", BuildDate:\"2019-01-13T23:15:13Z\", GoVersion:\"go1.11.4\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"13\", GitVersion:\"v1.13.2\", GitCommit:\"cff46ab41ff0bb44d8584413b598ad8360ec1def\", GitTreeState:\"clean\", BuildDate:\"2019-01-10T23:28:14Z\", GoVersion:\"go1.11.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\n- Cloud provider or hardware configuration:\r\n  AWS EC2\r\n\r\n- OS (e.g. from /etc/os-release):\r\n```\r\nID=coreos\r\nVERSION=1967.3.0\r\nVERSION_ID=1967.3.0\r\nBUILD_ID=2019-01-08-0044\r\nPRETTY_NAME=\"Container Linux by CoreOS 1967.3.0 (Rhyolite)\"\r\nANSI_COLOR=\"38;5;75\"\r\nHOME_URL=\"https://coreos.com/\"\r\nBUG_REPORT_URL=\"https://issues.coreos.com\"\r\nCOREOS_BOARD=\"amd64-usr\"\r\n```\r\n\r\n- Kernel (e.g. `uname -a`):\r\n  `Linux ip-10-105-48-17 4.14.88-coreos #1 SMP Mon Jan 7 23:48:02 -00 2019 x86_64 Intel(R) Xeon(R) Platinum 8175M CPU @ 2.50GHz GenuineIntel GNU/Linux`\r\n\r\n- Install tools:\r\n  _kubeadm_\r\n",
  "closed_at": "2019-02-05T08:24:00Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/73592/comments",
  "created_at": "2019-01-31T14:40:44Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/73592/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/73592",
  "id": 405276486,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Auth.",
      "id": 357119284,
      "name": "sig/auth",
      "node_id": "MDU6TGFiZWwzNTcxMTkyODQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/auth"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/73592/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MDUyNzY0ODY=",
  "number": 73592,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "API server logs wrong error message for Webhook token authentication failure",
  "updated_at": "2019-02-05T08:24:01Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/73592",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/175841?v=4",
    "events_url": "https://api.github.com/users/seh/events{/privacy}",
    "followers_url": "https://api.github.com/users/seh/followers",
    "following_url": "https://api.github.com/users/seh/following{/other_user}",
    "gists_url": "https://api.github.com/users/seh/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/seh",
    "id": 175841,
    "login": "seh",
    "node_id": "MDQ6VXNlcjE3NTg0MQ==",
    "organizations_url": "https://api.github.com/users/seh/orgs",
    "received_events_url": "https://api.github.com/users/seh/received_events",
    "repos_url": "https://api.github.com/users/seh/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/seh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/seh/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/seh"
  }
}