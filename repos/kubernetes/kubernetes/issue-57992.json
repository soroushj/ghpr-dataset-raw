{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- This form is for bug reports and feature requests ONLY! \r\n\r\nIf you're looking for help check [Stack Overflow](https://stackoverflow.com/questions/tagged/kubernetes) and the [troubleshooting guide](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).\r\n-->\r\n\r\n**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n/kind bug\r\n\r\n\r\n**What happened**:\r\nWhen opening port-forward requests to a pod, kubelet memory usage increases without releasing it again when the port-forward is stopped.\r\n\r\n**What you expected to happen**:\r\nKubelet should cleanup the port-forward when it is closed\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nUsing the following script I can observe an increase in Kubelet memory usage on the node where the pod runs:\r\n\r\n```bash\r\nfor i in {8000..8300}; do\r\nkubectl port-forward anypod $i:8080 &; sleep 0.2;\r\ndone\r\n\r\n...\r\nkillall kubectl\r\n```\r\n300 connections allocates roughly 30mb by kubelet\r\n\r\nWe first noticed this on the node where Tiller (Helm) runs. The node regularly runs out of memory because of the Kubelet memory usage. see also https://github.com/kubernetes/helm/issues/3121 We don't experience the helm issue on all clusters, but I can reproduce the memory leak with the above script on all clusters.\r\n\r\n**Anything else we need to know?**:\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): \r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"9\", GitVersion:\"v1.9.1\", GitCommit:\"3a1c9449a956b6026f075fa3134ff92f7d55f812\", GitTreeState:\"clean\", BuildDate:\"2018-01-04T19:59:01Z\", GoVersion:\"go1.9.2\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.11\", GitCommit:\"b13f2fd682d56eab7a6a2b5a1cab1a3d2c8bdd55\", GitTreeState:\"clean\", BuildDate:\"2017-11-25T17:51:39Z\", GoVersion:\"go1.8.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n- Cloud provider or hardware configuration: AWS\r\n- OS (e.g. from /etc/os-release): Debian jessie\r\n- Kernel (e.g. `uname -a`): `Linux 4.4.102-k8s #1 SMP Sun Nov 26 23:32:43 UTC 2017 x86_64 GNU/Linux`\r\n- Install tools: Kops 1.8.0\r\n- Others:\r\n\r\n  ",
  "closed_at": "2018-08-17T04:17:16Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 11,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/57992/comments",
  "created_at": "2018-01-09T07:46:51Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/57992/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/57992",
  "id": 286997523,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG API Machinery.",
      "id": 173493835,
      "name": "sig/api-machinery",
      "node_id": "MDU6TGFiZWwxNzM0OTM4MzU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/api-machinery"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/57992/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyODY5OTc1MjM=",
  "number": 57992,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Kubelet leaks memory on kubectl port-forward",
  "updated_at": "2018-08-17T04:17:16Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/57992",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/158820?v=4",
    "events_url": "https://api.github.com/users/SamClinckspoor/events{/privacy}",
    "followers_url": "https://api.github.com/users/SamClinckspoor/followers",
    "following_url": "https://api.github.com/users/SamClinckspoor/following{/other_user}",
    "gists_url": "https://api.github.com/users/SamClinckspoor/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/SamClinckspoor",
    "id": 158820,
    "login": "SamClinckspoor",
    "node_id": "MDQ6VXNlcjE1ODgyMA==",
    "organizations_url": "https://api.github.com/users/SamClinckspoor/orgs",
    "received_events_url": "https://api.github.com/users/SamClinckspoor/received_events",
    "repos_url": "https://api.github.com/users/SamClinckspoor/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/SamClinckspoor/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SamClinckspoor/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/SamClinckspoor"
  }
}