{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\nThe endpointSliceTracker creates a set of resource versions for each service, the resource versions in the set could be deleted when endpointslices are deleted, but the set and its key in the map is never deleted, leading to memory leak.\r\nhttps://github.com/kubernetes/kubernetes/blob/a26e5881d8aa38aaa0a56c78050fd4ea14611c9f/pkg/controller/endpointslice/endpointslice_tracker.go#L38\r\n```\r\nShowing top 10 nodes out of 59\r\n      flat  flat%   sum%        cum   cum%\r\n     32770 21.66% 21.66%      32770 21.66%  k8s.io/kubernetes/pkg/controller/endpointslice.(*endpointSliceTracker).relatedResourceVersions\r\n     32768 21.66% 43.33%      32768 21.66%  k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/apis/meta/v1.(*ObjectMeta).Unmarshal\r\n     16384 10.83% 54.16%      16384 10.83%  fmt.Errorf\r\n     16384 10.83% 64.99%      16384 10.83%  k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/runtime/schema.GroupVersion.String\r\n     16384 10.83% 75.82%      16384 10.83%  k8s.io/kubernetes/vendor/k8s.io/client-go/rest/watch.NewDecoder\r\n     10930  7.23% 83.05%      10930  7.23%  k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/runtime.(*Scheme).AddKnownTypeWithName\r\n     10923  7.22% 90.27%      10923  7.22%  k8s.io/kubernetes/vendor/k8s.io/api/core/v1.(*ObjectReference).Unmarshal\r\n      5462  3.61% 93.88%      16386 10.83%  k8s.io/kubernetes/pkg/controller/endpointslice.(*endpointSliceTracker).Update\r\n      5461  3.61% 97.49%       5461  3.61%  k8s.io/kubernetes/vendor/golang.org/x/net/http2.awaitRequestCancel\r\n      2521  1.67% 99.16%       2521  1.67%  k8s.io/kubernetes/pkg/controller/garbagecollector.(*concurrentUIDToNode).Write\r\n```\r\n\r\n**What you expected to happen**:\r\nThe set of resource versions should be delete from endpointSliceTracker when the service is deleted.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): 1.18.5\r\n",
  "closed_at": "2020-07-12T03:56:14Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/92837/comments",
  "created_at": "2020-07-06T17:54:54Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/92837/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/92837",
  "id": 651719994,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "ededed",
      "default": false,
      "description": "Indicates an issue or PR lacks a `sig/foo` label and requires one.",
      "id": 617149945,
      "name": "needs-sig",
      "node_id": "MDU6TGFiZWw2MTcxNDk5NDU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/needs-sig"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/92837/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2NTE3MTk5OTQ=",
  "number": 92837,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "endpointSliceTracker memory leak",
  "updated_at": "2020-07-12T03:56:14Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/92837",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/5331316?v=4",
    "events_url": "https://api.github.com/users/tnqn/events{/privacy}",
    "followers_url": "https://api.github.com/users/tnqn/followers",
    "following_url": "https://api.github.com/users/tnqn/following{/other_user}",
    "gists_url": "https://api.github.com/users/tnqn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tnqn",
    "id": 5331316,
    "login": "tnqn",
    "node_id": "MDQ6VXNlcjUzMzEzMTY=",
    "organizations_url": "https://api.github.com/users/tnqn/orgs",
    "received_events_url": "https://api.github.com/users/tnqn/received_events",
    "repos_url": "https://api.github.com/users/tnqn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tnqn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tnqn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tnqn"
  }
}