{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**:\r\nTestUnreservePlugin is flaky: https://prow.k8s.io/view/gcs/kubernetes-jenkins/pr-logs/pull/79109/pull-kubernetes-integration/1145723758279921668/\r\n\r\n**What you expected to happen**:\r\nTest to always pass.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nThis is a flaky test, but the issue is that the unreserve plugin didn't get the change to execute before the test checked the unreserve call counter in the test. Assuming thread1 runs the scheduler, thread2 runs the tests, here is the sequence that caused this flake:\r\n\r\n* thread2 creates a pod and blocks on a [scheduling error](https://github.com/kubernetes/kubernetes/blob/de8fb1c9f81b1bd48a0d25f866492acca2c199f0/test/integration/scheduler/framework_test.go#L589).\r\n* thread1 tries to schedule the pod, executing the pre-bind plugin which denies the pod and [records a scheduling error](https://github.com/kubernetes/kubernetes/blob/de8fb1c9f81b1bd48a0d25f866492acca2c199f0/pkg/scheduler/scheduler.go#L574).\r\n* thread2 gets unblocked before thread1 gets to [run unreserve plugins](https://github.com/kubernetes/kubernetes/blob/de8fb1c9f81b1bd48a0d25f866492acca2c199f0/pkg/scheduler/scheduler.go#L576). Thread2 checks the counters, throwing an error since unreserve plugin call counter didn't get to be incremented.\r\n\r\n\r\nWhat we need is for the test to block until unreserve is called, not until we get a scheduling error.\r\n\r\n/sig scheduling",
  "closed_at": "2019-07-03T20:52:40Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/79611/comments",
  "created_at": "2019-07-01T18:48:09Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/79611/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/79611",
  "id": 462858016,
  "labels": [
    {
      "color": "006b75",
      "default": true,
      "description": "Denotes an issue that needs help from a contributor. Must meet \"help wanted\" guidelines.",
      "id": 433686790,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw0MzM2ODY3OTA=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/help%20wanted"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Scheduling.",
      "id": 125550211,
      "name": "sig/scheduling",
      "node_id": "MDU6TGFiZWwxMjU1NTAyMTE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/scheduling"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/79611/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NjI4NTgwMTY=",
  "number": 79611,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "TestUnreservePlugin is flaky, again",
  "updated_at": "2019-07-03T20:52:40Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/79611",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/40361897?v=4",
    "events_url": "https://api.github.com/users/ahg-g/events{/privacy}",
    "followers_url": "https://api.github.com/users/ahg-g/followers",
    "following_url": "https://api.github.com/users/ahg-g/following{/other_user}",
    "gists_url": "https://api.github.com/users/ahg-g/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ahg-g",
    "id": 40361897,
    "login": "ahg-g",
    "node_id": "MDQ6VXNlcjQwMzYxODk3",
    "organizations_url": "https://api.github.com/users/ahg-g/orgs",
    "received_events_url": "https://api.github.com/users/ahg-g/received_events",
    "repos_url": "https://api.github.com/users/ahg-g/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ahg-g/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ahg-g/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ahg-g"
  }
}