{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/7740897?v=4",
    "events_url": "https://api.github.com/users/dchen1107/events{/privacy}",
    "followers_url": "https://api.github.com/users/dchen1107/followers",
    "following_url": "https://api.github.com/users/dchen1107/following{/other_user}",
    "gists_url": "https://api.github.com/users/dchen1107/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dchen1107",
    "id": 7740897,
    "login": "dchen1107",
    "node_id": "MDQ6VXNlcjc3NDA4OTc=",
    "organizations_url": "https://api.github.com/users/dchen1107/orgs",
    "received_events_url": "https://api.github.com/users/dchen1107/received_events",
    "repos_url": "https://api.github.com/users/dchen1107/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dchen1107/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dchen1107/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dchen1107"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/7740897?v=4",
      "events_url": "https://api.github.com/users/dchen1107/events{/privacy}",
      "followers_url": "https://api.github.com/users/dchen1107/followers",
      "following_url": "https://api.github.com/users/dchen1107/following{/other_user}",
      "gists_url": "https://api.github.com/users/dchen1107/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dchen1107",
      "id": 7740897,
      "login": "dchen1107",
      "node_id": "MDQ6VXNlcjc3NDA4OTc=",
      "organizations_url": "https://api.github.com/users/dchen1107/orgs",
      "received_events_url": "https://api.github.com/users/dchen1107/received_events",
      "repos_url": "https://api.github.com/users/dchen1107/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dchen1107/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dchen1107/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dchen1107"
    }
  ],
  "author_association": "NONE",
  "body": "I've been struggling on a problem over the past week, that a few pods always fail to run.\n\nWhen I tried to manually run one of those, I got:\n\n```\ncore@ip-10-237-218-56 ~ $ docker run -ti kiyoto/fluentd:0.12.1-2.1.5 ls\nUnable to find image 'kiyoto/fluentd:0.12.1-2.1.5' locally\nPulling repository kiyoto/fluentd\n7d5bd4ed392e: Error pulling image (0.12.1-2.1.5) from kiyoto/fluentd, Driver btrfs failed to get image parent aaabd2b41e22543a7b230c2c892a482e80f99039209b193bdd2b67a526996b30: stat /var/lib/docker/btrfs/subvolumes/aaabd2b41e22543a7b230c2c892a482e80f99039209b193bdd2b67a526996b30: no such file or directory dd2b67a526996b30: no such file or directory\n3c20e07c38ce: Error downloading dependent layers\nFATA[0058] Error pulling image (0.12.1-2.1.5) from kiyoto/fluentd, Driver btrfs failed to get image parent aaabd2b41e22543a7b230c2c892a482e80f99039209b193bdd2b67a526996b30: stat /var/lib/docker/btrfs/subvolumes/aaabd2b41e22543a7b230c2c892a482e80f99039209b193bdd2b67a526996b30: no such file or directory\n```\n\nI could succesfully run the image on another os with different docker version and different backend filesystem, so I did many tests, to conclude that the problem is neither with btrfs, nor with docker, nor with coreos.\nI could create another aws autoscaling group, reusing the same versions of those tools, but without kubernetes, and I could sucessfully run that image there as well.\nI then removed all components from my cloudformation template, and readded them progressively, to notice that pulling this image only fails when the kubelet is running.\n\nI then tried to run the kubelet with different options, but the bare minimum `/opt/bin/kubelet --etcd_servers=http://127.0.0.1:4001` is enough for docker to fail on that image. Looking at the traceback:\n\n```\ncore@ip-10-237-218-56 ~ $ /opt/bin/kubelet --etcd_servers=http://127.0.0.1:4001\nI0120 02:24:41.867394   28317 node.go:52] Connecting to docker on unix:///var/run/docker.sock\nI0120 02:24:41.867526   28317 util.go:128] No api servers specified.\nI0120 02:24:41.878683   28317 standalone.go:205] Watching for etcd configs at [http://127.0.0.1:4001]\nI0120 02:24:41.885479   28317 plugins.go:56] Registering credential provider: .dockercfg\nI0120 02:24:41.885661   28317 logs.go:39] etcd DEBUG: get /registry/nodes/ip-10-237-218-56.ec2.internal/boundpods [http://127.0.0.1:4001]\nI0120 02:24:41.885743   28317 logs.go:39] etcd DEBUG: Connecting to etcd: attempt1forkeys/registry/nodes/ip-10-237-218-56.ec2.internal/boundpods?consistent=true&recursive=false&sorted=false\nI0120 02:24:41.885815   28317 logs.go:39] etcd DEBUG: send.request.to http://127.0.0.1:4001/v2/keys/registry/nodes/ip-10-237-218-56.ec2.internal/boundpods?consistent=true&recursive=false&sorted=false | method GET\nI0120 02:24:41.885868   28317 event.go:92] Event(api.ObjectReference{Kind:\"Minion\", Namespace:\"default\", Name:\"ip-10-237-218-56.ec2.internal\", UID:\"ip-10-237-218-56.ec2.internal\", APIVersion:\"\", ResourceVersion:\"\", FieldPath:\"\"}): status: '', reason: 'starting' Starting kubelet.\nI0120 02:24:41.928419   28317 logs.go:39] etcd DEBUG: recv.response.fromhttp://127.0.0.1:4001/v2/keys/registry/nodes/ip-10-237-218-56.ec2.internal/boundpods?consistent=true&recursive=false&sorted=false\nI0120 02:24:41.928492   28317 logs.go:39] etcd DEBUG: recv.success.http://127.0.0.1:4001/v2/keys/registry/nodes/ip-10-237-218-56.ec2.internal/boundpods?consistent=true&recursive=false&sorted=false\nI0120 02:24:41.928564   28317 logs.go:39] etcd DEBUG: watch /registry/nodes/ip-10-237-218-56.ec2.internal/boundpods [http://127.0.0.1:4001]\nI0120 02:24:41.928611   28317 logs.go:39] etcd DEBUG: get /registry/nodes/ip-10-237-218-56.ec2.internal/boundpods [http://127.0.0.1:4001]\nI0120 02:24:41.928660   28317 logs.go:39] etcd DEBUG: Connecting to etcd: attempt1forkeys/registry/nodes/ip-10-237-218-56.ec2.internal/boundpods?consistent=true&wait=true&waitIndex=3381\nI0120 02:24:41.928695   28317 logs.go:39] etcd DEBUG: send.request.to http://127.0.0.1:4001/v2/keys/registry/nodes/ip-10-237-218-56.ec2.internal/boundpods?consistent=true&wait=true&waitIndex=3381 | method GET\nI0120 02:24:41.929632   28317 logs.go:39] etcd DEBUG: recv.response.fromhttp://127.0.0.1:4001/v2/keys/registry/nodes/ip-10-237-218-56.ec2.internal/boundpods?consistent=true&wait=true&waitIndex=3381\n\ncore@ip-10-237-218-56 ~ $ curl http://127.0.0.1:4001/v2/keys/registry/nodes\n{\"errorCode\":100,\"message\":\"Key not found\",\"cause\":\"/registry/nodes\",\"index\":3422}\n\ncore@ip-10-237-218-56 ~ $ curl http://127.0.0.1:4001/v2/keys/registry/\n{\"action\":\"get\",\"node\":{\"key\":\"/registry\",\"dir\":true,\"nodes\":[{\"key\":\"/registry/services\",\"dir\":true,\"modifiedIndex\":14,\"createdIndex\":14},{\"key\":\"/registry/minions\",\"dir\":true,\"modifiedIndex\":37,\"createdIndex\":37}],\"modifiedIndex\":14,\"createdIndex\":14}}\n\ncore@ip-10-237-218-56 ~ $\n```\n\nDoes kubelet try to query `registry/nodes` when only `registry/services` and `registry/minions` are available?\nI still don't understand what does kubelet has to do with the btrfs error raised by docker, but the evidence is that everytime I stop kubelet, docker has no problem with the image:\n\n```\ncore@ip-10-237-218-56 ~ $ sudo systemctl stop kube-kubelet\ncore@ip-10-237-218-56 ~ $ docker run -ti kiyoto/fluentd:0.12.1-2.1.5 ls\nUnable to find image 'kiyoto/fluentd:0.12.1-2.1.5' locally\nPulling repository kiyoto/fluentd\n7d5bd4ed392e: Download complete\n511136ea3c5a: Download complete\n36fd425d7d8a: Download complete\naaabd2b41e22: Download complete\n3c20e07c38ce: Download complete\nb6ef456c239c: Download complete\nb045b0cd49ad: Download complete\n7855c14973cc: Download complete\n2a24c9b7a5f1: Download complete\nc82cadc1856f: Download complete\nf0f017241bb0: Download complete\n146d795aeab9: Download complete\n0f154b063a84: Download complete\nc04060062646: Download complete\ne1ebcc148e67: Download complete\n197ad3ee39c6: Download complete\nd8b6573c9c35: Download complete\n643b35d35def: Download complete\nf2e6d6ac3fb7: Download complete\nStatus: Downloaded newer image for kiyoto/fluentd:0.12.1-2.1.5\nbin   dev  home  lib64  mnt  proc  run   srv  tmp  var\nboot  etc  lib   media  opt  root  sbin  sys  usr\n```\n\nThis issue is a blocker. Since I cannot get the cluster-side logging to work yet (#2918), I'm trying to have a temporary fluentd pod running for application-side logging at first.\n\nAny suggestion?\n",
  "closed_at": "2015-01-20T22:07:00Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/5751682?v=4",
    "events_url": "https://api.github.com/users/brendandburns/events{/privacy}",
    "followers_url": "https://api.github.com/users/brendandburns/followers",
    "following_url": "https://api.github.com/users/brendandburns/following{/other_user}",
    "gists_url": "https://api.github.com/users/brendandburns/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brendandburns",
    "id": 5751682,
    "login": "brendandburns",
    "node_id": "MDQ6VXNlcjU3NTE2ODI=",
    "organizations_url": "https://api.github.com/users/brendandburns/orgs",
    "received_events_url": "https://api.github.com/users/brendandburns/received_events",
    "repos_url": "https://api.github.com/users/brendandburns/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brendandburns/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brendandburns/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brendandburns"
  },
  "comments": 11,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/3617/comments",
  "created_at": "2015-01-20T02:52:59Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/3617/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/3617",
  "id": 54837823,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Highest priority. Must be actively worked on as someone's top priority right now.",
      "id": 114528068,
      "name": "priority/critical-urgent",
      "node_id": "MDU6TGFiZWwxMTQ1MjgwNjg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/priority/critical-urgent"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/3617/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1NDgzNzgyMw==",
  "number": 3617,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "docker btrfs issue caused by kubelet",
  "updated_at": "2015-03-12T19:11:26Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/3617",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/260983?v=4",
    "events_url": "https://api.github.com/users/AdrienLemaire/events{/privacy}",
    "followers_url": "https://api.github.com/users/AdrienLemaire/followers",
    "following_url": "https://api.github.com/users/AdrienLemaire/following{/other_user}",
    "gists_url": "https://api.github.com/users/AdrienLemaire/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/AdrienLemaire",
    "id": 260983,
    "login": "AdrienLemaire",
    "node_id": "MDQ6VXNlcjI2MDk4Mw==",
    "organizations_url": "https://api.github.com/users/AdrienLemaire/orgs",
    "received_events_url": "https://api.github.com/users/AdrienLemaire/received_events",
    "repos_url": "https://api.github.com/users/AdrienLemaire/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/AdrienLemaire/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AdrienLemaire/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/AdrienLemaire"
  }
}