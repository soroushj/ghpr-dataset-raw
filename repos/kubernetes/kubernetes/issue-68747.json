{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**Is this a BUG REPORT or FEATURE REQUEST?**:\r\n\r\n> Uncomment only one, leave it on its own line:\r\n>\r\n/kind bug\r\n> /kind feature\r\n\r\n\r\n**What happened**:\r\nI'm running e2e tests via sonobuoy and had a number of tests skipped due to lack of an SSH key on the node. I then have created a secret, mounted it, set env vars to point to the key and set the SSH user. However, some tests explicitly require an external IP address () while others fallback to using an internal IP address since that may be reachable (which it is if running the tests through sonobuoy).\r\n\r\n**What you expected to happen**:\r\nI expected the external->internal fallback to be used more consistently in the tests. To emphasize, this is just in the test code and not in the \r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nRun sonobuoy tests with the e2e focus set to one of the tests below. You have to use `sonobuoy gen` to generate the yaml and modify a few things so that you get the secret in the right namespace and it gets mounted appropriately though.\r\n\r\nI've not run the e2e tests manually from my own machine, but if you were doing that then it should be even easier as long as you have a cluster up where the nodes do not have external IPs set.\r\n\r\n**Anything else we need to know?**:\r\nThis test can pass in my current setup: https://github.com/kubernetes/kubernetes/blob/733a381ec42ede15cd0499bc502a0cba6612f3ca/test/e2e/node/mount_propagation.go#L81\r\nSince this function has the fallback logic: https://github.com/kubernetes/kubernetes/blob/5de3896d0d18f072664650b94a8f6089be420cc0/test/e2e/framework/service_util.go#L332\r\n\r\nThis test fails: https://github.com/kubernetes/kubernetes/blob/7f23a743e8c23ac6489340bbb34fa6f1d392db9d/test/e2e/node/ssh.go#L43\r\nBecause this function does not have the fallback logic: https://github.com/kubernetes/kubernetes/blob/690179b1220ce8eba6d7b5e295b88fbe7772c18f/test/e2e/framework/util.go#L3271\r\n\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`):\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"7\", GitVersion:\"v1.7.6\", GitCommit:\"4bc5e7f9a6c25dc4c03d4d656f2cefd21540e28c\", GitTreeState:\"clean\", BuildDate:\"2017-09-15T08:51:21Z\", GoVersion:\"go1.9\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"\", Minor:\"\", GitVersion:\"v1.10.4\", GitCommit:\"5ca598b4ba5abb89bb773071ce452e33fb66339d\", GitTreeState:\"\", BuildDate:\"2018-06-27T08:25:31Z\", GoVersion:\"go1.9.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n- Cloud provider or hardware configuration:\r\n- OS (e.g. from /etc/os-release):\r\n- Kernel (e.g. `uname -a`):\r\n`Linux box-1 4.4.0-134-generic #160-Ubuntu SMP Wed Aug 15 14:58:00 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux`\r\n- Install tools:\r\n- Others:\r\n",
  "closed_at": "2019-01-07T22:11:42Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 7,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68747/comments",
  "created_at": "2018-09-17T16:03:59Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68747/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/68747",
  "id": 360938238,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Testing.",
      "id": 483069764,
      "name": "sig/testing",
      "node_id": "MDU6TGFiZWw0ODMwNjk3NjQ=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/testing"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68747/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNjA5MzgyMzg=",
  "number": 68747,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "E2E tests using SSH are inconsistent in IP requirements",
  "updated_at": "2019-01-07T22:11:42Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/68747",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/10273533?v=4",
    "events_url": "https://api.github.com/users/johnSchnake/events{/privacy}",
    "followers_url": "https://api.github.com/users/johnSchnake/followers",
    "following_url": "https://api.github.com/users/johnSchnake/following{/other_user}",
    "gists_url": "https://api.github.com/users/johnSchnake/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/johnSchnake",
    "id": 10273533,
    "login": "johnSchnake",
    "node_id": "MDQ6VXNlcjEwMjczNTMz",
    "organizations_url": "https://api.github.com/users/johnSchnake/orgs",
    "received_events_url": "https://api.github.com/users/johnSchnake/received_events",
    "repos_url": "https://api.github.com/users/johnSchnake/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/johnSchnake/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/johnSchnake/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/johnSchnake"
  }
}