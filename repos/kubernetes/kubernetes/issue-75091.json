{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**What happened**:\r\nCreation of Volume on vSphere Cloud Provider failed with error \"A component of the virtual machine is not accessible on the host\" under these conditions:\r\n\r\nAssume we have following setup.\r\n\r\n```\r\nDC1\r\n    cls1 - zone-a\r\n        vsandatastore-1     (SPBM Policy: spbm-policy-1)\r\n        host-1  - localds1\r\n        host-2  - localds2\r\n        host-3  - localds3\r\n        resource-pool1\r\n\r\n    cls2 \u2013 zone-b\r\n        vsandatastore-2     (SPBM Policy: spbm-policy-2)\r\n        host-4 - localds4\r\n        host-5 - localds5 \r\n        host-6 - localds6\r\n        resource-pool2\r\n```\r\n\r\nIf vsphere.conf has `resourcepool-path=\"cls1/resource-pool1\"` then the dummy VM for a SPBM policy based Volume will be created on this resource pool.\r\n\r\nHowever, if the volume is provisioned using a SC that uses spbm-policy-2 on zone: zone-b, then the Volume creation fails with this error - Failed to provision volume with StorageClass \"xxx\": A component of the virtual machine is not accessible on the host.\r\n\r\n**What you expected to happen**:\r\nOne work around is to correct the entry in vsphere.conf as `resourcepool-path=\"cls2/resource-pool2\"` in the above example. This will then allow the Volume to be created in this cluster cls2.\r\n\r\nHowever, the next Volume creation on the first cluster cls1 will once again face the same issue. Changing the configuration in vsphere.conf and restarting the kube services potentially every time a Volume needs to be created is a very inferior work around.\r\n\r\nThe right behaviour is for vSphere Cloud Provider to either\r\n1. provide a way for users to configure both the resource pools, one for each zone, in vsphere.conf\r\n2. automatically detect the right 'resource pool' to use when creating a Volume.\r\n\r\nI would prefer the approach 2.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\nAlready described above.\r\n\r\n**Anything else we need to know?**:\r\nThis issue affects only when SPBM policy is used in Volume creation.\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): all\r\n- Cloud provider or hardware configuration: vsphere\r\n\r\n/sig vmware\r\n/sig cloud-provider\r\n",
  "closed_at": "2019-05-07T15:15:55Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/75091/comments",
  "created_at": "2019-03-07T09:30:28Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/75091/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/75091",
  "id": 418208931,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "Issues or PRs related to vmware provider",
      "id": 874113778,
      "name": "area/provider/vmware",
      "node_id": "MDU6TGFiZWw4NzQxMTM3Nzg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/provider/vmware"
    },
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Cloud Provider.",
      "id": 958178286,
      "name": "sig/cloud-provider",
      "node_id": "MDU6TGFiZWw5NTgxNzgyODY=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/cloud-provider"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/75091/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MTgyMDg5MzE=",
  "number": 75091,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Volume creation fails with \"A component of the virtual machine is not accessible on the host\"",
  "updated_at": "2019-05-07T15:15:55Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/75091",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/5960548?v=4",
    "events_url": "https://api.github.com/users/subramanian-neelakantan/events{/privacy}",
    "followers_url": "https://api.github.com/users/subramanian-neelakantan/followers",
    "following_url": "https://api.github.com/users/subramanian-neelakantan/following{/other_user}",
    "gists_url": "https://api.github.com/users/subramanian-neelakantan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/subramanian-neelakantan",
    "id": 5960548,
    "login": "subramanian-neelakantan",
    "node_id": "MDQ6VXNlcjU5NjA1NDg=",
    "organizations_url": "https://api.github.com/users/subramanian-neelakantan/orgs",
    "received_events_url": "https://api.github.com/users/subramanian-neelakantan/received_events",
    "repos_url": "https://api.github.com/users/subramanian-neelakantan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/subramanian-neelakantan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/subramanian-neelakantan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/subramanian-neelakantan"
  }
}