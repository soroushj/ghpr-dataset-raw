{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- Please use this template while reporting a bug and provide as much info as possible. Not doing so may result in your bug not being addressed in a timely manner. Thanks!\r\n\r\nIf the matter is security related, please disclose it privately via https://kubernetes.io/security/\r\n-->\r\n\r\n\r\n**What happened**: With CentOS 7.6, the kubelet systemd service may failed, because the numbers of NUMA nodes it reports is different from the actual number of nodes. the kubelet log is:\r\n\r\nSep 25 10:26:37 node50 systemd: Started Kubernetes systemd probe.\r\nSep 25 10:26:37 node50 kubelet: I0925 10:26:37.696734  275300 server.go:410] Version: v1.16.0\r\nSep 25 10:26:37 node50 kubelet: I0925 10:26:37.697108  275300 plugins.go:100] No cloud provider specified.\r\nSep 25 10:26:37 node50 kubelet: I0925 10:26:37.697143  275300 server.go:773] Client rotation is on, will bootstrap in background\r\nSep 25 10:26:37 node50 kubelet: I0925 10:26:37.719287  275300 certificate_store.go:129] Loading cert/key pair from \"/var/lib/kubelet/pki/kubelet-client-current.pem\".\r\nSep 25 10:26:37 node50 kubelet: I0925 10:26:37.962954  275300 server.go:644] --cgroups-per-qos enabled, but --cgroup-root was not specified.  defaulting to /\r\nSep 25 10:26:37 node50 kubelet: F0925 10:26:37.963578  275300 server.go:271] failed to run Kubelet: open /sys/devices/system/node/node2/cpulist: no such file or directory\r\nSep 25 10:26:37 node50 systemd: kubelet.service: main process exited, code=exited, status=255/n/a\r\nSep 25 10:26:37 node50 systemd: Unit kubelet.service entered failed state.\r\n\r\n\r\n**What you expected to happen**: \r\nBut this node has only 2 NUMA nodes, node0 and node1\r\n[root@node50 ~]# lscpu\r\nArchitecture:          x86_64\r\nCPU op-mode(s):        32-bit, 64-bit\r\nByte Order:            Little Endian\r\nCPU(s):                72\r\nOn-line CPU(s) list:   0-71\r\nThread(s) per core:    2\r\nCore(s) per socket:    18\r\nSocket(s):             2\r\nNUMA node(s):          2\r\nVendor ID:             GenuineIntel\r\nCPU family:            6\r\nModel:                 85\r\nModel name:            Intel(R) Xeon(R) Gold 6240Y CPU @ 2.60GHz\r\nStepping:              7\r\nCPU MHz:               1000.073\r\nCPU max MHz:           3900.0000\r\nCPU min MHz:           1000.0000\r\nBogoMIPS:              5200.00\r\nVirtualization:        VT-x\r\nL1d cache:             32K\r\nL1i cache:             32K\r\nL2 cache:              1024K\r\nL3 cache:              25344K\r\nNUMA node0 CPU(s):     0-17,36-53\r\nNUMA node1 CPU(s):     18-35,54-71\r\nFlags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 ......\r\n\r\n\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**: \r\nWith Intel Xeon CLX-SP 2 sockets CPUs, in CentOS 7.6, sometimes the sysfs /sys/devices/system/node/possible reports more than actual CPU counts. And the topology in cpumanager read this file, if it reads 4 CPUs, but there are only 2 CPUs, then kubelet service will failed.\r\n\r\n[root@node50 ~]# cat /sys/devices/system/node/possible\r\n0-3\r\n[root@node50 ~]# cat /sys/devices/system/node/online\r\n0-1\r\n\r\n\r\n**Anything else we need to know?**:\r\nSuggest func GetNUMANodeInfo() read /sys/devices/system/node/online instead of /sys/devices/system/node/possible\r\n\r\n**Environment**:\r\n- Kubernetes version (use `kubectl version`): \r\n[root@node50 ~]# kubectl version\r\nClient Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.0\", GitCommit:\"2bd9643cee5b3b3a5ecbd3af49d09018f0773c77\", GitTreeState:\"clean\", BuildDate:\"2019-09-18T14:36:53Z\", GoVersion:\"go1.12.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n- Cloud provider or hardware configuration: \r\n2x socket Intel Xeon Gold 6240Y\r\n- OS (e.g: `cat /etc/os-release`): \r\n[root@node50 ~]# cat /etc/os-release\r\nNAME=\"CentOS Linux\"\r\nVERSION=\"7 (Core)\"\r\nID=\"centos\"\r\nID_LIKE=\"rhel fedora\"\r\nVERSION_ID=\"7\"\r\nPRETTY_NAME=\"CentOS Linux 7 (Core)\"\r\nANSI_COLOR=\"0;31\"\r\nCPE_NAME=\"cpe:/o:centos:centos:7\"\r\nHOME_URL=\"https://www.centos.org/\"\r\nBUG_REPORT_URL=\"https://bugs.centos.org/\"\r\n\r\nCENTOS_MANTISBT_PROJECT=\"CentOS-7\"\r\nCENTOS_MANTISBT_PROJECT_VERSION=\"7\"\r\nREDHAT_SUPPORT_PRODUCT=\"centos\"\r\nREDHAT_SUPPORT_PRODUCT_VERSION=\"7\"\r\n\r\n- Kernel (e.g. `uname -a`):\r\n[root@node50 ~]# uname -a\r\nLinux node50 3.10.0-957.el7.x86_64 #1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n- Install tools:\r\n- Network plugin and version (if this is a network-related bug):\r\n- Others:\r\n",
  "closed_at": "2019-09-28T05:51:40Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/20407524?v=4",
    "events_url": "https://api.github.com/users/k8s-ci-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-ci-robot/followers",
    "following_url": "https://api.github.com/users/k8s-ci-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-ci-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-ci-robot",
    "id": 20407524,
    "login": "k8s-ci-robot",
    "node_id": "MDQ6VXNlcjIwNDA3NTI0",
    "organizations_url": "https://api.github.com/users/k8s-ci-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-ci-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-ci-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-ci-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-ci-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-ci-robot"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/83175/comments",
  "created_at": "2019-09-26T06:49:32Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/83175/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/83175",
  "id": 498693620,
  "labels": [
    {
      "color": "e11d21",
      "default": false,
      "description": "Categorizes issue or PR as related to a bug.",
      "id": 105146071,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwxMDUxNDYwNzE=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/kind/bug"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Node.",
      "id": 173493665,
      "name": "sig/node",
      "node_id": "MDU6TGFiZWwxNzM0OTM2NjU=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/node"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/83175/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0OTg2OTM2MjA=",
  "number": 83175,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "kubelet service failed with wrong number of possible NUMA nodes",
  "updated_at": "2019-09-28T05:51:40Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/83175",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/733305?v=4",
    "events_url": "https://api.github.com/users/tsrjzq/events{/privacy}",
    "followers_url": "https://api.github.com/users/tsrjzq/followers",
    "following_url": "https://api.github.com/users/tsrjzq/following{/other_user}",
    "gists_url": "https://api.github.com/users/tsrjzq/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tsrjzq",
    "id": 733305,
    "login": "tsrjzq",
    "node_id": "MDQ6VXNlcjczMzMwNQ==",
    "organizations_url": "https://api.github.com/users/tsrjzq/orgs",
    "received_events_url": "https://api.github.com/users/tsrjzq/received_events",
    "repos_url": "https://api.github.com/users/tsrjzq/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tsrjzq/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tsrjzq/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tsrjzq"
  }
}