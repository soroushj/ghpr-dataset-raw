{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/837034?v=4",
    "events_url": "https://api.github.com/users/bowei/events{/privacy}",
    "followers_url": "https://api.github.com/users/bowei/followers",
    "following_url": "https://api.github.com/users/bowei/following{/other_user}",
    "gists_url": "https://api.github.com/users/bowei/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bowei",
    "id": 837034,
    "login": "bowei",
    "node_id": "MDQ6VXNlcjgzNzAzNA==",
    "organizations_url": "https://api.github.com/users/bowei/orgs",
    "received_events_url": "https://api.github.com/users/bowei/received_events",
    "repos_url": "https://api.github.com/users/bowei/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bowei/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bowei/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bowei"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/837034?v=4",
      "events_url": "https://api.github.com/users/bowei/events{/privacy}",
      "followers_url": "https://api.github.com/users/bowei/followers",
      "following_url": "https://api.github.com/users/bowei/following{/other_user}",
      "gists_url": "https://api.github.com/users/bowei/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/bowei",
      "id": 837034,
      "login": "bowei",
      "node_id": "MDQ6VXNlcjgzNzAzNA==",
      "organizations_url": "https://api.github.com/users/bowei/orgs",
      "received_events_url": "https://api.github.com/users/bowei/received_events",
      "repos_url": "https://api.github.com/users/bowei/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/bowei/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bowei/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/bowei"
    },
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/5751682?v=4",
      "events_url": "https://api.github.com/users/brendandburns/events{/privacy}",
      "followers_url": "https://api.github.com/users/brendandburns/followers",
      "following_url": "https://api.github.com/users/brendandburns/following{/other_user}",
      "gists_url": "https://api.github.com/users/brendandburns/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/brendandburns",
      "id": 5751682,
      "login": "brendandburns",
      "node_id": "MDQ6VXNlcjU3NTE2ODI=",
      "organizations_url": "https://api.github.com/users/brendandburns/orgs",
      "received_events_url": "https://api.github.com/users/brendandburns/received_events",
      "repos_url": "https://api.github.com/users/brendandburns/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/brendandburns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brendandburns/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/brendandburns"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**BUG REPORT**:\r\n\r\n**Kubernetes version** (use `kubectl version`):\r\n\r\n````\r\nClient Version: version.Info{Major:\"1\", Minor:\"5\", GitVersion:\"v1.5.3\", GitCommit:\"029c3a408176b55c30846f0faedf56aae5992e9b\", GitTreeState:\"clean\", BuildDate:\"2017-02-15T06:40:50Z\", GoVersion:\"go1.7.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"5\", GitVersion:\"v1.5.3\", GitCommit:\"029c3a408176b55c30846f0faedf56aae5992e9b\", GitTreeState:\"clean\", BuildDate:\"2017-02-15T06:34:56Z\", GoVersion:\"go1.7.4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n````\r\n\r\n**Environment**:\r\n- **Cloud provider or hardware configuration**:\r\n````\r\nazure\r\n````\r\n- **OS** (e.g. from /etc/os-release): \r\n````\r\nPRETTY_NAME=\"CentOS Linux 7 (Core)\"\r\n````\r\n- **Kernel** (e.g. `uname -a`):\r\n````\r\nLinux kubemaster0 3.10.0-327.36.3.el7.x86_64 #1 SMP Mon Oct 24 16:09:20 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n````\r\n- **Install tools**: \r\n````\r\nin-house\r\n````\r\n- **Others**:\r\nCC: @colemickens @brendandburns \r\n\r\n**What happened**:\r\n\r\nThere are resource leaks in the cloud with respect to PublicIp and LoadBalancer Frontend Ip Pool and HealthProbe\r\n\r\n**What you expected to happen**:\r\n\r\nAll created cloud resources, associated with a deleted service, should be destroyed. This is causing the Azure Load Balancer to fill up its frontend IP Pool which is currently limited to 10 entries. After a few resource leak, the new kuberntes services cannot get valid External IP since the Azure Load Balancer is full. \r\n\r\n**How to reproduce it** (as minimally and precisely as possible):\r\n\r\n- Create 5 namespaces and deploy the guestbook-all-in-one.yml example. (making sure you turn on the LoadBalancer type for the frontend service)\r\n- Wait for all of the 5 PublicIP to be provisioned in the Azure Load Balancer.\r\n- Delete all of the 5 namespaces using the `kubectl delete ns <nsX>`\r\n- Poll the namespaces until they are totally gone from kubernetes and recreate them.\r\n- Redeploy the guestbook-all-in-one.yml in all 5 namespaces.\r\n\r\nYou will probably end up with 5 new IPs BUT not all of the previous ones will be deleted. \r\n\r\n**Anything else we need to know**:\r\n\r\n**Kube-Controller-Manager Logs**\r\n\r\n[kube-controller-manager.txt](https://github.com/kubernetes/kubernetes/files/874318/kube-controller-manager.txt)\r\n\r\n\r\nService IP after the first pod creation\r\n````\r\n[root@saltmaster ~]# kubectl get services --all-namespaces\r\nNAMESPACE     NAME                     CLUSTER-IP        EXTERNAL-IP      PORT(S)                       AGE\r\ndefault       kubernetes               192.168.0.1       <none>           443/TCP                       8h\r\nkube-system   grafana                  192.168.28.80     52.184.156.62    80:31953/TCP                  7h\r\nkube-system   heapster                 192.168.175.45    <none>           80/TCP                        7h\r\nkube-system   influxdb                 192.168.38.109    52.184.157.3     8083:8083/TCP,8086:8086/TCP   7h\r\nkube-system   k8s-dashboard-dpl-tool   192.168.164.238   <nodes>          9090:9090/TCP                 7h\r\nkube-system   kapacitor                192.168.167.191   <nodes>          9092:9092/TCP                 7h\r\nkube-system   kube-dns                 192.168.0.10      <none>           53/UDP,53/TCP,10054/TCP       7h\r\nkube-system   kube-state-metrics       192.168.109.99    <none>           80/TCP                        7h\r\nkube-system   kubernetes-dashboard     192.168.173.127   <none>           80/TCP                        7h\r\ntest1         frontend                 192.168.26.73     52.167.216.18    80:28459/TCP                  6m\r\ntest1         redis-master             192.168.94.101    <none>           6379/TCP                      6m\r\ntest1         redis-slave              192.168.21.41     <none>           6379/TCP                      6m\r\ntest2         frontend                 192.168.182.80    52.184.158.235   80:23436/TCP                  6m\r\ntest2         redis-master             192.168.15.131    <none>           6379/TCP                      6m\r\ntest2         redis-slave              192.168.137.122   <none>           6379/TCP                      6m\r\ntest3         frontend                 192.168.203.37    52.184.157.149   80:18365/TCP                  6m\r\ntest3         redis-master             192.168.237.227   <none>           6379/TCP                      6m\r\ntest3         redis-slave              192.168.217.46    <none>           6379/TCP                      6m\r\ntest4         frontend                 192.168.44.177    52.184.158.222   80:21141/TCP                  6m\r\ntest4         redis-master             192.168.56.115    <none>           6379/TCP                      6m\r\ntest4         redis-slave              192.168.94.50     <none>           6379/TCP                      6m\r\ntest5         frontend                 192.168.96.186    52.184.154.45    80:21171/TCP                  6m\r\ntest5         redis-master             192.168.228.221   <none>           6379/TCP                      6m\r\ntest5         redis-slave              192.168.98.239    <none>           6379/TCP                      6m\r\n````\r\nService IP after the re-creation\r\n````\r\n[root@kubemaster0 ~]# kubectl get service --all-namespaces\r\nNAMESPACE     NAME                     CLUSTER-IP        EXTERNAL-IP      PORT(S)                       AGE\r\ndefault       kubernetes               192.168.0.1       <none>           443/TCP                       8h\r\nkube-system   grafana                  192.168.28.80     52.184.156.62    80:31953/TCP                  8h\r\nkube-system   heapster                 192.168.175.45    <none>           80/TCP                        8h\r\nkube-system   influxdb                 192.168.38.109    52.184.157.3     8083:8083/TCP,8086:8086/TCP   8h\r\nkube-system   k8s-dashboard-dpl-tool   192.168.164.238   <nodes>          9090:9090/TCP                 8h\r\nkube-system   kapacitor                192.168.167.191   <nodes>          9092:9092/TCP                 8h\r\nkube-system   kube-dns                 192.168.0.10      <none>           53/UDP,53/TCP,10054/TCP       8h\r\nkube-system   kube-state-metrics       192.168.109.99    <none>           80/TCP                        7h\r\nkube-system   kubernetes-dashboard     192.168.173.127   <none>           80/TCP                        8h\r\ntest1         frontend                 192.168.217.229   52.184.182.50    80:30532/TCP                  9m\r\ntest1         redis-master             192.168.241.171   <none>           6379/TCP                      9m\r\ntest1         redis-slave              192.168.47.101    <none>           6379/TCP                      9m\r\ntest2         frontend                 192.168.116.19    52.184.185.178   80:13829/TCP                  7m\r\ntest2         redis-master             192.168.128.86    <none>           6379/TCP                      7m\r\ntest2         redis-slave              192.168.221.99    <none>           6379/TCP                      7m\r\ntest3         frontend                 192.168.140.231   52.167.213.164   80:14027/TCP                  7m\r\ntest3         redis-master             192.168.21.217    <none>           6379/TCP                      7m\r\ntest3         redis-slave              192.168.37.14     <none>           6379/TCP                      7m\r\ntest4         frontend                 192.168.194.229   52.184.181.215   80:7269/TCP                   7m\r\ntest4         redis-master             192.168.113.141   <none>           6379/TCP                      7m\r\ntest4         redis-slave              192.168.138.243   <none>           6379/TCP                      7m\r\ntest5         frontend                 192.168.111.68    52.167.212.141   80:13231/TCP                  7m\r\ntest5         redis-master             192.168.249.202   <none>           6379/TCP                      7m\r\ntest5         redis-slave              192.168.65.147    <none>           6379/TCP                      7m\r\n````\r\n\r\nAzure frontend Pool Screen Shot\r\n<img width=\"799\" alt=\"screen shot 2017-03-27 at 22 17 38\" src=\"https://cloud.githubusercontent.com/assets/4981802/24386010/3aa0f1d8-133b-11e7-8339-776aa53cb0e0.png\">\r\n",
  "closed_at": "2017-08-24T09:32:09Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/13653959?v=4",
    "events_url": "https://api.github.com/users/k8s-github-robot/events{/privacy}",
    "followers_url": "https://api.github.com/users/k8s-github-robot/followers",
    "following_url": "https://api.github.com/users/k8s-github-robot/following{/other_user}",
    "gists_url": "https://api.github.com/users/k8s-github-robot/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/k8s-github-robot",
    "id": 13653959,
    "login": "k8s-github-robot",
    "node_id": "MDQ6VXNlcjEzNjUzOTU5",
    "organizations_url": "https://api.github.com/users/k8s-github-robot/orgs",
    "received_events_url": "https://api.github.com/users/k8s-github-robot/received_events",
    "repos_url": "https://api.github.com/users/k8s-github-robot/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/k8s-github-robot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k8s-github-robot/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/k8s-github-robot"
  },
  "comments": 41,
  "comments_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43730/comments",
  "created_at": "2017-03-28T02:23:49Z",
  "events_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43730/events",
  "html_url": "https://github.com/kubernetes/kubernetes/issues/43730",
  "id": 217429313,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 136601472,
      "name": "area/controller-manager",
      "node_id": "MDU6TGFiZWwxMzY2MDE0NzI=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/area/controller-manager"
    },
    {
      "color": "d2b48c",
      "default": false,
      "description": "Categorizes an issue or PR as relevant to SIG Network.",
      "id": 116712108,
      "name": "sig/network",
      "node_id": "MDU6TGFiZWwxMTY3MTIxMDg=",
      "url": "https://api.github.com/repos/kubernetes/kubernetes/labels/sig/network"
    }
  ],
  "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43730/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2019-08-26T17:23:28Z",
    "closed_issues": 1061,
    "created_at": "2017-05-26T17:18:43Z",
    "creator": {
      "avatar_url": "https://avatars0.githubusercontent.com/u/169553?v=4",
      "events_url": "https://api.github.com/users/timothysc/events{/privacy}",
      "followers_url": "https://api.github.com/users/timothysc/followers",
      "following_url": "https://api.github.com/users/timothysc/following{/other_user}",
      "gists_url": "https://api.github.com/users/timothysc/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/timothysc",
      "id": 169553,
      "login": "timothysc",
      "node_id": "MDQ6VXNlcjE2OTU1Mw==",
      "organizations_url": "https://api.github.com/users/timothysc/orgs",
      "received_events_url": "https://api.github.com/users/timothysc/received_events",
      "repos_url": "https://api.github.com/users/timothysc/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/timothysc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/timothysc/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/timothysc"
    },
    "description": "",
    "due_on": "2017-09-27T07:00:00Z",
    "html_url": "https://github.com/kubernetes/kubernetes/milestone/36",
    "id": 2545392,
    "labels_url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/36/labels",
    "node_id": "MDk6TWlsZXN0b25lMjU0NTM5Mg==",
    "number": 36,
    "open_issues": 0,
    "state": "closed",
    "title": "v1.8",
    "updated_at": "2019-08-26T17:23:28Z",
    "url": "https://api.github.com/repos/kubernetes/kubernetes/milestones/36"
  },
  "node_id": "MDU6SXNzdWUyMTc0MjkzMTM=",
  "number": 43730,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/kubernetes/kubernetes",
  "state": "closed",
  "title": "Cloud Provider PublicIP resource Leak when deleting and re-creating multiple services at the same time. ",
  "updated_at": "2018-02-26T21:38:06Z",
  "url": "https://api.github.com/repos/kubernetes/kubernetes/issues/43730",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/4981802?v=4",
    "events_url": "https://api.github.com/users/djsly/events{/privacy}",
    "followers_url": "https://api.github.com/users/djsly/followers",
    "following_url": "https://api.github.com/users/djsly/following{/other_user}",
    "gists_url": "https://api.github.com/users/djsly/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/djsly",
    "id": 4981802,
    "login": "djsly",
    "node_id": "MDQ6VXNlcjQ5ODE4MDI=",
    "organizations_url": "https://api.github.com/users/djsly/orgs",
    "received_events_url": "https://api.github.com/users/djsly/received_events",
    "repos_url": "https://api.github.com/users/djsly/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/djsly/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/djsly/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/djsly"
  }
}