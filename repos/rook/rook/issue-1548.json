{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/3718398?v=4",
    "events_url": "https://api.github.com/users/galexrt/events{/privacy}",
    "followers_url": "https://api.github.com/users/galexrt/followers",
    "following_url": "https://api.github.com/users/galexrt/following{/other_user}",
    "gists_url": "https://api.github.com/users/galexrt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/galexrt",
    "id": 3718398,
    "login": "galexrt",
    "node_id": "MDQ6VXNlcjM3MTgzOTg=",
    "organizations_url": "https://api.github.com/users/galexrt/orgs",
    "received_events_url": "https://api.github.com/users/galexrt/received_events",
    "repos_url": "https://api.github.com/users/galexrt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/galexrt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/galexrt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/galexrt"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/3718398?v=4",
      "events_url": "https://api.github.com/users/galexrt/events{/privacy}",
      "followers_url": "https://api.github.com/users/galexrt/followers",
      "following_url": "https://api.github.com/users/galexrt/following{/other_user}",
      "gists_url": "https://api.github.com/users/galexrt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/galexrt",
      "id": 3718398,
      "login": "galexrt",
      "node_id": "MDQ6VXNlcjM3MTgzOTg=",
      "organizations_url": "https://api.github.com/users/galexrt/orgs",
      "received_events_url": "https://api.github.com/users/galexrt/received_events",
      "repos_url": "https://api.github.com/users/galexrt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/galexrt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/galexrt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/galexrt"
    }
  ],
  "author_association": "NONE",
  "body": "Bug Report\r\n\r\nWhat happened:\r\n\r\nI rebooted a machine, and it was down long enough to trigger a mon rollover.   The new mon came up on 127.0.0.1 and in a bad state.\r\n\r\nWhat you expected to happen:\r\n\r\na new mon comes up in a good state.\r\n\r\nHow to reproduce it (minimal and precise):\r\n\r\nWith a 4 machine kubernetes cluster, shut down one of your machines.\r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release):  Ubuntu 16.04\r\n* Kernel (e.g. `uname -a`): 4.13.0-32-generic\r\n* Cloud provider or hardware configuration: ThreadRippper bare metal\r\n* Rook version (use `rook version` inside of a Rook Pod): v0.6.0-204.gc62747d\r\n* Kubernetes version (use `kubectl version`): v1.9.2+coreos.0\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift): kubespray\r\n* Ceph status (use `ceph health` in the [Rook toolbox](https://Rook.io/docs/Rook/master/toolbox.html)): HEALTH_OK\r\n\r\nrookctl status\r\n\r\n```\r\nNAME             ADDRESS                 IN QUORUM   STATUS\r\nrook-ceph-mon3   127.0.0.1:6790/0        true        OK\r\nrook-ceph-mon0   192.168.100.93:6790/0   true        OK\r\nrook-ceph-mon2   192.168.100.95:6790/0   true        OK\r\n```\r\n\r\noperator logs\r\n\r\n```\r\nE0305 16:46:02.179049       7 streamwatcher.go:109] Unable to decode an event from the watch stream: http2: server sent GOAWAY and closed the connection; LastStreamID=2495, ErrCode=NO_ERROR, debug=\"\"\r\nE0305 16:46:02.179778       7 streamwatcher.go:109] Unable to decode an event from the watch stream: http2: server sent GOAWAY and closed the connection; LastStreamID=2495, ErrCode=NO_ERROR, debug=\"\"\r\nE0305 16:46:02.180044       7 streamwatcher.go:109] Unable to decode an event from the watch stream: http2: server sent GOAWAY and closed the connection; LastStreamID=2495, ErrCode=NO_ERROR, debug=\"\"\r\nE0305 16:46:02.180303       7 streamwatcher.go:109] Unable to decode an event from the watch stream: http2: server sent GOAWAY and closed the connection; LastStreamID=2495, ErrCode=NO_ERROR, debug=\"\"\r\nE0305 16:46:02.180879       7 streamwatcher.go:109] Unable to decode an event from the watch stream: http2: server sent GOAWAY and closed the connection; LastStreamID=2495, ErrCode=NO_ERROR, debug=\"\"\r\nE0305 16:46:02.180915       7 streamwatcher.go:109] Unable to decode an event from the watch stream: http2: server sent GOAWAY and closed the connection; LastStreamID=2495, ErrCode=NO_ERROR, debug=\"\"\r\nE0305 16:46:02.180929       7 streamwatcher.go:109] Unable to decode an event from the watch stream: http2: server sent GOAWAY and closed the connection; LastStreamID=2495, ErrCode=NO_ERROR, debug=\"\"\r\n2018-03-05 16:46:48.669015 W | op-mon: mon rook-ceph-mon1 NOT found in quorum. {Quorum:[0 2] MonMap:{Mons:[{Name:rook-ceph-mon0 Rank:0 Address:192.168.100.93:6790/0} {Name:rook-ceph-mon1 Rank:1 Address:192.168.100.94:6790/0} {Name:rook-ceph-mon2 Rank:2 Address:192.168.100.95:6790/0}]}}\r\n2018-03-05 16:46:48.669049 W | op-mon: mon rook-ceph-mon1 NOT found in quorum, STILL in mon out timeout\r\n2018-03-05 16:47:34.023946 W | op-mon: mon rook-ceph-mon1 NOT found in quorum. {Quorum:[0 2] MonMap:{Mons:[{Name:rook-ceph-mon0 Rank:0 Address:192.168.100.93:6790/0} {Name:rook-ceph-mon1 Rank:1 Address:192.168.100.94:6790/0} {Name:rook-ceph-mon2 Rank:2 Address:192.168.100.95:6790/0}]}}\r\n2018-03-05 16:47:34.023975 W | op-mon: mon rook-ceph-mon1 NOT found in quorum, STILL in mon out timeout\r\n2018-03-05 16:48:19.391703 W | op-mon: mon rook-ceph-mon1 NOT found in quorum. {Quorum:[0 2] MonMap:{Mons:[{Name:rook-ceph-mon0 Rank:0 Address:192.168.100.93:6790/0} {Name:rook-ceph-mon1 Rank:1 Address:192.168.100.94:6790/0} {Name:rook-ceph-mon2 Rank:2 Address:192.168.100.95:6790/0}]}}\r\n2018-03-05 16:48:19.391889 W | op-mon: mon rook-ceph-mon1 NOT found in quorum, STILL in mon out timeout\r\n2018-03-05 16:49:04.746534 W | op-mon: mon rook-ceph-mon1 NOT found in quorum. {Quorum:[0 2] MonMap:{Mons:[{Name:rook-ceph-mon0 Rank:0 Address:192.168.100.93:6790/0} {Name:rook-ceph-mon1 Rank:1 Address:192.168.100.94:6790/0} {Name:rook-ceph-mon2 Rank:2 Address:192.168.100.95:6790/0}]}}\r\n2018-03-05 16:49:04.746563 W | op-mon: mon rook-ceph-mon1 NOT found in quorum, STILL in mon out timeout\r\n2018-03-05 16:49:50.129352 W | op-mon: mon rook-ceph-mon1 NOT found in quorum. {Quorum:[0 2] MonMap:{Mons:[{Name:rook-ceph-mon0 Rank:0 Address:192.168.100.93:6790/0} {Name:rook-ceph-mon1 Rank:1 Address:192.168.100.94:6790/0} {Name:rook-ceph-mon2 Rank:2 Address:192.168.100.95:6790/0}]}}\r\n2018-03-05 16:49:50.129388 W | op-mon: mon rook-ceph-mon1 NOT found in quorum, STILL in mon out timeout\r\n2018-03-05 16:50:35.484356 W | op-mon: mon rook-ceph-mon1 NOT found in quorum. {Quorum:[0 2] MonMap:{Mons:[{Name:rook-ceph-mon0 Rank:0 Address:192.168.100.93:6790/0} {Name:rook-ceph-mon1 Rank:1 Address:192.168.100.94:6790/0} {Name:rook-ceph-mon2 Rank:2 Address:192.168.100.95:6790/0}]}}\r\n2018-03-05 16:50:35.484407 W | op-mon: mon rook-ceph-mon1 NOT found in quorum, STILL in mon out timeout\r\n2018-03-05 16:51:20.982597 W | op-mon: mon rook-ceph-mon1 NOT found in quorum. {Quorum:[0 2] MonMap:{Mons:[{Name:rook-ceph-mon0 Rank:0 Address:192.168.100.93:6790/0} {Name:rook-ceph-mon1 Rank:1 Address:192.168.100.94:6790/0} {Name:rook-ceph-mon2 Rank:2 Address:192.168.100.95:6790/0}]}}\r\n2018-03-05 16:51:20.982631 W | op-mon: mon rook-ceph-mon1 NOT found in quorum, STILL in mon out timeout\r\n2018-03-05 16:52:06.345015 W | op-mon: mon rook-ceph-mon1 NOT found in quorum. {Quorum:[0 2] MonMap:{Mons:[{Name:rook-ceph-mon0 Rank:0 Address:192.168.100.93:6790/0} {Name:rook-ceph-mon1 Rank:1 Address:192.168.100.94:6790/0} {Name:rook-ceph-mon2 Rank:2 Address:192.168.100.95:6790/0}]}}\r\n2018-03-05 16:52:06.345048 I | op-mon: Failing over monitor rook-ceph-mon1\r\n2018-03-05 16:52:06.345055 I | op-mon: starting new mon rook-ceph-mon3\r\n2018-03-05 16:52:06.375746 I | op-mon: mon rook-ceph-mon3 running at None:6790\r\n2018-03-05 16:52:06.390855 I | op-mon: Found 1 running nodes without mons\r\n2018-03-05 16:52:06.402100 I | op-mon: mons created: 1\r\n2018-03-05 16:52:06.402132 I | op-mon: waiting for mon quorum\r\n2018-03-05 16:52:06.402325 I | exec: Running command: ceph mon_status --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring --format json --out-file /tmp/632396222\r\n2018-03-05 16:52:06.724099 W | op-mon: failed to find initial monitor rook-ceph-mon3 in mon map\r\n2018-03-05 16:52:11.724510 I | exec: Running command: ceph mon_status --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring --format json --out-file /tmp/354655237\r\n2018-03-05 16:52:20.403025 I | op-mon: Ceph monitors formed quorum\r\n2018-03-05 16:52:20.403069 I | op-mon: ensuring removal of unhealthy monitor rook-ceph-mon1\r\n2018-03-05 16:52:20.420899 I | exec: Running command: ceph mon remove rook-ceph-mon1 --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring --format json --out-file /tmp/065905568\r\n2018-03-05 16:52:20.894881 I | exec: removing mon.rook-ceph-mon1 at 192.168.100.94:6790/0, there will be 3 monitors\r\n2018-03-05 16:52:20.895047 I | op-mon: removed monitor rook-ceph-mon1\r\n2018-03-05 16:52:20.899161 I | op-mon: dead mon service rook-ceph-mon1 was already gone\r\n2018-03-05 16:52:20.924123 I | op-mon: saved mon endpoints to config map map[maxMonId:3 mapping:{\"node\":{\"rook-ceph-mon0\":{\"Name\":\"serv093\",\"Hostname\":\"serv093\",\"Address\":\"192.168.100.93\"},\"rook-ceph-mon2\":{\"Name\":\"serv095\",\"Hostname\":\"serv095\",\"Address\":\"192.168.100.95\"},\"rook-ceph-mon3\":{\"Name\":\"serv099\",\"Hostname\":\"serv099\",\"Address\":\"192.168.100.99\"}},\"port\":{\"serv093\":6790,\"serv095\":6790,\"serv099\":6790}} data:rook-ceph-mon0=192.168.100.93:6790,rook-ceph-mon2=192.168.100.95:6790]\r\n2018-03-05 16:52:20.924568 I | cephmon: writing config file /var/lib/rook/rook/rook.config\r\n2018-03-05 16:52:20.924680 I | cephmon: generated admin config in /var/lib/rook/rook\r\n2018-03-05 16:52:20.924879 I | cephmon: writing config file /var/lib/rook/rook/rook.config\r\n2018-03-05 16:52:20.924991 I | cephmon: generated admin config in /var/lib/rook/rook\r\n2018-03-05 16:53:06.294937 W | op-mon: mon rook-ceph-mon3 not in source of truth and not in quorum, not enough mons to remove now (wanted: 3, current: 3)\r\n```\r\n\r\nlast line repeats indefinitely\r\n\r\nkubectl -n rook get cluster rook -o yaml:\r\n\r\n```\r\napiVersion: rook.io/v1alpha1\r\nkind: Cluster\r\nmetadata:\r\n  annotations:\r\n    kubectl.kubernetes.io/last-applied-configuration: |\r\n      {\"apiVersion\":\"rook.io/v1alpha1\",\"kind\":\"Cluster\",\"metadata\":{\"annotations\":{},\"name\":\"rook\",\"namespace\":\"rook\"},\"spec\":{\"backend\":\"ceph\",\"dataDirHostPath\":\"/var/lib/rook\",\"hostNetwork\":true,\"monCount\":3,\"resources\":null,\"storage\":{\"deviceFilter\":null,\"location\":null,\"metadataDevice\":null,\"nodes\":[{\"directories\":[{\"path\":\"/mnt/rook-1\"},{\"path\":\"/mnt/rook-2\"}],\"name\":\"serv093\"},{\"directories\":[{\"path\":\"/mnt/rook-1\"},{\"path\":\"/mnt/rook-2\"}],\"name\":\"serv094\"},{\"directories\":[{\"path\":\"/mnt/rook-1\"},{\"path\":\"/mnt/rook-2\"}],\"name\":\"serv095\"},{\"directories\":[{\"path\":\"/mnt/rook-1\"},{\"path\":\"/mnt/rook-2\"}],\"name\":\"serv099\"}],\"storeConfig\":{\"storeType\":\"bluestore\"},\"useAllDevices\":false,\"useAllNodes\":false}}}\r\n  clusterName: \"\"\r\n  creationTimestamp: 2018-03-05T12:51:43Z\r\n  finalizers:\r\n  - cluster.rook.io\r\n  generation: 0\r\n  name: rook\r\n  namespace: rook\r\n  resourceVersion: \"3446137\"\r\n  selfLink: /apis/rook.io/v1alpha1/namespaces/rook/clusters/rook\r\n  uid: f4840872-2073-11e8-b956-107b4492e419\r\nspec:\r\n  backend: ceph\r\n  dataDirHostPath: /var/lib/rook\r\n  hostNetwork: true\r\n  monCount: 3\r\n  placement:\r\n    all:\r\n      tolerations: null\r\n    api:\r\n      tolerations: null\r\n    mgr:\r\n      tolerations: null\r\n    mon:\r\n      tolerations: null\r\n    osd:\r\n      tolerations: null\r\n  resources:\r\n    api: {}\r\n    mgr: {}\r\n    mon: {}\r\n    osd: {}\r\n  storage:\r\n    nodes:\r\n    - directories:\r\n      - path: /mnt/rook-1\r\n      - path: /mnt/rook-2\r\n      name: serv093\r\n      resources: {}\r\n      storeConfig: {}\r\n    - directories:\r\n      - path: /mnt/rook-1\r\n      - path: /mnt/rook-2\r\n      name: serv094\r\n      resources: {}\r\n      storeConfig: {}\r\n    - directories:\r\n      - path: /mnt/rook-1\r\n      - path: /mnt/rook-2\r\n      name: serv095\r\n      resources: {}\r\n      storeConfig: {}\r\n    - directories:\r\n      - path: /mnt/rook-1\r\n      - path: /mnt/rook-2\r\n      name: serv099\r\n      resources: {}\r\n      storeConfig: {}\r\n    storeConfig:\r\n      storeType: bluestore\r\n    useAllDevices: false\r\nstatus:\r\n  state: Created\r\n```\r\n",
  "closed_at": "2018-03-08T20:15:52Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/1548/comments",
  "created_at": "2018-03-05T17:50:49Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/1548/events",
  "html_url": "https://github.com/rook/rook/issues/1548",
  "id": 302398525,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "00aaaa",
      "default": false,
      "description": null,
      "id": 479820581,
      "name": "operator",
      "node_id": "MDU6TGFiZWw0Nzk4MjA1ODE=",
      "url": "https://api.github.com/repos/rook/rook/labels/operator"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/1548/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-08-03T22:26:42Z",
    "closed_issues": 62,
    "created_at": "2018-02-12T17:12:56Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/1463491?v=4",
      "events_url": "https://api.github.com/users/bassam/events{/privacy}",
      "followers_url": "https://api.github.com/users/bassam/followers",
      "following_url": "https://api.github.com/users/bassam/following{/other_user}",
      "gists_url": "https://api.github.com/users/bassam/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/bassam",
      "id": 1463491,
      "login": "bassam",
      "node_id": "MDQ6VXNlcjE0NjM0OTE=",
      "organizations_url": "https://api.github.com/users/bassam/orgs",
      "received_events_url": "https://api.github.com/users/bassam/received_events",
      "repos_url": "https://api.github.com/users/bassam/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/bassam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bassam/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/bassam"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/rook/rook/milestone/9",
    "id": 3108603,
    "labels_url": "https://api.github.com/repos/rook/rook/milestones/9/labels",
    "node_id": "MDk6TWlsZXN0b25lMzEwODYwMw==",
    "number": 9,
    "open_issues": 0,
    "state": "closed",
    "title": "0.7",
    "updated_at": "2018-08-03T22:26:42Z",
    "url": "https://api.github.com/repos/rook/rook/milestones/9"
  },
  "node_id": "MDU6SXNzdWUzMDIzOTg1MjU=",
  "number": 1548,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "[hostNetwork] new mon come up with 127.0.0.1",
  "updated_at": "2018-03-08T20:15:52Z",
  "url": "https://api.github.com/repos/rook/rook/issues/1548",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/32073?v=4",
    "events_url": "https://api.github.com/users/bryanlarsen/events{/privacy}",
    "followers_url": "https://api.github.com/users/bryanlarsen/followers",
    "following_url": "https://api.github.com/users/bryanlarsen/following{/other_user}",
    "gists_url": "https://api.github.com/users/bryanlarsen/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bryanlarsen",
    "id": 32073,
    "login": "bryanlarsen",
    "node_id": "MDQ6VXNlcjMyMDcz",
    "organizations_url": "https://api.github.com/users/bryanlarsen/orgs",
    "received_events_url": "https://api.github.com/users/bryanlarsen/received_events",
    "repos_url": "https://api.github.com/users/bryanlarsen/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bryanlarsen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bryanlarsen/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bryanlarsen"
  }
}