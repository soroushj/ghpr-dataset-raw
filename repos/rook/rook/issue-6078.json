{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
      "events_url": "https://api.github.com/users/leseb/events{/privacy}",
      "followers_url": "https://api.github.com/users/leseb/followers",
      "following_url": "https://api.github.com/users/leseb/following{/other_user}",
      "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/leseb",
      "id": 912735,
      "login": "leseb",
      "node_id": "MDQ6VXNlcjkxMjczNQ==",
      "organizations_url": "https://api.github.com/users/leseb/orgs",
      "received_events_url": "https://api.github.com/users/leseb/received_events",
      "repos_url": "https://api.github.com/users/leseb/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/leseb"
    }
  ],
  "author_association": "NONE",
  "body": "<!-- **Are you in the right place?**\r\n1. For issues or feature requests, please create an issue in this repository.\r\n2. For general technical and non-technical questions, we are happy to help you on our [Rook.io Slack](https://slack.rook.io/).\r\n3. Did you already search the existing open issues for anything similar? -->\r\n\r\n**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\nThis [new check in 1.4](https://github.com/rook/rook/commit/f3c4975e353e3ce3599c958ec6d2cae8ee8f6f61) causes a issue with RancherOS.  This seems to be because the [check assumes to look for the lvm command in the root namespace](https://github.com/rook/rook/commit/f3c4975e353e3ce3599c958ec6d2cae8ee8f6f61#diff-82aa5dcd60af6a0db6da0bda373128daR29), but with RancherOS lvm exists in the system-docker console. \r\n\r\n```\r\n> kubectl -n rook-ceph logs rook-ceph-osd-prepare-k8s011vmwkr0-w8cxn\r\n2020-08-12 05:08:33.741276 I | rookcmd: starting Rook v1.4.0 with arguments '/rook/rook ceph osd provision'\r\n2020-08-12 05:08:33.741362 I | rookcmd: flag values: --cluster-id=e9ede491-9c19-4903-b8ec-10df54bcec16, --data-device-filter=all, --data-device-path-filter=, --data-devices=, --drive-groups=, --encrypted-device=false, --force-format=false, --help=false, --location=, --log-flush-frequency=5s, --log-level=DEBUG, --metadata-device=, --node-name=k8s011vmwkr0, --operator-image=, --osd-database-size=0, --osd-store=, --osd-wal-size=576, --osds-per-device=1, --pvc-backed-osd=false, --service-account=\r\n2020-08-12 05:08:33.741370 I | op-mon: parsing mon endpoints: b=192.168.18.80:6789,c=192.168.19.171:6789,a=192.168.30.154:6789\r\n2020-08-12 05:08:33.752083 I | op-osd: CRUSH location=root=default host=k8s011vmwkr0\r\n2020-08-12 05:08:33.752100 I | cephcmd: crush location of osd: root=default host=k8s011vmwkr0\r\n2020-08-12 05:08:33.752110 D | exec: Running command: nsenter --mount=/rootfs/proc/1/ns/mnt -- /usr/sbin/lvm --help\r\n2020-08-12 05:08:33.754101 D | cephosd: failed to call nsenter. failed to execute nsenter. output: nsenter: failed to execute /usr/sbin/lvm: No such file or directory: exit status 127\r\n2020-08-12 05:08:33.754116 D | exec: Running command: nsenter --mount=/rootfs/proc/1/ns/mnt -- /sbin/lvm --help\r\n2020-08-12 05:08:33.755497 D | cephosd: failed to call nsenter. failed to execute nsenter. output: nsenter: failed to execute /sbin/lvm: No such file or directory: exit status 127\r\nbinary \"lvm\" does not exist on the host, make sure lvm2 package is installed: binary \"lvm\" does not exist on the host\r\n```\r\n\r\nReference discussion here: https://github.com/rook/rook/issues/6057#issuecomment-673500998\r\n\r\n**Expected behavior:**\r\nosd prepare job to complete successfully\r\n\r\n**How to reproduce it (minimal and precise):**\r\n<!-- Please let us know any circumstances for reproduction of your bug. -->\r\nDeploy Rook Ceph 1.4 to cluster running on RancherOS\r\n\r\n**File(s) to submit**:\r\n\r\nGiven the prepare container volume mounts the rootfs could you check check for the binary in the filesystem instead of by ns?\r\n\r\n*lvm binary in the rootfs  (this seems to be the ROS console container)*\r\n```\r\n[root@rook-ceph-osd-prepare-test-k8s011vmwkr0-cc9b99fb5-cdp4q /]#  /rootfs/sbin/lvm version  \r\n  LVM version:     2.02.173(2) (2017-07-20)\r\n  Library version: 1.02.169-RHEL8 (2020-02-11)\r\n  Driver version:  4.37.0\r\n  Configuration:   ./configure --target=x86_64-buildroot-linux-gnu --host=x86_64-buildroot-linux-gnu --build=x86_64-pc-linux-gnu --prefix=/usr --exec-prefix=/usr --sysconfdir=/etc --localstatedir=/var --program-prefix= --disable-gtk-doc --disable-gtk-doc-html --disable-doc --disable-docs --disable-documentation --with-xmlto=no --with-fop=no --disable-dependency-tracking --enable-ipv6 --disable-nls --disable-static --enable-shared --enable-write_install --enable-pkgconfig --enable-cmdlib --enable-dmeventd --disable-nls --disable-symvers --disable-selinux --disable-applib\r\n```\r\n*Compared to the lvm binary in the ceph container used for rook prepare*\r\n```\r\n[root@rook-ceph-osd-prepare-test-k8s011vmwkr0-cc9b99fb5-cdp4q /]# lvm version\r\n  LVM version:     2.03.08(2)-RHEL8 (2020-02-11)\r\n  Library version: 1.02.169-RHEL8 (2020-02-11)\r\n  Driver version:  4.37.0\r\n  Configuration:   ./configure --build=x86_64-redhat-linux-gnu --host=x86_64-redhat-linux-gnu --program-prefix= --disable-dependency-tracking --prefix=/usr --exec-prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --datadir=/usr/share --includedir=/usr/include --libdir=/usr/lib64 --libexecdir=/usr/libexec --localstatedir=/var --sharedstatedir=/var/lib --mandir=/usr/share/man --infodir=/usr/share/info --with-default-dm-run-dir=/run --with-default-run-dir=/run/lvm --with-default-pid-dir=/run --with-default-locking-dir=/run/lock/lvm --with-usrlibdir=/usr/lib64 --enable-fsadm --enable-write_install --with-user= --with-group= --with-device-uid=0 --with-device-gid=6 --with-device-mode=0660 --enable-pkgconfig --enable-cmdlib --enable-dmeventd --enable-blkid_wiping --with-cluster=internal --enable-cmirrord --with-udevdir=/usr/lib/udev/rules.d --enable-udev_sync --with-thin=internal --with-cache=internal --enable-lvmpolld --enable-lvmlockd-dlm --enable-lvmlockd-dlmcontrol --enable-lvmlockd-sanlock --enable-dbus-service --enable-notify-dbus --enable-dmfilemapd --with-writecache=internal --with-vdo=internal --with-vdo-format=/usr/bin/vdoformat --disable-silent-rules\r\n[root@rook-ceph-osd-prepare-test-k8s011vmwkr0-cc9b99fb5-cdp4q /]#\r\n```\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release): `RancherOS v1.5.6`\r\n* Kernel (e.g. `uname -a`): `4.14.138-rancher`\r\n* Cloud provider or hardware configuration: `Openstack cloud`\r\n* Rook version (use `rook version` inside of a Rook Pod): `v1.4.0`\r\n* Storage backend version (e.g. for ceph do `ceph -v`): `ceph version 15.2.4 (7447c15c6ff58d7fce91843b705a268a1917325c) octopus (stable)`\r\n* Kubernetes version (use `kubectl version`): `Server Version: version.Info{Major:\"1\", Minor:\"18\", GitVersion:\"v1.18.3\", GitCommit:\"2e7996e3e2712684bc73f0dec0200d64eec7fe40\", GitTreeState:\"clean\", BuildDate:\"2020-05-20T12:43:34Z\", GoVersion:\"go1.13.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}`\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift): `RKE`\r\n* Storage backend status (e.g. for Ceph use `ceph health` in the [Rook Ceph toolbox](https://rook.io/docs/rook/master/ceph-toolbox.html)):\r\n```\r\n[root@rook-ceph-tools-7d9467775-w6qfv /]# ceph status\r\n  cluster:\r\n    id:     fea7efc1-6780-4684-9040-64defd58db0e\r\n    health: HEALTH_WARN\r\n            clock skew detected on mon.b, mon.c\r\n            Reduced data availability: 1 pg inactive\r\n            465915 slow ops, oldest one blocked for 147922 sec, mon.b has slow ops\r\n            OSD count 0 < osd_pool_default_size 3\r\n \r\n  services:\r\n    mon: 3 daemons, quorum a,b,c (age 43h)\r\n    mgr: a(active, since 41h)\r\n    osd: 0 osds: 0 up, 0 in\r\n \r\n  data:\r\n    pools:   1 pools, 1 pgs\r\n    objects: 0 objects, 0 B\r\n    usage:   0 B used, 0 B / 0 B avail\r\n    pgs:     100.000% pgs unknown\r\n             1 unknown\r\n```\r\n",
  "closed_at": "2020-08-27T14:26:03Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/6078/comments",
  "created_at": "2020-08-14T00:12:28Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/6078/events",
  "html_url": "https://github.com/rook/rook/issues/6078",
  "id": 678812199,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/6078/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2Nzg4MTIxOTk=",
  "number": 6078,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "osd prepare fails check for lvm in RancherOS ",
  "updated_at": "2020-08-27T14:26:03Z",
  "url": "https://api.github.com/repos/rook/rook/issues/6078",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/35084494?v=4",
    "events_url": "https://api.github.com/users/neatherweb/events{/privacy}",
    "followers_url": "https://api.github.com/users/neatherweb/followers",
    "following_url": "https://api.github.com/users/neatherweb/following{/other_user}",
    "gists_url": "https://api.github.com/users/neatherweb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/neatherweb",
    "id": 35084494,
    "login": "neatherweb",
    "node_id": "MDQ6VXNlcjM1MDg0NDk0",
    "organizations_url": "https://api.github.com/users/neatherweb/orgs",
    "received_events_url": "https://api.github.com/users/neatherweb/received_events",
    "repos_url": "https://api.github.com/users/neatherweb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/neatherweb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/neatherweb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/neatherweb"
  }
}