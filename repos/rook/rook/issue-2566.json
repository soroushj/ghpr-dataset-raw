{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "When the cluster's ceph version supports ceph-volume, rook-ceph still uses traditional sgdisk-based provision for device when metadataDevice is specified: https://github.com/rook/rook/pull/2269/files#diff-d422456f63710f6140fbb62ba3b6ae8aR155 and there seems no followup issue on this.\r\n\r\nCurrently our use of `ceph-volume lvm batch` is per-device, as we need to support the osdsPerDevice param. this makes it difficult to make use of the `lvm batch` feature of mixed devices, where `ceph-volume` attempts to put db volume on ssd for multiple OSDs in one go.\r\n\r\n```\r\n[root@b4e442ada745 /]# ceph-volume lvm batch --prepare  --block-db-size 2048000000 /dev/sdb /dev/sdc /dev/sdd /dev/sde \r\n\r\nTotal OSDs: 3\r\n\r\nSolid State VG:\r\n  Targets:   block.db                  Total size: 19.00 GB                 \r\n  Total LVs: 3                         Size per LV: 1.91 GB                  \r\n  Devices:   /dev/sdb\r\n\r\n  Type            Path                                                    LV Size         % of device\r\n----------------------------------------------------------------------------------------------------\r\n  [data]          /dev/sdc                                                40.00 GB        100%\r\n  [block.db]      vg: osd-db                                              1.91 GB         11%\r\n----------------------------------------------------------------------------------------------------\r\n  [data]          /dev/sdd                                                40.00 GB        100%\r\n  [block.db]      vg: osd-db                                              1.91 GB         11%\r\n----------------------------------------------------------------------------------------------------\r\n  [data]          /dev/sde                                                40.00 GB        100%\r\n  [block.db]      vg: osd-db                                              1.91 GB         11%\r\n--> The above OSDs would be created if the operation continues\r\n--> do you want to proceed? (yes/no) yes\r\n```\r\n\r\nBut actually, if we simply pass the ssd metadata device to `lvm batch` runs, it will be used for block.db properly (vg is created the first time and will be reused)\r\n\r\nIn short, for metadataDevice to work with ceph-volume, The cheapest way seems to be making use of the existing lvm batch behaviour and pass the metadataDevice to it. Though there should probably be lots of checking to make sure `lvm batch` does what we intend to, as misconfigured ceph-volume params seem will likely trigger #2445 and is hard to diagnose.\r\n\r\n",
  "closed_at": "2019-04-29T18:56:42Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/2566/comments",
  "created_at": "2019-01-26T17:07:32Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/2566/events",
  "html_url": "https://github.com/rook/rook/issues/2566",
  "id": 403460678,
  "labels": [
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    },
    {
      "color": "ad0036",
      "default": false,
      "description": "",
      "id": 1232323300,
      "name": "ceph-osd",
      "node_id": "MDU6TGFiZWwxMjMyMzIzMzAw",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph-osd"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/2566/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MDM0NjA2Nzg=",
  "number": 2566,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "support metadataDevice for osd provisioning with ceph-volume",
  "updated_at": "2019-04-29T18:56:42Z",
  "url": "https://api.github.com/repos/rook/rook/issues/2566",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/69736?v=4",
    "events_url": "https://api.github.com/users/clkao/events{/privacy}",
    "followers_url": "https://api.github.com/users/clkao/followers",
    "following_url": "https://api.github.com/users/clkao/following{/other_user}",
    "gists_url": "https://api.github.com/users/clkao/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/clkao",
    "id": 69736,
    "login": "clkao",
    "node_id": "MDQ6VXNlcjY5NzM2",
    "organizations_url": "https://api.github.com/users/clkao/orgs",
    "received_events_url": "https://api.github.com/users/clkao/received_events",
    "repos_url": "https://api.github.com/users/clkao/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/clkao/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/clkao/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/clkao"
  }
}