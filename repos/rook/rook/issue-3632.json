{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/8311215?v=4",
    "events_url": "https://api.github.com/users/rohantmp/events{/privacy}",
    "followers_url": "https://api.github.com/users/rohantmp/followers",
    "following_url": "https://api.github.com/users/rohantmp/following{/other_user}",
    "gists_url": "https://api.github.com/users/rohantmp/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/rohantmp",
    "id": 8311215,
    "login": "rohantmp",
    "node_id": "MDQ6VXNlcjgzMTEyMTU=",
    "organizations_url": "https://api.github.com/users/rohantmp/orgs",
    "received_events_url": "https://api.github.com/users/rohantmp/received_events",
    "repos_url": "https://api.github.com/users/rohantmp/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/rohantmp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rohantmp/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/rohantmp"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/8311215?v=4",
      "events_url": "https://api.github.com/users/rohantmp/events{/privacy}",
      "followers_url": "https://api.github.com/users/rohantmp/followers",
      "following_url": "https://api.github.com/users/rohantmp/following{/other_user}",
      "gists_url": "https://api.github.com/users/rohantmp/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rohantmp",
      "id": 8311215,
      "login": "rohantmp",
      "node_id": "MDQ6VXNlcjgzMTEyMTU=",
      "organizations_url": "https://api.github.com/users/rohantmp/orgs",
      "received_events_url": "https://api.github.com/users/rohantmp/received_events",
      "repos_url": "https://api.github.com/users/rohantmp/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rohantmp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rohantmp/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rohantmp"
    }
  ],
  "author_association": "NONE",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\n\r\nIf toplogyAware is set to true in the cluster-on-pvc.yaml example, kubernetes topology information is not reflected in the crush map.\r\n\r\n**Expected behavior:**\r\n\r\nIf toplogyAware is set to true in the cluster-on-pvc.yaml example, kubernetes topology information should be reflected in the crush map.\r\n\r\nPresumably we are attempting to move the named host bucket to the right zone bucket, but it doesn't exist because the name of the host bucket when using OSD backed by PVC is the PVC id. This is to ensure a stable crush  map if the pod+PVC moves to another instance. If we're using OSD on PV we need to pass ROOK_NODE_NAME here (I think):\r\n\r\nhttps://github.com/rook/rook/blob/1bb8a5dcd90a2246ce6a3f37e8d60466e88ec2d6/pkg/operator/k8sutil/node.go#L255\r\n\r\n**How to reproduce it (minimal and precise):**\r\n\r\nSet topologyAware to true in cluster-on-pvc.yaml, then from toolbox pod run\r\n\r\n```\r\nceph osd tree\r\n```\r\n\r\n**File(s) to submit**:\r\n\r\n* Cluster CR\r\n```\r\napiVersion: ceph.rook.io/v1\r\nkind: CephCluster\r\nmetadata:\r\n  name: rook-ceph\r\n  namespace: rook-ceph\r\nspec:\r\n  cephVersion:\r\n    image: ceph/ceph:v14.2.2-20190722\r\n    allowUnsupported: false\r\n  dataDirHostPath: /var/lib/rook\r\n  mon:\r\n    count: 3\r\n    allowMultiplePerNode: false\r\n  dashboard:\r\n    enabled: true\r\n  monitoring:\r\n    enabled: false\r\n    rulesNamespace: rook-ceph\r\n  network:\r\n    hostNetwork: false\r\n  rbdMirroring:\r\n    workers: 0\r\n  annotations:\r\n  resources:\r\n  storage:\r\n    topologyAware: true\r\n    storageClassDeviceSets:\r\n    - name: set1\r\n      count: 3\r\n      resources:\r\n      volumeClaimTemplates:\r\n      - metadata:\r\n          name: data\r\n        spec:\r\n          resources:\r\n            requests:\r\n              storage: 1000Gi\r\n          storageClassName: gp2\r\n          volumeMode: Block\r\n          accessModes:\r\n            - ReadWriteOnce            \r\n```\r\n\r\nExample output from toolbox pod:\r\n```\r\nsh-4.2# ceph osd tree\r\nID CLASS WEIGHT  TYPE NAME                  STATUS REWEIGHT PRI-AFF\r\n-1       2.92676 root default\r\n-7       0.97559     host set1-0-data-5hnlz\r\n 1   hdd 0.97559         osd.1                  up  1.00000 1.00000\r\n-5       0.97559     host set1-1-data-cb8jn\r\n 2   hdd 0.97559         osd.2                  up  1.00000 1.00000\r\n-3       0.97559     host set1-2-data-qrhhj\r\n 0   hdd 0.97559         osd.0                  up  1.00000 1.00000\r\n```\r\n\r\nExpected output\r\n```\r\nsh-4.2# ceph osd tree\r\nID  CLASS WEIGHT  TYPE NAME                  STATUS REWEIGHT PRI-AFF\r\n-12       0.97559 zone us-west-2a\r\n -5       0.97559     host set1-1-data-cb8jn\r\n  2   hdd 0.97559         osd.2                  up  1.00000 1.00000\r\n-11       0.97559 zone us-west-2b\r\n -3       0.97559     host set1-2-data-qrhhj\r\n  0   hdd 0.97559         osd.0                  up  1.00000 1.00000\r\n-10       0.97559 zone us-west-2c\r\n -7       0.97559     host set1-0-data-5hnlz\r\n  1   hdd 0.97559         osd.1                  up  1.00000 1.00000\r\n -1             0 root default\r\n```\r\n\r\n**Environment**:\r\n* Cloud provider or hardware configuration:\r\nAWS\r\n* Rook version:\r\n6a61286e4a353548525bf126bfd4152d7eebf3f1\r\n* Storage backend version:\r\n```ceph version 14.2.2 (4f8fa0a0024755aae7d95567c63f11d6862d55be) nautilus (stable)```\r\n* Kubernetes version:\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"10\", GitVersion:\"v1.10.11\", GitCommit:\"637c7e288581ee40ab4ca210618a89a555b6e7e9\", GitTreeState:\"clean\", BuildDate:\"2018-11-26T14:38:32Z\", GoVersion:\"go1.9.3\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"13+\", GitVersion:\"v1.13.4+c62ce01\", GitCommit:\"c62ce01\", GitTreeState:\"clean\", BuildDate:\"2019-06-27T18:14:14Z\", GoVersion:\"go1.11.6\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift):\r\n`OpenShift 4.1 (IPI)`\r\n* Storage backend status\r\n`HEALTH_OK`\r\n",
  "closed_at": "2019-09-06T19:59:23Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/3632/comments",
  "created_at": "2019-08-15T19:01:55Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/3632/events",
  "html_url": "https://github.com/rook/rook/issues/3632",
  "id": 481291229,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    },
    {
      "color": "ad0036",
      "default": false,
      "description": "",
      "id": 1232323300,
      "name": "ceph-osd",
      "node_id": "MDU6TGFiZWwxMjMyMzIzMzAw",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph-osd"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/3632/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2020-03-31T19:33:42Z",
    "closed_issues": 148,
    "created_at": "2019-03-15T19:30:30Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/3989526?v=4",
      "events_url": "https://api.github.com/users/BlaineEXE/events{/privacy}",
      "followers_url": "https://api.github.com/users/BlaineEXE/followers",
      "following_url": "https://api.github.com/users/BlaineEXE/following{/other_user}",
      "gists_url": "https://api.github.com/users/BlaineEXE/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BlaineEXE",
      "id": 3989526,
      "login": "BlaineEXE",
      "node_id": "MDQ6VXNlcjM5ODk1MjY=",
      "organizations_url": "https://api.github.com/users/BlaineEXE/orgs",
      "received_events_url": "https://api.github.com/users/BlaineEXE/received_events",
      "repos_url": "https://api.github.com/users/BlaineEXE/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BlaineEXE/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BlaineEXE/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BlaineEXE"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/rook/rook/milestone/12",
    "id": 4144795,
    "labels_url": "https://api.github.com/repos/rook/rook/milestones/12/labels",
    "node_id": "MDk6TWlsZXN0b25lNDE0NDc5NQ==",
    "number": 12,
    "open_issues": 0,
    "state": "closed",
    "title": "1.1",
    "updated_at": "2020-03-31T19:33:42Z",
    "url": "https://api.github.com/repos/rook/rook/milestones/12"
  },
  "node_id": "MDU6SXNzdWU0ODEyOTEyMjk=",
  "number": 3632,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "OSD on PV breaks topologyAware",
  "updated_at": "2019-09-06T19:59:23Z",
  "url": "https://api.github.com/repos/rook/rook/issues/3632",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/697371?v=4",
    "events_url": "https://api.github.com/users/mmgaggle/events{/privacy}",
    "followers_url": "https://api.github.com/users/mmgaggle/followers",
    "following_url": "https://api.github.com/users/mmgaggle/following{/other_user}",
    "gists_url": "https://api.github.com/users/mmgaggle/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mmgaggle",
    "id": 697371,
    "login": "mmgaggle",
    "node_id": "MDQ6VXNlcjY5NzM3MQ==",
    "organizations_url": "https://api.github.com/users/mmgaggle/orgs",
    "received_events_url": "https://api.github.com/users/mmgaggle/received_events",
    "repos_url": "https://api.github.com/users/mmgaggle/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mmgaggle/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mmgaggle/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mmgaggle"
  }
}