{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\nAfter changing values.yaml and adding resource request and limit for CSI pod rook operator doesn't set limits.\r\n\r\n**helm upgrade --install rook-ceph rook-release/rook-ceph -f operator/values.production.yaml --wait --namespace rook-ceph --version v1.3.3**\r\n\r\n**values.yaml**\r\n```\r\n...\r\n\r\ncsi:\r\n  enableRbdDriver: true\r\n  enableCephfsDriver: true\r\n  enableGrpcMetrics: true\r\n  enableSnapshotter: false\r\n              \r\n  csiCephFSPluginResource:\r\n    - name : driver-registrar\r\n      resource:\r\n        requests:\r\n          memory: 128Mi\r\n          cpu: 50m\r\n        limits:\r\n          memory: 256Mi  \r\n    - name : csi-cephfsplugin\r\n      resource:\r\n        requests:\r\n          memory: 512Mi\r\n          cpu: 250m\r\n        limits:\r\n          memory: 1Gi\r\n    - name : liveness-prometheus\r\n      resource:\r\n        requests:\r\n          memory: 128Mi\r\n          cpu: 50m\r\n        limits:\r\n          memory: 256Mi\r\n```\r\nrook operator pod contains define resources\r\n\r\n```\r\n    - name: CSI_CEPHFS_PLUGIN_RESOURCE\r\n      value: '[map[name:driver-registrar resource:map[limits:map[memory:256Mi] requests:map[cpu:50m\r\n        memory:128Mi]]] map[name:csi-cephfsplugin resource:map[limits:map[memory:1Gi]\r\n        requests:map[cpu:250m memory:512Mi]]] map[name:liveness-prometheus resource:map[limits:map[memory:256Mi]\r\n        requests:map[cpu:50m memory:128Mi]]]]'\r\n```\r\n\r\nBut csi-cephfsplugin pod not restart. After a manual restart pod it doesn't contain requests and limits.\r\n```\r\n...\r\n    image: quay.io/k8scsi/csi-node-driver-registrar:v1.3.0\r\n    imagePullPolicy: IfNotPresent\r\n    lifecycle:\r\n      preStop:\r\n        exec:\r\n          command:\r\n          - /bin/sh\r\n          - -c\r\n          - rm -rf /registration/rook-ceph.cephfs.csi.ceph.com /registration/rook-ceph.cephfs.csi.ceph.com-reg.sock\r\n    name: driver-registrar\r\n    resources: {}\r\n...\r\n    image: quay.io/cephcsi/cephcsi:v2.1.1\r\n    imagePullPolicy: IfNotPresent\r\n    name: csi-cephfsplugin\r\n    resources: {}\r\n...\r\n    image: quay.io/cephcsi/cephcsi:v2.1.1\r\n    imagePullPolicy: IfNotPresent\r\n    name: liveness-prometheus\r\n    resources: {}\r\n```\r\nLimits/requests don't apply to other csi pod.\r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release): CentOS Linux 8 (Core)\r\n* Kernel (e.g. `uname -a`): 4.18.0-147.8.1.el8_1.x86_64 #1 SMP Thu Apr 9 13:49:54 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n* Rook version (use `rook version` inside of a Rook Pod): 1.3.3\r\n* Storage backend version (e.g. for ceph do `ceph -v`): 14.2.9\r\n* Kubernetes version (use `kubectl version`): 1.18.2\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift):  baremetal(kubeadm)\r\n* Storage backend status (e.g. for Ceph use `ceph health` in the [Rook Ceph toolbox](https://rook.io/docs/rook/master/ceph-toolbox.html)): \r\n  cluster:\r\n    id:     483f12d6-fee6-4bf9-98d8-313769921520\r\n    health: HEALTH_OK\r\n\r\n  services:\r\n    mon: 3 daemons, quorum a,b,c (age 3d)\r\n    mgr: a(active, since 3d)\r\n    mds: rook-filesystem:1 {0=rook-filesystem-a=up:active} 1 up:standby-replay\r\n    osd: 3 osds: 3 up (since 3d), 3 in (since 3d)\r\n\r\n  data:\r\n    pools:   3 pools, 96 pgs\r\n    objects: 274 objects, 308 MiB\r\n    usage:   3.8 GiB used, 2.7 TiB / 2.7 TiB avail\r\n    pgs:     96 active+clean\r\n",
  "closed_at": "2020-08-18T15:20:01Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "comments": 9,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/5501/comments",
  "created_at": "2020-05-18T13:17:18Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/5501/events",
  "html_url": "https://github.com/rook/rook/issues/5501",
  "id": 620201815,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/5501/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MjAyMDE4MTU=",
  "number": 5501,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "Rook operator doesn't set resource request and limit for CSI pods",
  "updated_at": "2020-08-18T15:20:01Z",
  "url": "https://api.github.com/repos/rook/rook/issues/5501",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/36562344?v=4",
    "events_url": "https://api.github.com/users/retinio/events{/privacy}",
    "followers_url": "https://api.github.com/users/retinio/followers",
    "following_url": "https://api.github.com/users/retinio/following{/other_user}",
    "gists_url": "https://api.github.com/users/retinio/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/retinio",
    "id": 36562344,
    "login": "retinio",
    "node_id": "MDQ6VXNlcjM2NTYyMzQ0",
    "organizations_url": "https://api.github.com/users/retinio/orgs",
    "received_events_url": "https://api.github.com/users/retinio/received_events",
    "repos_url": "https://api.github.com/users/retinio/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/retinio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/retinio/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/retinio"
  }
}