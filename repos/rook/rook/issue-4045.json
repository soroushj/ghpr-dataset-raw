{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\nOSDs being provisioned by rook v1.1.2 while using Ceph Mimic are failing to start (seems to be both encrypted and non-encrypted OSDs).  This is a cluster upgraded recently from 1.1.0.\r\n\r\n**Expected behavior:**\r\nOSDs are provisioned and started successfully\r\n\r\n**How to reproduce it (minimal and precise):**\r\nProvision a new OSD using Ceph Mimic in rook v1.1.2, once the deployment comes up it enters a crashloop state.\r\n\r\n**File(s) to submit**:\r\nHere are the OSD logs : \r\n```\r\n2019-10-03 18:06:31.459410 I | rookcmd: starting Rook v1.1.2 with arguments '/rook/rook ceph osd start -- --foreground --id 0 --fsid 920f488f-a33b-471b-b449-c2d47114237a --cluster ceph --setuser ceph --setgroup ceph --setuser-match-path /var/lib/rook/osd0 --osd-memory-target=6012954112.000000'\r\n2019-10-03 18:06:31.459521 I | rookcmd: flag values: --help=false, --log-flush-frequency=5s, --log-level=INFO, --lv-path=, --operator-image=, --osd-id=0, --osd-store-type=bluestore, --osd-uuid=b6e17735-aa5e-4e6c-988a-a2b21aab5220, --pvc-backed-osd=false, --service-account=\r\n2019-10-03 18:06:31.459531 I | op-mon: parsing mon endpoints:\r\n2019-10-03 18:06:31.459538 W | op-mon: ignoring invalid monitor\r\n2019-10-03 18:06:31.465440 I | cephosd: Successfully updated lvm config file\r\n2019-10-03 18:06:31.465490 I | exec: Running command: stdbuf -oL ceph-volume lvm activate --no-systemd --bluestore 0 b6e17735-aa5e-4e6c-988a-a2b21aab5220\r\n2019-10-03 18:06:32.090282 I | Running command: /bin/mount -t tmpfs tmpfs /var/lib/ceph/osd/ceph-0\r\n2019-10-03 18:06:32.449512 I | Running command: /usr/sbin/restorecon /var/lib/ceph/osd/ceph-0\r\n2019-10-03 18:06:32.804441 I | Running command: /bin/ceph-authtool /var/lib/ceph/osd/ceph-0/lockbox.keyring --create-keyring --name client.osd-lockbox.b6e17735-aa5e-4e6c-988a-a2b21aab5220 --add-key AQDoKZZdMRdeEBAAi1DqFnvvpfaFdNAPaBtF+A==\r\n2019-10-03 18:06:33.214906 I |  stdout: creating /var/lib/ceph/osd/ceph-0/lockbox.keyring\r\n2019-10-03 18:06:33.215299 I |  stdout: added entity client.osd-lockbox.b6e17735-aa5e-4e6c-988a-a2b21aab5220 auth auth(auid = 18446744073709551615 key=AQDoKZZdMRdeEBAAi1DqFnvvpfaFdNAPaBtF+A== with 0 caps)\r\n2019-10-03 18:06:38.232184 I | Running command: /bin/chown -R ceph:ceph /var/lib/ceph/osd/ceph-0/lockbox.keyring\r\n2019-10-03 18:06:38.589361 I | Running command: /bin/ceph --cluster ceph --name client.osd-lockbox.b6e17735-aa5e-4e6c-988a-a2b21aab5220 --keyring /var/lib/ceph/osd/ceph-0/lockbox.keyring config-key get dm-crypt/osd/b6e17735-aa5e-4e6c-988a-a2b21aab5220/luks\r\n2019-10-03 18:06:39.520007 I | Running command: /usr/sbin/cryptsetup --key-file - --allow-discards luksOpen /dev/ceph-ea338024-6e8f-4ac0-a856-f608640ca0e8/osd-data-11368b7d-6912-4ad0-bc25-81e96a7bf25e k4hdaK-FkDc-s1fy-WEID-rbGp-EMdp-zaxJUl\r\n2019-10-03 18:06:39.878557 I |  stderr: Device k4hdaK-FkDc-s1fy-WEID-rbGp-EMdp-zaxJUl already exists.\r\n2019-10-03 18:06:39.878581 I | Running command: /bin/chown -R ceph:ceph /var/lib/ceph/osd/ceph-0\r\n2019-10-03 18:06:40.234392 I | Running command: /bin/ceph-bluestore-tool --cluster=ceph prime-osd-dir --dev /dev/mapper/k4hdaK-FkDc-s1fy-WEID-rbGp-EMdp-zaxJUl --path /var/lib/ceph/osd/ceph-0 --no-mon-config\r\n2019-10-03 18:06:40.675291 I | Running command: /bin/ln -snf /dev/mapper/k4hdaK-FkDc-s1fy-WEID-rbGp-EMdp-zaxJUl /var/lib/ceph/osd/ceph-0/block\r\n2019-10-03 18:06:41.028347 I | Running command: /bin/chown -h ceph:ceph /var/lib/ceph/osd/ceph-0/block\r\n2019-10-03 18:06:41.393419 I | Running command: /bin/chown -R ceph:ceph /dev/dm-3\r\n2019-10-03 18:06:41.745274 I | Running command: /bin/chown -R ceph:ceph /var/lib/ceph/osd/ceph-0\r\n2019-10-03 18:06:42.098871 I | --> ceph-volume lvm activate successful for osd ID: 0\r\n2019-10-03 18:06:42.110440 I | exec: Running command: ceph-osd --foreground --id 0 --fsid 920f488f-a33b-471b-b449-c2d47114237a --cluster ceph --setuser ceph --setgroup ceph --setuser-match-path /var/lib/rook/osd0 --osd-memory-target=6012954112.000000 --crush-location=root=default host=worker-10ab51-opus-v1-staging-discogs-com\r\n2019-10-03 18:06:42.151213 I | parse error setting 'osd_memory_target' to '6012954112.000000' (strict_si_cast: unit prefix not recognized)\r\n2019-10-03 18:06:42.151316 I |\r\n2019-10-03 18:06:42.202359 I | unrecognized arg --crush-location=root=default host=worker-10ab51-opus-v1-staging-discogs-com\r\nfailed to start osd. Failed to complete '': exit status 1.\r\n```\r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release): Centos 7 \r\n* Kernel (e.g. `uname -a`):3.10.0-957.27.2.el7.x86_64\r\n* Cloud provider or hardware configuration: baremetal\r\n* Rook version (use `rook version` inside of a Rook Pod): v1.1.2\r\n* Storage backend version (e.g. for ceph do `ceph -v`): ceph version 13.2.6 (7b695f835b03642f85998b2ae7b6dd093d9fbce4) mimic (stable)\r\n* Kubernetes version (use `kubectl version`): 1.15.3\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift): baremetal (kubeadm)\r\n* Storage backend status (e.g. for Ceph use `ceph health` in the [Rook Ceph toolbox](https://rook.io/docs/rook/master/ceph-toolbox.html)):\r\n    health: HEALTH_WARN\r\n            mons k,m are low on available space   (cluster is OK though)",
  "closed_at": "2019-10-10T07:27:51Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/4045/comments",
  "created_at": "2019-10-03T18:11:55Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/4045/events",
  "html_url": "https://github.com/rook/rook/issues/4045",
  "id": 502217675,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/4045/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MDIyMTc2NzU=",
  "number": 4045,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "OSD Provisioning Errors on Rook 1.1.2",
  "updated_at": "2019-10-10T07:27:51Z",
  "url": "https://api.github.com/repos/rook/rook/issues/4045",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/4227456?v=4",
    "events_url": "https://api.github.com/users/eknudtson/events{/privacy}",
    "followers_url": "https://api.github.com/users/eknudtson/followers",
    "following_url": "https://api.github.com/users/eknudtson/following{/other_user}",
    "gists_url": "https://api.github.com/users/eknudtson/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/eknudtson",
    "id": 4227456,
    "login": "eknudtson",
    "node_id": "MDQ6VXNlcjQyMjc0NTY=",
    "organizations_url": "https://api.github.com/users/eknudtson/orgs",
    "received_events_url": "https://api.github.com/users/eknudtson/received_events",
    "repos_url": "https://api.github.com/users/eknudtson/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/eknudtson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/eknudtson/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/eknudtson"
  }
}