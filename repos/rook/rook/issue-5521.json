{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
      "events_url": "https://api.github.com/users/leseb/events{/privacy}",
      "followers_url": "https://api.github.com/users/leseb/followers",
      "following_url": "https://api.github.com/users/leseb/following{/other_user}",
      "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/leseb",
      "id": 912735,
      "login": "leseb",
      "node_id": "MDQ6VXNlcjkxMjczNQ==",
      "organizations_url": "https://api.github.com/users/leseb/orgs",
      "received_events_url": "https://api.github.com/users/leseb/received_events",
      "repos_url": "https://api.github.com/users/leseb/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/leseb"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**Bug Report**\r\nDuring a Ceph image upgrade the monitors are nicely upgraded in a staggered manner. This seems to be the case as well for the first 2 osds (out of 3) in my cluster as well. However the third osd seems to be upgraded more or less at the same time as the second.\r\n\r\n**Deviation from expected behavior:**\r\nAt least 2 OSDs were upgraded at the same time, leading to unnecessary downtime for many PGs\r\n\r\n\r\n**Expected behavior:**\r\nAll OSDs should be upgraded in staggered manner s.t. there is no unnecessary downtime.\r\n\r\n**How to reproduce it (minimal and precise):**\r\nUpgrade from ceph 14.2 to 15.2.2 with Rook 1.3.4\r\n\r\nI am not sure if rook actually looks at the crushmap / topology to see if it can intelligently upgrade more than one OSD, but my failure domains seem right afaict\r\n\r\n```\r\nID  CLASS  WEIGHT   TYPE NAME       STATUS  REWEIGHT  PRI-AFF\r\n-1         2.72719  root default                             \r\n-9         0.90900      host node1                           \r\n 5    hdd  0.90900          osd.5       up   1.00000  1.00000\r\n-7         0.90900      host node2                           \r\n 4    hdd  0.90900          osd.4       up   1.00000  1.00000\r\n-5         0.90919      host node4                           \r\n 1    hdd  0.90919          osd.1       up   1.00000  1.00000\r\n\r\n```\r\n\r\n\r\nHere is a snippet to show the relatively short interval between the upgrade of osd 4 and 1\r\nPlease ignore the `redacted` node related logging, it's from different, offsite, cluster.\r\n```\r\nk -n rook-ceph-system logs rook-ceph-operator-7cd66bbb85-cvtjd |grep started\r\n2020-05-21 11:01:32.780371 I | operator: rook-provisioner ceph.rook.io/block started using ceph.rook.io flex vendor dir\r\n2020-05-21 11:01:32.780712 I | operator: rook-provisioner rook.io/block started using rook.io flex vendor dir\r\n2020-05-21 11:01:59.703057 I | ceph-object-controller: object store \"objects\" deployment \"rook-ceph-rgw-objects-a\" started\r\n2020-05-21 11:02:17.150071 I | operator: successfully started Ceph CSI driver(s)\r\n2020-05-21 11:02:49.087323 I | ceph-object-controller: object store \"objects\" deployment \"rook-ceph-rgw-objects-a\" started\r\n2020-05-21 11:02:59.730597 I | op-osd: osd provision job started for node redacted\r\n2020-05-21 11:03:04.993815 I | op-osd: started deployment for osd 0\r\n2020-05-21 11:03:06.210412 I | rbd-mirror: rook-ceph-rbd-mirror-a deployment started\r\n2020-05-21 11:06:23.259507 I | op-osd: osd provision job started for node node1\r\n2020-05-21 11:06:24.913380 I | ceph-object-controller: object store \"objects\" deployment \"rook-ceph-rgw-objects-a\" started\r\n2020-05-21 11:06:25.484187 I | op-osd: osd provision job started for node node2\r\n2020-05-21 11:06:27.869455 I | op-osd: osd provision job started for node node4\r\n2020-05-21 11:06:44.229383 I | op-osd: started deployment for osd 5\r\n2020-05-21 11:07:00.314966 I | ceph-object-controller: object store \"objects\" deployment \"rook-ceph-rgw-objects-a\" started\r\n2020-05-21 11:08:03.428927 I | op-osd: started deployment for osd 4\r\n2020-05-21 11:08:13.682079 I | op-osd: started deployment for osd 1\r\n2020-05-21 11:08:17.455824 I | rbd-mirror: rook-ceph-rbd-mirror-a deployment started\r\n\r\n```\r\n\r\nComplete log attached.\r\n[rook-bug.txt](https://github.com/rook/rook/files/4662186/rook-bug.txt)\r\n\r\n\r\n\r\n \r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release): ubuntu 16.04\r\n* Kernel (e.g. `uname -a`): \r\n* Cloud provider or hardware configuration:\r\n* Rook version (use `rook version` inside of a Rook Pod): 1.3.4\r\n* Storage backend version (e.g. for ceph do `ceph -v`): bluestore\r\n* Kubernetes version (use `kubectl version`):  1.17.6\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift): Canonical MAAS\r\n* Storage backend status (e.g. for Ceph use `ceph health` in the [Rook Ceph toolbox](https://rook.io/docs/rook/master/ceph-toolbox.html)): HEALTH OK before starting upgrade.\r\n",
  "closed_at": "2020-06-05T15:12:38Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/5521/comments",
  "created_at": "2020-05-21T11:29:12Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/5521/events",
  "html_url": "https://github.com/rook/rook/issues/5521",
  "id": 622437151,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/5521/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MjI0MzcxNTE=",
  "number": 5521,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "OSDs are upgraded too soon after each other",
  "updated_at": "2020-06-05T15:12:39Z",
  "url": "https://api.github.com/repos/rook/rook/issues/5521",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/2630900?v=4",
    "events_url": "https://api.github.com/users/hansbogert/events{/privacy}",
    "followers_url": "https://api.github.com/users/hansbogert/followers",
    "following_url": "https://api.github.com/users/hansbogert/following{/other_user}",
    "gists_url": "https://api.github.com/users/hansbogert/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/hansbogert",
    "id": 2630900,
    "login": "hansbogert",
    "node_id": "MDQ6VXNlcjI2MzA5MDA=",
    "organizations_url": "https://api.github.com/users/hansbogert/orgs",
    "received_events_url": "https://api.github.com/users/hansbogert/received_events",
    "repos_url": "https://api.github.com/users/hansbogert/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/hansbogert/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hansbogert/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/hansbogert"
  }
}