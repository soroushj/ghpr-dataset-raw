{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!-- **Are you in the right place?**\r\n1. For issues or feature requests, please create an issue in this repository.\r\n2. For general technical and non-technical questions, we are happy to help you on our [Rook.io Slack](https://slack.rook.io/).\r\n3. Did you already search the existing open issues for anything similar? -->\r\n\r\n**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\nThe pod failed to mount its pvc after restarting randomly\r\n**Expected behavior:**\r\nThe pod should be able to mount its pvc after restarting consistently\r\n\r\n**How to reproduce it (minimal and precise):**\r\n<!-- Please let us know any circumstances for reproduction of your bug. -->\r\nThe similar issue has been in discussion in rook slack ( https://app.slack.com/client/T47C56S7Q/C46Q5UC05/thread/C46Q5UC05-1563182392.429800 ).\r\nThe conclusion seems ending with \"kubelet-wrapper\". Unfortunately, we have the same issue without using kubelet-wrapper. \r\n\r\nImportant note: The test done by @nikvoss indicating it's not PVC issue but the pod mounting issue, which caused by kubernetes wrapper.  \r\n``\r\nOk, so I might have found the culprit:\r\n1. I deleted an affected pod multiple times (belonging to a statefulset) and was able to reproduce the mount issues\r\n2. Scheduled a test pod to node which does NOT use the CoreOS kubelet-wrapper, which mounts the affected PVC (from pod above)\r\n3. Deleted affected pod again and cleaned up mounts manually\r\n4. Test pod was able to mount the PVC, once pod was deleted umount was working without issues\r\n5. Affected pod on different host still had mount issues afterwards\r\n=> So without the kubelet-wrapper I am unable to reproduce the issues. So the root cause might the the rkt container and mount redundancy because of it.\r\n\r\n``\r\n'\r\n[Service]\r\nExecStart=/usr/local/bin/kubelet \\\r\n  --pod-infra-container-image=registry:5000/gcr.io/google-containers/pause-amd64:3.1 \\\r\n  --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\\r\n  --config=/etc/kubernetes/kubelet-config.yml \\\r\n  --client-ca-file=/etc/kubernetes/ssl/ca.pem \\\r\n  --register-node=true \\\r\n  --rotate-certificates \\\r\n  --node-labels=is_control=true,is_worker=false,is_edge=false,is_storage=true,bcmt_storage_node=true \\\r\n  --register-with-taints=is_control=true:NoExecute \\\r\n  --allow-privileged=true \\\r\n  --docker-root=/data0/docker \\\r\n  --node-ip=172.16.1.26 \\\r\n  --network-plugin=cni \\\r\n  --cni-bin-dir=/opt/cni/bin \\\r\n  --cni-conf-dir=/etc/cni/kubernetes \\\r\n  --cloud-provider=openstack \\\r\n  --cloud-config=/etc/kubernetes/cloud.conf \\\r\n  --v=1\r\n'\r\n\r\n**File(s) to submit**:\r\n\r\n* Cluster CR (custom resource), typically called `cluster.yaml`, if necessary\r\n* Operator's logs, if necessary\r\n* Crashing pod(s) logs, if necessary\r\n\r\n- Failure symptom 1: \r\n`\r\nMessage:      error setting label on mount source '/var/lib/kubelet/pods/4f13766a-b837-11e9-a2ce-fa163ef27ec8/volumes/ceph.rook.io~rook-ceph-system/pvc-176a8bb5-a22c-11e9-af13-fa163e3d4ff7': no such file or directory\r\n`\r\n-  Failure symptom 2:\r\n`\r\n  Warning  FailedMount  6m49s (x663 over 29h)  kubelet, neolab2-worker-01  Unable to mount volumes for pod\r\n\"csf-compaas-cluster-belk-elasticsearch-data-0_paas(446fc2d4-b76d-11e9-a2ce-fa163ef27ec8)\": timeout expired waiting for volumes to attach or mount for\r\npod \"paas\"/\"csf-compaas-cluster-belk-elasticsearch-data-0\". list of unmounted volumes=[datadir]. list of unattached volumes=[datadir ssl\r\nsearchguard-config elasticsearch-backup default-token-dffmn]\r\n  Warning  FailedMount  113s (x980 over 29h)   kubelet, neolab2-worker-01  (combined from similar events): MountVolume.SetUp failed for volume\r\n\"pvc-174a1721-a22c-11e9-af13-fa163e3d4ff7\" : mount command failed, status: Failure, reason: failed to mount volume /dev/rbd3 [xfs] to\r\n/var/lib/kubelet/plugins/ceph.rook.io/rook-ceph-system/mounts/pvc-174a1721-a22c-11e9-af13-fa163e3d4ff7, error mount failed: exit status 32\r\nMounting command: systemd-run\r\nMounting arguments: --description=Kubernetes transient mount for\r\n/var/lib/kubelet/plugins/ceph.rook.io/rook-ceph-system/mounts/pvc-174a1721-a22c-11e9-af13-fa163e3d4ff7 --scope -- mount -t xfs -o rw,defaults /dev/rbd3\r\n/var/lib/kubelet/plugins/ceph.rook.io/rook-ceph-system/mounts/pvc-174a1721-a22c-11e9-af13-fa163e3d4ff7\r\nOutput: Running scope as unit run-23989.scope.\r\nmount: mount /dev/rbd3 on /var/lib/kubelet/plugins/ceph.rook.io/rook-ceph-system/mounts/pvc-174a1721-a22c-11e9-af13-fa163e3d4ff7 failed: Structure needs\r\ncleaning\r\n`\r\n To get logs, use `kubectl -n <namespace> logs <pod name>`\r\nWhen pasting logs, always surround them with backticks or use the `insert code` button from the Github UI.\r\nRead [Github documentation if you need help](https://help.github.com/en/articles/creating-and-highlighting-code-blocks).\r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release): Centos 7\r\n* Kernel (e.g. `uname -a`):3.10.0-957.10.1.el7.x86_64 #1 SMP Mon Mar 18 15:06:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n* Cloud provider or hardware configuration: openstack\r\n* Rook version (use `rook version` inside of a Rook Pod): v0.9.3\r\n* Storage backend version (e.g. for ceph do `ceph -v`):  v13.2.4-20190109\r\n* Kubernetes version (use `kubectl version`): v1.13.4\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift): Tectonic\r\n* Storage backend status (e.g. for Ceph use `ceph health` in the [Rook Ceph toolbox](https://rook.io/docs/rook/master/ceph-toolbox.html)):\r\n",
  "closed_at": "2019-10-25T08:13:31Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "comments": 14,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/3580/comments",
  "created_at": "2019-08-06T19:35:19Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/3580/events",
  "html_url": "https://github.com/rook/rook/issues/3580",
  "id": 477557651,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/3580/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0Nzc1NTc2NTE=",
  "number": 3580,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "Unable to mount volume for pod - mount command failed, structure needs cleaning",
  "updated_at": "2020-07-02T19:59:03Z",
  "url": "https://api.github.com/repos/rook/rook/issues/3580",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/36163095?v=4",
    "events_url": "https://api.github.com/users/yanchicago/events{/privacy}",
    "followers_url": "https://api.github.com/users/yanchicago/followers",
    "following_url": "https://api.github.com/users/yanchicago/following{/other_user}",
    "gists_url": "https://api.github.com/users/yanchicago/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/yanchicago",
    "id": 36163095,
    "login": "yanchicago",
    "node_id": "MDQ6VXNlcjM2MTYzMDk1",
    "organizations_url": "https://api.github.com/users/yanchicago/orgs",
    "received_events_url": "https://api.github.com/users/yanchicago/received_events",
    "repos_url": "https://api.github.com/users/yanchicago/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/yanchicago/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yanchicago/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/yanchicago"
  }
}