{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**Is this a bug report or feature request?**\r\n* Bug\r\n\r\n**Deviation from expected behavior:**\r\nObject Bucket provisioner fails when CephObjectStore port is not set to port 80.\r\n\r\n**Expected behavior:**\r\nObject Bucket provisioner successfully provisions an insecure bucket when CephObjectStore port != 80 and successfully provisions a secure bucket when CephObjectStore securePort is set.\r\n\r\n**How to reproduce it (minimal and precise):**\r\nConfigure CephObjectStore with port=\"8080\" and securePort=\"8443\". Port \"8080\" is configured just to satisfy the RGW livenessProbe requirement. The intention is for clients to use SSL exclusively. When a Greenfield ObjectBucketClaim is created, the following error is reported:\r\n`op-bucket-prov: error creating bucket \"my-bucket\". Bucket \"my-bucket\" could not be created: RequestError: send request failed caused by: Put http://rook-ceph-rgw-my-store.rook-ceph/my-bucket: dial tcp172.30.138.96:80: connect: no route to host.`\r\n\r\nWhy does the endpoint url specify scheme http and port 80? The following code https://github.com/rook/rook/blob/0c76097a26f85b457545fb3c2405f67c69f435f6/pkg/operator/ceph/object/bucket/provisioner.go#L400 makes me think the provisioner would at least get the first port from the RGW Service object. But even this does not seem to be happening.\r\n\r\nAlso, consider supporting parameter ObjectStorePort in the ServiceClass so that an Administrator can specify the desired port in case the RGW Service has both http and https ports defined. This allows the Administrator to decide whether scheme http or https should be used to connect to the service. This is more straight forward than supporting a boolean ssl parameter in the ObjectBucketClaim which requires the ObjectBucket consumer to make this decision. The current approach of picking the first available port implemented in the following code gives unexpected results depending upon whether the http or https port appears first in the list: https://github.com/rook/rook/blob/0c76097a26f85b457545fb3c2405f67c69f435f6/pkg/operator/ceph/object/bucket/provisioner.go#L400.\r\n \r\n**Environment**: \r\nRook 1.1.1 with Ceph 14.2.4\r\nOCP 3.11 on RHEL 7.7\r\n",
  "closed_at": "2019-12-20T09:37:23Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/4049/comments",
  "created_at": "2019-10-04T18:28:47Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/4049/events",
  "html_url": "https://github.com/rook/rook/issues/4049",
  "id": 502781331,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/4049/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MDI3ODEzMzE=",
  "number": 4049,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "ObjectBucketClaim only binds to insecure port 80",
  "updated_at": "2019-12-20T09:37:23Z",
  "url": "https://api.github.com/repos/rook/rook/issues/4049",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1318509?v=4",
    "events_url": "https://api.github.com/users/ron1/events{/privacy}",
    "followers_url": "https://api.github.com/users/ron1/followers",
    "following_url": "https://api.github.com/users/ron1/following{/other_user}",
    "gists_url": "https://api.github.com/users/ron1/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ron1",
    "id": 1318509,
    "login": "ron1",
    "node_id": "MDQ6VXNlcjEzMTg1MDk=",
    "organizations_url": "https://api.github.com/users/ron1/orgs",
    "received_events_url": "https://api.github.com/users/ron1/received_events",
    "repos_url": "https://api.github.com/users/ron1/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ron1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ron1/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ron1"
  }
}