{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
      "events_url": "https://api.github.com/users/leseb/events{/privacy}",
      "followers_url": "https://api.github.com/users/leseb/followers",
      "following_url": "https://api.github.com/users/leseb/following{/other_user}",
      "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/leseb",
      "id": 912735,
      "login": "leseb",
      "node_id": "MDQ6VXNlcjkxMjczNQ==",
      "organizations_url": "https://api.github.com/users/leseb/orgs",
      "received_events_url": "https://api.github.com/users/leseb/received_events",
      "repos_url": "https://api.github.com/users/leseb/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/leseb"
    }
  ],
  "author_association": "NONE",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\n* I had to move the cluster physically, which required a power down.\r\n* After turning the cluster back up, several OSDs are in constant CrashLoopBackOff without generating any logs (we'll get to why).\r\n\r\n**Expected behavior:**\r\nThe cluster to come back without errors.\r\n\r\n**How to reproduce it (minimal and precise):**\r\n* I had a healthy cluster before the migration\r\n* Set **noup**,nodown,noout,nobackfill,norecover,noscrub,nodeep-scrub on the cluster (based on another website as the Rook wiki has no info on this)\r\n* Waited a few minutes.\r\n* Powered down the nodes one by one.\r\n* Did the physical move\r\n* Powered the nodes back on (starting with the kubernetes master)\r\n* Waited a few minutes\r\n* Ran ceph -s to see that the cluster is not healthy.\r\n\r\nCannot get any logs out of the OSD pod.\r\nIt only creates a single line:\r\n`2020-05-16 18:02:30.394 7f06d8e79a80 -1 Falling back to public interface`\r\n\r\nThis is all that exists in the kubernetes or docker logs.\r\n\r\nIn some guides, for cluster reboots they also recommend for you to set \"NOUP\" on the OSDs.\r\n\r\nNaturally this prevents the OSD from starting up properly:\r\n```\r\n$ kubectl logs -f -n rook-ceph rook-ceph-osd-14-cb8958458-dvfzc\r\n2020-05-17 21:32:33.954 7fd5f721ea80 -1 Falling back to public interface\r\n2020-05-17 21:33:50.267 7fd5f721ea80 -1 osd.14 21144 log_to_monitors {default=true}\r\n2020-05-17 21:33:50.363 7fd5dd007700 -1 osd.14 21144 osdmap NOUP flag is set, waiting for it to clear\r\n```\r\n\r\nThe problem is that the liveliness check only gives 10 seconds for the logs to get populated, but it takes ~30 seconds for that error message to show up, so the logs will not tell you this.\r\n\r\nI ended up editing the deployment (stopped/scaled the operator first):\r\n`$ kubectl -n rook-ceph edit deployment rook-ceph-osd-14`\r\n\r\nAnd setting the livenessProbe to periodSeconds to 600 (but anything more than 1 minute would work), then when either just watch the OSD figure out that the NOUP has cleared on it's own or issue an `ceph osd unset noup` then delete/restart the pod, and \"surprise\", everything is back to normal.\r\n\r\n**Essentially it takes up to a minute to get a new OSDMAP and flags from the monitors, the config only gives them 10 seconds and kills them actively.**\r\n\r\n**File(s) to submit**:\r\n\r\n* Cluster CR: [cluster.yaml.log](https://github.com/rook/rook/files/4638989/cluster.yaml.log)\r\n* Operator's logs: [operator.log](https://github.com/rook/rook/files/4639004/operator.log)\r\n* Crashing pod(s) logs: I'd love to, but there are none\r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release): Ubuntu 18.04.4 LTS\r\n* Kernel (e.g. `uname -a`):  4.15.0-99-generic\r\n* Cloud provider or hardware configuration: Bare metal with kubeadm, 5x Dell R720x with 9 drives each\r\n* Rook version (use `rook version` inside of a Rook Pod):  v1.3.1\r\n* Storage backend version (e.g. for ceph do `ceph -v`): 14.2.8\r\n* Kubernetes version (use `kubectl version`): v1.18.2\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift): N/A\r\n* Storage backend status (e.g. for Ceph use `ceph health` in the [Rook Ceph toolbox](https://rook.io/docs/rook/master/ceph-toolbox.html)):\r\nHEALTH_WARN 1 filesystem is degraded; 2 MDSs report slow metadata IOs; pauserd,pausewr,nodown,noout,nobackfill,norecover,noscrub,nodeep-scrub flag(s) set; Reduced data availability: 236 pgs inactive, 69 pgs peering; 79 pgs not deep-scrubbed in time; 18 daemons have recently crashed \r\n",
  "closed_at": "2020-06-05T15:24:18Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/5492/comments",
  "created_at": "2020-05-16T18:20:48Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/5492/events",
  "html_url": "https://github.com/rook/rook/issues/5492",
  "id": 619529476,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/5492/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MTk1Mjk0NzY=",
  "number": 5492,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "Setting NOUP during a cluster reboot results in broken OSDs in CrashLoopBackOff, due to too short livenessProbe.periodSeconds ",
  "updated_at": "2020-06-05T15:24:18Z",
  "url": "https://api.github.com/repos/rook/rook/issues/5492",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/207358?v=4",
    "events_url": "https://api.github.com/users/psarossy/events{/privacy}",
    "followers_url": "https://api.github.com/users/psarossy/followers",
    "following_url": "https://api.github.com/users/psarossy/following{/other_user}",
    "gists_url": "https://api.github.com/users/psarossy/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/psarossy",
    "id": 207358,
    "login": "psarossy",
    "node_id": "MDQ6VXNlcjIwNzM1OA==",
    "organizations_url": "https://api.github.com/users/psarossy/orgs",
    "received_events_url": "https://api.github.com/users/psarossy/received_events",
    "repos_url": "https://api.github.com/users/psarossy/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/psarossy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/psarossy/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/psarossy"
  }
}