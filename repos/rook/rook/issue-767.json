{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/2524996?v=4",
    "events_url": "https://api.github.com/users/dangula/events{/privacy}",
    "followers_url": "https://api.github.com/users/dangula/followers",
    "following_url": "https://api.github.com/users/dangula/following{/other_user}",
    "gists_url": "https://api.github.com/users/dangula/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/dangula",
    "id": 2524996,
    "login": "dangula",
    "node_id": "MDQ6VXNlcjI1MjQ5OTY=",
    "organizations_url": "https://api.github.com/users/dangula/orgs",
    "received_events_url": "https://api.github.com/users/dangula/received_events",
    "repos_url": "https://api.github.com/users/dangula/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/dangula/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dangula/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/dangula"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/2524996?v=4",
      "events_url": "https://api.github.com/users/dangula/events{/privacy}",
      "followers_url": "https://api.github.com/users/dangula/followers",
      "following_url": "https://api.github.com/users/dangula/following{/other_user}",
      "gists_url": "https://api.github.com/users/dangula/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dangula",
      "id": 2524996,
      "login": "dangula",
      "node_id": "MDQ6VXNlcjI1MjQ5OTY=",
      "organizations_url": "https://api.github.com/users/dangula/orgs",
      "received_events_url": "https://api.github.com/users/dangula/received_events",
      "repos_url": "https://api.github.com/users/dangula/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dangula/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dangula/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dangula"
    }
  ],
  "author_association": "MEMBER",
  "body": "The integration tests create the following:\r\n\r\n```\r\napiVersion: rook.io/v1alpha1\r\nkind: Pool\r\nmetadata:\r\n  name: replicapool\r\n  namespace: rook\r\nspec:\r\n  replication:\r\n    size: 1\r\n  # For an erasure-coded pool, comment out the replication count above and uncomment the following settings.\r\n  # Make sure you have enough OSDs to support the replica count or erasure code chunks.\r\n  #erasureCode:\r\n  #  codingChunks: 2\r\n  #  dataChunks: 2\r\n---\r\napiVersion: storage.k8s.io/v1\r\nkind: StorageClass\r\nmetadata:\r\n   name: rook-block\r\nprovisioner: rook.io/block\r\nparameters:\r\n    pool: replicapool\r\n---\r\napiVersion: v1\r\nkind: PersistentVolumeClaim\r\nmetadata:\r\n  name: block-pv-claim\r\n  annotations:\r\n    volume.beta.kubernetes.io/storage-class: rook-block\r\nspec:\r\n  accessModes:\r\n    - ReadWriteOnce\r\n  resources:\r\n    requests:\r\n      storage: 1M\r\n```\r\n\r\nbut the PersistentVolumeClaim seems to be created before the Pool is created leading in a failure:\r\n\r\n```\r\n> kubectl logs rook-api-2485995279-d1pvp --namespace rook | grep replica\r\n2017-06-28 08:00:54.824596 I | exec: Running command: rbd create replicapool/k8s-dynamic-pvc-e945d0af-5bd7-11e7-8ac4-02420ac00002-e94b5d5b-5bd7-11e7-855c-0a580ac00302 --size 1 --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring\r\n2017-06-28 08:00:54.932104 E | api: failed to create image {Name:k8s-dynamic-pvc-e945d0af-5bd7-11e7-8ac4-02420ac00002-e94b5d5b-5bd7-11e7-855c-0a580ac00302 PoolName:replicapool Size:1000000 Device: MountPoint:}: failed to create image k8s-dynamic-pvc-e945d0af-5bd7-11e7-8ac4-02420ac00002-e94b5d5b-5bd7-11e7-855c-0a580ac00302 in pool replicapool of size 1048576: Failed to complete : exit status 2. output: rbd: error opening pool replicapool: (2) No such file or directory\r\n2017-06-28 08:00:55.137547 I | exec: Running command: ceph osd pool create replicapool 0 replicated --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring --format json --out-file /tmp/480999081\r\n2017-06-28 08:00:55.281874 I | exec: Running command: rbd create replicapool/k8s-dynamic-pvc-e945d0af-5bd7-11e7-8ac4-02420ac00002-e9915691-5bd7-11e7-855c-0a580ac00302 --size 1 --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring\r\n2017-06-28 08:00:55.317201 E | api: failed to create image {Name:k8s-dynamic-pvc-e945d0af-5bd7-11e7-8ac4-02420ac00002-e9915691-5bd7-11e7-855c-0a580ac00302 PoolName:replicapool Size:1000000 Device: MountPoint:}: failed to create image k8s-dynamic-pvc-e945d0af-5bd7-11e7-8ac4-02420ac00002-e9915691-5bd7-11e7-855c-0a580ac00302 in pool replicapool of size 1048576: Failed to complete : exit status 2. output: rbd: error opening pool replicapool: (2) No such file or directory\r\n2017-06-28 08:00:55.731585 I | exec: pool 'replicapool' created\r\n2017-06-28 08:00:55.732127 I | exec: Running command: ceph osd pool set replicapool size 1 --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring --format json --out-file /tmp/939657716\r\n2017-06-28 08:00:56.806107 I | cephclient: creating pool replicapool succeeded, buf: \r\n2017-06-28 08:01:10.281525 I | exec: Running command: rbd create replicapool/k8s-dynamic-pvc-e945d0af-5bd7-11e7-8ac4-02420ac00002-f28248d7-5bd7-11e7-855c-0a580ac00302 --size 1 --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring\r\n2017-06-28 08:01:11.907592 I | exec: Running command: rbd ls -l replicapool --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring --format json\r\n```\r\n\r\nNot sure how we should handle this kind of race, but it would not be ideal if we had to ask the user to wait for pool creation and if this kind of dependency is handled by the operator.\r\n\r\n@travisn @jbw976 ",
  "closed_at": "2017-10-12T17:01:33Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 7,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/767/comments",
  "created_at": "2017-06-28T16:16:45Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/767/events",
  "html_url": "https://github.com/rook/rook/issues/767",
  "id": 239218774,
  "labels": [
    {
      "color": "5319e7",
      "default": false,
      "description": "unit or integration testing",
      "id": 607329642,
      "name": "test",
      "node_id": "MDU6TGFiZWw2MDczMjk2NDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/test"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/767/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2018-01-02T03:49:47Z",
    "closed_issues": 86,
    "created_at": "2017-05-03T02:33:11Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/1463491?v=4",
      "events_url": "https://api.github.com/users/bassam/events{/privacy}",
      "followers_url": "https://api.github.com/users/bassam/followers",
      "following_url": "https://api.github.com/users/bassam/following{/other_user}",
      "gists_url": "https://api.github.com/users/bassam/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/bassam",
      "id": 1463491,
      "login": "bassam",
      "node_id": "MDQ6VXNlcjE0NjM0OTE=",
      "organizations_url": "https://api.github.com/users/bassam/orgs",
      "received_events_url": "https://api.github.com/users/bassam/received_events",
      "repos_url": "https://api.github.com/users/bassam/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/bassam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bassam/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/bassam"
    },
    "description": "Ceph Block storage declared Beta on K8S /\r\nKubernetes 1.8 Support /\r\nRook volume plugin support in K8S /\r\nRook agent on client nodes /\r\nRook is upgradeable /\r\nSupport for local storage (and arbitrary volumes) underneath OSD pods /\r\nSupport for public cloud environments /\r\nImproved test matrix and more test coverage /\r\nCRDs for object storage and file system",
    "due_on": null,
    "html_url": "https://github.com/rook/rook/milestone/6",
    "id": 2496353,
    "labels_url": "https://api.github.com/repos/rook/rook/milestones/6/labels",
    "node_id": "MDk6TWlsZXN0b25lMjQ5NjM1Mw==",
    "number": 6,
    "open_issues": 0,
    "state": "closed",
    "title": "0.6",
    "updated_at": "2018-01-02T03:49:47Z",
    "url": "https://api.github.com/repos/rook/rook/milestones/6"
  },
  "node_id": "MDU6SXNzdWUyMzkyMTg3NzQ=",
  "number": 767,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "race between pool and PV creation",
  "updated_at": "2017-10-12T17:01:33Z",
  "url": "https://api.github.com/repos/rook/rook/issues/767",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1463491?v=4",
    "events_url": "https://api.github.com/users/bassam/events{/privacy}",
    "followers_url": "https://api.github.com/users/bassam/followers",
    "following_url": "https://api.github.com/users/bassam/following{/other_user}",
    "gists_url": "https://api.github.com/users/bassam/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bassam",
    "id": 1463491,
    "login": "bassam",
    "node_id": "MDQ6VXNlcjE0NjM0OTE=",
    "organizations_url": "https://api.github.com/users/bassam/orgs",
    "received_events_url": "https://api.github.com/users/bassam/received_events",
    "repos_url": "https://api.github.com/users/bassam/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bassam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bassam/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bassam"
  }
}