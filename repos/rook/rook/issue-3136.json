{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\nAfter updating the rook version from 0.9.3 to 1.0.0 following the [guide](https://rook.io/docs/rook/v1.0/ceph-upgrade.html) the cluster is in a `HEALTH_WARN` state and all PGs are marked as unknown.\r\nThe logs of the mgr pod shows `Not sending PG status to monitor yet, waiting for OSDs`.\r\n\r\n**Expected behavior:**\r\nAfter updating the rook version from 0.9.3 to 1.0.0 the cluster should be in a `HEALTH_OK` state and all PGs should be good.\r\n\r\n**How to reproduce it (minimal and precise):**\r\n- Install a rook cluster using 0.9.3 and, e.g., ceph 13.2.5.\r\n- Follow the update guide to update to 1.0.0.\r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release):\r\n  Debian 9.9.0, also on CoreOS\r\n* Kernel (e.g. `uname -a`):\r\n  `Linux daniel-test 4.9.0-9-amd64 #1 SMP Debian 4.9.168-1 (2019-04-12) x86_64 GNU/Linux`\r\n* Cloud provider or hardware configuration:\r\n  Kubernetes bare-metal test cluster with 1 OSD using a drive (/etc/sdb) of 8GB.\r\n* Rook version (use `rook version` inside of a Rook Pod):\r\n  ` rook: v1.0.0`\r\n* Kubernetes version (use `kubectl version`):\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"13\", GitVersion:\"v1.13.4\", GitCommit:\"c27b913fddd1a6c480c229191a087698aa92f0b1\", GitTreeState:\"clean\", BuildDate:\"2019-02-28T13:37:52Z\", GoVersion:\"go1.11.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"13\", GitVersion:\"v1.13.4\", GitCommit:\"c27b913fddd1a6c480c229191a087698aa92f0b1\", GitTreeState:\"clean\", BuildDate:\"2019-02-28T13:30:26Z\", GoVersion:\"go1.11.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift):\r\n  bare-metal\r\n* Storage backend status (e.g. for Ceph use `ceph health` in the [Rook Ceph toolbox](https://rook.io/docs/rook/master/ceph-toolbox.html)):\r\n```\r\n2019-05-08 09:06:39.274 7fec92ffd700 -1 --2- 10.32.3.1:0/2947321591 >> v2:10.32.2.5:6790/0 conn(0x7fec9414ca90 0x7fec9414ee90 unknown :-1 s=BANNER_CONNECTING pgs=0 cs=0 l=0 rx=0 tx=0)._handle_peer_banner peer v2:10.32.2.5:6790/0 is using msgr V1 protocol\r\n2019-05-08 09:06:39.274 7fec93fff700 -1 --2- 10.32.3.1:0/2947321591 >> v2:10.32.2.22:6790/0 conn(0x7fec9414f580 0x7fec94151a50 unknown :-1 s=BANNER_CONNECTING pgs=0 cs=0 l=0 rx=0 tx=0)._handle_peer_banner peer v2:10.32.2.22:6790/0 is using msgr V1 protocol\r\n2019-05-08 09:06:39.314 7fec93fff700 -1 --2-  >> v2:10.32.2.22:6790/0 conn(0x7fec94156500 0x7fec9415f290 unknown :-1 s=BANNER_CONNECTING pgs=0 cs=0 l=1 rx=0 tx=0)._handle_peer_banner peer v2:10.32.2.22:6790/0 is using msgr V1 protocol\r\n2019-05-08 09:06:39.318 7fec937fe700 -1 --2- 10.32.3.1:0/2390400519 >> v2:10.32.2.5:6790/0 conn(0x7fec941575d0 0x7fec941555e0 unknown :-1 s=BANNER_CONNECTING pgs=0 cs=0 l=1 rx=0 tx=0)._handle_peer_banner peer v2:10.32.2.5:6790/0 is using msgr V1 protocol\r\nHEALTH_WARN Reduced data availability: 800 pgs inactive; mons a,b are low on available space\r\n```\r\n\r\n`ceph status` output:\r\n```\r\n2019-05-08 09:08:17.634 7ffabb082700 -1 --2-  >> v2:10.32.2.22:6790/0 conn(0x7ffabc066ab0 0x7ffabc066f50 unknown :-1 s=BANNER_CONNECTING pgs=0 cs=0 l=0 rx=0 tx=0)._handle_peer_banner peer v2:10.32.2.22:6790/0 is using msgr V1 protocol\r\n2019-05-08 09:08:17.682 7ffabb883700 -1 --2-  >> v2:10.32.2.22:6790/0 conn(0x7ffabc154310 0x7ffabc15d0a0 unknown :-1 s=BANNER_CONNECTING pgs=0 cs=0 l=1 rx=0 tx=0)._handle_peer_banner peer v2:10.32.2.22:6790/0 is using msgr V1 protocol\r\n2019-05-08 09:08:17.686 7ffabb082700 -1 --2- 10.32.3.1:0/2301690069 >> v2:10.32.2.5:6790/0 conn(0x7ffabc1553e0 0x7ffabc1533f0 unknown :-1 s=BANNER_CONNECTING pgs=0 cs=0 l=1 rx=0 tx=0)._handle_peer_banner peer v2:10.32.2.5:6790/0 is using msgr V1 protocol\r\n  cluster:\r\n    id:     5de51fcd-ed80-47ac-8add-a979a6be3b86\r\n    health: HEALTH_WARN\r\n            Reduced data availability: 800 pgs inactive\r\n            mons a,b are low on available space\r\n\r\n  services:\r\n    mon: 2 daemons, quorum b,a\r\n    mgr: a(active)\r\n    mds: ceph-fs-1/1/1 up  {0=ceph-fs-a=up:active}, 1 up:standby-replay\r\n    osd: 1 osds: 1 up, 1 in\r\n\r\n  data:\r\n    pools:   8 pools, 800 pgs\r\n    objects: 0  objects, 0 B\r\n    usage:   0 B used, 0 B / 0 B avail\r\n    pgs:     100.000% pgs unknown\r\n             800 unknown\r\n```\r\n\r\n**Log Files**:\r\n* [operator.log](https://github.com/rook/rook/files/3156510/operator.log)\r\n* [osd.log](https://github.com/rook/rook/files/3156511/osd.log)\r\n* [mgr.log](https://github.com/rook/rook/files/3156513/mgr.log)\r\n",
  "closed_at": "2019-08-19T16:26:54Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/3718398?v=4",
    "events_url": "https://api.github.com/users/galexrt/events{/privacy}",
    "followers_url": "https://api.github.com/users/galexrt/followers",
    "following_url": "https://api.github.com/users/galexrt/following{/other_user}",
    "gists_url": "https://api.github.com/users/galexrt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/galexrt",
    "id": 3718398,
    "login": "galexrt",
    "node_id": "MDQ6VXNlcjM3MTgzOTg=",
    "organizations_url": "https://api.github.com/users/galexrt/orgs",
    "received_events_url": "https://api.github.com/users/galexrt/received_events",
    "repos_url": "https://api.github.com/users/galexrt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/galexrt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/galexrt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/galexrt"
  },
  "comments": 19,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/3136/comments",
  "created_at": "2019-05-08T09:09:04Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/3136/events",
  "html_url": "https://github.com/rook/rook/issues/3136",
  "id": 441630021,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/3136/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NDE2MzAwMjE=",
  "number": 3136,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "Update 0.9.3 -> 1.0.0: all PGs unknown, mgr waiting for OSDs",
  "updated_at": "2019-08-19T16:26:54Z",
  "url": "https://api.github.com/repos/rook/rook/issues/3136",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/653739?v=4",
    "events_url": "https://api.github.com/users/muhlba91/events{/privacy}",
    "followers_url": "https://api.github.com/users/muhlba91/followers",
    "following_url": "https://api.github.com/users/muhlba91/following{/other_user}",
    "gists_url": "https://api.github.com/users/muhlba91/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/muhlba91",
    "id": 653739,
    "login": "muhlba91",
    "node_id": "MDQ6VXNlcjY1MzczOQ==",
    "organizations_url": "https://api.github.com/users/muhlba91/orgs",
    "received_events_url": "https://api.github.com/users/muhlba91/received_events",
    "repos_url": "https://api.github.com/users/muhlba91/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/muhlba91/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/muhlba91/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/muhlba91"
  }
}