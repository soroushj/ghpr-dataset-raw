{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\n\r\nCan't restore a rook/ceph data to a different kubernetes cluster by following the guide because I can't SSH to the nodes in the new cluster.\r\n\r\n**How to reproduce it (minimal and precise):**\r\n\r\nI am trying to follow the disaster recovery guide for moving my rook/ceph 1.4.4 data to a new kubernetes cluster using standard kubernetes operations only, without ssh. Can't get it to work. Also the deployment `rook-ceph-tools` that is addressed in the guide does not exist in `rook-ceph` namespace.\r\n\r\nhttps://github.com/rook/rook/blob/v1.4.4/Documentation/ceph-disaster-recovery.md#adopt-an-existing-rook-ceph-cluster-into-a-new-kubernetes-cluster\r\n\r\nI'm doing the following:\r\n*In the old cluster:*\r\n1. Install rook/ceph with 3 mons and 3 OSDs. The OSDs are configured to use large PVCs that I provide myself (see yaml below).\r\n1. Provision some RBD volumes then add files to them.\r\n1. Take AWS snapshots of all the 6 volumes in rook-ceph namespace in the old cluster. (using velero)\r\n\r\n*In the new cluster:*\r\n1. Install rook/ceph with exactly the same setup.\r\n1. Scale down the rook operator deployment and delete all other deployments (rook-ceph-mgr-a, .., rook-ceph-osd-0, ..)\r\n1. Remove all the 6 PVCs (mons and osds) and replace with PVCs created from the AWS snapshots. (using velero)\r\n1. Modify the secret `rook-ceph-mons-keyring`. Change the `keystring` value by overriding `[mon.]` section with the value in the corresponding secret in the old cluster. Also remove the section `[client.admin]`\r\n1. Modify the secret `rook-ceph-mon`. Change `fsid` with the corresponding value in the old cluster.\r\n1. Modify the configmap `rook-config-override`. Disable authentication as explained in the guide.\r\n1. Scale up the rook operator and wait.\r\n\r\nAfter a while, I see that the only pod that is up and running is `mon-a`  (no other mons, no OSDs, no mgr). The operator logs show that it is stuck an infinite loop and just print this line once every 20 seconds:\r\n> 2020-10-15 19:01:49.957462 I | op-mon: mons running: [a]\r\n\r\nAlso once every 2-3 minutes it prints this line too:\r\n> 2020-10-15 19:01:37.155224 E | ceph-block-pool-controller: failed to reconcile invalid pool CR \"replicapool\" spec: failed to get crush map: failed to get crush map. timed out\r\n: exit status 1\r\n\r\nThe logs of the mon-a show thousands of lines like this\r\n> debug 2020-10-15T19:08:22.121+0000 7f0c7dc76700  1 mon.a@0(probing) e3 handle_auth_request failed to assign global_id\r\n\r\nBy the way, if I copy the configmap `rook-ceph-mon-endpoints` from the old cluster I do get 3 monds (a, b, c) running instead of just one, but still the loop in the operator is still there\r\n> 2020-10-15 20:08:56.370771 I | op-mon: mons running: [b c a]\r\n\r\nAfter A LOT of time I get this in the operator log and then the loop starts again.\r\n> 2020-10-15 20:09:11.471190 E | ceph-cluster-controller: failed to reconcile. failed to reconcile cluster \"rook-ceph\": failed to configure local ceph cluster: failed to create cluster: failed to start ceph monitors: failed to start mon pods: failed to check mon quorum a: failed to wait for mon quorum: exceeded max retry count waiting for monitors to reach quorum\r\n",
  "closed_at": "2020-10-27T17:33:26Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/6442/comments",
  "created_at": "2020-10-15T19:10:01Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/6442/events",
  "html_url": "https://github.com/rook/rook/issues/6442",
  "id": 722594844,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "5522ee",
      "default": false,
      "description": "",
      "id": 626631231,
      "name": "reliability",
      "node_id": "MDU6TGFiZWw2MjY2MzEyMzE=",
      "url": "https://api.github.com/repos/rook/rook/labels/reliability"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/6442/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU3MjI1OTQ4NDQ=",
  "number": 6442,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "Disaster Recovery Without SSH to Nodes Not Working",
  "updated_at": "2020-10-27T17:33:26Z",
  "url": "https://api.github.com/repos/rook/rook/issues/6442",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/196764?v=4",
    "events_url": "https://api.github.com/users/tareqhs/events{/privacy}",
    "followers_url": "https://api.github.com/users/tareqhs/followers",
    "following_url": "https://api.github.com/users/tareqhs/following{/other_user}",
    "gists_url": "https://api.github.com/users/tareqhs/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tareqhs",
    "id": 196764,
    "login": "tareqhs",
    "node_id": "MDQ6VXNlcjE5Njc2NA==",
    "organizations_url": "https://api.github.com/users/tareqhs/orgs",
    "received_events_url": "https://api.github.com/users/tareqhs/received_events",
    "repos_url": "https://api.github.com/users/tareqhs/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tareqhs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tareqhs/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tareqhs"
  }
}