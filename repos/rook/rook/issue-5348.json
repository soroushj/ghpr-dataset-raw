{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "<!-- **Are you in the right place?**\r\n1. For issues or feature requests, please create an issue in this repository.\r\n2. For general technical and non-technical questions, we are happy to help you on our [Rook.io Slack](https://slack.rook.io/).\r\n3. Did you already search the existing open issues for anything similar? -->\r\n\r\n**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\nIf a node is goes down and portable OSDs are running on that node, we would expect the OSDs to move to another available node. When the node is drained, the OSDs are rescheduled as expected. However, when the node is abruptly terminated (e.g. power outage), the OSD pod will remain indefinitely in the `terminating` stage because of the PV underneath the OSD that cannot be detached. \r\n\r\nManual intervention is currently needed to force delete the pod. Kubernetes will wait indefinitely for the node to avoid a split brain scenario in case it comes back up as described in https://github.com/kubernetes/kubernetes/issues/65392. However, in the case of OSDs, Ceph is already designed to protect against the split brain and keeps track of the active OSD.\r\n\r\n**Expected behavior:**\r\nThe portable OSDs should allow for automatic failover even in the scenario where a node was not terminated properly. This could be accomplished by:\r\n- The operator would monitor the OSD pods \r\n- If 1) an OSD pod is portable, 2) the OSD is marked as `out`, 3) the OSD pod is stuck in `terminating` state, and 4) the node status is not available\r\n   - Then force delete the OSD pod in an attempt to allow it to start on another node\r\n\r\n**How to reproduce it (minimal and precise):**\r\n<!-- Please let us know any circumstances for reproduction of your bug. -->\r\n- Start a K8s cluster in the cloud\r\n- Create a rook cluster with a `storageClassDeviceSet` where `portable: true`\r\n- Terminate a node ungracefully\r\n- See the OSD be stuck indefinitely (unexpected)\r\n- Notice that the mon will be automatically failed over as expected\r\n",
  "closed_at": "2020-05-01T14:39:04Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/5348/comments",
  "created_at": "2020-04-27T22:00:42Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/5348/events",
  "html_url": "https://github.com/rook/rook/issues/5348",
  "id": 607883339,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/5348/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MDc4ODMzMzk=",
  "number": 5348,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "Portable OSDs get stuck if a node is terminated abruptly",
  "updated_at": "2020-05-01T14:39:04Z",
  "url": "https://api.github.com/repos/rook/rook/issues/5348",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  }
}