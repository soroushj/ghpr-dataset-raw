{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/3718398?v=4",
    "events_url": "https://api.github.com/users/galexrt/events{/privacy}",
    "followers_url": "https://api.github.com/users/galexrt/followers",
    "following_url": "https://api.github.com/users/galexrt/following{/other_user}",
    "gists_url": "https://api.github.com/users/galexrt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/galexrt",
    "id": 3718398,
    "login": "galexrt",
    "node_id": "MDQ6VXNlcjM3MTgzOTg=",
    "organizations_url": "https://api.github.com/users/galexrt/orgs",
    "received_events_url": "https://api.github.com/users/galexrt/received_events",
    "repos_url": "https://api.github.com/users/galexrt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/galexrt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/galexrt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/galexrt"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/3718398?v=4",
      "events_url": "https://api.github.com/users/galexrt/events{/privacy}",
      "followers_url": "https://api.github.com/users/galexrt/followers",
      "following_url": "https://api.github.com/users/galexrt/following{/other_user}",
      "gists_url": "https://api.github.com/users/galexrt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/galexrt",
      "id": 3718398,
      "login": "galexrt",
      "node_id": "MDQ6VXNlcjM3MTgzOTg=",
      "organizations_url": "https://api.github.com/users/galexrt/orgs",
      "received_events_url": "https://api.github.com/users/galexrt/received_events",
      "repos_url": "https://api.github.com/users/galexrt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/galexrt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/galexrt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/galexrt"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**Bug Report**\r\n\r\nWhat happened: When trying to use block storage with an erasure coded pool I get the following errors in the operator:\r\n```2018-05-22 14:34:07.303570 I | op-provisioner: creating volume with configuration {pool:ecpool clusterNamespace:rook fstype:}                                                                                                                                                                         2018-05-22 14:34:07.303598 I | exec: Running command: rbd create ecpool/pvc-3ff8755a-5dcc-11e8-876a-ecf4bbc33eac --size 1024 --cluster=rook --conf=/var/lib/rook/rook/rook.config --keyring=/var/lib/rook/rook/client.admin.keyring                                                                   \r\nE0522 14:34:10.101498       7 controller.go:801] Failed to provision volume for claim \"default/test-ec-claim\" with StorageClass \"rook-block\": Failed to create rook block image ecpool/pvc-3ff8755a-5dcc-11e8-876a-ecf4bbc33eac: failed to create image pvc-3ff8755a-5dcc-11e8-876a-ecf4bbc33eac in po\r\nol ecpool of size 1073741824: Failed to complete '': exit status 95. 2018-05-22 14:34:10.081449 7fffd3fff700 -1 librbd::image::CreateRequest: 0x555555b6cfc0 handle_add_image_to_directory: error adding image to directory: (95) Operation not supported                                             \r\n````\r\n\r\nWhat you expected to happen: The volume is created and attached.\r\n\r\nHow to reproduce it (minimal and precise):\r\nApply:\r\n```apiVersion: rook.io/v1alpha1\r\nkind: Pool\r\nmetadata:\r\n  name: ecpool\r\n  namespace: rook\r\nspec:\r\n  failureDomain: osd\r\n  erasureCoded:\r\n    dataChunks: 8\r\n    codingChunks: 2\r\n---\r\napiVersion: storage.k8s.io/v1\r\nkind: StorageClass\r\nmetadata:\r\n   name: rook-block\r\nprovisioner: rook.io/block\r\nparameters:\r\n  pool: ecpool\r\n````\r\nAnd create a pod with a PVC using rook-block.\r\n\r\nFrom what I understand based on [https://www.spinics.net/lists/ceph-users/msg39489.html](this) , the issue is that the metadata still needs to use a replicated pool. Following the suggestions in that thread, that does indeed seem to work:\r\n\r\n```root@rook-tools:/# rbd create ecpool/test --size 10                      \r\n2018-05-22 14:40:24.193248 7fffd3fff700 -1 librbd::image::CreateRequest: 0x555555b64250 handle_add_image_to_directory: error adding image to directory: (95) Operation not supported\r\nrbd: create error: (95) Operation not supported                          \r\nroot@rook-tools:/# rbd create --size 10 --data-pool ecpool replicapool/test                                                                        \r\nroot@rook-tools:/# rbd create ecpool/test --size 10                                                                                                \r\n2018-05-22 14:42:06.132323 7fffd3fff700 -1 librbd::image::CreateRequest: 0x555555b63fd0 handle_add_image_to_directory: error adding image to directory: (95) Operation not supported\r\nrbd: create error: (95) Operation not supported                          \r\nroot@rook-tools:/# rbd info replicapool/test                             \r\nrbd image 'test':                   \r\n        size 10240 kB in 3 objects  \r\n        order 22 (4096 kB objects)  \r\n        data_pool: ecpool           \r\n        block_name_prefix: rbd_data.4.1ec7e2ae8944a                      \r\n        format: 2                   \r\n        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten, data-pool                                                         \r\n        flags:                      \r\n        create_timestamp: Tue May 22 14:41:42 2018\r\n```\r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release): RHEL 7.3\r\n* Kernel (e.g. `uname -a`): 3.10.0-514.6.1.el7\r\n* Rook version (use `rook version` inside of a Rook Pod): v0.7.0-100.ge11b3d8\r\n* Kubernetes version (use `kubectl version`): v1.9.3\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift): Open source on-prem\r\n* Ceph status: HEALTH_OK\r\n",
  "closed_at": "2018-08-22T09:03:15Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/3718398?v=4",
    "events_url": "https://api.github.com/users/galexrt/events{/privacy}",
    "followers_url": "https://api.github.com/users/galexrt/followers",
    "following_url": "https://api.github.com/users/galexrt/following{/other_user}",
    "gists_url": "https://api.github.com/users/galexrt/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/galexrt",
    "id": 3718398,
    "login": "galexrt",
    "node_id": "MDQ6VXNlcjM3MTgzOTg=",
    "organizations_url": "https://api.github.com/users/galexrt/orgs",
    "received_events_url": "https://api.github.com/users/galexrt/received_events",
    "repos_url": "https://api.github.com/users/galexrt/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/galexrt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/galexrt/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/galexrt"
  },
  "comments": 13,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/1733/comments",
  "created_at": "2018-05-23T15:20:07Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/1733/events",
  "html_url": "https://github.com/rook/rook/issues/1733",
  "id": 325755830,
  "labels": [
    {
      "color": "00bbcc",
      "default": false,
      "description": "",
      "id": 496364161,
      "name": "block",
      "node_id": "MDU6TGFiZWw0OTYzNjQxNjE=",
      "url": "https://api.github.com/repos/rook/rook/labels/block"
    },
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    },
    {
      "color": "128A0C",
      "default": true,
      "description": null,
      "id": 405241118,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTg=",
      "url": "https://api.github.com/repos/rook/rook/labels/help%20wanted"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/1733/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMjU3NTU4MzA=",
  "number": 1733,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "Block storage using erasure coding doesn't work",
  "updated_at": "2019-04-22T14:14:28Z",
  "url": "https://api.github.com/repos/rook/rook/issues/1733",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/1381651?v=4",
    "events_url": "https://api.github.com/users/benceszikora/events{/privacy}",
    "followers_url": "https://api.github.com/users/benceszikora/followers",
    "following_url": "https://api.github.com/users/benceszikora/following{/other_user}",
    "gists_url": "https://api.github.com/users/benceszikora/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/benceszikora",
    "id": 1381651,
    "login": "benceszikora",
    "node_id": "MDQ6VXNlcjEzODE2NTE=",
    "organizations_url": "https://api.github.com/users/benceszikora/orgs",
    "received_events_url": "https://api.github.com/users/benceszikora/received_events",
    "repos_url": "https://api.github.com/users/benceszikora/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/benceszikora/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benceszikora/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/benceszikora"
  }
}