{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/3989526?v=4",
    "events_url": "https://api.github.com/users/BlaineEXE/events{/privacy}",
    "followers_url": "https://api.github.com/users/BlaineEXE/followers",
    "following_url": "https://api.github.com/users/BlaineEXE/following{/other_user}",
    "gists_url": "https://api.github.com/users/BlaineEXE/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/BlaineEXE",
    "id": 3989526,
    "login": "BlaineEXE",
    "node_id": "MDQ6VXNlcjM5ODk1MjY=",
    "organizations_url": "https://api.github.com/users/BlaineEXE/orgs",
    "received_events_url": "https://api.github.com/users/BlaineEXE/received_events",
    "repos_url": "https://api.github.com/users/BlaineEXE/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/BlaineEXE/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/BlaineEXE/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/BlaineEXE"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/3989526?v=4",
      "events_url": "https://api.github.com/users/BlaineEXE/events{/privacy}",
      "followers_url": "https://api.github.com/users/BlaineEXE/followers",
      "following_url": "https://api.github.com/users/BlaineEXE/following{/other_user}",
      "gists_url": "https://api.github.com/users/BlaineEXE/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BlaineEXE",
      "id": 3989526,
      "login": "BlaineEXE",
      "node_id": "MDQ6VXNlcjM5ODk1MjY=",
      "organizations_url": "https://api.github.com/users/BlaineEXE/orgs",
      "received_events_url": "https://api.github.com/users/BlaineEXE/received_events",
      "repos_url": "https://api.github.com/users/BlaineEXE/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BlaineEXE/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BlaineEXE/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BlaineEXE"
    }
  ],
  "author_association": "NONE",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\nAfter applying the `operator.yaml` manifest the rook-ceph-operator pod fails with:\r\n\r\n`Error: container has runAsNonRoot and image will run as root`\r\n\r\n**Expected behavior:**\r\n\r\nThe operator applies correctly and the pods start in running state.\r\n\r\n**How to reproduce it (minimal and precise):**\r\n\r\n1. On vanilla 3-node kuberenetes deployment\r\n2. `cd cluster/examples/kubernetes/ceph`\r\n3. `kubectl apply -f common.yaml`\r\n4. `kubectl apply -f operator.yaml`\r\n5. Observe failure\r\n\r\n(As a note, deploying from v1.3.1 tag works fine).\r\n\r\n**File(s) to submit**:\r\n\r\n`kubectl describe pod/rook-ceph-operator-ff4fc4d9b-cbtqj`\r\n\r\n```\r\nName:         rook-ceph-operator-ff4fc4d9b-cbtqj\r\nNamespace:    rook-ceph\r\nPriority:     0\r\nNode:         josh-rookci-e1853ce3-worker-0/10.86.4.167\r\nStart Time:   Mon, 20 Apr 2020 21:34:53 +1000\r\nLabels:       app=rook-ceph-operator\r\n              pod-template-hash=ff4fc4d9b\r\nAnnotations:  container.apparmor.security.beta.kubernetes.io/rook-ceph-operator: runtime/default\r\n              kubernetes.io/psp: default\r\n              seccomp.security.alpha.kubernetes.io/pod: docker/default\r\nStatus:       Pending\r\nIP:           10.244.2.3\r\nIPs:\r\n  IP:           10.244.2.3\r\nControlled By:  ReplicaSet/rook-ceph-operator-ff4fc4d9b\r\nContainers:\r\n  rook-ceph-operator:\r\n    Container ID:  \r\n    Image:         rook/ceph:master\r\n    Image ID:      \r\n    Port:          <none>\r\n    Host Port:     <none>\r\n    Args:\r\n      ceph\r\n      operator\r\n    State:          Waiting\r\n      Reason:       CreateContainerConfigError\r\n    Ready:          False\r\n    Restart Count:  0\r\n    Environment:\r\n      ROOK_CURRENT_NAMESPACE_ONLY:               false\r\n      ROOK_ALLOW_MULTIPLE_FILESYSTEMS:           false\r\n      ROOK_LOG_LEVEL:                            INFO\r\n      ROOK_CEPH_STATUS_CHECK_INTERVAL:           60s\r\n      ROOK_MON_HEALTHCHECK_INTERVAL:             45s\r\n      ROOK_MON_OUT_TIMEOUT:                      600s\r\n      ROOK_DISCOVER_DEVICES_INTERVAL:            60m\r\n      ROOK_HOSTPATH_REQUIRES_PRIVILEGED:         false\r\n      ROOK_ENABLE_SELINUX_RELABELING:            true\r\n      ROOK_ENABLE_FSGROUP:                       true\r\n      ROOK_DISABLE_DEVICE_HOTPLUG:               false\r\n      DISCOVER_DAEMON_UDEV_BLACKLIST:            (?i)dm-[0-9]+,(?i)rbd[0-9]+,(?i)nbd[0-9]+\r\n      ROOK_ENABLE_FLEX_DRIVER:                   false\r\n      ROOK_ENABLE_DISCOVERY_DAEMON:              true\r\n      ROOK_UNREACHABLE_NODE_TOLERATION_SECONDS:  5\r\n      NODE_NAME:                                  (v1:spec.nodeName)\r\n      POD_NAME:                                  rook-ceph-operator-ff4fc4d9b-cbtqj (v1:metadata.name)\r\n      POD_NAMESPACE:                             rook-ceph (v1:metadata.namespace)\r\n    Mounts:\r\n      /etc/ceph from default-config-dir (rw)\r\n      /var/lib/rook from rook-config (rw)\r\n      /var/run/secrets/kubernetes.io/serviceaccount from rook-ceph-system-token-ltsv5 (ro)\r\nConditions:\r\n  Type              Status\r\n  Initialized       True \r\n  Ready             False \r\n  ContainersReady   False \r\n  PodScheduled      True \r\nVolumes:\r\n  rook-config:\r\n    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)\r\n    Medium:     \r\n    SizeLimit:  <unset>\r\n  default-config-dir:\r\n    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)\r\n    Medium:     \r\n    SizeLimit:  <unset>\r\n  rook-ceph-system-token-ltsv5:\r\n    Type:        Secret (a volume populated by a Secret)\r\n    SecretName:  rook-ceph-system-token-ltsv5\r\n    Optional:    false\r\nQoS Class:       BestEffort\r\nNode-Selectors:  <none>\r\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\r\n                 node.kubernetes.io/unreachable:NoExecute for 300s\r\nEvents:\r\n  Type     Reason     Age               From                                    Message\r\n  ----     ------     ----              ----                                    -------\r\n  Normal   Scheduled  34s               default-scheduler                       Successfully assigned rook-ceph/rook-ceph-operator-ff4fc4d9b-cbtqj to josh-rookci-e1853ce3-worker-0\r\n  Normal   Pulled     6s (x4 over 33s)  kubelet, josh-rookci-e1853ce3-worker-0  Container image \"rook/ceph:master\" already present on machine\r\n  Warning  Failed     6s (x4 over 33s)  kubelet, josh-rookci-e1853ce3-worker-0  Error: container has runAsNonRoot and image will run as root\r\n```\r\n\r\n**Environment**:\r\n* `openSUSE Leap 15.1`\r\n* `Linux josh-rookci-2e875dac-master-0 4.12.14-lp151.28.44-default #1 SMP Fri Mar 20 18:20:20 UTC 2020 (dbf1aea) x86_64 x86_64 x86_64 GNU/Linux`\r\n* Private OpenStack cloud\r\n* Rook version: `master` branch and master tags. Fails with both public container images and locally built ones.\r\n* `Server Version: version.Info{Major:\"1\", Minor:\"17\", GitVersion:\"v1.17.5\", GitCommit:\"e0fccafd69541e3750d460ba0f9743b90336f24f\", GitTreeState:\"clean\", BuildDate:\"2020-04-16T11:35:47Z\", GoVersion:\"go1.13.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}`\r\n* Kubernetes cluster type: Upstream `kubeadm` deployment\r\n",
  "closed_at": "2020-04-27T17:23:47Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/3989526?v=4",
    "events_url": "https://api.github.com/users/BlaineEXE/events{/privacy}",
    "followers_url": "https://api.github.com/users/BlaineEXE/followers",
    "following_url": "https://api.github.com/users/BlaineEXE/following{/other_user}",
    "gists_url": "https://api.github.com/users/BlaineEXE/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/BlaineEXE",
    "id": 3989526,
    "login": "BlaineEXE",
    "node_id": "MDQ6VXNlcjM5ODk1MjY=",
    "organizations_url": "https://api.github.com/users/BlaineEXE/orgs",
    "received_events_url": "https://api.github.com/users/BlaineEXE/received_events",
    "repos_url": "https://api.github.com/users/BlaineEXE/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/BlaineEXE/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/BlaineEXE/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/BlaineEXE"
  },
  "comments": 28,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/5293/comments",
  "created_at": "2020-04-20T12:17:30Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/5293/events",
  "html_url": "https://github.com/rook/rook/issues/5293",
  "id": 603193579,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/5293/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MDMxOTM1Nzk=",
  "number": 5293,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "Deploying rook-ceph operator fails with runAsNonRoot",
  "updated_at": "2020-04-27T17:23:47Z",
  "url": "https://api.github.com/repos/rook/rook/issues/5293",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/728450?v=4",
    "events_url": "https://api.github.com/users/jhesketh/events{/privacy}",
    "followers_url": "https://api.github.com/users/jhesketh/followers",
    "following_url": "https://api.github.com/users/jhesketh/following{/other_user}",
    "gists_url": "https://api.github.com/users/jhesketh/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jhesketh",
    "id": 728450,
    "login": "jhesketh",
    "node_id": "MDQ6VXNlcjcyODQ1MA==",
    "organizations_url": "https://api.github.com/users/jhesketh/orgs",
    "received_events_url": "https://api.github.com/users/jhesketh/received_events",
    "repos_url": "https://api.github.com/users/jhesketh/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jhesketh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jhesketh/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jhesketh"
  }
}