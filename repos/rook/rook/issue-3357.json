{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**Description of problem:**\r\n\r\nIn the latest rook + csi setup (after PR -https://github.com/rook/rook/pull/3324 was merged) , rbd pvcs are not getting bound with below mentioned error message\r\n\r\n$oc get pvc\r\n\r\nrbd-pvc      Pending                                                                        csi-rbd\r\n  18m\r\n\r\nEvents:\r\n  Type       Reason                Age                From                                                                               Message\r\n  ----       ------                ----               ----                                                                               -------\r\n  Normal     Provisioning          26s (x6 over 57s)  rbd.csi.ceph.com_csi-rbdplugin-provisioner-0_6e128fc9-97f6-11e9-9393-0a580a80020a  External provisioner is provisioning volume for claim \"test-csi/rbd-pvc\"\r\n  Warning    ProvisioningFailed    26s (x6 over 57s)  rbd.csi.ceph.com_csi-rbdplugin-provisioner-0_6e128fc9-97f6-11e9-9393-0a580a80020a  failed to provision volume with StorageClass \"csi-rbd\": rpc error: code = Internal desc = missing ID field 'userID' in secrets\r\n  Normal     ExternalProvisioning  0s (x5 over 57s)   persistentvolume-controller                                                        waiting for a volume to be created, either by external provisioner \"rbd.csi.ceph.com\" or manually created by system administrator\r\nMounted By:  <none>\r\n\r\n\r\n**Observation:**\r\n\r\n1. The code seems to be looking for UserID In RBD secret. But rbd/secret.yaml doesn't have a separate field \"userid\" as cephfs/secret.yaml has.\r\n\r\n**rbd_secret.yaml**\r\n\r\n```\r\ndata:\r\n  # Key value corresponds to a user name defined in Ceph cluster\r\n  admin: BASE64-ENCODED-PASSWORD\r\n  # Key value corresponds to a user name defined in Ceph cluster\r\n  kubernetes: BASE64-ENCODED-PASSWORD\r\n```\r\n\r\n**cephfs_secret.yaml**\r\n\r\n```\r\n  userID: BASE64-ENCODED-USER\r\n  userKey: BASE64-ENCODED-PASSWORD\r\n\r\n  # Required if provisionVolume is set to true\r\n  adminID: BASE64-ENCODED-USER\r\n  adminKey: BASE64-ENCODED-PASSWORD\r\n\r\n```\r\n\r\nHow reproducible:\r\n=====================\r\n100%\r\n\r\n**Steps to Reproduce:**\r\n1. Create a ceph based rook-csi cluster using the latest rook repo files (https://github.com/rook/rook) - master branch\r\n2. Create a cephblockpool \\\r\n $oc create -f pool.yaml (pool name =rbd)\r\n\r\n3. Create a kubernetes user from the toolbox pod\r\n  $ceph auth get-or-create-key client.kubernetes mon  \"allow profile rbd\" osd \"profile rbd pool=rbd\"\r\n\r\n4. Create secret and storageclass. Yamls attached in next comment (from ceph/csi/examples/rbd)\r\n  $oc create -f secret.yaml ; oc create -f storageclass.yaml\r\n\r\n5. Create pvc\r\n  $ oc create -f pvc.yaml\r\n\r\n6. Check the status of pvc\r\n  $oc get pvc; oc describe pvc $pvc-name\r\n\r\n\r\n\r\nActual results:\r\n===================\r\nThe rbd pvc is not bound as the code looks for \"clusterid\" field in secret which is not present in yaml.\r\n\r\nExpected results:\r\n====================\r\nPVC should get bound.\r\n\r\n\r\n\r\nVersion-Release number of selected component (if applicable):\r\n=================================================\r\n\r\n\r\noc version\r\n\r\n$ oc version\r\nClient Version: version.Info{Major:\"4\", Minor:\"1+\", GitVersion:\"v4.1.0-201905091432+4910781-dirty\", GitCommit:\"4910781\", GitTreeState:\"dirty\", BuildDate:\"2019-05-09T19:19:42Z\", GoVersion:\"go1.11.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"13+\", GitVersion:\"v1.13.4+d4417a7\", GitCommit:\"d4417a7\", GitTreeState:\"clean\", BuildDate:\"2019-06-12T15:47:30Z\", GoVersion:\"go1.11.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\n\r\n$ oc get clusterversion\r\nNAME      VERSION   AVAILABLE   PROGRESSING   SINCE   STATUS\r\nversion   4.1.2     True        False         3h3m    Cluster version is 4.1.2\r\n\r\n\r\n```\r\n**Ceph and rook version**\r\n-----------------------\r\n\r\nsh-4.2# ceph version\r\nceph version 14.2.1 (d555a9489eb35f84f2e1ef49b77e19da9d113972) nautilus (stable)\r\n\r\nsh-4.2# rook version\r\n rook: v1.0.0-154.g004f795\r\n\r\n\r\n**CSI version**\r\n-------------\r\n\r\n$oc logs csi-rbdplugin-provisioner-0 -n openshift-storage -c csi-rbdplugin\r\n\r\nI0626 09:40:26.830842       1 cephcsi.go:108] Starting driver type: rbd with name: rbd.csi.ceph.com\r\nI0626 09:40:26.830922       1 rbd.go:104] Driver: rbd.csi.ceph.com version: 1.0.0\r\n\r\n$ oc describe pod csi-rbdplugin-provisioner-0 -n openshift-storage|grep -i image\r\n    Image:         quay.io/k8scsi/csi-provisioner:v1.2.0\r\n    Image ID:      quay.io/k8scsi/csi-provisioner@sha256:0dffe9a8d39c4fdd49c5dd98ca5611a3f9726c012b082946f630e36988ba9f37\r\n    Image:         quay.io/k8scsi/csi-attacher:v1.1.1\r\n    Image ID:      quay.io/k8scsi/csi-attacher@sha256:e4db94969e1d463807162a1115192ed70d632a61fbeb3bdc97b40fe9ce78c831\r\n    Image:         quay.io/k8scsi/csi-snapshotter:v1.1.0\r\n    Image ID:      quay.io/k8scsi/csi-snapshotter@sha256:a49e0da1af6f2bf717e41ba1eee8b5e6a1cbd66a709dd92cc43fe475fe2589eb\r\n    Image:         quay.io/cephcsi/cephcsi:canary\r\n    Image ID:      quay.io/cephcsi/cephcsi@sha256:e832be9790bf12ab74c87217cce1dbd0a2416500e1d9a39af53b3fece414feac\r\n```\r\n**Rook image**\r\n----------------------\r\n\r\n$ oc describe pod rook-ceph-operator-5c6fd4b7db-rldcf -n openshift-storage|grep -i image\r\n    Image:         rook/ceph:master\r\n    Image ID:      docker.io/rook/ceph@sha256:4d0057e90c28a7bd8d3c3e9b13df40d0df1847567ef50a2a1e41dcea7ddb1d18\r\n      ROOK_CSI_CEPH_IMAGE:                quay.io/cephcsi/cephcsi:canary\r\n      ROOK_CSI_REGISTRAR_IMAGE:           quay.io/k8scsi/csi-node-driver-registrar:v1.1.0\r\n      ROOK_CSI_PROVISIONER_IMAGE:         quay.io/k8scsi/csi-provisioner:v1.2.0\r\n      ROOK_CSI_SNAPSHOTTER_IMAGE:         quay.io/k8scsi/csi-snapshotter:v1.1.0\r\n      ROOK_CSI_ATTACHER_IMAGE:            quay.io/k8scsi/csi-attacher:v1.1.1\r\n",
  "closed_at": "2019-07-04T06:56:04Z",
  "closed_by": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
    "events_url": "https://api.github.com/users/leseb/events{/privacy}",
    "followers_url": "https://api.github.com/users/leseb/followers",
    "following_url": "https://api.github.com/users/leseb/following{/other_user}",
    "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/leseb",
    "id": 912735,
    "login": "leseb",
    "node_id": "MDQ6VXNlcjkxMjczNQ==",
    "organizations_url": "https://api.github.com/users/leseb/orgs",
    "received_events_url": "https://api.github.com/users/leseb/received_events",
    "repos_url": "https://api.github.com/users/leseb/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/leseb"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/3357/comments",
  "created_at": "2019-06-26T12:08:21Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/3357/events",
  "html_url": "https://github.com/rook/rook/issues/3357",
  "id": 460932392,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/3357/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NjA5MzIzOTI=",
  "number": 3357,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "RBD pvc not getting bound in rook-v1.0.0-154.g004f795 and rbd.csi.ceph.com version: 1.0.0",
  "updated_at": "2019-07-04T06:56:04Z",
  "url": "https://api.github.com/repos/rook/rook/issues/3357",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/38582702?v=4",
    "events_url": "https://api.github.com/users/nehaberry/events{/privacy}",
    "followers_url": "https://api.github.com/users/nehaberry/followers",
    "following_url": "https://api.github.com/users/nehaberry/following{/other_user}",
    "gists_url": "https://api.github.com/users/nehaberry/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/nehaberry",
    "id": 38582702,
    "login": "nehaberry",
    "node_id": "MDQ6VXNlcjM4NTgyNzAy",
    "organizations_url": "https://api.github.com/users/nehaberry/orgs",
    "received_events_url": "https://api.github.com/users/nehaberry/received_events",
    "repos_url": "https://api.github.com/users/nehaberry/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/nehaberry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nehaberry/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/nehaberry"
  }
}