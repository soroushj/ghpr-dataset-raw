{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "Using the latest rookd and rook-operator images (anything after dev-2017-02-10-k8s), OSDs fail to provision disks.  Same result with real disks (`--data-devices=all`) and using `emptyDir` volumes.\r\n\r\nSome log lines from one of the OSD pods:\r\n```\r\n2017-02-23 19:15:38.867191 I | cephosd: configuring osd dirs: map[/var/lib/rook:-1]\r\n2017-02-23 19:15:38.867209 I | cephmon: connecting to ceph cluster rookcluster with user bootstrap-osd\r\n2017-02-23 19:15:39.406850 I | cephosd: successfully created OSD 9d8747e1-aa24-4fdd-b28d-5fb27b60b728 with ID 11\r\n2017-02-23 19:15:39.408484 I | cephosd: Initializing OSD 11 file system at /var/lib/rook/osd11...\r\n2017-02-23 19:15:39.408653 I | proc: Running process osd with args: [--mkfs --mkkey --id=11 --cluster=rookcluster --conf=/var/lib/rook/osd11/rookcluster.config --osd-data=/var/lib/rook/osd11 --osd-uuid=9d8747e1-aa24-4fdd-b28d-5fb27b60b728 --monmap=/var/lib/rook/osd11/tmp/activate.monmap --osd-journal=/var/lib/rook/osd11/journal --keyring=/var/lib/rook/osd11/keyring]\r\n2017-02-23 19:15:39.408687 I | exec: Running command: /usr/bin/rookd tool --type=osd -- --mkfs --mkkey --id=11 --cluster=rookcluster --conf=/var/lib/rook/osd11/rookcluster.config --osd-data=/var/lib/rook/osd11 --osd-uuid=9d8747e1-aa24-4fdd-b28d-5fb27b60b728 --monmap=/var/lib/rook/osd11/tmp/activate.monmap --osd-journal=/var/lib/rook/osd11/journal --keyring=/var/lib/rook/osd11/keyring\r\n2017-02-23 19:15:39.497331 I | mkfs-osd11: 2017-02-23 19:15:39.497177 ca5e240  0 ceph version 11.0.2-8651-gb7551f1 (b7551f136a37e895a4eb7c185a03c58aa260b2a9), process rookd, pid 81\r\n2017-02-23 19:15:39.504904 I | mkfs-osd11: 2017-02-23 19:15:39.504769 ca5e240  0 filestore(/var/lib/rook/osd11) backend generic (magic 0x1021994)\r\n2017-02-23 19:15:39.510044 I | mkfs-osd11: 2017-02-23 19:15:39.509894 ca5e240 -1 filestore(/var/lib/rook/osd11) mkjournal error creating journal on /var/lib/rook/osd11/journal: (22) Invalid argument\r\n2017-02-23 19:15:39.510069 I | mkfs-osd11: 2017-02-23 19:15:39.509928 ca5e240 -1 OSD::mkfs: ObjectStore::mkfs failed with error -22\r\n2017-02-23 19:15:39.510087 I | mkfs-osd11: 2017-02-23 19:15:39.510018 ca5e240 -1  ** ERROR: error creating empty object store in /var/lib/rook/osd11: (22) Invalid argument\r\n2017-02-23 19:15:39.512853 I | mkfs-osd11: 2017-02-23 19:15:39.509894 ca5e240 -1 filestore(/var/lib/rook/osd11) mkjournal error creating journal on /var/lib/rook/osd11/journal: (22) Invalid argument\r\n2017-02-23 19:15:39.512871 I | mkfs-osd11: 2017-02-23 19:15:39.509928 ca5e240 -1 OSD::mkfs: ObjectStore::mkfs failed with error -22\r\n2017-02-23 19:15:39.512880 I | mkfs-osd11: 2017-02-23 19:15:39.510018 ca5e240 -1  ** ERROR: error creating empty object store in /var/lib/rook/osd11: (22) Invalid argument\r\n2017-02-23 19:15:39.512987 E | cephosd: failed to config osd in path /var/lib/rook. failed to initialize OSD at /var/lib/rook/osd11: failed osd mkfs for OSD ID 11, UUID 9d8747e1-aa24-4fdd-b28d-5fb27b60b728, dataDir /var/lib/rook/osd11: failed to run osd: Failed to complete mkfs-osd11: exit status 1\r\n2017-02-23 19:15:39.513016 I | cephosd: 0/1 osds (filestore) succeeded on this node\r\nError: failed to configure dirs map[/var/lib/rook:11]. failed to initialize OSD at /var/lib/rook/osd11: failed osd mkfs for OSD ID 11, UUID 9d8747e1-aa24-4fdd-b28d-5fb27b60b728, dataDir /var/lib/rook/osd11: failed to run osd: Failed to complete mkfs-osd11: exit status 1\r\n```\r\n\r\nTo debug I made the OSD pods sleep so I could log in and run the failing command:\r\n```\r\n/bin/sh -c \"/usr/bin/rookd tool --type=osd -- --mkfs --mkkey --id=11 --cluster=rookcluster --conf=/var/lib/rook/osd11/rookcluster.config --osd-data=/var/lib/rook/osd11 --osd-uuid=9d8747e1-aa24-4fdd-b28d-5fb27b60b728 --monmap=/var/lib/rook/osd11/tmp/activate.monmap --osd-journal=/var/lib/rook/osd11/journal --keyring=/var/lib/rook/osd11/keyring\"\r\n```\r\noutput:\r\n```\r\n2017-02-23 19:18:02.169597 c102240  0 ceph version 11.0.2-8651-gb7551f1 (b7551f136a37e895a4eb7c185a03c58aa260b2a9), process rookd, pid 133\r\n2017-02-23 19:18:02.176887 c102240  0 filestore(/var/lib/rook/osd11) backend generic (magic 0x1021994)\r\n2017-02-23 19:18:02.182293 c102240 -1 journal FileJournal::_open: disabling aio for non-block journal.  Use journal_force_aio to force use of aio anyway\r\n2017-02-23 19:18:02.182293 c102240 -1 journal FileJournal::_open: disabling aio for non-block journal.  Use journal_force_aio to force use of aio anyway\r\n2017-02-23 19:18:02.182313 c102240 -1 journal check: ondisk fsid 00000000-0000-0000-0000-000000000000 doesn't match expected 9d8747e1-aa24-4fdd-b28d-5fb27b60b728, invalid (someone else's?)journal\r\n2017-02-23 19:18:02.182313 c102240 -1 journal check: ondisk fsid 00000000-0000-0000-0000-000000000000 doesn't match expected 9d8747e1-aa24-4fdd-b28d-5fb27b60b728, invalid (someone else's?)journal\r\n2017-02-23 19:18:02.182327 c102240 -1 filestore(/var/lib/rook/osd11) mkjournal error creating journal on /var/lib/rook/osd11/journal: (22) Invalid argument\r\n2017-02-23 19:18:02.182327 c102240 -1 filestore(/var/lib/rook/osd11) mkjournal error creating journal on /var/lib/rook/osd11/journal: (22) Invalid argument\r\n2017-02-23 19:18:02.182357 c102240 -1 OSD::mkfs: ObjectStore::mkfs failed with error -22\r\n2017-02-23 19:18:02.182357 c102240 -1 OSD::mkfs: ObjectStore::mkfs failed with error -22\r\n2017-02-23 19:18:02.182441 c102240 -1  ** ERROR: error creating empty object store in /var/lib/rook/osd11: (22) Invalid argument\r\n2017-02-23 19:18:02.182441 c102240 -1  ** ERROR: error creating empty object store in /var/lib/rook/osd11: (22) Invalid argument\r\n```",
  "closed_at": "2017-02-25T20:37:59Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 14,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/427/comments",
  "created_at": "2017-02-23T19:40:47Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/427/events",
  "html_url": "https://github.com/rook/rook/issues/427",
  "id": 209862705,
  "labels": [],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/427/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMDk4NjI3MDU=",
  "number": 427,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "[rook-operator] ObjectStore::mkfs failed with error -22",
  "updated_at": "2017-06-27T14:14:37Z",
  "url": "https://api.github.com/repos/rook/rook/issues/427",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/2439036?v=4",
    "events_url": "https://api.github.com/users/bzub/events{/privacy}",
    "followers_url": "https://api.github.com/users/bzub/followers",
    "following_url": "https://api.github.com/users/bzub/following{/other_user}",
    "gists_url": "https://api.github.com/users/bzub/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bzub",
    "id": 2439036,
    "login": "bzub",
    "node_id": "MDQ6VXNlcjI0MzkwMzY=",
    "organizations_url": "https://api.github.com/users/bzub/orgs",
    "received_events_url": "https://api.github.com/users/bzub/received_events",
    "repos_url": "https://api.github.com/users/bzub/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bzub/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bzub/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bzub"
  }
}