{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/10368581?v=4",
    "events_url": "https://api.github.com/users/umangachapagain/events{/privacy}",
    "followers_url": "https://api.github.com/users/umangachapagain/followers",
    "following_url": "https://api.github.com/users/umangachapagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/umangachapagain/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/umangachapagain",
    "id": 10368581,
    "login": "umangachapagain",
    "node_id": "MDQ6VXNlcjEwMzY4NTgx",
    "organizations_url": "https://api.github.com/users/umangachapagain/orgs",
    "received_events_url": "https://api.github.com/users/umangachapagain/received_events",
    "repos_url": "https://api.github.com/users/umangachapagain/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/umangachapagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umangachapagain/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/umangachapagain"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/10368581?v=4",
      "events_url": "https://api.github.com/users/umangachapagain/events{/privacy}",
      "followers_url": "https://api.github.com/users/umangachapagain/followers",
      "following_url": "https://api.github.com/users/umangachapagain/following{/other_user}",
      "gists_url": "https://api.github.com/users/umangachapagain/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/umangachapagain",
      "id": 10368581,
      "login": "umangachapagain",
      "node_id": "MDQ6VXNlcjEwMzY4NTgx",
      "organizations_url": "https://api.github.com/users/umangachapagain/orgs",
      "received_events_url": "https://api.github.com/users/umangachapagain/received_events",
      "repos_url": "https://api.github.com/users/umangachapagain/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/umangachapagain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/umangachapagain/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/umangachapagain"
    }
  ],
  "author_association": "CONTRIBUTOR",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\n\r\n```console\r\n$ kubectl -n rook-ceph get pod -l app=rook-ceph-mds -o wide\r\nNAME                                               READY   STATUS    RESTARTS   AGE   IP            NODE                               NOMINATED NODE\r\nrook-ceph-mds-ceph-filesystem-a-7866d4cd68-mnlxz   1/1     Running   0          6m    10.244.8.22   0b5642a6cc18493d81a606483d9cbb7b   <none>\r\nrook-ceph-mds-ceph-filesystem-b-56cf9d9986-fzn5p   1/1     Running   0          8m    10.244.8.21   0b5642a6cc18493d81a606483d9cbb7b   <none>\r\n```\r\n\r\nBoth mds instances were scheduled on the same host.  This seems bad for something that exists to be a failover pair (aiui).\r\n\r\nSure enough, the k8s config for these pods has `affinity: {}`.\r\n\r\n**Expected behavior:**\r\n\r\nI think there should be a AZ/host pod anti-affinity rule configured.  Something like:\r\n\r\n```yaml\r\naffinity:\r\n  podAntiAffinity:\r\n    requiredDuringSchedulingIgnoredDuringExecution:\r\n    - labelSelector:\r\n        app: rook-ceph-mds\r\n      topologyKey: kubernetes.io/hostname\r\n```\r\n\r\nAlternatively, we could use a weaker `preferredDuringSchedulingIgnoredDuringExecution` with multiple AZ/host terms.\r\n\r\n**How to reproduce it (minimal and precise):**\r\n\r\nStraightforward `CephFilesystem` with\r\n```yaml\r\n  spec:\r\n    dataPools:\r\n    - replicated:\r\n        size: 2\r\n    metadataPool:\r\n      crushRoot: \"\"\r\n      erasureCoded:\r\n        algorithm: \"\"\r\n        codingChunks: 0\r\n        dataChunks: 0\r\n      failureDomain: \"\"\r\n      replicated:\r\n        size: 3\r\n    metadataServer:\r\n      activeCount: 1\r\n      activeStandby: true\r\n      placement: {}\r\n      resources: {}\r\n```\r\n\r\nI imagine I can configure this myself with `metadataServer.placement` (I will try that next).  I suggest anti-affinity should be the default.\r\n\r\n**Environment**:\r\n\r\noperator = rook/ceph:v1.0.2\r\ncephVersion.image = ceph/ceph:v13.2.5-20190410\r\n",
  "closed_at": "2019-08-22T13:42:38Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/3332/comments",
  "created_at": "2019-06-21T05:23:58Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/3332/events",
  "html_url": "https://github.com/rook/rook/issues/3332",
  "id": 459014088,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/3332/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0NTkwMTQwODg=",
  "number": 3332,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "mds active/standby lack anti-affinity",
  "updated_at": "2019-09-06T07:40:37Z",
  "url": "https://api.github.com/repos/rook/rook/issues/3332",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/224224?v=4",
    "events_url": "https://api.github.com/users/anguslees/events{/privacy}",
    "followers_url": "https://api.github.com/users/anguslees/followers",
    "following_url": "https://api.github.com/users/anguslees/following{/other_user}",
    "gists_url": "https://api.github.com/users/anguslees/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/anguslees",
    "id": 224224,
    "login": "anguslees",
    "node_id": "MDQ6VXNlcjIyNDIyNA==",
    "organizations_url": "https://api.github.com/users/anguslees/orgs",
    "received_events_url": "https://api.github.com/users/anguslees/received_events",
    "repos_url": "https://api.github.com/users/anguslees/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/anguslees/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/anguslees/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/anguslees"
  }
}