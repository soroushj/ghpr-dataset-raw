{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "<!-- **Are you in the right place?**\r\n1. For issues or feature requests, please create an issue in this repository.\r\n2. For general technical and non-technical questions, we are happy to help you on our [Rook.io Slack](https://slack.rook.io/).\r\n3. Did you already search the existing open issues for anything similar? -->\r\n\r\n**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\nThe CRUSH hierarchy changes unexpectedly for portable OSDs on PVCs during either a Rook upgrade or an operator restart.\r\n\r\nHierarchy after cluster creation (expected):\r\n```\r\nsh-4.2$ ceph osd tree\r\nID  CLASS WEIGHT  TYPE NAME                          STATUS REWEIGHT PRI-AFF \r\n -1       0.02637 root default                                               \r\n -5       0.02637     region us-east-1                                       \r\n-10       0.00879         zone us-east-1a                                    \r\n -9       0.00879             host set1-1-data-vtj8w                         \r\n  1   ssd 0.00879                 osd.1                  up  1.00000 1.00000 \r\n -4       0.01758         zone us-east-1b                                    \r\n -3       0.00879             host set1-0-data-x6svc                         \r\n  0   ssd 0.00879                 osd.0                  up  1.00000 1.00000 \r\n-13       0.00879             host set1-2-data-zqt8x                         \r\n  2   ssd 0.00879                 osd.2                  up  1.00000 1.00000 \r\n```\r\n\r\nHierarchy after operator restart or upgrade (not expected):\r\n```\r\nsh-4.2$ ceph osd tree\r\nID  CLASS WEIGHT  TYPE NAME                                 STATUS REWEIGHT PRI-AFF \r\n -1       0.02637 root default                                                      \r\n-15       0.00879     host rook-ceph-osd-0-69f5cf5d55-vh62r                         \r\n  0   ssd 0.00879         osd.0                                 up  1.00000 1.00000 \r\n-17       0.00879     host rook-ceph-osd-1-86ccccdddc-ph7jj                         \r\n  1   ssd 0.00879         osd.1                                 up  1.00000 1.00000 \r\n-19       0.00879     host rook-ceph-osd-2-6c677b9cbb-vvx98                         \r\n  2   ssd 0.00879         osd.2                                 up  1.00000 1.00000 \r\n -5             0     region us-east-1                                              \r\n-10             0         zone us-east-1a                                           \r\n -9             0             host set1-1-data-vtj8w                                \r\n -4             0         zone us-east-1b                                           \r\n -3             0             host set1-0-data-x6svc                                \r\n-13             0             host set1-2-data-zqt8x          \r\n```\r\n\r\n**Expected behavior:**\r\nThe OSDs should remain in the correct place in the CRUSH map. The operator should still recognize after restart that the OSDs should be based on the PVC name in the CRUSH hierarchy.\r\n\r\n**How to reproduce it (minimal and precise):**\r\n<!-- Please let us know any circumstances for reproduction of your bug. -->\r\n- Install a 1.2-beta.1 cluster with `cluster-on-pvc.yaml` and `portable: true`\r\n- Wait for the cluster to initialize\r\n- See the expected CRUSH hierarchy\r\n- Restart the operator\r\n- The OSDs will be restarted and they will be in the wrong place in the CRUSH hierarchy\r\n",
  "closed_at": "2019-12-18T22:48:53Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/4543/comments",
  "created_at": "2019-12-18T20:20:25Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/4543/events",
  "html_url": "https://github.com/rook/rook/issues/4543",
  "id": 539903379,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    },
    {
      "color": "ef5c55",
      "default": false,
      "description": "main ceph tag",
      "id": 479456042,
      "name": "ceph",
      "node_id": "MDU6TGFiZWw0Nzk0NTYwNDI=",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph"
    },
    {
      "color": "ad0036",
      "default": false,
      "description": "",
      "id": 1232323300,
      "name": "ceph-osd",
      "node_id": "MDU6TGFiZWwxMjMyMzIzMzAw",
      "url": "https://api.github.com/repos/rook/rook/labels/ceph-osd"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/4543/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2020-09-11T22:42:52Z",
    "closed_issues": 65,
    "created_at": "2019-08-22T12:51:15Z",
    "creator": {
      "avatar_url": "https://avatars3.githubusercontent.com/u/912735?v=4",
      "events_url": "https://api.github.com/users/leseb/events{/privacy}",
      "followers_url": "https://api.github.com/users/leseb/followers",
      "following_url": "https://api.github.com/users/leseb/following{/other_user}",
      "gists_url": "https://api.github.com/users/leseb/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/leseb",
      "id": 912735,
      "login": "leseb",
      "node_id": "MDQ6VXNlcjkxMjczNQ==",
      "organizations_url": "https://api.github.com/users/leseb/orgs",
      "received_events_url": "https://api.github.com/users/leseb/received_events",
      "repos_url": "https://api.github.com/users/leseb/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/leseb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leseb/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/leseb"
    },
    "description": "",
    "due_on": null,
    "html_url": "https://github.com/rook/rook/milestone/13",
    "id": 4594913,
    "labels_url": "https://api.github.com/repos/rook/rook/milestones/13/labels",
    "node_id": "MDk6TWlsZXN0b25lNDU5NDkxMw==",
    "number": 13,
    "open_issues": 0,
    "state": "closed",
    "title": "1.2",
    "updated_at": "2020-09-18T21:21:55Z",
    "url": "https://api.github.com/repos/rook/rook/milestones/13"
  },
  "node_id": "MDU6SXNzdWU1Mzk5MDMzNzk=",
  "number": 4543,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "OSDs on PVCs are moved to wrong place in CRUSH map after upgrade or operator restart",
  "updated_at": "2019-12-18T22:48:53Z",
  "url": "https://api.github.com/repos/rook/rook/issues/4543",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  }
}