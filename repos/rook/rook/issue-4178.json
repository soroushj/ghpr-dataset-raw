{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behaviour:**\r\n\r\nWe experimented with the CephCSI drivers back in Rook v1.0 so our cluster had some old CRDs. Specifically: \r\n* volumesnapshotclasses.snapshot.storage.k8s.io\r\n* volumesnapshotcontents.snapshot.storage.k8s.io\r\n* volumesnapshots.snapshot.storage.k8s.io\r\n\r\nUpon running through an upgrade to Rook v1.1 and switching to using the CephCSI drivers for RBD, those CRDs don't get updated. Trying to take a volume snapshot produces this error in the csi-snapshotter logs: \r\n\r\n`E1015 20:47:13.057258       1 goroutinemap.go:150] Operation for \"create-wordpress/mysql-csi-pvc[b1bc1c9d-ef8c-11e9-bdcd-901b0e6be2b4]\" failed. No retries permitted until 2019-10-15 20:47:15.057225226 +0000 UTC m=+3214.959239580 (durationBeforeRetry 2s). Error: \"snapshot controller failed to update wordpress/mysql-csi-pvc on API server: the server could not find the requested resource (put volumesnapshots.snapshot.storage.k8s.io mysql-csi-pvc)\"`\r\n\r\nDescribing the VolumeSnapshot also show that the Ready To Use is false. \r\n\r\n**Expected behaviour:**\r\n\r\nThe Volumesnapshot should be created successfully without errors in the logs and the \"Ready To Use\" status should be set to true. \r\n\r\nThe root cause was determined to be the old CRDs, as discussed here: https://github.com/kubernetes-csi/external-snapshotter/issues/147#issuecomment-513664310\r\n\r\nUpon deleting the old CRDs and restarting the `csi-rbd-provisioner-0` pod, those CRDs were recreated with the new versions and the snapshots were successful. \r\n\r\n**How to reproduce it (minimal and precise):**\r\n\r\nThis issue was only reproducible due to the fact that we tested CephCSI functionality in v1.0. I reviewed the upgrade docs again and the upgrade-from-v1.0-crds.yaml but there's no mention of deleting the CRDs. ",
  "closed_at": "2020-01-23T04:26:22Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/18114231?v=4",
    "events_url": "https://api.github.com/users/Madhu-1/events{/privacy}",
    "followers_url": "https://api.github.com/users/Madhu-1/followers",
    "following_url": "https://api.github.com/users/Madhu-1/following{/other_user}",
    "gists_url": "https://api.github.com/users/Madhu-1/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/Madhu-1",
    "id": 18114231,
    "login": "Madhu-1",
    "node_id": "MDQ6VXNlcjE4MTE0MjMx",
    "organizations_url": "https://api.github.com/users/Madhu-1/orgs",
    "received_events_url": "https://api.github.com/users/Madhu-1/received_events",
    "repos_url": "https://api.github.com/users/Madhu-1/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/Madhu-1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Madhu-1/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/Madhu-1"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/4178/comments",
  "created_at": "2019-10-24T19:50:14Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/4178/events",
  "html_url": "https://github.com/rook/rook/issues/4178",
  "id": 512146714,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/4178/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1MTIxNDY3MTQ=",
  "number": 4178,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "VolumeSnapshots never go into Ready-To-Use state if using old CRDs",
  "updated_at": "2020-01-23T04:26:23Z",
  "url": "https://api.github.com/repos/rook/rook/issues/4178",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/7551089?v=4",
    "events_url": "https://api.github.com/users/mohahmed13/events{/privacy}",
    "followers_url": "https://api.github.com/users/mohahmed13/followers",
    "following_url": "https://api.github.com/users/mohahmed13/following{/other_user}",
    "gists_url": "https://api.github.com/users/mohahmed13/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/mohahmed13",
    "id": 7551089,
    "login": "mohahmed13",
    "node_id": "MDQ6VXNlcjc1NTEwODk=",
    "organizations_url": "https://api.github.com/users/mohahmed13/orgs",
    "received_events_url": "https://api.github.com/users/mohahmed13/received_events",
    "repos_url": "https://api.github.com/users/mohahmed13/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/mohahmed13/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mohahmed13/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/mohahmed13"
  }
}