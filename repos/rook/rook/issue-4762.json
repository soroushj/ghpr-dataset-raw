{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/5376585?v=4",
    "events_url": "https://api.github.com/users/egafford/events{/privacy}",
    "followers_url": "https://api.github.com/users/egafford/followers",
    "following_url": "https://api.github.com/users/egafford/following{/other_user}",
    "gists_url": "https://api.github.com/users/egafford/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/egafford",
    "id": 5376585,
    "login": "egafford",
    "node_id": "MDQ6VXNlcjUzNzY1ODU=",
    "organizations_url": "https://api.github.com/users/egafford/orgs",
    "received_events_url": "https://api.github.com/users/egafford/received_events",
    "repos_url": "https://api.github.com/users/egafford/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/egafford/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/egafford/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/egafford"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars2.githubusercontent.com/u/5376585?v=4",
      "events_url": "https://api.github.com/users/egafford/events{/privacy}",
      "followers_url": "https://api.github.com/users/egafford/followers",
      "following_url": "https://api.github.com/users/egafford/following{/other_user}",
      "gists_url": "https://api.github.com/users/egafford/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/egafford",
      "id": 5376585,
      "login": "egafford",
      "node_id": "MDQ6VXNlcjUzNzY1ODU=",
      "organizations_url": "https://api.github.com/users/egafford/orgs",
      "received_events_url": "https://api.github.com/users/egafford/received_events",
      "repos_url": "https://api.github.com/users/egafford/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/egafford/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/egafford/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/egafford"
    }
  ],
  "author_association": "MEMBER",
  "body": "<!-- **Are you in the right place?**\r\n1. For issues or feature requests, please create an issue in this repository.\r\n2. For general technical and non-technical questions, we are happy to help you on our [Rook.io Slack](https://slack.rook.io/).\r\n3. Did you already search the existing open issues for anything similar? -->\r\n\r\n**Is this a bug report or feature request?**\r\n* Bug Report\r\nI have build a custom image to test upgrade from 1.1.9 to 1.2.3(which is next rook release) the operator pod is crashing due to ceph version check failure in recomcile\r\n\r\n**Deviation from expected behavior:**\r\n\r\n**Expected behavior:**\r\nUpgrade should be successful\r\n\r\n**How to reproduce it (minimal and precise):**\r\n<!-- Please let us know any circumstances for reproduction of your bug. -->\r\n* Deploy rook using v1.1.9 branch\r\n* Create a custom image from release-v1.2 branch and upgrade rook\r\n**File(s) to submit**:\r\n\r\n* Cluster CR (custom resource), typically called `cluster.yaml`, if necessary\r\n* Operator's logs, if necessary\r\n* Crashing pod(s) logs, if necessary\r\n\r\n To get logs, use `kubectl -n <namespace> logs <pod name>`\r\nWhen pasting logs, always surround them with backticks or use the `insert code` button from the Github UI.\r\nRead [Github documentation if you need help](https://help.github.com/en/articles/creating-and-highlighting-code-blocks).\r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release):\r\n* Kernel (e.g. `uname -a`):\r\n* Cloud provider or hardware configuration:\r\n* Rook version (use `rook version` inside of a Rook Pod): 1.1.9\r\n* Storage backend version (e.g. for ceph do `ceph -v`):\r\n* Kubernetes version (use `kubectl version`): 1.17.1\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift):\r\n* Storage backend status (e.g. for Ceph use `ceph health` in the [Rook Ceph toolbox](https://rook.io/docs/rook/master/ceph-toolbox.html)):\r\n\r\n\r\noperator logs:\r\n```\r\n020-01-29 06:17:44.985016 I | operator: Watching all namespaces for cluster CRDs\r\n2020-01-29 06:17:44.985029 I | op-cluster: start watching clusters in all namespaces\r\n2020-01-29 06:17:44.985070 I | op-cluster: Enabling hotplug orchestration: ROOK_DISABLE_DEVICE_HOTPLUG=false\r\nI0129 06:17:44.985864       8 leaderelection.go:217] attempting to acquire leader lease  rook-ceph/rook.io-block...\r\n2020-01-29 06:17:44.986455 I | operator: setting up the controller-runtime manager\r\n2020-01-29 06:17:45.023114 I | op-cluster: starting cluster in namespace rook-ceph\r\n2020-01-29 06:17:45.503978 I | operator: starting the controller-runtime manager\r\nE0129 06:17:45.726018       8 runtime.go:69] Observed a panic: \"invalid memory address or nil pointer dereference\" (runtime error: invalid memory address or nil pointer dereference)\r\n/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:76\r\n/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:65\r\n/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:51\r\n/usr/local/go/src/runtime/panic.go:522\r\n/usr/local/go/src/runtime/panic.go:82\r\n/usr/local/go/src/runtime/signal_unix.go:390\r\n/home/mrajanna/workspace/src/github.com/rook/rook/pkg/operator/ceph/cluster/crash/reconcile.go:211\r\n/home/mrajanna/workspace/src/github.com/rook/rook/pkg/operator/ceph/cluster/crash/reconcile.go:157\r\n/home/mrajanna/workspace/src/github.com/rook/rook/pkg/operator/ceph/cluster/crash/reconcile.go:74\r\n/home/mrajanna/workspace/src/github.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller/controller.go:216\r\n/home/mrajanna/workspace/src/github.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller/controller.go:192\r\n/home/mrajanna/workspace/src/github.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller/controller.go:171\r\n/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:152\r\n/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:153\r\n/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:88\r\n/usr/local/go/src/runtime/asm_amd64.s:1337\r\npanic: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n\tpanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x165a342]\r\ngoroutine 472 [running]:\r\ngithub.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/runtime.HandleCrash(0x0, 0x0, 0x0)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:58 +0x105\r\npanic(0x1bd05e0, 0x35ca600)\r\n\t/usr/local/go/src/runtime/panic.go:522 +0x1b5\r\ngithub.com/rook/rook/pkg/operator/ceph/cluster/crash.getImageVersion(0x19eb1ab, 0xb, 0xc000cdda71, 0xf, 0xc000808840, 0x9, 0x0, 0x0, 0xc000808860, 0x9, ...)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/pkg/operator/ceph/cluster/crash/reconcile.go:211 +0x82\r\ngithub.com/rook/rook/pkg/operator/ceph/cluster/crash.(*ReconcileNode).reconcile(0xc000b01760, 0x0, 0x0, 0xc000a4bb48, 0x6, 0xc00079fcb0, 0x60ec4cf5e0, 0xc02b2f674e, 0x2b2f674e00414237)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/pkg/operator/ceph/cluster/crash/reconcile.go:157 +0x704\r\ngithub.com/rook/rook/pkg/operator/ceph/cluster/crash.(*ReconcileNode).Reconcile(0xc000b01760, 0x0, 0x0, 0xc000a4bb48, 0x6, 0x35ed680, 0xc000a90900, 0xc00079fd88, 0xc00079fdb8)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/pkg/operator/ceph/cluster/crash/reconcile.go:74 +0x69\r\ngithub.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).reconcileHandler(0xc0003ac1e0, 0x1c692c0, 0xc0008eadc0, 0x1c69200)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller/controller.go:216 +0x146\r\ngithub.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).processNextWorkItem(0xc0003ac1e0, 0xc0000ff200)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller/controller.go:192 +0xb5\r\ngithub.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).worker(0xc0003ac1e0)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller/controller.go:171 +0x2b\r\ngithub.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil.func1(0xc000469390)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:152 +0x54\r\ngithub.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil(0xc000469390, 0x3b9aca00, 0x0, 0x1, 0xc0009d2f60)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:153 +0xf8\r\ngithub.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/wait.Until(0xc000469390, 0x3b9aca00, 0xc0009d2f60)\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:88 +0x4d\r\ncreated by github.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).Start\r\n\t/home/mrajanna/workspace/src/github.com/rook/rook/vendor/sigs.k8s.io/controller-runtime/pkg/internal/controller/controller.go:157 +0x311\r\n```\r\n\r\nceph cluster crd\r\n\r\n```\r\nkuberc get cephcluster -o yaml\r\napiVersion: v1\r\nitems:\r\n- apiVersion: ceph.rook.io/v1\r\n  kind: CephCluster\r\n  metadata:\r\n    creationTimestamp: \"2020-01-29T05:42:03Z\"\r\n    finalizers:\r\n    - cephcluster.ceph.rook.io\r\n    generation: 6\r\n    name: rook-ceph\r\n    namespace: rook-ceph\r\n    resourceVersion: \"4208\"\r\n    selfLink: /apis/ceph.rook.io/v1/namespaces/rook-ceph/cephclusters/rook-ceph\r\n    uid: 42f847bb-f048-4e9b-88a7-009668ce85ff\r\n  spec:\r\n    cephVersion:\r\n      allowUnsupported: true\r\n      image: ceph/ceph:v14.2.4-20190917\r\n    dashboard:\r\n      enabled: true\r\n      ssl: true\r\n    dataDirHostPath: /var/lib/rook\r\n    disruptionManagement: {}\r\n    external:\r\n      enable: false\r\n    mgr:\r\n      modules:\r\n      - enabled: true\r\n        name: pg_autoscaler\r\n    mon:\r\n      allowMultiplePerNode: true\r\n      count: 1\r\n    monitoring:\r\n      rulesNamespace: rook-ceph\r\n    network:\r\n      hostNetwork: false\r\n      provider: \"\"\r\n      selectors: null\r\n    rbdMirroring:\r\n      workers: 0\r\n    removeOSDsIfOutAndSafeToRemove: false\r\n    storage:\r\n      config:\r\n        databaseSizeMB: \"1024\"\r\n        journalSizeMB: \"1024\"\r\n        osdsPerDevice: \"1\"\r\n      directories:\r\n      - config: null\r\n        path: /var/lib/rook\r\n      storageClassDeviceSets: null\r\n      useAllDevices: false\r\n      useAllNodes: true\r\n  status:\r\n    ceph:\r\n      health: HEALTH_OK\r\n      lastChecked: \"2020-01-29T06:16:04Z\"\r\n    state: Created\r\nkind: List\r\nmetadata:\r\n  resourceVersion: \"\"\r\n  selfLink: \"\"\r\n```",
  "closed_at": "2020-01-29T18:59:54Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/4762/comments",
  "created_at": "2020-01-29T06:27:02Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/4762/events",
  "html_url": "https://github.com/rook/rook/issues/4762",
  "id": 556664431,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/4762/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1NTY2NjQ0MzE=",
  "number": 4762,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "Failed to upgrade rook cluster from 1.1.9 to custom version(1.2.3)",
  "updated_at": "2020-01-29T18:59:54Z",
  "url": "https://api.github.com/repos/rook/rook/issues/4762",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/18114231?v=4",
    "events_url": "https://api.github.com/users/Madhu-1/events{/privacy}",
    "followers_url": "https://api.github.com/users/Madhu-1/followers",
    "following_url": "https://api.github.com/users/Madhu-1/following{/other_user}",
    "gists_url": "https://api.github.com/users/Madhu-1/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/Madhu-1",
    "id": 18114231,
    "login": "Madhu-1",
    "node_id": "MDQ6VXNlcjE4MTE0MjMx",
    "organizations_url": "https://api.github.com/users/Madhu-1/orgs",
    "received_events_url": "https://api.github.com/users/Madhu-1/received_events",
    "repos_url": "https://api.github.com/users/Madhu-1/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/Madhu-1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Madhu-1/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/Madhu-1"
  }
}