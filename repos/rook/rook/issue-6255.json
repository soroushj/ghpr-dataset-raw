{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**Is this a bug report or feature request?**\r\n* Bug Report\r\n\r\n**Deviation from expected behavior:**\r\n\r\nOn a fresh helm-based deployment of v1.4.3, ceph-operator pod logs the following:\r\n\r\n```\r\n2020-09-15 03:30:36.303110 E | op-mgr: failed to enable service monitor. service monitor could not be enabled: failed to retrieve servicemonitor. servicemonitors.monitoring.coreos.com \"rook-ceph-mgr\" is forbidden: User \"system:serviceaccount:rook-ceph:rook-ceph-system\" cannot get resource \"servicemonitors\" in API group \"monitoring.coreos.com\" in the namespace \"rook-ceph\": RBAC: clusterrole.rbac.authorization.k8s.io \"rook-ceph-system-psp-user\" not found\r\nW0915 03:30:36.314350       7 client_config.go:543] Neither --kubeconfig nor --master was specified.  Using the inClusterConfig.  This might not work.\r\n2020-09-15 03:30:36.317293 E | op-mgr: failed to deploy prometheus rule. prometheus rule could not be deployed: failed to create prometheusRules. prometheusrules.monitoring.coreos.com is forbidden: User \"system:serviceaccount:rook-ceph:rook-ceph-system\" cannot create resource \"prometheusrules\" in API group \"monitoring.coreos.com\" in the namespace \"rook-ceph\": RBAC: clusterrole.rbac.authorization.k8s.io \"rook-ceph-system-psp-user\" not found\r\n```\r\n\r\nServiceMonitors are evidently not created\r\n\r\n**Expected behavior:**\r\n\r\nServiceMonitors are created, error logs are not produced by the operator\r\n\r\n**How to reproduce it (minimal and precise):**\r\n\r\n1. Deploy the operator using helm chart v1.4.3\r\n\r\n**File(s) to submit**:\r\n\r\nCR:\r\n\r\n```\r\nroot@cn1:~# kubectl get cephclusters.ceph.rook.io -n rook-ceph rook-ceph -o yaml\r\napiVersion: ceph.rook.io/v1\r\nkind: CephCluster\r\nmetadata:\r\n  annotations:\r\n    kubectl.kubernetes.io/last-applied-configuration: |\r\n      {\"apiVersion\":\"ceph.rook.io/v1\",\"kind\":\"CephCluster\",\"metadata\":{\"annotations\":{},\"name\":\"rook-ceph\",\"namespace\":\"rook-ceph\"},\"spec\":{\"cephVersion\":{\"image\":\"registry-internal.elpenguino.net/library/ceph:v15.2.4-20200819\"},\"dashboard\":{\"enabled\":true},\"dataDirHostPath\":\"/var/lib/rook\",\"mon\":{\"allowMultiplePerNode\":false,\"count\":3},\"monitoring\":{\"enabled\":true,\"rulesNamespace\":\"rook-ceph\"},\"network\":{\"hostNetwork\":true},\"storage\":{\"config\":{\"databaseSizeMB\":\"1024\",\"journalSizeMB\":\"1024\"},\"deviceFilter\":\"^sdb$\",\"nodes\":[{\"devices\":[{\"name\":\"disk/by-path/pci-0000:00:1f.2-ata-3.0\"}],\"name\":\"wn1\"},{\"devices\":[{\"name\":\"disk/by-path/pci-0000:00:1f.2-ata-3.0\"}],\"name\":\"wn2\"},{\"devices\":[{\"name\":\"disk/by-path/pci-0000:00:1f.2-ata-3.0\"}],\"name\":\"wn3\"},{\"devices\":[{\"name\":\"disk/by-path/pci-0000:00:1f.2-ata-3.0\"}],\"name\":\"wn4\"}],\"resources\":{\"mgr\":{\"limits\":{\"cpu\":\"2000m\",\"memory\":\"1Gi\"},\"modules\":[{\"enabled\":true,\"name\":\"pg_autoscaler\"}],\"requests\":{\"cpu\":\"2000m\",\"memory\":\"1Gi\"}},\"mon\":{\"limits\":{\"cpu\":\"2000m\",\"memory\":\"1Gi\"},\"requests\":{\"cpu\":\"2000m\",\"memory\":\"1Gi\"}},\"osd\":{\"requests\":{\"cpu\":\"2000m\",\"memory\":\"4Gi\"}}},\"useAllDevices\":false,\"useAllNodes\":true}}}\r\n  creationTimestamp: \"2020-09-15T03:11:34Z\"\r\n  finalizers:\r\n  - cephcluster.ceph.rook.io\r\n  generation: 2\r\n  managedFields:\r\n  - apiVersion: ceph.rook.io/v1\r\n    fieldsType: FieldsV1\r\n    fieldsV1:\r\n      f:metadata:\r\n        f:annotations:\r\n          .: {}\r\n          f:kubectl.kubernetes.io/last-applied-configuration: {}\r\n      f:spec:\r\n        .: {}\r\n        f:cephVersion:\r\n          .: {}\r\n          f:image: {}\r\n        f:dashboard:\r\n          .: {}\r\n          f:enabled: {}\r\n        f:dataDirHostPath: {}\r\n        f:mon:\r\n          .: {}\r\n          f:count: {}\r\n        f:monitoring:\r\n          .: {}\r\n          f:enabled: {}\r\n          f:rulesNamespace: {}\r\n        f:network:\r\n          .: {}\r\n          f:hostNetwork: {}\r\n        f:storage:\r\n          .: {}\r\n          f:config:\r\n            .: {}\r\n            f:databaseSizeMB: {}\r\n            f:journalSizeMB: {}\r\n          f:deviceFilter: {}\r\n          f:useAllDevices: {}\r\n          f:useAllNodes: {}\r\n    manager: kubectl\r\n    operation: Update\r\n    time: \"2020-09-15T03:11:34Z\"\r\n  - apiVersion: ceph.rook.io/v1\r\n    fieldsType: FieldsV1\r\n    fieldsV1:\r\n      f:metadata:\r\n        f:finalizers:\r\n          .: {}\r\n          v:\"cephcluster.ceph.rook.io\": {}\r\n      f:spec:\r\n        f:cleanupPolicy:\r\n          .: {}\r\n          f:sanitizeDisks: {}\r\n        f:crashCollector:\r\n          .: {}\r\n          f:disable: {}\r\n        f:disruptionManagement: {}\r\n        f:external:\r\n          .: {}\r\n          f:enable: {}\r\n        f:healthCheck:\r\n          .: {}\r\n          f:daemonHealth:\r\n            .: {}\r\n            f:mon: {}\r\n            f:osd: {}\r\n            f:status: {}\r\n        f:mgr: {}\r\n        f:network:\r\n          f:provider: {}\r\n          f:selectors: {}\r\n        f:removeOSDsIfOutAndSafeToRemove: {}\r\n        f:storage:\r\n          f:nodes: {}\r\n          f:storageClassDeviceSets: {}\r\n      f:status:\r\n        .: {}\r\n        f:ceph:\r\n          .: {}\r\n          f:health: {}\r\n          f:lastChanged: {}\r\n          f:lastChecked: {}\r\n          f:previousHealth: {}\r\n        f:conditions: {}\r\n        f:message: {}\r\n        f:phase: {}\r\n        f:state: {}\r\n        f:storage:\r\n          .: {}\r\n          f:deviceClasses: {}\r\n        f:version:\r\n          .: {}\r\n          f:image: {}\r\n          f:version: {}\r\n    manager: rook\r\n    operation: Update\r\n    time: \"2020-09-15T03:54:45Z\"\r\n  name: rook-ceph\r\n  namespace: rook-ceph\r\n  resourceVersion: \"42872\"\r\n  selfLink: /apis/ceph.rook.io/v1/namespaces/rook-ceph/cephclusters/rook-ceph\r\n  uid: 4d60e7ea-50d6-4829-9c06-690406c7fec7\r\nspec:\r\n  cephVersion:\r\n    image: registry-internal.elpenguino.net/library/ceph:v15.2.4-20200819\r\n  cleanupPolicy:\r\n    sanitizeDisks: {}\r\n  crashCollector:\r\n    disable: false\r\n  dashboard:\r\n    enabled: true\r\n  dataDirHostPath: /var/lib/rook\r\n  disruptionManagement: {}\r\n  external:\r\n    enable: false\r\n  healthCheck:\r\n    daemonHealth:\r\n      mon: {}\r\n      osd: {}\r\n      status: {}\r\n  mgr: {}\r\n  mon:\r\n    count: 3\r\n  monitoring:\r\n    enabled: true\r\n    rulesNamespace: rook-ceph\r\n  network:\r\n    hostNetwork: true\r\n    provider: \"\"\r\n    selectors: null\r\n  removeOSDsIfOutAndSafeToRemove: false\r\n  storage:\r\n    config:\r\n      databaseSizeMB: \"1024\"\r\n      journalSizeMB: \"1024\"\r\n    deviceFilter: ^sdb$\r\n    nodes:\r\n    - config: null\r\n      devices:\r\n      - config: null\r\n        name: disk/by-path/pci-0000:00:1f.2-ata-3.0\r\n      name: wn1\r\n      resources: {}\r\n    - config: null\r\n      devices:\r\n      - config: null\r\n        name: disk/by-path/pci-0000:00:1f.2-ata-3.0\r\n      name: wn2\r\n      resources: {}\r\n    - config: null\r\n      devices:\r\n      - config: null\r\n        name: disk/by-path/pci-0000:00:1f.2-ata-3.0\r\n      name: wn3\r\n      resources: {}\r\n    - config: null\r\n      devices:\r\n      - config: null\r\n        name: disk/by-path/pci-0000:00:1f.2-ata-3.0\r\n      name: wn4\r\n      resources: {}\r\n    storageClassDeviceSets: null\r\n    useAllDevices: false\r\n    useAllNodes: true\r\nstatus:\r\n  ceph:\r\n    health: HEALTH_OK\r\n    lastChanged: \"2020-09-15T03:31:15Z\"\r\n    lastChecked: \"2020-09-15T03:54:45Z\"\r\n    previousHealth: HEALTH_ERR\r\n  conditions:\r\n  - lastHeartbeatTime: \"2020-09-15T03:31:05Z\"\r\n    lastTransitionTime: \"2020-09-15T03:12:53Z\"\r\n    message: Cluster progression is completed\r\n    reason: ProgressingCompleted\r\n    status: \"False\"\r\n    type: Progressing\r\n  - lastHeartbeatTime: \"2020-09-15T03:15:54Z\"\r\n    lastTransitionTime: \"2020-09-15T03:15:54Z\"\r\n    message: Cluster created successfully\r\n    reason: ClusterCreated\r\n    status: \"True\"\r\n    type: Ready\r\n  - lastHeartbeatTime: \"2020-09-15T03:15:55Z\"\r\n    lastTransitionTime: \"2020-09-15T03:15:55Z\"\r\n    message: Cluster progression is completed\r\n    reason: ProgressingCompleted\r\n    status: \"False\"\r\n  - lastHeartbeatTime: \"2020-09-15T03:30:12Z\"\r\n    lastTransitionTime: \"2020-09-15T03:30:12Z\"\r\n    message: Failed to configure ceph cluster\r\n    reason: ClusterFailure\r\n    status: \"True\"\r\n    type: Failure\r\n  message: Cluster created successfully\r\n  phase: Ready\r\n  state: Created\r\n  storage:\r\n    deviceClasses:\r\n    - name: ssd\r\n  version:\r\n    image: registry-internal.elpenguino.net/library/ceph:v15.2.4-20200819\r\n    version: 15.2.4-0\r\n```\r\n\r\n**Environment**:\r\n* OS (e.g. from /etc/os-release): CentOS 7\r\n* Kernel (e.g. `uname -a`): 5.8.9-1.el7.elrepo.x86_64\r\n* Cloud provider or hardware configuration: bare-metal hardware\r\n* Rook version (use `rook version` inside of a Rook Pod): 1.4.3\r\n* Storage backend version (e.g. for ceph do `ceph -v`): \r\n* Kubernetes version (use `kubectl version`): 1.18\r\n* Kubernetes cluster type (e.g. Tectonic, GKE, OpenShift): bare-metal, kube-adm launched\r\n* Storage backend status (e.g. for Ceph use `ceph health` in the [Rook Ceph toolbox](https://rook.io/docs/rook/master/ceph-toolbox.html)):\r\n",
  "closed_at": "2020-10-01T17:45:55Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1048514?v=4",
    "events_url": "https://api.github.com/users/travisn/events{/privacy}",
    "followers_url": "https://api.github.com/users/travisn/followers",
    "following_url": "https://api.github.com/users/travisn/following{/other_user}",
    "gists_url": "https://api.github.com/users/travisn/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/travisn",
    "id": 1048514,
    "login": "travisn",
    "node_id": "MDQ6VXNlcjEwNDg1MTQ=",
    "organizations_url": "https://api.github.com/users/travisn/orgs",
    "received_events_url": "https://api.github.com/users/travisn/received_events",
    "repos_url": "https://api.github.com/users/travisn/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/travisn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/travisn/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/travisn"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/rook/rook/issues/6255/comments",
  "created_at": "2020-09-15T04:03:39Z",
  "events_url": "https://api.github.com/repos/rook/rook/issues/6255/events",
  "html_url": "https://github.com/rook/rook/issues/6255",
  "id": 701588910,
  "labels": [
    {
      "color": "ee0000",
      "default": true,
      "description": "",
      "id": 405241115,
      "name": "bug",
      "node_id": "MDU6TGFiZWw0MDUyNDExMTU=",
      "url": "https://api.github.com/repos/rook/rook/labels/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/rook/rook/issues/6255/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU3MDE1ODg5MTA=",
  "number": 6255,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/rook/rook",
  "state": "closed",
  "title": "clusterrole \"rook-ceph-system-psp-user\" not found in v1.4.3",
  "updated_at": "2020-10-16T15:59:17Z",
  "url": "https://api.github.com/repos/rook/rook/issues/6255",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1524686?v=4",
    "events_url": "https://api.github.com/users/funkypenguin/events{/privacy}",
    "followers_url": "https://api.github.com/users/funkypenguin/followers",
    "following_url": "https://api.github.com/users/funkypenguin/following{/other_user}",
    "gists_url": "https://api.github.com/users/funkypenguin/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/funkypenguin",
    "id": 1524686,
    "login": "funkypenguin",
    "node_id": "MDQ6VXNlcjE1MjQ2ODY=",
    "organizations_url": "https://api.github.com/users/funkypenguin/orgs",
    "received_events_url": "https://api.github.com/users/funkypenguin/received_events",
    "repos_url": "https://api.github.com/users/funkypenguin/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/funkypenguin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/funkypenguin/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/funkypenguin"
  }
}