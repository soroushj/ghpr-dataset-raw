{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**What happened**:\r\n\r\nRecently, we have seen CoreDNS pods panic with no probe failures.  The pod logs show a panic and error yet there are no liveness nor readiness probe failures.  As a result, the pod isn't working and isn't restarted thus leading to DNS failures within the cluster.\r\n\r\n**Pod liveness probe:**\r\n```\r\n    livenessProbe:\r\n      failureThreshold: 5\r\n      httpGet:\r\n        path: /health\r\n        port: 8080\r\n        scheme: HTTP\r\n      initialDelaySeconds: 60\r\n      periodSeconds: 10\r\n      successThreshold: 1\r\n      timeoutSeconds: 5\r\n```\r\n\r\n**Pod readiness probe:**\r\n```\r\n    readinessProbe:\r\n      failureThreshold: 3\r\n      httpGet:\r\n        path: /ready\r\n        port: 8181\r\n        scheme: HTTP\r\n      periodSeconds: 10\r\n      successThreshold: 1\r\n      timeoutSeconds: 1\r\n```\r\n\r\n**What you expected to happen**:\r\n\r\nCoreDNS liveness probe detects that the CoreDNS pod has failed and restarts it.\r\n\r\n**How to reproduce it (as minimally and precisely as possible)**:\r\n\r\nWe don't have an easy recreate scenario.  The problem may be triggered by master network connectivity flakes.\r\n\r\n**Anything else we need to know?**:\r\n\r\nNo.\r\n\r\n**Environment**:\r\n\r\n- the version of CoreDNS: 1.6.7 and 1.6.9\r\n- Corefile: See below\r\n- logs, if applicable: Not available\r\n- OS (e.g: `cat /etc/os-release`): Ubuntu 18.04.4 LTS\r\n- Others: Failures seen on IBM Cloud Kubernetes Service clusters running Kubernetes version 1.16 and 1.17.\r\n\r\n```\r\n    .:53 {\r\n        errors\r\n        health {\r\n            lameduck 10s\r\n        }\r\n        ready\r\n        kubernetes cluster.local in-addr.arpa ip6.arpa {\r\n            pods insecure\r\n            fallthrough in-addr.arpa ip6.arpa\r\n            ttl 30\r\n        }\r\n        prometheus :9153\r\n        forward . /etc/resolv.conf\r\n        cache 30\r\n        loop\r\n        reload\r\n        loadbalance\r\n    }\r\n```\r\n",
  "closed_at": "2020-05-14T19:39:41Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/9468083?v=4",
    "events_url": "https://api.github.com/users/johnbelamaric/events{/privacy}",
    "followers_url": "https://api.github.com/users/johnbelamaric/followers",
    "following_url": "https://api.github.com/users/johnbelamaric/following{/other_user}",
    "gists_url": "https://api.github.com/users/johnbelamaric/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/johnbelamaric",
    "id": 9468083,
    "login": "johnbelamaric",
    "node_id": "MDQ6VXNlcjk0NjgwODM=",
    "organizations_url": "https://api.github.com/users/johnbelamaric/orgs",
    "received_events_url": "https://api.github.com/users/johnbelamaric/received_events",
    "repos_url": "https://api.github.com/users/johnbelamaric/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/johnbelamaric/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/johnbelamaric/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/johnbelamaric"
  },
  "comments": 34,
  "comments_url": "https://api.github.com/repos/coredns/coredns/issues/3860/comments",
  "created_at": "2020-04-27T13:07:16Z",
  "events_url": "https://api.github.com/repos/coredns/coredns/issues/3860/events",
  "html_url": "https://github.com/coredns/coredns/issues/3860",
  "id": 607534137,
  "labels": [
    {
      "color": "fc2929",
      "default": true,
      "description": null,
      "id": 343986366,
      "name": "bug",
      "node_id": "MDU6TGFiZWwzNDM5ODYzNjY=",
      "url": "https://api.github.com/repos/coredns/coredns/labels/bug"
    },
    {
      "color": "a73fe2",
      "default": false,
      "description": "",
      "id": 977816976,
      "name": "kubernetes",
      "node_id": "MDU6TGFiZWw5Nzc4MTY5NzY=",
      "url": "https://api.github.com/repos/coredns/coredns/labels/kubernetes"
    }
  ],
  "labels_url": "https://api.github.com/repos/coredns/coredns/issues/3860/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MDc1MzQxMzc=",
  "number": 3860,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/coredns/coredns",
  "state": "closed",
  "title": "CoreDNS pods panic with no probe failures",
  "updated_at": "2020-06-18T17:23:52Z",
  "url": "https://api.github.com/repos/coredns/coredns/issues/3860",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/17885615?v=4",
    "events_url": "https://api.github.com/users/rtheis/events{/privacy}",
    "followers_url": "https://api.github.com/users/rtheis/followers",
    "following_url": "https://api.github.com/users/rtheis/following{/other_user}",
    "gists_url": "https://api.github.com/users/rtheis/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/rtheis",
    "id": 17885615,
    "login": "rtheis",
    "node_id": "MDQ6VXNlcjE3ODg1NjE1",
    "organizations_url": "https://api.github.com/users/rtheis/orgs",
    "received_events_url": "https://api.github.com/users/rtheis/received_events",
    "repos_url": "https://api.github.com/users/rtheis/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/rtheis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rtheis/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/rtheis"
  }
}