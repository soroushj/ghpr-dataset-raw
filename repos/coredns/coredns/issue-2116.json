{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "#### Version\r\nCoreDNS-1.2.2\r\nlinux/amd64, go1.11, eb51e8b\r\n\r\n#### Description\r\nI'm experimenting with a bit of a weird setup, where I'm attempting to use CoreDNS to serve some local records, proxy to an upstream provider, and act as a replica for our kubernetes service discovery, running outside of kubernetes. The problem I'm experiencing, is the kubernetes API might not be available when CoreDNS starts, and if it's not available, I'm experiencing a hang in the CoreDNS startup where the process never binds and isn't able to serve non-kubernetes records.\r\n\r\nI've isolated it to this code:\r\nhttps://github.com/coredns/coredns/blob/master/plugin/kubernetes/setup.go#L71-L75\r\n\r\nWhich appears to have been introduced to prevent a race / unit tests:\r\nPR: #1155 \r\nIssue: #1006\r\n\r\n#### Desired Behaiour\r\nI'm not sure if this is intended behaviour or not. \r\n\r\nMy expectation would be, that the kubernetes API being unavailable/unreachable would not block startup of a server under partial outage, only return serv fail on the zones the kubernetes plugin is responsible for (depending on fall-through).\r\n\r\nI haven't investigated the tests, to see what implications this approach might have from a unit test perspective.\r\n\r\nAlternatively, as a simpler workaround, I was considering the option to simply time limit the start-up routine would be blocked waiting for the kubernetes resources to sync. I was thinking something like 10-15 seconds would work.\r\n\r\n#### Closing\r\nI'm willing to contribute a fix for this issue with the desired approach.\r\n\r\nThank You\r\n\r\n\r\n\r\n",
  "closed_at": "2018-10-22T13:30:09Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/14335541?v=4",
    "events_url": "https://api.github.com/users/chrisohaver/events{/privacy}",
    "followers_url": "https://api.github.com/users/chrisohaver/followers",
    "following_url": "https://api.github.com/users/chrisohaver/following{/other_user}",
    "gists_url": "https://api.github.com/users/chrisohaver/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/chrisohaver",
    "id": 14335541,
    "login": "chrisohaver",
    "node_id": "MDQ6VXNlcjE0MzM1NTQx",
    "organizations_url": "https://api.github.com/users/chrisohaver/orgs",
    "received_events_url": "https://api.github.com/users/chrisohaver/received_events",
    "repos_url": "https://api.github.com/users/chrisohaver/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/chrisohaver/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chrisohaver/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/chrisohaver"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/coredns/coredns/issues/2116/comments",
  "created_at": "2018-09-21T18:19:34Z",
  "events_url": "https://api.github.com/repos/coredns/coredns/issues/2116/events",
  "html_url": "https://github.com/coredns/coredns/issues/2116",
  "id": 362724992,
  "labels": [
    {
      "color": "53e8c0",
      "default": false,
      "description": null,
      "id": 728076193,
      "name": "plugin/kubernetes",
      "node_id": "MDU6TGFiZWw3MjgwNzYxOTM=",
      "url": "https://api.github.com/repos/coredns/coredns/labels/plugin/kubernetes"
    }
  ],
  "labels_url": "https://api.github.com/repos/coredns/coredns/issues/2116/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzNjI3MjQ5OTI=",
  "number": 2116,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/coredns/coredns",
  "state": "closed",
  "title": "startup blocked if kubernetes API is unavailable",
  "updated_at": "2018-10-22T13:30:09Z",
  "url": "https://api.github.com/repos/coredns/coredns/issues/2116",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/12373072?v=4",
    "events_url": "https://api.github.com/users/knisbet/events{/privacy}",
    "followers_url": "https://api.github.com/users/knisbet/followers",
    "following_url": "https://api.github.com/users/knisbet/following{/other_user}",
    "gists_url": "https://api.github.com/users/knisbet/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/knisbet",
    "id": 12373072,
    "login": "knisbet",
    "node_id": "MDQ6VXNlcjEyMzczMDcy",
    "organizations_url": "https://api.github.com/users/knisbet/orgs",
    "received_events_url": "https://api.github.com/users/knisbet/received_events",
    "repos_url": "https://api.github.com/users/knisbet/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/knisbet/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/knisbet/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/knisbet"
  }
}