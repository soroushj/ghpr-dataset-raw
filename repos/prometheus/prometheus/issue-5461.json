{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "## Bug Report\r\n**What did you do?**\r\nI'm federating a prometheus running in a kubernetes cluster into another prometheus instance, something like:\r\n\r\n```yaml\r\n  - job_name: 'federate'\r\n    scrape_interval: 30s\r\n    scrape_timeout: 30s\r\n    honor_labels: true\r\n    metrics_path: '/federate'\r\n    params:\r\n      'match[]':\r\n        - '{job=~\"(kubernetes-pods|kubernetes-service-endpoints|kubernetes-nodes-cadvisor|kubernetes-nodes)\"}'\r\n    static_configs:\r\n      - targets:\r\n        - 'foo.bar:80'\r\n        labels:\r\n          service: kubernetes\r\n          env: explore\r\n```\r\n\r\n**What did you expect to see?**\r\n\r\nMetrics being federated\r\n\r\n**What did you see instead? Under which circumstances?**\r\n\r\n```\r\nexpected equal, got \"INVALID\"\r\n```\r\n\r\nI did `curl -s add | prom metrics check` and found this:\r\n\r\n```\r\nerror while linting: text format parsing error in line 14936: expected '=' after label name, found '-'\r\n```\r\n\r\nLine `14936` has this metric:\r\n\r\n```\r\ncontroller_runtime_reconcile_time_seconds_bucket{controller=\"jupyter-controller\",instance=\"172.16.3.15:8080\",job=\"kubernetes-pods\",kubernetes_namespace=\"operator\",kubernetes_pod_name=\"manager-6b7d97c669-sr9xs\",le=\"5\",operator=\"manager\",pod-template-hash=\"6b7d97c669\"} 8 1555338376838\r\n```\r\n\r\nSeems like the problem is this `pod-template-hash=\"6b7d97c669\"`. It works on the prometheus running inside the cluster, but when federating, the other prometheus fails to read the metrics because they are indeed invalid.\r\n\r\n**Environment**\r\n\r\n* System information:\r\n\r\n\tirrelevant afaik\r\n\r\n* Prometheus version:\r\n\r\n\t2.9.0 on both prometheus instances\r\n\r\n* Alertmanager version:\r\n\r\n\tirrelevant afaik\r\n\r\n* Prometheus configuration file:\r\n\r\nits the default generated by the prometheus helm chart.\r\n\r\n* Alertmanager configuration file:\r\nirrelevant.\r\n\r\n* Logs:\r\n```\r\nApr 15 15:07:53 i-ops-us-west2-prometheus-1 prometheus[21819]: level=warn ts=2019-04-15T15:07:53.563Z caller=scrape.go:933 component=\"scrape manager\" scrape_pool=federate target=\"http://foo.bar:80/federate?match%5B%5D=%7Bjob%3D~%22%28kubernetes-pods%7Ckubernetes-service-endpoints%7Ckubernetes-nodes-cadvisor%7Ckubernetes-nodes%29%22%7D\" msg=\"append failed\" err=\"expected equal, got \\\"INVALID\\\"\"\r\n```\r\n",
  "closed_at": "2019-04-15T18:04:50Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  },
  "comments": 6,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/5461/comments",
  "created_at": "2019-04-15T15:08:12Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/5461/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/5461",
  "id": 433335250,
  "labels": [],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/5461/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MzMzMzUyNTA=",
  "number": 5461,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "federate fails with labels like pod-template-hash",
  "updated_at": "2019-10-12T19:05:04Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/5461",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/245435?v=4",
    "events_url": "https://api.github.com/users/caarlos0/events{/privacy}",
    "followers_url": "https://api.github.com/users/caarlos0/followers",
    "following_url": "https://api.github.com/users/caarlos0/following{/other_user}",
    "gists_url": "https://api.github.com/users/caarlos0/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/caarlos0",
    "id": 245435,
    "login": "caarlos0",
    "node_id": "MDQ6VXNlcjI0NTQzNQ==",
    "organizations_url": "https://api.github.com/users/caarlos0/orgs",
    "received_events_url": "https://api.github.com/users/caarlos0/received_events",
    "repos_url": "https://api.github.com/users/caarlos0/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/caarlos0/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/caarlos0/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/caarlos0"
  }
}