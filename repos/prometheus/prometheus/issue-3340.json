{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "Using Prometheus built from the\r\n current `master` with the attached `data` directory ([data.tar.gz](https://github.com/prometheus/prometheus/files/1409032/data.tar.gz)) (which just contains a WAL so far), Prometheus consistently crashes like this:\r\n\r\n```\r\nlevel=info ts=2017-10-23T22:57:16.067433961Z caller=main.go:215 msg=\"Starting Prometheus\" version=\"(version=2.0.0-rc.1, branch=master, revision=c3d6abc8e6444c33c0071aaddbef402aa553ff68)\"\r\nlevel=info ts=2017-10-23T22:57:16.067475452Z caller=main.go:216 build_context=\"(go=go1.9, user=julius@julius-samsung, date=20171023-22:56:03)\"\r\nlevel=info ts=2017-10-23T22:57:16.067491611Z caller=main.go:217 host_details=\"(Linux 4.11.0-14-generic #20~16.04.1-Ubuntu SMP Wed Aug 9 09:06:22 UTC 2017 x86_64 julius-samsung (none))\"\r\nlevel=info ts=2017-10-23T22:57:16.069739337Z caller=web.go:380 component=web msg=\"Start listening for connections\" address=0.0.0.0:9090\r\nlevel=info ts=2017-10-23T22:57:16.069779637Z caller=main.go:314 msg=\"Starting TSDB\"\r\nlevel=info ts=2017-10-23T22:57:16.069784013Z caller=targetmanager.go:69 component=\"target manager\" msg=\"Starting target manager...\"\r\nlevel=info ts=2017-10-23T22:57:16.090802158Z caller=main.go:326 msg=\"TSDB started\"\r\nlevel=info ts=2017-10-23T22:57:16.090856994Z caller=main.go:394 msg=\"Loading configuration file\" filename=prometheus.yml\r\nlevel=info ts=2017-10-23T22:57:16.091676177Z caller=main.go:371 msg=\"Server is ready to receive requests.\"\r\npanic: runtime error: index out of range\r\n\r\ngoroutine 242 [running]:\r\ngithub.com/prometheus/prometheus/storage/tsdb.adapter.StartTime(0xc4203348f0, 0x6ddd00, 0xc420064fa8, 0x42a529, 0xc400000008)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/storage/tsdb/tsdb.go:193 +0x4e0\r\ngithub.com/prometheus/prometheus/storage/tsdb.(*ReadyStorage).StartTime(0xc420432320, 0x196bf00, 0xc420064f01, 0x297f098)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/storage/tsdb/tsdb.go:68 +0x4e\r\ngithub.com/prometheus/prometheus/storage/tsdb.(*ReadyStorage).StartTime-fm(0x196bf00, 0x0, 0x0)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/cmd/prometheus/main.go:227 +0x2a\r\ngithub.com/prometheus/prometheus/storage/remote.(*Storage).Querier(0xc4204b9180, 0x2890c00, 0xc421898a80, 0x15f4b6fdbfa, 0x15f4b746fda, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/storage/remote/read.go:33 +0x10a\r\ngithub.com/prometheus/prometheus/storage.(*fanout).Querier(0xc420052600, 0x2890c00, 0xc421898a80, 0x15f4b6fdbfa, 0x15f4b746fda, 0xffffffbbc166ed07, 0x295be80, 0xa60b19d1f4a2c767, 0xc4200651a8)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/storage/fanout.go:79 +0x1ed\r\ngithub.com/prometheus/prometheus/promql.(*Engine).populateIterators(0xc420436690, 0x2890c00, 0xc421898a80, 0xc42189e550, 0x411bbc, 0xc4200207e0, 0xc4200652a8, 0x43c81c)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/promql/engine.go:510 +0x2f5\r\ngithub.com/prometheus/prometheus/promql.(*Engine).execEvalStmt(0xc420436690, 0x2890c00, 0xc421898a80, 0xc420e661c0, 0xc42189e550, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/promql/engine.go:361 +0xf5\r\ngithub.com/prometheus/prometheus/promql.(*Engine).exec(0xc420436690, 0x2890c00, 0xc421898a80, 0xc420e661c0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/promql/engine.go:341 +0x317\r\ngithub.com/prometheus/prometheus/promql.(*query).Exec(0xc420e661c0, 0x2890b80, 0xc420052f00, 0x2890b80)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/promql/engine.go:179 +0xb8\r\ngithub.com/prometheus/prometheus/rules.(*AlertingRule).Eval(0xc420444c00, 0x7f05ed803ac8, 0xc420052f00, 0xbe73bad4b609b929, 0x19acba507, 0x295be80, 0xc420436690, 0xc420359700, 0x0, 0x0, ...)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/rules/alerting.go:164 +0x177\r\ngithub.com/prometheus/prometheus/rules.(*Group).Eval.func1(0x1ba6776, 0x8, 0xc420444d80, 0xbe73bad4b609b929, 0x19acba507, 0x295be80, 0x0, 0x2890ec0, 0xc420444c00)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/rules/manager.go:307 +0x194\r\ngithub.com/prometheus/prometheus/rules.(*Group).Eval(0xc420444d80, 0xbe73bad4b609b929, 0x19acba507, 0x295be80)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/rules/manager.go:375 +0xbf\r\ngithub.com/prometheus/prometheus/rules.(*Group).run.func1()\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/rules/manager.go:182 +0x81\r\ngithub.com/prometheus/prometheus/rules.(*Group).run(0xc420444d80)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/rules/manager.go:207 +0x23c\r\ngithub.com/prometheus/prometheus/rules.(*Manager).ApplyConfig.func1.1(0xc420052f40, 0xc420444d80)\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/rules/manager.go:510 +0x46\r\ncreated by github.com/prometheus/prometheus/rules.(*Manager).ApplyConfig.func1\r\n\t/home/julius/gosrc/src/github.com/prometheus/prometheus/rules/manager.go:505 +0x56\r\n```\r\n\r\nI'm not aware of anything I did to corrupt the data directory, so this seems like a Prometheus bug to me.\r\n\r\nThe code where it crashes:\r\n\r\n```go\r\n                        if p.Next() {\r\n                                var lset tsdbLabels.Labels\r\n                                var chks []tsdb.ChunkMeta\r\n                                indexr.Series(p.At(), &lset, &chks)\r\n                                if startTime > chks[0].MinTime {    // <--- CRASH HERE\r\n                                        startTime = chks[0].MinTime\r\n                                }\r\n                        }\r\n```\r\n\r\n...looks like it expects there to always be a chunk, but maybe my storage doesn't have one for this case yet?",
  "closed_at": "2017-10-26T07:08:49Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/4948210?v=4",
    "events_url": "https://api.github.com/users/fabxc/events{/privacy}",
    "followers_url": "https://api.github.com/users/fabxc/followers",
    "following_url": "https://api.github.com/users/fabxc/following{/other_user}",
    "gists_url": "https://api.github.com/users/fabxc/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/fabxc",
    "id": 4948210,
    "login": "fabxc",
    "node_id": "MDQ6VXNlcjQ5NDgyMTA=",
    "organizations_url": "https://api.github.com/users/fabxc/orgs",
    "received_events_url": "https://api.github.com/users/fabxc/received_events",
    "repos_url": "https://api.github.com/users/fabxc/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/fabxc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fabxc/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/fabxc"
  },
  "comments": 10,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/3340/comments",
  "created_at": "2017-10-23T23:12:47Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/3340/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/3340",
  "id": 267846410,
  "labels": [],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/3340/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNjc4NDY0MTA=",
  "number": 3340,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Consistent startup crash in storage adapter",
  "updated_at": "2019-03-23T05:55:29Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/3340",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/538008?v=4",
    "events_url": "https://api.github.com/users/juliusv/events{/privacy}",
    "followers_url": "https://api.github.com/users/juliusv/followers",
    "following_url": "https://api.github.com/users/juliusv/following{/other_user}",
    "gists_url": "https://api.github.com/users/juliusv/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/juliusv",
    "id": 538008,
    "login": "juliusv",
    "node_id": "MDQ6VXNlcjUzODAwOA==",
    "organizations_url": "https://api.github.com/users/juliusv/orgs",
    "received_events_url": "https://api.github.com/users/juliusv/received_events",
    "repos_url": "https://api.github.com/users/juliusv/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/juliusv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/juliusv/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/juliusv"
  }
}