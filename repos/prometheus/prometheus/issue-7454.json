{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/15064823?v=4",
    "events_url": "https://api.github.com/users/codesome/events{/privacy}",
    "followers_url": "https://api.github.com/users/codesome/followers",
    "following_url": "https://api.github.com/users/codesome/following{/other_user}",
    "gists_url": "https://api.github.com/users/codesome/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/codesome",
    "id": 15064823,
    "login": "codesome",
    "node_id": "MDQ6VXNlcjE1MDY0ODIz",
    "organizations_url": "https://api.github.com/users/codesome/orgs",
    "received_events_url": "https://api.github.com/users/codesome/received_events",
    "repos_url": "https://api.github.com/users/codesome/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/codesome/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codesome/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/codesome"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars1.githubusercontent.com/u/15064823?v=4",
      "events_url": "https://api.github.com/users/codesome/events{/privacy}",
      "followers_url": "https://api.github.com/users/codesome/followers",
      "following_url": "https://api.github.com/users/codesome/following{/other_user}",
      "gists_url": "https://api.github.com/users/codesome/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/codesome",
      "id": 15064823,
      "login": "codesome",
      "node_id": "MDQ6VXNlcjE1MDY0ODIz",
      "organizations_url": "https://api.github.com/users/codesome/orgs",
      "received_events_url": "https://api.github.com/users/codesome/received_events",
      "repos_url": "https://api.github.com/users/codesome/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/codesome/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codesome/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/codesome"
    }
  ],
  "author_association": "NONE",
  "body": "**What did you do?**\r\nRestart Prometheus\r\n\r\n**What did you expect to see?**\r\nClean startup\r\n\r\n**What did you see instead? Under which circumstances?**\r\nPanic and stack trace during a call to /metrics before startup finished (that the upstream Prometheus server called /metrics despite Prometheus not having signalled ready appears to be a bug in our service discovery in that setup)\r\n`{\"caller\":\"web.go:99\",\"client\":\"10.86.14.4:43362\",\"component\":\"web\",\"err\":\"runtime error: invalid memory address or nil pointer dereference\",\"level\":\"error\",\"msg\":\"panic while serving request\",\"stack\":\"<see decoded stack below>\",\"url\":\"/metrics\"}`\r\n\r\nFull logs supplied below, here's the stack:\r\n```\r\ngoroutine 166 [running]:\r\ngithub.com/prometheus/prometheus/web.withStackTracer.func1.1(0x2f3b7e0, 0xc0004ccc60, 0xc0000f6600)\r\n\t/app/web/web.go:98 +0xb5\r\npanic(0x2334740, 0x42d4ba0)\r\n\t/usr/local/go/src/runtime/panic.go:969 +0x166\r\ngithub.com/prometheus/prometheus/tsdb.(*Head).MinTime(...)\r\n\t/app/tsdb/head.go:1407\r\ngithub.com/prometheus/prometheus/tsdb.newDBMetrics.func3(0x0)\r\n\t/app/tsdb/db.go:228 +0x80\r\ngithub.com/prometheus/client_golang/prometheus.(*valueFunc).Write(0xc0001fab40, 0xc0001c0620, 0xc000113040, 0x3)\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/value.go:76 +0x2f\r\ngithub.com/prometheus/client_golang/prometheus.processMetric(0x2f53020, 0xc0001fab40, 0xc000112ed0, 0xc000112f00, 0x0, 0x0, 0x0)\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/registry.go:595 +0x9b\r\ngithub.com/prometheus/client_golang/prometheus.(*Registry).Gather(0xc0001385f0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/registry.go:489 +0x87c\r\ngithub.com/prometheus/client_golang/prometheus/promhttp.HandlerFor.func1(0x7f98a29be170, 0xc0000a1180, 0xc0000f6900)\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/promhttp/http.go:126 +0x93\r\nnet/http.HandlerFunc.ServeHTTP(0xc000492850, 0x7f98a29be170, 0xc0000a1180, 0xc0000f6900)\r\n\t/usr/local/go/src/net/http/server.go:2012 +0x44\r\ngithub.com/prometheus/client_golang/prometheus/promhttp.InstrumentHandlerInFlight.func1(0x7f98a29be170, 0xc0000a1180, 0xc0000f6900)\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/promhttp/instrument_server.go:40 +0xab\r\nnet/http.HandlerFunc.ServeHTTP(0xc0005c3b90, 0x7f98a29be170, 0xc0000a1180, 0xc0000f6900)\r\n\t/usr/local/go/src/net/http/server.go:2012 +0x44\r\ngithub.com/prometheus/client_golang/prometheus/promhttp.InstrumentHandlerCounter.func1(0x7f98a29be170, 0xc0000a1130, 0xc0000f6900)\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/promhttp/instrument_server.go:100 +0xda\r\nnet/http.HandlerFunc.ServeHTTP(0xc0005c3cb0, 0x7f98a29be170, 0xc0000a1130, 0xc0000f6900)\r\n\t/usr/local/go/src/net/http/server.go:2012 +0x44\r\nnet/http.HandlerFunc.ServeHTTP(0xc00018bd40, 0x7f98a29be170, 0xc0000a1130, 0xc0000f6900)\r\n\t/usr/local/go/src/net/http/server.go:2012 +0x44\r\ngithub.com/prometheus/client_golang/prometheus/promhttp.InstrumentHandlerResponseSize.func1(0x7f98a29be170, 0xc0000a10e0, 0xc0000f6900)\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/promhttp/instrument_server.go:196 +0xea\r\nnet/http.HandlerFunc.ServeHTTP(0xc0005c3e30, 0x7f98a29be170, 0xc0000a10e0, 0xc0000f6900)\r\n\t/usr/local/go/src/net/http/server.go:2012 +0x44\r\ngithub.com/prometheus/client_golang/prometheus/promhttp.InstrumentHandlerDuration.func2(0x7f98a29be170, 0xc0000a10e0, 0xc0000f6900)\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/promhttp/instrument_server.go:76 +0xb2\r\nnet/http.HandlerFunc.ServeHTTP(0xc0005c3f50, 0x7f98a29be170, 0xc0000a10e0, 0xc0000f6900)\r\n\t/usr/local/go/src/net/http/server.go:2012 +0x44\r\ngithub.com/prometheus/client_golang/prometheus/promhttp.InstrumentHandlerCounter.func1(0x2f85560, 0xc0000a1040, 0xc0000f6900)\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/promhttp/instrument_server.go:100 +0xda\r\ngithub.com/prometheus/prometheus/web.setPathWithPrefix.func1.1(0x2f85560, 0xc0000a1040, 0xc0000f6800)\r\n\t/app/web/web.go:1142 +0x1c6\r\ngithub.com/prometheus/common/route.(*Router).handle.func1(0x2f85560, 0xc0000a1040, 0xc0000f6700, 0x0, 0x0, 0x0)\r\n\t/app/vendor/github.com/prometheus/common/route/route.go:83 +0x27f\r\ngithub.com/julienschmidt/httprouter.(*Router).ServeHTTP(0xc000183f80, 0x2f85560, 0xc0000a1040, 0xc0000f6700)\r\n\t/app/vendor/github.com/julienschmidt/httprouter/router.go:387 +0xc37\r\ngithub.com/prometheus/common/route.(*Router).ServeHTTP(0xc00018a0e0, 0x2f85560, 0xc0000a1040, 0xc0000f6700)\r\n\t/app/vendor/github.com/prometheus/common/route/route.go:121 +0x4c\r\nnet/http.(*ServeMux).ServeHTTP(0xc0005fe440, 0x2f85560, 0xc0000a1040, 0xc0000f6700)\r\n\t/usr/local/go/src/net/http/server.go:2387 +0x1a5\r\ngithub.com/opentracing-contrib/go-stdlib/nethttp.MiddlewareFunc.func5(0x2f83ae0, 0xc0001ce0e0, 0xc0000f6600)\r\n\t/app/vendor/github.com/opentracing-contrib/go-stdlib/nethttp/server.go:140 +0x5f6\r\nnet/http.HandlerFunc.ServeHTTP(0xc0007869f0, 0x2f83ae0, 0xc0001ce0e0, 0xc0000f6600)\r\n\t/usr/local/go/src/net/http/server.go:2012 +0x44\r\ngithub.com/prometheus/prometheus/web.withStackTracer.func1(0x2f83ae0, 0xc0001ce0e0, 0xc0000f6600)\r\n\t/app/web/web.go:103 +0x8b\r\nnet/http.HandlerFunc.ServeHTTP(0xc000786a20, 0x2f83ae0, 0xc0001ce0e0, 0xc0000f6600)\r\n\t/usr/local/go/src/net/http/server.go:2012 +0x44\r\nnet/http.serverHandler.ServeHTTP(0xc00081a000, 0x2f83ae0, 0xc0001ce0e0, 0xc0000f6600)\r\n\t/usr/local/go/src/net/http/server.go:2807 +0xa3\r\nnet/http.(*conn).serve(0xc000360640, 0x2f8cfa0, 0xc000694d00)\r\n\t/usr/local/go/src/net/http/server.go:1895 +0x86c\r\ncreated by net/http.(*Server).Serve\r\n\t/usr/local/go/src/net/http/server.go:2933 +0x35c\r\n```\r\n\r\n**Environment**\r\n\r\n* System information:\r\nLinux 4.14.138+ x86_64 (Container running on Google Kubernetes Engine)\r\n\r\n* Prometheus version:\r\n\r\nprometheus, version 2.19.1 (branch: HEAD, revision: eba3fdcbf0d378b66600281903e3aab515732b39)\r\n  build user:       root@62700b3d0ef9\r\n  build date:       20200618-16:35:26\r\n  go version:       go1.14.4\r\n\r\n**Logs**\r\n```\r\n{\"caller\":\"main.go:337\",\"level\":\"info\",\"msg\":\"Starting Prometheus\",\"ts\":\"2020-06-25T05:05:22.144Z\",\"version\":\"(version=2.19.1, branch=HEAD, revision=eba3fdcbf0d378b66600281903e3aab515732b39)\"}\r\n{\"build_context\":\"(go=go1.14.4, user=root@62700b3d0ef9, date=20200618-16:35:26)\",\"caller\":\"main.go:338\",\"level\":\"info\",\"ts\":\"2020-06-25T05:05:22.144Z\"}\r\n{\"caller\":\"main.go:339\",\"host_details\":\"(Linux 4.14.138+ #1 SMP Tue Sep 3 02:58:08 PDT 2019 x86_64 prometheus-player-metrics-0 (none))\",\"level\":\"info\",\"ts\":\"2020-06-25T05:05:22.144Z\"}\r\n{\"caller\":\"main.go:340\",\"fd_limits\":\"(soft=1048576, hard=1048576)\",\"level\":\"info\",\"ts\":\"2020-06-25T05:05:22.144Z\"}\r\n{\"caller\":\"main.go:341\",\"level\":\"info\",\"ts\":\"2020-06-25T05:05:22.144Z\",\"vm_limits\":\"(soft=unlimited, hard=unlimited)\"}\r\n{\"caller\":\"main.go:678\",\"level\":\"info\",\"msg\":\"Starting TSDB ...\",\"ts\":\"2020-06-25T05:05:22.240Z\"}\r\n{\"address\":\"0.0.0.0:9090\",\"caller\":\"web.go:524\",\"component\":\"web\",\"level\":\"info\",\"msg\":\"Start listening for connections\",\"ts\":\"2020-06-25T05:05:22.240Z\"}\r\n{\"caller\":\"web.go:99\",\"client\":\"10.86.14.4:43362\",\"component\":\"web\",\"err\":\"runtime error: invalid memory address or nil pointer dereference\",\"level\":\"error\",\"msg\":\"panic while serving request\",\"stack\":\"<see decoded stack above>\",\"url\":\"/metrics\"}\r\n{\"caller\":\"http: panic serving 10.86.14.4:43362\",\"component\":\"web\",\"level\":\"error\",\"msg\":\"runtime error: invalid memory address or nil pointer dereference\",\"ts\":\"2020-06-25T05:05:32.640Z\"}\r\n{\"caller\":\"head.go:645\",\"component\":\"tsdb\",\"level\":\"info\",\"msg\":\"Replaying WAL and on-disk memory mappable chunks if any, this may take a while\",\"ts\":\"2020-06-25T05:05:33.096Z\"}\r\n...\r\n```",
  "closed_at": "2020-07-05T04:41:43Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/15064823?v=4",
    "events_url": "https://api.github.com/users/codesome/events{/privacy}",
    "followers_url": "https://api.github.com/users/codesome/followers",
    "following_url": "https://api.github.com/users/codesome/following{/other_user}",
    "gists_url": "https://api.github.com/users/codesome/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/codesome",
    "id": 15064823,
    "login": "codesome",
    "node_id": "MDQ6VXNlcjE1MDY0ODIz",
    "organizations_url": "https://api.github.com/users/codesome/orgs",
    "received_events_url": "https://api.github.com/users/codesome/received_events",
    "repos_url": "https://api.github.com/users/codesome/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/codesome/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codesome/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/codesome"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/7454/comments",
  "created_at": "2020-06-25T05:22:09Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/7454/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/7454",
  "id": 645161665,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "",
      "id": 1498495148,
      "name": "component/tsdb",
      "node_id": "MDU6TGFiZWwxNDk4NDk1MTQ4",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/tsdb"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/7454/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2NDUxNjE2NjU=",
  "number": 7454,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Panic from /metrics during startup",
  "updated_at": "2020-07-05T04:41:43Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/7454",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/214867?v=4",
    "events_url": "https://api.github.com/users/carlpett/events{/privacy}",
    "followers_url": "https://api.github.com/users/carlpett/followers",
    "following_url": "https://api.github.com/users/carlpett/following{/other_user}",
    "gists_url": "https://api.github.com/users/carlpett/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/carlpett",
    "id": 214867,
    "login": "carlpett",
    "node_id": "MDQ6VXNlcjIxNDg2Nw==",
    "organizations_url": "https://api.github.com/users/carlpett/orgs",
    "received_events_url": "https://api.github.com/users/carlpett/received_events",
    "repos_url": "https://api.github.com/users/carlpett/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/carlpett/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/carlpett/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/carlpett"
  }
}