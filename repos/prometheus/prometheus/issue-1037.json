{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "on a clean checkout of HEAD (facf60e0331977bc9245d54c0c1b6fee6df335b6), running `make`, I get a deadlock repeatably.\n\n$ make\ncurl -o /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/cache/go1.4.2.darwin-amd64-osx10.8.tar.gz -L https://golang.org/dl/go1.4.2.darwin-amd64-osx10.8.tar.gz\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100    96  100    96    0     0    364      0 --:--:-- --:--:-- --:--:--   365\n100 58.7M  100 58.7M    0     0  8137k      0  0:00:07  0:00:07 --:--:-- 9162k\ntar -C /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root -xzf /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/cache/go1.4.2.darwin-amd64-osx10.8.tar.gz\ntouch /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/go/bin/go\ncp -a /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/Godeps/_workspace \"/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/gopath\"\nln -s /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/gopath/src/github.com/prometheus/prometheus\nTMPDIR=/tmp GOROOT=/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/go GOPATH=/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/gopath /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/go/bin/go build -o prometheus -ldflags \" -X github.com/prometheus/prometheus/version.Version 0.15.1 -X github.com/prometheus/prometheus/version.Revision facf60e -X github.com/prometheus/prometheus/version.Branch master -X github.com/prometheus/prometheus/version.BuildUser swsnider@ssnider-mini.apple.com -X github.com/prometheus/prometheus/version.BuildDate 20150827-19:38:59 -X github.com/prometheus/prometheus/version.GoVersion 1.4.2\" github.com/prometheus/prometheus/cmd/prometheus\nTMPDIR=/tmp GOROOT=/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/go GOPATH=/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/gopath /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/go/bin/go build -o promtool -ldflags \" -X github.com/prometheus/prometheus/version.Version 0.15.1 -X github.com/prometheus/prometheus/version.Revision facf60e -X github.com/prometheus/prometheus/version.Branch master -X github.com/prometheus/prometheus/version.BuildUser swsnider@ssnider-mini.apple.com -X github.com/prometheus/prometheus/version.BuildDate 20150827-19:38:59 -X github.com/prometheus/prometheus/version.GoVersion 1.4.2\" github.com/prometheus/prometheus/cmd/promtool\nTMPDIR=/tmp GOROOT=/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/go GOPATH=/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/gopath /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/go/bin/go test -short ./...\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/cmd/prometheus    [no test files]\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/cmd/promtool  [no test files]\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/config    0.017s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/notification  0.014s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/promql    0.278s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval 2.599s\ntime=\"2015-08-27T19:39:23-07:00\" level=error msg=\"Error reading file \\\"fixtures/_test.yml\\\": yaml: did not find expected node content\" file=file.go line=170\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\ntesting.RunTests(0x569bb8, 0x6b8120, 0x7, 0x7, 0xc20803aa01)\n    /usr/local/go/src/testing/testing.go:556 +0xad6\ntesting.(*M).Run(0xc2080525f0, 0x6c34e0)\n    /usr/local/go/src/testing/testing.go:485 +0x6c\nmain.main()\n    _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/_test/_testmain.go:64 +0x1d5\n\ngoroutine 9 [chan receive]:\n_/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery.testFileSD(0xc2080321b0, 0x492000, 0x4)\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/file_test.go:109 +0xdbd\n_/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery.TestFileSD(0xc2080321b0)\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/file_test.go:16 +0x95\ntesting.tRunner(0xc2080321b0, 0x6b8120)\n    /usr/local/go/src/testing/testing.go:447 +0xbf\ncreated by testing.RunTests\n    /usr/local/go/src/testing/testing.go:555 +0xa8b\n\ngoroutine 10 [chan send]:\ngopkg.in/fsnotify%2ev1.(_Watcher).Close(0xc2080549c0, 0x0, 0x0)\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/gopath/src/gopkg.in/fsnotify.v1/kqueue.go:87 +0x220\n_/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery.(_FileDiscovery).stop(0xc20803de00)\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/file.go:215 +0x16f\n_/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery.(*FileDiscovery).Run(0xc20803de00, 0xc208054780, 0xc2080547e0)\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/file.go:131 +0x2fe\ncreated by _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery.testFileSD\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/file_test.go:32 +0x282\n\ngoroutine 12 [chan send]:\ngopkg.in/fsnotify%2ev1.(*Watcher).readEvents(0xc2080549c0)\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/gopath/src/gopkg.in/fsnotify.v1/kqueue.go:301 +0x711\ncreated by gopkg.in/fsnotify%2ev1.NewWatcher\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/.build/root/gopath/src/gopkg.in/fsnotify.v1/kqueue.go:61 +0x31f\n\ngoroutine 13 [chan receive]:\n_/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery.func\u00b7006()\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/file_test.go:85 +0x6d\ncreated by _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery.testFileSD\n    /Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/file_test.go:93 +0xa47\nFAIL    _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery   15.054s\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/kubernetes    [no test files]\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/retrieval/discovery/marathon  [no test files]\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/rules 0.059s\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/storage   [no test files]\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/storage/local 3.699s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/storage/local/codable 0.007s\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/storage/local/index   [no test files]\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/storage/metric    0.007s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/storage/remote    0.015s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/storage/remote/influxdb   0.013s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/storage/remote/opentsdb   0.011s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/template  0.040s\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/util/cli  [no test files]\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/util/flock    0.007s\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/util/httputil [no test files]\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/util/route    [no test files]\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/util/stats    [no test files]\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/util/strutil  [no test files]\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/util/testutil [no test files]\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/version   [no test files]\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/web   0.015s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/web/api/legacy    0.037s\nok      _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/web/api/v1    0.023s\n?       _/Users/swsnider/Documents/Projects/Code/src/github.com/prometheus/prometheus/web/blob  [no test files]\nmake: **\\* [test] Error 1\n",
  "closed_at": "2015-08-28T13:53:24Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/4948210?v=4",
    "events_url": "https://api.github.com/users/fabxc/events{/privacy}",
    "followers_url": "https://api.github.com/users/fabxc/followers",
    "following_url": "https://api.github.com/users/fabxc/following{/other_user}",
    "gists_url": "https://api.github.com/users/fabxc/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/fabxc",
    "id": 4948210,
    "login": "fabxc",
    "node_id": "MDQ6VXNlcjQ5NDgyMTA=",
    "organizations_url": "https://api.github.com/users/fabxc/orgs",
    "received_events_url": "https://api.github.com/users/fabxc/received_events",
    "repos_url": "https://api.github.com/users/fabxc/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/fabxc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fabxc/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/fabxc"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/1037/comments",
  "created_at": "2015-08-28T02:42:19Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/1037/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/1037",
  "id": 103635691,
  "labels": [],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/1037/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxMDM2MzU2OTE=",
  "number": 1037,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "REGRESSION: Test deadlocks",
  "updated_at": "2019-03-24T18:27:53Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/1037",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/1662?v=4",
    "events_url": "https://api.github.com/users/swsnider/events{/privacy}",
    "followers_url": "https://api.github.com/users/swsnider/followers",
    "following_url": "https://api.github.com/users/swsnider/following{/other_user}",
    "gists_url": "https://api.github.com/users/swsnider/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/swsnider",
    "id": 1662,
    "login": "swsnider",
    "node_id": "MDQ6VXNlcjE2NjI=",
    "organizations_url": "https://api.github.com/users/swsnider/orgs",
    "received_events_url": "https://api.github.com/users/swsnider/received_events",
    "repos_url": "https://api.github.com/users/swsnider/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/swsnider/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/swsnider/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/swsnider"
  }
}