{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "The handy `/service-discovery` endpoint also show all dropped labels. However, SD often retrieve essentially all the meta data and then drop most of it for each job. In the case of K8s, imagine a decently sized cluster of 10k pods, each with 10 labels or annotations, each needs ~1kiB to display in HTML with its operation. A Prometheus server with 10 configured job would display all 100k labels/annotations in the K8s cluster for each of the 10 job, i.e. 1M labels/annotations, resulting in about 1GiB of data. That's just a broad estimate. I have just done a practical measurement and retrieved 1.4GiB of HTML code from the `/service-discovery` endpoint. This is a drain on the Prometheus server and the network, and usually kills the browser tab. Most K8s clusters might be smaller, but the ~10k pod clusters at SoundCloud are not meant to be beyond the scalability limit of Prometheus. Selected few organizations even run much larger clusters, which Prometheus should still be able to monitor.\r\n\r\nIn short, the `/service-discovery` endpoint needs to be capped for such large clusters. Details need to be figured out, but it could be something like a message \"displaying only 100 dropped labels. There are 999,900 more labels.\" with a pagination mechanism or a download link for same raw data of the labels (which is then explicitly requested by the user rather than accidentally triggered by visiting the Service Discovery status page).\r\n\r\nIIRC @Conorbro implemented the endpoint and might have the best ideas how to proceed here.\r\n\r\n@krasi-georgiev : as discussed.",
  "closed_at": "2018-06-12T12:57:01Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/8903888?v=4",
    "events_url": "https://api.github.com/users/krasi-georgiev/events{/privacy}",
    "followers_url": "https://api.github.com/users/krasi-georgiev/followers",
    "following_url": "https://api.github.com/users/krasi-georgiev/following{/other_user}",
    "gists_url": "https://api.github.com/users/krasi-georgiev/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/krasi-georgiev",
    "id": 8903888,
    "login": "krasi-georgiev",
    "node_id": "MDQ6VXNlcjg5MDM4ODg=",
    "organizations_url": "https://api.github.com/users/krasi-georgiev/orgs",
    "received_events_url": "https://api.github.com/users/krasi-georgiev/received_events",
    "repos_url": "https://api.github.com/users/krasi-georgiev/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/krasi-georgiev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/krasi-georgiev/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/krasi-georgiev"
  },
  "comments": 11,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/4134/comments",
  "created_at": "2018-05-02T22:15:12Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/4134/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/4134",
  "id": 319730744,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567222,
      "name": "component/ui",
      "node_id": "MDU6TGFiZWwzNjU1NjcyMjI=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/ui"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": null,
      "id": 365563606,
      "name": "priority/P1",
      "node_id": "MDU6TGFiZWwzNjU1NjM2MDY=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/priority/P1"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/4134/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMTk3MzA3NDQ=",
  "number": 4134,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "/service-discovery returns excessive amount of HTML for large K8s clusters",
  "updated_at": "2019-03-22T15:09:50Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/4134",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/5609886?v=4",
    "events_url": "https://api.github.com/users/beorn7/events{/privacy}",
    "followers_url": "https://api.github.com/users/beorn7/followers",
    "following_url": "https://api.github.com/users/beorn7/following{/other_user}",
    "gists_url": "https://api.github.com/users/beorn7/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/beorn7",
    "id": 5609886,
    "login": "beorn7",
    "node_id": "MDQ6VXNlcjU2MDk4ODY=",
    "organizations_url": "https://api.github.com/users/beorn7/orgs",
    "received_events_url": "https://api.github.com/users/beorn7/received_events",
    "repos_url": "https://api.github.com/users/beorn7/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/beorn7/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/beorn7/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/beorn7"
  }
}