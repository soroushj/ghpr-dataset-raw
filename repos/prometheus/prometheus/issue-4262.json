{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "## Bug Report\r\n\r\nRunning Prometheus 2.3.0 with graphite-remote-adapter and stopping it:\r\n```\r\nlevel=info ts=2018-06-13T06:49:24.26401728Z caller=queue_manager.go:258 component=remote queue=\"0:http://prometheus-meta-graphite-remote-adapter/write?graphite.default-prefix=sre.network.services.prometheus.\" msg=\"Stopping remote storage...\"\r\nlevel=info ts=2018-06-13T06:49:25.680587091Z caller=queue_manager.go:266 component=remote queue=\"0:http://prometheus-meta-graphite-remote-adapter/write?graphite.default-prefix=sre.network.services.prometheus.\" msg=\"Remote storage stopped.\"\r\nlevel=info ts=2018-06-13T06:49:25.680647131Z caller=manager.go:464 component=\"rule manager\" msg=\"Stopping rule manager...\"\r\npanic: send on closed channel\r\n\r\ngoroutine 932 [running]:\r\ngithub.com/prometheus/prometheus/storage/remote.(*shards).enqueue(0xc42017b0e0, 0xc42e688c00, 0x5)\r\n        /go/src/github.com/prometheus/prometheus/storage/remote/queue_manager.go:438 +0x8b\r\ngithub.com/prometheus/prometheus/storage/remote.(*QueueManager).Append(0xc4202e41e0, 0xc439343918, 0x8, 0xc437844090)\r\n        /go/src/github.com/prometheus/prometheus/storage/remote/queue_manager.go:222 +0x26e\r\ngithub.com/prometheus/prometheus/storage/remote.(*Storage).Add(0xc420193420, 0xc429089100, 0x5, 0x8, 0x163f7e7f3cc, 0x0, 0x0, 0x0, 0x0)\r\n        /go/src/github.com/prometheus/prometheus/storage/remote/write.go:32 +0x11a\r\ngithub.com/prometheus/prometheus/storage.(*fanoutAppender).Add(0xc426cafa40, 0xc429089100, 0x5, 0x8, 0x163f7e7f3cc, 0x0, 0x1c85b, 0x0, 0x0)\r\n        /go/src/github.com/prometheus/prometheus/storage/fanout.go:140 +0x131\r\ngithub.com/prometheus/prometheus/rules.(*Group).Eval.func1(0x1decdc0, 0xc420042118, 0x275dbd39, 0xed2b2b573, 0x2afd680, 0xc4208fa870, 0x10, 0x1df69e0, 0xc42109fcc0)\r\n        /go/src/github.com/prometheus/prometheus/rules/manager.go:365 +0x6f8\r\ngithub.com/prometheus/prometheus/rules.(*Group).Eval(0xc4208fa870, 0x1decdc0, 0xc420042118, 0x275dbd39, 0xed2b2b573, 0x2afd680)\r\n        /go/src/github.com/prometheus/prometheus/rules/manager.go:406 +0xad\r\ngithub.com/prometheus/prometheus/rules.(*Group).run.func1()\r\n        /go/src/github.com/prometheus/prometheus/rules/manager.go:206 +0xc0\r\ngithub.com/prometheus/prometheus/rules.(*Group).run(0xc4208fa870, 0x1decdc0, 0xc420042118)\r\n        /go/src/github.com/prometheus/prometheus/rules/manager.go:235 +0x2e6\r\ngithub.com/prometheus/prometheus/rules.(*Manager).Update.func1.1(0xc420179340, 0xc4208fa870)\r\n        /go/src/github.com/prometheus/prometheus/rules/manager.go:509 +0x60\r\ncreated by github.com/prometheus/prometheus/rules.(*Manager).Update.func1\r\n        /go/src/github.com/prometheus/prometheus/rules/manager.go:504 +0x56\r\n```\r\n\r\n**Environment**\r\n\r\n```\r\nLinux 4.13.0-45-generic x86_64\r\nprometheus, version 2.3.0 (branch: HEAD, revision: 290d71791a507a5057b9a099c9d48703d86dc941)\r\n  build user:       root@d539e167976a\r\n  build date:       20180607-08:46:54\r\n  go version:       go1.10.2\r\n```\r\n",
  "closed_at": "2018-07-04T12:41:17Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  },
  "comments": 7,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/4262/comments",
  "created_at": "2018-06-13T06:52:32Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/4262/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/4262",
  "id": 331863708,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567165,
      "name": "component/remote storage",
      "node_id": "MDU6TGFiZWwzNjU1NjcxNjU=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/remote%20storage"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/4262/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMzE4NjM3MDg=",
  "number": 4262,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "remote_write: send on closed channel",
  "updated_at": "2019-03-22T14:09:26Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/4262",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1032963?v=4",
    "events_url": "https://api.github.com/users/iksaif/events{/privacy}",
    "followers_url": "https://api.github.com/users/iksaif/followers",
    "following_url": "https://api.github.com/users/iksaif/following{/other_user}",
    "gists_url": "https://api.github.com/users/iksaif/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/iksaif",
    "id": 1032963,
    "login": "iksaif",
    "node_id": "MDQ6VXNlcjEwMzI5NjM=",
    "organizations_url": "https://api.github.com/users/iksaif/orgs",
    "received_events_url": "https://api.github.com/users/iksaif/received_events",
    "repos_url": "https://api.github.com/users/iksaif/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/iksaif/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iksaif/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/iksaif"
  }
}