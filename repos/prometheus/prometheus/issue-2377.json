{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
      "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
      "followers_url": "https://api.github.com/users/brian-brazil/followers",
      "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
      "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/brian-brazil",
      "id": 7115638,
      "login": "brian-brazil",
      "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
      "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
      "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
      "repos_url": "https://api.github.com/users/brian-brazil/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/brian-brazil"
    }
  ],
  "author_association": "NONE",
  "body": "Hi, first of all thank you for your job, I really appreciate it.\r\n\r\n## Config\r\nI have this Prometheus configuration and as target, for simplicity, there are three different files, corresponding to three different jobs, in the blackbox targets' directory.  \r\n```yaml\r\nglobal:\r\n  scrape_interval: 10s\r\n  evaluation_interval: 10s\r\n \r\nrule_files: \r\n - /etc/prometheus/rules/recording/*.rules\r\n - /etc/prometheus/rules/alerting/*.rules\r\n \r\n \r\nscrape_configs:\r\n - job_name: 'override-exporters'\r\n   scrape_interval: 5s\r\n \r\n   file_sd_configs:\r\n     - files:\r\n       - '/etc/prometheus/targets/exporters/*.yml'\r\n \r\n - job_name: 'override-blackbox'\r\n   scrape_interval: 10s\r\n   metrics_path: /probe\r\n   file_sd_configs:\r\n     - files:\r\n         - '/etc/prometheus/targets/blackbox/*.yml'\r\n   relabel_configs:\r\n     - source_labels: [module]\r\n       target_label: __param_module\r\n     - source_labels: [module, __address__]\r\n       regex: ^[http|tcp].*;(.*):(.*)$\r\n       target_label: __param_target\r\n       replacement: ${1}:${2}\r\n     - source_labels: [module, __address__]\r\n       regex: ^icmp;(.*):?.*\r\n       target_label: __param_target\r\n       replacement: ${1}\r\n     - source_labels: [__param_target]\r\n       regex: ^(.*):(.*)\r\n       target_label: remote_address\r\n       replacement: ${1}\r\n     - source_labels: [__param_target]\r\n       regex: ^([^:]*)$\r\n       target_label: remote_address\r\n       replacement: ${1}\r\n     - source_labels: [host]\r\n       target_label: instance\r\n     - source_labels: []\r\n       target_label: module\r\n       replacement: \"\"\r\n     - source_labels: []\r\n       target_label: host\r\n       replacement: \"\"\r\n     - source_labels: []\r\n       regex: .*\r\n       target_label: __address__\r\n       replacement: '<link_to_the_blackbox_exporter>:9115'\r\n```\r\n\r\nIn the directory **/etc/prometheus/targets/blackbox/** there are the following files. In my configuration each file represents a job hence, all the targets for a job are in the same file.  \r\n**job_http.yml** \r\n```yaml\r\n- labels:\r\n    host: host1\r\n    job: blackbox-http\r\n    module: http_get_5s\r\n  targets:\r\n  - 1.1.1.1:8080\r\n```  \r\n\r\n**job_ping.yml**\r\n```yaml\r\n- labels:\r\n    host: host1\r\n    job: blackbox-ping\r\n    module: icmp\r\n  targets:\r\n  - 1.1.1.1\r\n```  \r\n\r\n**job_ssh.yml**\r\n```yaml\r\n- labels:\r\n    host: host1\r\n    job: blackbox-ssh\r\n    module: tcp\r\n  targets:\r\n  - 1.1.1.1:22\r\n```\r\n\r\n## Problem\r\nI was using the version **v1.4.0** and everything was fine; the files were loaded correctly and the relabeling didn't have problems.  \r\nAfter the upgrade to **v1.5.0** the relabeling for all the targets of the **first file only** (first file in alphabetical order) is not replacing the labels correctly.  \r\nThe label **remote_address** is rewritten as **<link_to_the_blackbox_exporter>** and not with the address **1.1.1.1** as it should be; in addition the relabel works only for the first 2/3 seconds after Prometheus startup. But I repeat, this bad behavior happens only for the targets of the first file; the relabeling for the other files keeps working.\r\n\r\nWhen I unify all the targets from all the files in an unique one everything works fine.  \r\nFurthermore when Prometheus loads the files, the first one is loaded immediately the others, instead, are shown in the interface only after the first scrape of a random target of the first file.\r\n\r\nThe log in debug mode doesn't give any other information.\r\n\r\nGiuseppe",
  "closed_at": "2017-02-01T19:50:09Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  },
  "comments": 10,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/2377/comments",
  "created_at": "2017-01-30T09:40:44Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/2377/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/2377",
  "id": 203962744,
  "labels": [
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/2377/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyMDM5NjI3NDQ=",
  "number": 2377,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Relabeling with multiple target files broken in 1.5.0",
  "updated_at": "2019-03-24T01:19:56Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/2377",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/17132223?v=4",
    "events_url": "https://api.github.com/users/joe-pll/events{/privacy}",
    "followers_url": "https://api.github.com/users/joe-pll/followers",
    "following_url": "https://api.github.com/users/joe-pll/following{/other_user}",
    "gists_url": "https://api.github.com/users/joe-pll/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/joe-pll",
    "id": 17132223,
    "login": "joe-pll",
    "node_id": "MDQ6VXNlcjE3MTMyMjIz",
    "organizations_url": "https://api.github.com/users/joe-pll/orgs",
    "received_events_url": "https://api.github.com/users/joe-pll/received_events",
    "repos_url": "https://api.github.com/users/joe-pll/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/joe-pll/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/joe-pll/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/joe-pll"
  }
}