{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "This is a follow-up issue to #1893.\r\n\r\nThe regular samples are appended to TSDB with an appender that is committed or rolled-back, depending on success or failure. After that, a new appender is created to append the reporting samples (`up`, `scrape_...`, etc.). The problem with this approach is that the reporting samples will become visible to the query engine a bit after the regular samples are visible.\r\n\r\nTo fix this, only one appender has to be used for both samples in the case of success. If appending the regular samples already fails for some reason, that appender has to be rolled back and a new appender has to be used for the reporting samples (which still need to be appended because `up` is now 0). If all looks successful but then the final commit for the one appender errors out, things are most likely so broken that we don't need to retry appending with just the reporting samples.",
  "closed_at": "2020-07-16T11:53:40Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/291750?v=4",
    "events_url": "https://api.github.com/users/roidelapluie/events{/privacy}",
    "followers_url": "https://api.github.com/users/roidelapluie/followers",
    "following_url": "https://api.github.com/users/roidelapluie/following{/other_user}",
    "gists_url": "https://api.github.com/users/roidelapluie/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/roidelapluie",
    "id": 291750,
    "login": "roidelapluie",
    "node_id": "MDQ6VXNlcjI5MTc1MA==",
    "organizations_url": "https://api.github.com/users/roidelapluie/orgs",
    "received_events_url": "https://api.github.com/users/roidelapluie/received_events",
    "repos_url": "https://api.github.com/users/roidelapluie/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/roidelapluie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roidelapluie/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/roidelapluie"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/6950/comments",
  "created_at": "2020-03-09T16:37:24Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/6950/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/6950",
  "id": 578038430,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "",
      "id": 664475581,
      "name": "component/scraping",
      "node_id": "MDU6TGFiZWw2NjQ0NzU1ODE=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/scraping"
    },
    {
      "color": "006b75",
      "default": true,
      "description": null,
      "id": 216836002,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWwyMTY4MzYwMDI=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/help%20wanted"
    },
    {
      "color": "bfd4f2",
      "default": false,
      "description": "",
      "id": 1574803245,
      "name": "kind/feature",
      "node_id": "MDU6TGFiZWwxNTc0ODAzMjQ1",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/feature"
    },
    {
      "color": "fbca04",
      "default": false,
      "description": null,
      "id": 365563607,
      "name": "priority/P2",
      "node_id": "MDU6TGFiZWwzNjU1NjM2MDc=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/priority/P2"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/6950/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1NzgwMzg0MzA=",
  "number": 6950,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Ingestion: Use the same appender for regular samples and reporting (`up` and friends)",
  "updated_at": "2020-07-16T11:53:40Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/6950",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/5609886?v=4",
    "events_url": "https://api.github.com/users/beorn7/events{/privacy}",
    "followers_url": "https://api.github.com/users/beorn7/followers",
    "following_url": "https://api.github.com/users/beorn7/following{/other_user}",
    "gists_url": "https://api.github.com/users/beorn7/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/beorn7",
    "id": 5609886,
    "login": "beorn7",
    "node_id": "MDQ6VXNlcjU2MDk4ODY=",
    "organizations_url": "https://api.github.com/users/beorn7/orgs",
    "received_events_url": "https://api.github.com/users/beorn7/received_events",
    "repos_url": "https://api.github.com/users/beorn7/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/beorn7/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/beorn7/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/beorn7"
  }
}