{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "## Bug Report\r\n**What did you do?**\r\nI added a file scraper using swarm-discovery that automatically generates the file from the docker API.\r\nI opened the 'Targets' page.\r\n\r\n**What did you expect to see?**\r\nTargets in a consistent order, ordered by job first, then label, as specified by https://github.com/prometheus/prometheus/pull/4898\r\n\r\n**What did you see instead? Under which circumstances?**\r\nWhen refreshing the page, the target order in the group changes. Targets for one job seem to always be ordered by instance, but they mix with the other jobs.\r\n\r\nI don't know why https://github.com/prometheus/prometheus/blob/v2.7.0/web/web.go#L698 is using the OR operation for the 2 conditions, normally one would do something like this:\r\n```\r\nif (a.L1 == a.L1)\r\n  return a.L2 < b.L2;\r\nreturn a.L1 < b.L1;\r\n```\r\n\r\n**Environment**\r\n\r\n* Prometheus version:\r\n\r\n\t2.7.0\r\n\r\n* Prometheus configuration file:\r\n```\r\nscrape_configs:\r\n  - job_name: swarm-service-endpoints\r\n    file_sd_configs:\r\n      - files:\r\n        - /etc/swarm-endpoints/swarm-endpoints.json\r\n    # node exporter + container exporter\r\n    metric_relabel_configs:\r\n    # Set the instance to the hostname\r\n    - source_labels: [__meta_swarm_node_hostname]\r\n      target_label: instance\r\n    # scrap only running tasks\r\n    - source_labels: [__meta_swarm_task_desired_state]\r\n      regex: running\r\n      action: keep\r\n    # Add a task label\r\n    - source_labels: [__meta_swarm_task_name]\r\n      target_label: task\r\n```\r\n",
  "closed_at": "2019-01-31T20:48:23Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/107980?v=4",
    "events_url": "https://api.github.com/users/martinhanzik/events{/privacy}",
    "followers_url": "https://api.github.com/users/martinhanzik/followers",
    "following_url": "https://api.github.com/users/martinhanzik/following{/other_user}",
    "gists_url": "https://api.github.com/users/martinhanzik/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/martinhanzik",
    "id": 107980,
    "login": "martinhanzik",
    "node_id": "MDQ6VXNlcjEwNzk4MA==",
    "organizations_url": "https://api.github.com/users/martinhanzik/orgs",
    "received_events_url": "https://api.github.com/users/martinhanzik/received_events",
    "repos_url": "https://api.github.com/users/martinhanzik/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/martinhanzik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/martinhanzik/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/martinhanzik"
  },
  "comments": 6,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/5155/comments",
  "created_at": "2019-01-30T11:55:42Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/5155/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/5155",
  "id": 404736294,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567222,
      "name": "component/ui",
      "node_id": "MDU6TGFiZWwzNjU1NjcyMjI=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/ui"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    },
    {
      "color": "fbca04",
      "default": false,
      "description": null,
      "id": 647013637,
      "name": "priority/P3",
      "node_id": "MDU6TGFiZWw2NDcwMTM2Mzc=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/priority/P3"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/5155/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MDQ3MzYyOTQ=",
  "number": 5155,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Ordering of targets in a group is not consistent",
  "updated_at": "2019-07-30T21:04:44Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/5155",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/107980?v=4",
    "events_url": "https://api.github.com/users/martinhanzik/events{/privacy}",
    "followers_url": "https://api.github.com/users/martinhanzik/followers",
    "following_url": "https://api.github.com/users/martinhanzik/following{/other_user}",
    "gists_url": "https://api.github.com/users/martinhanzik/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/martinhanzik",
    "id": 107980,
    "login": "martinhanzik",
    "node_id": "MDQ6VXNlcjEwNzk4MA==",
    "organizations_url": "https://api.github.com/users/martinhanzik/orgs",
    "received_events_url": "https://api.github.com/users/martinhanzik/received_events",
    "repos_url": "https://api.github.com/users/martinhanzik/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/martinhanzik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/martinhanzik/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/martinhanzik"
  }
}