{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "\r\n## Proposal\r\n**Improve the calculation used to generate the endsAt parameter sent to AlertManager?**\r\n\r\nWe have encountered AlertManager closing and re-opening alerts on multiple occasions even though Prometheus itself does not close the alert.\r\n\r\nCurrently the `endsAt` parameter sent to AlertManager defaults to a short time frame which results in AlertManager closing and then re-opening alerts if Prometheus is unable to update the alert within the time frame.\r\n\r\nThe `endsAt` parameter[ is set to 3x](https://github.com/prometheus/prometheus/blob/f678e27eb62ecf56e2b0bad82345925a4d6162a2/rules/alerting.go#L450) the greater of the `evaluation_interval` or `resend-delay` values. This results in a default maximum value 3 minutes in the future. In practice, this is often less due to the delay between evaluation and the message being sent to AlertManager.\r\n\r\nThis is fine under normal running operations. However under normal running operations, Prometheus will send [resolved] messages to AlertManager and the `endsAt` field adds little value.\r\n\r\nUnder other operational processes, such as restarting Prometheus or reloading a large configuration, these processes may start sometime after the last message was sent to AlertManager and not complete in time for Prometheus to complete it's evaluation cycle and send the next expected message to AlertManager.\r\n\r\nAdditionally, the 'rules.alert.for-grace-period' was specifically introduced to allow persisting of alert state, so the `endsAt` field should account for this too.\r\n\r\nIf this proposal is agreed, it should be a fairly easy improvement.\r\n",
  "closed_at": "2020-05-09T04:37:47Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  },
  "comments": 10,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/5277/comments",
  "created_at": "2019-02-27T02:44:05Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/5277/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/5277",
  "id": 414918166,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567376,
      "name": "component/notify",
      "node_id": "MDU6TGFiZWwzNjU1NjczNzY=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/notify"
    },
    {
      "color": "c7def8",
      "default": false,
      "description": "",
      "id": 647078166,
      "name": "kind/more-info-needed",
      "node_id": "MDU6TGFiZWw2NDcwNzgxNjY=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/more-info-needed"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/5277/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MTQ5MTgxNjY=",
  "number": 5277,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Prometheus endsAt timeout is too short",
  "updated_at": "2020-05-09T04:37:47Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/5277",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/7984750?v=4",
    "events_url": "https://api.github.com/users/steve-exley/events{/privacy}",
    "followers_url": "https://api.github.com/users/steve-exley/followers",
    "following_url": "https://api.github.com/users/steve-exley/following{/other_user}",
    "gists_url": "https://api.github.com/users/steve-exley/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/steve-exley",
    "id": 7984750,
    "login": "steve-exley",
    "node_id": "MDQ6VXNlcjc5ODQ3NTA=",
    "organizations_url": "https://api.github.com/users/steve-exley/orgs",
    "received_events_url": "https://api.github.com/users/steve-exley/received_events",
    "repos_url": "https://api.github.com/users/steve-exley/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/steve-exley/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/steve-exley/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/steve-exley"
  }
}