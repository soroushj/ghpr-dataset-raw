{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "I'm using prometheus with remote storage of openTSDB, but prometheus failed to send metrics.\n\nprometheus version 1.2.0\nopenTSDB version 2.2.0\n\nprometheus log:\n\n```\ntime=\"2016-10-11T07:43:46Z\" level=warning msg=\"error sending 100 samples to remote storage: Post http://opentsdb-1.default.svc:4242/api/put: read tcp 192.168.75.6:32806->192.168.71.7:4242: i/o timeout\" source=\"queue_manager.go:246\" \ntime=\"2016-10-11T07:43:46Z\" level=warning msg=\"error sending 100 samples to remote storage: Post http://opentsdb-1.default.svc:4242/api/put: read tcp 192.168.75.6:32807->192.168.71.7:4242: i/o timeout\" source=\"queue_manager.go:246\" \ntime=\"2016-10-11T07:43:46Z\" level=warning msg=\"error sending 100 samples to remote storage: Post http://opentsdb-1.default.svc:4242/api/put: read tcp 192.168.75.6:32808->192.168.71.7:4242: i/o timeout\" source=\"queue_manager.go:246\" \ntime=\"2016-10-11T07:43:46Z\" level=warning msg=\"error sending 100 samples to remote storage: Post http://opentsdb-1.default.svc:4242/api/put: read tcp 192.168.75.6:32809->192.168.71.7:4242: i/o timeout\" source=\"queue_manager.go:246\"\ntime=\"2016-10-11T07:43:48Z\" level=warning msg=\"cannot send value NaN to OpenTSDB, skipping sample &model.Sample{Metric:model.Metric{\\\"operation_type\\\":\\\"runContainerInPod\\\", \\\"quantile\\\":\\\"0.5\\\", \\\"__name__\\\":\\\"kubelet_container_manager_latency_microseconds\\\", \\\"job\\\":\\\"kubernetes-nodes\\\", \\\"beta_kubernetes_io_os\\\":\\\"linux\\\", \\\"kubernetes_io_hostname\\\":\\\"kube-node-1\\\", \\\"beta_kubernetes_io_arch\\\":\\\"amd64\\\", \\\"instance\\\":\\\"kube-node-1\\\"}, Value:NaN, Timestamp:1476171826102}\" source=\"client.go:79\"\n```\n\nopenTSDB log:\n\n```\n2016-10-11 07:43:46,756 INFO  [OpenTSDB I/O Worker #3] ConnectionManager: [id: 0x8512e244, /192.168.75.6:32803 :> /192.168.71.7:4242] CLOSED\n2016-10-11 07:43:46,915 INFO  [OpenTSDB I/O Boss #1] ConnectionManager: [id: 0x17ba8b25, /192.168.75.6:32806 => /192.168.71.7:4242] OPEN\n2016-10-11 07:43:46,915 INFO  [OpenTSDB I/O Boss #1] ConnectionManager: [id: 0x2c9fbab5, /192.168.75.6:32807 => /192.168.71.7:4242] OPEN\n2016-10-11 07:43:46,915 INFO  [OpenTSDB I/O Worker #5] ConnectionManager: [id: 0x17ba8b25, /192.168.75.6:32806 => /192.168.71.7:4242] BOUND: /192.168.71.7:4242\n2016-10-11 07:43:46,916 INFO  [OpenTSDB I/O Worker #5] ConnectionManager: [id: 0x17ba8b25, /192.168.75.6:32806 => /192.168.71.7:4242] CONNECTED: /192.168.75.6:32806\n2016-10-11 07:43:46,917 INFO  [OpenTSDB I/O Worker #7] ConnectionManager: [id: 0x2c9fbab5, /192.168.75.6:32807 => /192.168.71.7:4242] BOUND: /192.168.71.7:4242\n2016-10-11 07:43:46,920 INFO  [OpenTSDB I/O Worker #5] ConnectionManager: [id: 0x17ba8b25, /192.168.75.6:32806 :> /192.168.71.7:4242] DISCONNECTED\n2016-10-11 07:43:46,929 INFO  [OpenTSDB I/O Worker #7] ConnectionManager: [id: 0x2c9fbab5, /192.168.75.6:32807 => /192.168.71.7:4242] CONNECTED: /192.168.75.6:32807\n2016-10-11 07:43:46,932 INFO  [OpenTSDB I/O Worker #7] ConnectionManager: [id: 0x2c9fbab5, /192.168.75.6:32807 :> /192.168.71.7:4242] DISCONNECTED\n2016-10-11 07:43:46,933 INFO  [OpenTSDB I/O Worker #7] ConnectionManager: [id: 0x2c9fbab5, /192.168.75.6:32807 :> /192.168.71.7:4242] UNBOUND\n2016-10-11 07:43:46,935 INFO  [OpenTSDB I/O Worker #7] ConnectionManager: [id: 0x2c9fbab5, /192.168.75.6:32807 :> /192.168.71.7:4242] CLOSED\n2016-10-11 07:43:46,936 INFO  [OpenTSDB I/O Worker #5] ConnectionManager: [id: 0x17ba8b25, /192.168.75.6:32806 :> /192.168.71.7:4242] UNBOUND\n2016-10-11 07:43:46,937 INFO  [OpenTSDB I/O Worker #5] ConnectionManager: [id: 0x17ba8b25, /192.168.75.6:32806 :> /192.168.71.7:4242] CLOSED\n2016-10-11 07:43:46,956 INFO  [OpenTSDB I/O Boss #1] ConnectionManager: [id: 0x4175e3a6, /192.168.75.6:32808 => /192.168.71.7:4242] OPEN\n2016-10-11 07:43:46,962 INFO  [OpenTSDB I/O Boss #1] ConnectionManager: [id: 0xe9fc750b, /192.168.75.6:32809 => /192.168.71.7:4242] OPEN\n2016-10-11 07:43:46,964 INFO  [OpenTSDB I/O Worker #11] ConnectionManager: [id: 0xe9fc750b, /192.168.75.6:32809 => /192.168.71.7:4242] BOUND: /192.168.71.7:4242\n2016-10-11 07:43:46,964 INFO  [OpenTSDB I/O Worker #11] ConnectionManager: [id: 0xe9fc750b, /192.168.75.6:32809 => /192.168.71.7:4242] CONNECTED: /192.168.75.6:32809\n2016-10-11 07:43:46,962 INFO  [OpenTSDB I/O Worker #6] ConnectionManager: [id: 0x4175e3a6, /192.168.75.6:32808 => /192.168.71.7:4242] BOUND: /192.168.71.7:4242\n2016-10-11 07:43:46,968 INFO  [OpenTSDB I/O Worker #6] ConnectionManager: [id: 0x4175e3a6, /192.168.75.6:32808 => /192.168.71.7:4242] CONNECTED: /192.168.75.6:32808\n2016-10-11 07:43:46,973 INFO  [OpenTSDB I/O Worker #11] ConnectionManager: [id: 0xe9fc750b, /192.168.75.6:32809 :> /192.168.71.7:4242] DISCONNECTED\n2016-10-11 07:43:46,974 INFO  [OpenTSDB I/O Worker #11] ConnectionManager: [id: 0xe9fc750b, /192.168.75.6:32809 :> /192.168.71.7:4242] UNBOUND\n2016-10-11 07:43:46,980 INFO  [OpenTSDB I/O Worker #11] ConnectionManager: [id: 0xe9fc750b, /192.168.75.6:32809 :> /192.168.71.7:4242] CLOSED\n2016-10-11 07:43:46,980 INFO  [OpenTSDB I/O Worker #6] ConnectionManager: [id: 0x4175e3a6, /192.168.75.6:32808 :> /192.168.71.7:4242] DISCONNECTED\n2016-10-11 07:43:46,998 INFO  [OpenTSDB I/O Worker #6] ConnectionManager: [id: 0x4175e3a6, /192.168.75.6:32808 :> /192.168.71.7:4242] UNBOUND\n2016-10-11 07:43:46,998 INFO  [OpenTSDB I/O Worker #6] ConnectionManager: [id: 0x4175e3a6, /192.168.75.6:32808 :> /192.168.71.7:4242] CLOSED\n2016-10-11 07:43:49,000 INFO  [OpenTSDB I/O Boss #1] ConnectionManager: [id: 0xd43b2356, /192.168.75.6:32812 => /192.168.71.7:4242] OPEN\n2016-10-11 07:43:49,002 INFO  [OpenTSDB I/O Boss #1] ConnectionManager: [id: 0xa163f990, /192.168.75.6:32813 => /192.168.71.7:4242] OPEN\n```\n\nComparing the date time of the log, the two parts of log is corresponding. openTSDB said the connection was closed shortly after connection open, but prometheus said it was timed out...\n\nThey all running in k8s. But my partner @harryge00 reproduced this problem locally on his PC.\n",
  "closed_at": "2016-10-26T13:47:48Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  },
  "comments": 7,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/2075/comments",
  "created_at": "2016-10-11T10:58:40Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/2075/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/2075",
  "id": 182234539,
  "labels": [
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/2075/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxODIyMzQ1Mzk=",
  "number": 2075,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Prometheus failed sending data to openTSDB",
  "updated_at": "2019-03-23T13:45:53Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/2075",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1191377?v=4",
    "events_url": "https://api.github.com/users/reAsOn2010/events{/privacy}",
    "followers_url": "https://api.github.com/users/reAsOn2010/followers",
    "following_url": "https://api.github.com/users/reAsOn2010/following{/other_user}",
    "gists_url": "https://api.github.com/users/reAsOn2010/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/reAsOn2010",
    "id": 1191377,
    "login": "reAsOn2010",
    "node_id": "MDQ6VXNlcjExOTEzNzc=",
    "organizations_url": "https://api.github.com/users/reAsOn2010/orgs",
    "received_events_url": "https://api.github.com/users/reAsOn2010/received_events",
    "repos_url": "https://api.github.com/users/reAsOn2010/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/reAsOn2010/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/reAsOn2010/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/reAsOn2010"
  }
}