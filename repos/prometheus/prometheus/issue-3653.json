{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**What did you do?**\r\n\r\nI ran the latest build from master, and it paniced.\r\n\r\n**What did you expect to see?**\r\n\r\nHappy Prometheus.\r\n\r\n**What did you see instead? Under which circumstances?**\r\n\r\n```\r\nlevel=info ts=2018-01-04T12:34:30.797481431Z caller=main.go:221 msg=\"Starting Prometheus\" version=\"(version=2.0.0, branch=master, revision=ec94df49d45baa8e680d81e732294eb04fff00de)\"\r\nlevel=info ts=2018-01-04T12:34:30.797587605Z caller=main.go:222 build_context=\"(go=go1.9.2, user=root@1885792ecf46, date=20171229-20:03:34)\"\r\nlevel=info ts=2018-01-04T12:34:30.797618333Z caller=main.go:223 host_details=\"(Linux 4.4.64+ #1 SMP Wed Aug 30 20:27:36 PDT 2017 x86_64 weave-cortex-agent-1352299515-q9b40 (none))\"\r\nlevel=info ts=2018-01-04T12:34:30.797643323Z caller=main.go:224 fd_limits=\"(soft=1048576, hard=1048576)\"\r\nlevel=info ts=2018-01-04T12:34:30.802483848Z caller=manager.go:58 component=\"scrape manager\" msg=\"Starting scrape manager...\"\r\nlevel=info ts=2018-01-04T12:34:30.802561868Z caller=main.go:434 msg=\"Starting TSDB ...\"\r\nlevel=info ts=2018-01-04T12:34:30.806440473Z caller=web.go:383 component=web msg=\"Start listening for connections\" address=:8080\r\nlevel=info ts=2018-01-04T12:34:30.812878794Z caller=main.go:444 msg=\"TSDB started\"\r\nlevel=info ts=2018-01-04T12:34:30.812978586Z caller=main.go:511 msg=\"Loading configuration file\" filename=/etc/prometheus/prometheus.yml\r\nlevel=info ts=2018-01-04T12:34:30.814840891Z caller=kubernetes.go:191 component=\"discovery manager\" discovery=k8s msg=\"Using pod service account via in-cluster config\"\r\nlevel=info ts=2018-01-04T12:34:30.816859216Z caller=kubernetes.go:191 component=\"discovery manager\" discovery=k8s msg=\"Using pod service account via in-cluster config\"\r\nlevel=info ts=2018-01-04T12:34:30.817553956Z caller=kubernetes.go:191 component=\"discovery manager\" discovery=k8s msg=\"Using pod service account via in-cluster config\"\r\nlevel=info ts=2018-01-04T12:34:30.818090353Z caller=kubernetes.go:191 component=\"discovery manager\" discovery=k8s msg=\"Using pod service account via in-cluster config\"\r\nlevel=info ts=2018-01-04T12:34:30.81978125Z caller=kubernetes.go:191 component=\"discovery manager\" discovery=k8s msg=\"Using pod service account via in-cluster config\"\r\nlevel=info ts=2018-01-04T12:34:30.821172572Z caller=main.go:421 msg=\"Server is ready to receive requests.\"\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0x155d32a]\r\n\r\ngoroutine 123 [running]:\r\ngithub.com/prometheus/prometheus/discovery.(*Manager).allGroups.func1(0x29062c0, 0xc420402c00)\r\n\t/go/src/github.com/prometheus/prometheus/discovery/manager.go:188 +0x28a\r\ngithub.com/prometheus/prometheus/discovery.(*Manager).Run(0xc4203a9700, 0x29062c0, 0xc420402c00, 0x0, 0x0)\r\n\t/go/src/github.com/prometheus/prometheus/discovery/manager.go:96 +0x54\r\nmain.main.func5(0x0, 0x0)\r\n\t/go/src/github.com/prometheus/prometheus/cmd/prometheus/main.go:338 +0x52\r\ngithub.com/prometheus/prometheus/vendor/github.com/oklog/oklog/pkg/group.(*Group).Run.func1(0xc420052240, 0xc42047fb60, 0xc4204424c0)\r\n\t/go/src/github.com/prometheus/prometheus/vendor/github.com/oklog/oklog/pkg/group/group.go:38 +0x27\r\ncreated by github.com/prometheus/prometheus/vendor/github.com/oklog/oklog/pkg/group.(*Group).Run\r\n\t/go/src/github.com/prometheus/prometheus/vendor/github.com/oklog/oklog/pkg/group/group.go:37 +0xa8\r\n```\r\n\r\n**Environment**\r\n\r\nKubernetes 1.7 on GKE.\r\n\r\n* Prometheus version:\r\n\r\n```\r\n> docker run prom/prometheus@sha256:6050e90c156d4e6be31a23e87b53673b2a2d2ab5b71677225555675b43a1b445 --version                 \r\nprometheus, version 2.0.0 (branch: master, revision: ec94df49d45baa8e680d81e732294eb04fff00de)\r\n  build user:       root@1885792ecf46\r\n  build date:       20171229-20:03:34\r\n  go version:       go1.9.2\r\n```\r\n\r\n* Prometheus configuration file:\r\n```\r\n        global:\r\n          scrape_interval: 5s\r\n        remote_write:\r\n          - url: 'https://cloud.weave.works./api/prom/push'\r\n            basic_auth:\r\n              password: <snip>\r\n        remote_read:\r\n          - url: 'https://cloud.weave.works./api/prom/read'\r\n            basic_auth:\r\n              password: <snip>\r\n        scrape_configs:\r\n          - job_name: kubernetes-apiservers\r\n            kubernetes_sd_configs:\r\n              - role: endpoints\r\n            scheme: https\r\n            tls_config:\r\n              ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\r\n            bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\r\n            relabel_configs:\r\n              - source_labels:\r\n                  - __meta_kubernetes_namespace\r\n                  - __meta_kubernetes_service_name\r\n                  - __meta_kubernetes_endpoint_port_name\r\n                action: keep\r\n                regex: default;kubernetes;https\r\n              - source_labels:\r\n                  - __meta_kubernetes_namespace\r\n                target_label: _weave_namespace\r\n              - source_labels:\r\n                  - __meta_kubernetes_endpoints_name\r\n                target_label: _weave_service\r\n          - job_name: kubernetes-pods\r\n            kubernetes_sd_configs:\r\n              - role: pod\r\n            relabel_configs:\r\n              - source_labels:\r\n                  - __meta_kubernetes_pod_annotation_prometheus_io_scrape\r\n                action: drop\r\n                regex: 'false'\r\n              - source_labels:\r\n                  - __meta_kubernetes_pod_annotation_prometheus_io_scheme\r\n                action: replace\r\n                target_label: __scheme__\r\n                regex: ^(https?)$\r\n                replacement: $1\r\n              - source_labels:\r\n                  - __meta_kubernetes_pod_annotation_prometheus_io_path\r\n                action: replace\r\n                target_label: __metrics_path__\r\n                regex: ^(.+)$\r\n                replacement: $1\r\n              - source_labels:\r\n                  - __address__\r\n                  - __meta_kubernetes_pod_annotation_prometheus_io_port\r\n                action: replace\r\n                target_label: __address__\r\n                regex: '([^:]+)(?::\\d+)?;(\\d+)'\r\n                replacement: '$1:$2'\r\n              - source_labels:\r\n                  - __meta_kubernetes_namespace\r\n                target_label: _weave_namespace\r\n              - source_labels:\r\n                  - __meta_kubernetes_pod_name\r\n                  - __meta_kubernetes_pod_node_name\r\n                target_label: node\r\n                regex: ^weave-cortex-node-exporter-.+;(.+)$\r\n                replacement: $1\r\n              - source_labels:\r\n                  - _weave_service\r\n                  - __meta_kubernetes_pod_name\r\n                target_label: _weave_service\r\n                regex: '^;(kube-.*)-(?:ip|gke)-.*$'\r\n                replacement: $1\r\n              - source_labels:\r\n                  - _weave_service\r\n                  - __meta_kubernetes_pod_name\r\n                target_label: _weave_service\r\n                regex: '^;(.*?)(?:(?:-[0-9bcdf]+)?-[0-9a-z]{5})?$'\r\n                replacement: $1\r\n              - source_labels:\r\n                  - _weave_service\r\n                  - __meta_kubernetes_pod_name\r\n                regex: ^;(.+)$\r\n                target_label: _weave_service\r\n                replacement: $1\r\n          - job_name: kubernetes-nodes\r\n            kubernetes_sd_configs:\r\n              - role: node\r\n            tls_config:\r\n              insecure_skip_verify: true\r\n            bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\r\n            relabel_configs:\r\n              - target_label: __scheme__\r\n                replacement: https\r\n              - target_label: __address__\r\n                replacement: 'kubernetes.default.svc:443'\r\n              - source_labels:\r\n                  - __meta_kubernetes_node_name\r\n                regex: (.+)\r\n                target_label: __metrics_path__\r\n                replacement: '/api/v1/nodes/${1}/proxy/metrics'\r\n              - target_label: _weave_namespace\r\n                replacement: default\r\n              - target_label: _weave_service\r\n                replacement: kubelet\r\n          - job_name: weave-net\r\n            kubernetes_sd_configs:\r\n              - role: pod\r\n            relabel_configs:\r\n              - source_labels:\r\n                  - __meta_kubernetes_namespace\r\n                  - __meta_kubernetes_pod_label_name\r\n                action: keep\r\n                regex: ^kube-system;weave-net$\r\n              - source_labels:\r\n                  - __meta_kubernetes_pod_container_name\r\n                  - __address__\r\n                action: replace\r\n                target_label: __address__\r\n                regex: '^weave;(.+?)(?::\\d+)?$'\r\n                replacement: '$1:6782'\r\n              - source_labels:\r\n                  - __meta_kubernetes_pod_container_name\r\n                  - __address__\r\n                action: replace\r\n                target_label: __address__\r\n                regex: '^weave-npc;(.+?)(?::\\d+)?$'\r\n                replacement: '$1:6781'\r\n              - source_labels:\r\n                  - __meta_kubernetes_namespace\r\n                target_label: _weave_namespace\r\n              - target_label: _weave_service\r\n                replacement: weave-net\r\n          - job_name: cadvisor\r\n            kubernetes_sd_configs:\r\n              - role: node\r\n            tls_config:\r\n              insecure_skip_verify: true\r\n            bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\r\n            scheme: https\r\n            relabel_configs:\r\n              - target_label: __address__\r\n                replacement: 'kubernetes.default.svc:443'\r\n              - source_labels:\r\n                  - __meta_kubernetes_node_name\r\n                regex: (.+)\r\n                target_label: __metrics_path__\r\n                replacement: '/api/v1/nodes/${1}/proxy/metrics/cadvisor'\r\n              - target_label: _weave_namespace\r\n                replacement: default\r\n              - target_label: _weave_service\r\n                replacement: cadvisor\r\n            metric_relabel_configs:\r\n              - source_labels:\r\n                  - _weave_pod_name\r\n                  - pod_name\r\n                target_label: _weave_pod_name\r\n                regex: '^;(kube-.*)-(?:ip|gke)-.*$'\r\n                replacement: $1\r\n              - source_labels:\r\n                  - _weave_pod_name\r\n                  - pod_name\r\n                target_label: _weave_pod_name\r\n                regex: '^;(.*?)(?:(?:-[0-9bcdf]+)?-[0-9a-z]{5})?$'\r\n                replacement: $1\r\n              - source_labels:\r\n                  - _weave_pod_name\r\n                  - pod_name\r\n                regex: ^;(.+)$\r\n                target_label: _weave_pod_name\r\n                replacement: $1\r\n```",
  "closed_at": "2018-01-15T13:23:23Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7354143?v=4",
    "events_url": "https://api.github.com/users/gouthamve/events{/privacy}",
    "followers_url": "https://api.github.com/users/gouthamve/followers",
    "following_url": "https://api.github.com/users/gouthamve/following{/other_user}",
    "gists_url": "https://api.github.com/users/gouthamve/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/gouthamve",
    "id": 7354143,
    "login": "gouthamve",
    "node_id": "MDQ6VXNlcjczNTQxNDM=",
    "organizations_url": "https://api.github.com/users/gouthamve/orgs",
    "received_events_url": "https://api.github.com/users/gouthamve/received_events",
    "repos_url": "https://api.github.com/users/gouthamve/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/gouthamve/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gouthamve/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/gouthamve"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/3653/comments",
  "created_at": "2018-01-04T12:56:21Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/3653/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/3653",
  "id": 285977709,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567641,
      "name": "component/service discovery",
      "node_id": "MDU6TGFiZWwzNjU1Njc2NDE=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/service%20discovery"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/3653/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyODU5Nzc3MDk=",
  "number": 3653,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "invalid memory address or nil pointer dereference",
  "updated_at": "2019-04-17T22:06:24Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/3653",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/251467?v=4",
    "events_url": "https://api.github.com/users/errordeveloper/events{/privacy}",
    "followers_url": "https://api.github.com/users/errordeveloper/followers",
    "following_url": "https://api.github.com/users/errordeveloper/following{/other_user}",
    "gists_url": "https://api.github.com/users/errordeveloper/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/errordeveloper",
    "id": 251467,
    "login": "errordeveloper",
    "node_id": "MDQ6VXNlcjI1MTQ2Nw==",
    "organizations_url": "https://api.github.com/users/errordeveloper/orgs",
    "received_events_url": "https://api.github.com/users/errordeveloper/received_events",
    "repos_url": "https://api.github.com/users/errordeveloper/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/errordeveloper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/errordeveloper/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/errordeveloper"
  }
}