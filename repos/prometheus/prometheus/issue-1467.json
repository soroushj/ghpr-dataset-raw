{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "The \"Scraped samples did not match served metrics\" test in scrape_test.go is flaky:\n\n```\n$ make test\n>> running tests\nok      github.com/prometheus/prometheus/cmd/prometheus 0.030s\n?       github.com/prometheus/prometheus/cmd/promtool   [no test files]\nok      github.com/prometheus/prometheus/config 0.012s\nok      github.com/prometheus/prometheus/notifier   0.021s\nok      github.com/prometheus/prometheus/promql 0.764s\n--- FAIL: TestTargetScraperScrapeOK (0.00s)\n    scrape_test.go:474: Scraped samples did not match served metrics\n    scrape_test.go:475: Expected: [metric_a => 1 @[1457378821.545] metric_b => 2 @[1457378821.545]]\n    scrape_test.go:476: Got: [metric_b => 2 @[1457378821.545] metric_a => 1 @[1457378821.545]]\nFAIL\nFAIL    github.com/prometheus/prometheus/retrieval  3.624s\nok      github.com/prometheus/prometheus/retrieval/discovery    0.066s\n?       github.com/prometheus/prometheus/retrieval/discovery/kubernetes [no test files]\n?       github.com/prometheus/prometheus/retrieval/discovery/marathon   [no test files]\nok      github.com/prometheus/prometheus/rules  0.053s\n?       github.com/prometheus/prometheus/storage    [no test files]\nok      github.com/prometheus/prometheus/storage/local  4.733s\nok      github.com/prometheus/prometheus/storage/local/codable  0.002s\n?       github.com/prometheus/prometheus/storage/local/index    [no test files]\n?       github.com/prometheus/prometheus/storage/local/storagetool  [no test files]\nok      github.com/prometheus/prometheus/storage/metric 0.002s\nok      github.com/prometheus/prometheus/storage/remote 0.005s\nok      github.com/prometheus/prometheus/storage/remote/graphite    0.002s\nok      github.com/prometheus/prometheus/storage/remote/influxdb    0.006s\nok      github.com/prometheus/prometheus/storage/remote/opentsdb    0.014s\nok      github.com/prometheus/prometheus/template   0.043s\n?       github.com/prometheus/prometheus/util/cli   [no test files]\nok      github.com/prometheus/prometheus/util/flock 0.002s\n?       github.com/prometheus/prometheus/util/httputil  [no test files]\n?       github.com/prometheus/prometheus/util/stats [no test files]\nok      github.com/prometheus/prometheus/util/strutil   0.001s\n?       github.com/prometheus/prometheus/util/testutil  [no test files]\n?       github.com/prometheus/prometheus/util/treecache [no test files]\n?       github.com/prometheus/prometheus/version    [no test files]\nok      github.com/prometheus/prometheus/web    0.005s\nok      github.com/prometheus/prometheus/web/api/legacy 0.048s\nok      github.com/prometheus/prometheus/web/api/v1 0.040s\n?       github.com/prometheus/prometheus/web/ui [no test files]\nMakefile:29: recipe for target 'test' failed\nmake: *** [test] Error 1\n\n$ make test\n>> running tests\nok      github.com/prometheus/prometheus/cmd/prometheus 0.009s\n?       github.com/prometheus/prometheus/cmd/promtool   [no test files]\nok      github.com/prometheus/prometheus/config 0.005s\nok      github.com/prometheus/prometheus/notifier   0.034s\nok      github.com/prometheus/prometheus/promql 0.791s\nok      github.com/prometheus/prometheus/retrieval  3.694s\nok      github.com/prometheus/prometheus/retrieval/discovery    0.066s\n?       github.com/prometheus/prometheus/retrieval/discovery/kubernetes [no test files]\n?       github.com/prometheus/prometheus/retrieval/discovery/marathon   [no test files]\nok      github.com/prometheus/prometheus/rules  0.047s\n?       github.com/prometheus/prometheus/storage    [no test files]\nok      github.com/prometheus/prometheus/storage/local  4.179s\nok      github.com/prometheus/prometheus/storage/local/codable  0.005s\n?       github.com/prometheus/prometheus/storage/local/index    [no test files]\n?       github.com/prometheus/prometheus/storage/local/storagetool  [no test files]\nok      github.com/prometheus/prometheus/storage/metric 0.009s\nok      github.com/prometheus/prometheus/storage/remote 0.005s\nok      github.com/prometheus/prometheus/storage/remote/graphite    0.004s\nok      github.com/prometheus/prometheus/storage/remote/influxdb    0.015s\nok      github.com/prometheus/prometheus/storage/remote/opentsdb    0.004s\nok      github.com/prometheus/prometheus/template   0.055s\n?       github.com/prometheus/prometheus/util/cli   [no test files]\nok      github.com/prometheus/prometheus/util/flock 0.002s\n?       github.com/prometheus/prometheus/util/httputil  [no test files]\n?       github.com/prometheus/prometheus/util/stats [no test files]\nok      github.com/prometheus/prometheus/util/strutil   0.001s\n?       github.com/prometheus/prometheus/util/testutil  [no test files]\n?       github.com/prometheus/prometheus/util/treecache [no test files]\n?       github.com/prometheus/prometheus/version    [no test files]\nok      github.com/prometheus/prometheus/web    0.005s\nok      github.com/prometheus/prometheus/web/api/legacy 0.064s\nok      github.com/prometheus/prometheus/web/api/v1 0.033s\n?       github.com/prometheus/prometheus/web/ui [no test files]\n```\n\nReproduce with:\n\n```\n$ TEMP=`mktemp`; N=0; until make test 2>&1 | tee $TEMP | grep -q FAIL; do N=$(($N+1)); done; echo \"Failure after $N successes\"; cat $TEMP; rm -f $TEMP\nFailure after 2 successes\n>> running tests\nok      github.com/prometheus/prometheus/cmd/prometheus 0.014s\n?       github.com/prometheus/prometheus/cmd/promtool   [no test files]\nok      github.com/prometheus/prometheus/config 0.011s\nok      github.com/prometheus/prometheus/notifier   0.034s\nok      github.com/prometheus/prometheus/promql 0.780s\n--- FAIL: TestTargetScraperScrapeOK (0.00s)\n    scrape_test.go:474: Scraped samples did not match served metrics\n    scrape_test.go:475: Expected: [metric_a => 1 @[1457380428.348] metric_b => 2 @[1457380428.348]]\n    scrape_test.go:476: Got: [metric_b => 2 @[1457380428.348] metric_a => 1 @[1457380428.348]]\nFAIL\nFAIL    github.com/prometheus/prometheus/retrieval  3.696s\nok      github.com/prometheus/prometheus/retrieval/discovery    0.065s\n?       github.com/prometheus/prometheus/retrieval/discovery/kubernetes [no test files]\n?       github.com/prometheus/prometheus/retrieval/discovery/marathon   [no test files]\nok      github.com/prometheus/prometheus/rules  0.059s\n?       github.com/prometheus/prometheus/storage    [no test files]\n```\n",
  "closed_at": "2016-03-09T15:36:39Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/4948210?v=4",
    "events_url": "https://api.github.com/users/fabxc/events{/privacy}",
    "followers_url": "https://api.github.com/users/fabxc/followers",
    "following_url": "https://api.github.com/users/fabxc/following{/other_user}",
    "gists_url": "https://api.github.com/users/fabxc/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/fabxc",
    "id": 4948210,
    "login": "fabxc",
    "node_id": "MDQ6VXNlcjQ5NDgyMTA=",
    "organizations_url": "https://api.github.com/users/fabxc/orgs",
    "received_events_url": "https://api.github.com/users/fabxc/received_events",
    "repos_url": "https://api.github.com/users/fabxc/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/fabxc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fabxc/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/fabxc"
  },
  "comments": 2,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/1467/comments",
  "created_at": "2016-03-07T19:56:34Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/1467/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/1467",
  "id": 139077196,
  "labels": [],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/1467/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUxMzkwNzcxOTY=",
  "number": 1467,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Flaky test in scrape_test.go",
  "updated_at": "2019-03-24T12:28:36Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/1467",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/321591?v=4",
    "events_url": "https://api.github.com/users/pdbogen/events{/privacy}",
    "followers_url": "https://api.github.com/users/pdbogen/followers",
    "following_url": "https://api.github.com/users/pdbogen/following{/other_user}",
    "gists_url": "https://api.github.com/users/pdbogen/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/pdbogen",
    "id": 321591,
    "login": "pdbogen",
    "node_id": "MDQ6VXNlcjMyMTU5MQ==",
    "organizations_url": "https://api.github.com/users/pdbogen/orgs",
    "received_events_url": "https://api.github.com/users/pdbogen/received_events",
    "repos_url": "https://api.github.com/users/pdbogen/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/pdbogen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pdbogen/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/pdbogen"
  }
}