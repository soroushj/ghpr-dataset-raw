{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "## Bug Report\r\n**What did you do?**\r\nAttempted to use bearer_token_file in stead of plaintext bearer_token in kubernetes_sd_configs\r\n\r\n**What did you expect to see?**\r\nAuthorized http calls\r\n\r\n**What did you see instead? Under which circumstances?**\r\nnet/http: invalid header field value \\\"Bearer *******************\\\\n\\\" for key Authorization\r\n\r\nIn kubernetes_sd_configs only:\r\n* if bearer_token_file set, loads data, but throws errors (see logs below). It looks like there is a newline character added even though the file does not contain one.\r\n\r\n**Environment**\r\n\r\n* System information:\r\nLinux 4.15.0-45-generic x86_64\r\n\r\n* Prometheus version:\r\nprometheus, version 2.7.1 (branch: HEAD, revision: 62e591f928ddf6b3468308b7ac1de1c63aa7fcf3)\r\n  build user:       root@f9f82868fc43\r\n  build date:       20190131-11:16:59\r\n  go version:       go1.11.5\r\n\r\n* Prometheus configuration file:\r\n```\r\n# Global Prometheus Configuration\r\nglobal:\r\n  scrape_interval: 30s     # By default, scrape targets every 30 seconds.\r\n  evaluation_interval: 30s # By default, scrape targets every 30 seconds.\r\n\r\nscrape_configs:\r\n\r\n- job_name: kubernetes-apiservers-pre\r\n  kubernetes_sd_configs:\r\n  - role: endpoints\r\n    api_server: https://**********:443\r\n    tls_config:\r\n      insecure_skip_verify: true\r\n      bearer_token_file: /var/run/secrets/prometheus/pre\r\n  scheme: https\r\n  tls_config:\r\n    insecure_skip_verify: true\r\n  bearer_token_file: /var/run/secrets/prometheus/pre\r\n  relabel_configs:\r\n  - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]\r\n    action: keep\r\n    regex: default;kubernetes;https\r\n```\r\n\r\n* Logs:\r\n```\r\nprometheus_1         | level=error ts=2019-02-14T16:40:10.193074594Z caller=klog.go:94 component=k8s_client_runtime func=ErrorDepth msg=\"github.com/prometheus/prometheus/discovery/kubernetes/kubernetes.go:306: Failed to list *v1.Endpoints: Get https://*********:443/api/v1/endpoints?limit=500&resourceVersion=0: net/http: invalid header field value \\\"Bearer *******************\\\\n\\\" for key Authorization\"\r\nprometheus_1         | level=debug ts=2019-02-14T16:40:10.19404676Z caller=klog.go:53 component=k8s_client_runtime func=Verbose.Infof msg=\"Listing and watching *v1.Service from github.com/prometheus/prometheus/discovery/kubernetes/kubernetes.go:307\"\r\nprometheus_1         | level=debug ts=2019-02-14T16:40:10.194199661Z caller=klog.go:70 component=k8s_client_runtime func=Infof msg=\"GET https://*********:443/api/v1/services?limit=500&resourceVersion=0  in 0 milliseconds\"\r\n\r\n```\r\n",
  "closed_at": "2019-02-20T10:22:35Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/2587585?v=4",
    "events_url": "https://api.github.com/users/simonpasquier/events{/privacy}",
    "followers_url": "https://api.github.com/users/simonpasquier/followers",
    "following_url": "https://api.github.com/users/simonpasquier/following{/other_user}",
    "gists_url": "https://api.github.com/users/simonpasquier/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/simonpasquier",
    "id": 2587585,
    "login": "simonpasquier",
    "node_id": "MDQ6VXNlcjI1ODc1ODU=",
    "organizations_url": "https://api.github.com/users/simonpasquier/orgs",
    "received_events_url": "https://api.github.com/users/simonpasquier/received_events",
    "repos_url": "https://api.github.com/users/simonpasquier/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/simonpasquier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simonpasquier/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/simonpasquier"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/5221/comments",
  "created_at": "2019-02-14T17:17:11Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/5221/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/5221",
  "id": 410405851,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567641,
      "name": "component/service discovery",
      "node_id": "MDU6TGFiZWwzNjU1Njc2NDE=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/service%20discovery"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/5221/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MTA0MDU4NTE=",
  "number": 5221,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "bearer_token_file option not working in kubernetes_sd_configs",
  "updated_at": "2019-08-19T11:04:46Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/5221",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/6523434?v=4",
    "events_url": "https://api.github.com/users/drewboswell/events{/privacy}",
    "followers_url": "https://api.github.com/users/drewboswell/followers",
    "following_url": "https://api.github.com/users/drewboswell/following{/other_user}",
    "gists_url": "https://api.github.com/users/drewboswell/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/drewboswell",
    "id": 6523434,
    "login": "drewboswell",
    "node_id": "MDQ6VXNlcjY1MjM0MzQ=",
    "organizations_url": "https://api.github.com/users/drewboswell/orgs",
    "received_events_url": "https://api.github.com/users/drewboswell/received_events",
    "repos_url": "https://api.github.com/users/drewboswell/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/drewboswell/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/drewboswell/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/drewboswell"
  }
}