{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "## Bug Report\r\n**What did you do?**\r\nNot sure if proposal of bug report but when recording rule expression results to multiple series with different values and has the `labels` section specified which will cause the two series having exact same labels. This results to recorded serie which will have randomly value of one of those values because of random ordering.\r\n\r\nSimple example:\r\n```yaml\r\n groups:\r\n     - name: \"test\"\r\n       interval: \"1s\"\r\n       rules:\r\n         - record: test_metric\r\n           expr: \"0\"\r\n           labels:\r\n               label: \"value\"\r\n         - record: \"test_metric\"\r\n           expr: \"1\"\r\n         - record: \"result\"\r\n           expr: \"max(test_metric) by (label)\"\r\n           labels:\r\n               label: \"value\"\r\n```\r\n\r\nWill result to:\r\n![image](https://user-images.githubusercontent.com/6112562/57088855-73677400-6d03-11e9-840e-82fab955c964.png)\r\n\r\nI understand that it is users responsibility to make sure the resulting metrics won't be identical, but on the other hand I'd expect this to result as a failed rule evaluation or at least log something or increment metric about it?\r\nThis way user has no notice that the data he has recorded are invalid. ",
  "closed_at": "2019-12-18T12:29:36Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  },
  "comments": 22,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/5529/comments",
  "created_at": "2019-05-02T16:03:40Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/5529/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/5529",
  "id": 439668933,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567449,
      "name": "component/rules",
      "node_id": "MDU6TGFiZWwzNjU1Njc0NDk=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/rules"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    },
    {
      "color": "4ae04a",
      "default": false,
      "description": "",
      "id": 365563587,
      "name": "low hanging fruit",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODc=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/low%20hanging%20fruit"
    },
    {
      "color": "fbca04",
      "default": false,
      "description": null,
      "id": 647013637,
      "name": "priority/P3",
      "node_id": "MDU6TGFiZWw2NDcwMTM2Mzc=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/priority/P3"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/5529/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0Mzk2Njg5MzM=",
  "number": 5529,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Random value in recording rule with multiple identical series result",
  "updated_at": "2020-06-24T20:29:48Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/5529",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/6112562?v=4",
    "events_url": "https://api.github.com/users/FUSAKLA/events{/privacy}",
    "followers_url": "https://api.github.com/users/FUSAKLA/followers",
    "following_url": "https://api.github.com/users/FUSAKLA/following{/other_user}",
    "gists_url": "https://api.github.com/users/FUSAKLA/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/FUSAKLA",
    "id": 6112562,
    "login": "FUSAKLA",
    "node_id": "MDQ6VXNlcjYxMTI1NjI=",
    "organizations_url": "https://api.github.com/users/FUSAKLA/orgs",
    "received_events_url": "https://api.github.com/users/FUSAKLA/received_events",
    "repos_url": "https://api.github.com/users/FUSAKLA/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/FUSAKLA/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/FUSAKLA/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/FUSAKLA"
  }
}