{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "## Bug Report\r\n**What did you do?**\r\nAttempted to use password_file in stead of plaintext password in kubernetes_sd_configs\r\n\r\n**What did you expect to see?**\r\nAuthorized http calls\r\n\r\n**What did you see instead? Under which circumstances?**\r\nUnauthorized/401 codes thrown in response\r\n\r\nIn kubernetes_sd_configs only:\r\n* if I use password, authorized, it works\r\n* if I use password_file, unauthorized, it doesn't work\r\n* if I use password and password_file at the same time, no error thrown, but it works\r\n\r\nit appears that the password_file variable is ignored completely \r\n\r\n**Environment**\r\n\r\n* System information:\r\nLinux 4.15.0-45-generic x86_64\r\n\r\n* Prometheus version:\r\nprometheus, version 2.7.1 (branch: HEAD, revision: 62e591f928ddf6b3468308b7ac1de1c63aa7fcf3)\r\n  build user:       root@f9f82868fc43\r\n  build date:       20190131-11:16:59\r\n  go version:       go1.11.5\r\n\r\n* Prometheus configuration file:\r\n```\r\n# Global Prometheus Configuration\r\nglobal:\r\n  scrape_interval: 30s     # By default, scrape targets every 30 seconds.\r\n  evaluation_interval: 30s # By default, scrape targets every 30 seconds.\r\n\r\nscrape_configs:\r\n\r\n- job_name: kubernetes-apiservers-pre\r\n  kubernetes_sd_configs:\r\n  - role: endpoints\r\n    api_server: https://**********:443\r\n    tls_config:\r\n      insecure_skip_verify: true\r\n    basic_auth:\r\n      username: prometheus\r\n      password_file: /var/run/secrets/prometheus/pre\r\n  scheme: https\r\n  tls_config:\r\n    insecure_skip_verify: true\r\n  basic_auth:\r\n    username: prometheus\r\n    password_file: /var/run/secrets/prometheus/pre\r\n  relabel_configs:\r\n  - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]\r\n    action: keep\r\n    regex: default;kubernetes;https\r\n```\r\n\r\n* Logs:\r\n```\r\nprometheus_1  | level=debug ts=2019-02-13T11:16:30.775409678Z caller=klog.go:70 component=k8s_client_runtime func=Infof msg=\"GET https://********:443/api/v1/endpoints?limit=500&resourceVersion=0 401 Unauthorized in 2 milliseconds\"\r\nprometheus_1  | level=error ts=2019-02-13T11:16:30.775560501Z caller=klog.go:94 component=k8s_client_runtime func=ErrorDepth msg=\"/app/discovery/kubernetes/kubernetes.go:300: Failed to list *v1.Endpoints: Unauthorized\"\r\n```\r\n",
  "closed_at": "2019-02-20T10:22:35Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/2587585?v=4",
    "events_url": "https://api.github.com/users/simonpasquier/events{/privacy}",
    "followers_url": "https://api.github.com/users/simonpasquier/followers",
    "following_url": "https://api.github.com/users/simonpasquier/following{/other_user}",
    "gists_url": "https://api.github.com/users/simonpasquier/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/simonpasquier",
    "id": 2587585,
    "login": "simonpasquier",
    "node_id": "MDQ6VXNlcjI1ODc1ODU=",
    "organizations_url": "https://api.github.com/users/simonpasquier/orgs",
    "received_events_url": "https://api.github.com/users/simonpasquier/received_events",
    "repos_url": "https://api.github.com/users/simonpasquier/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/simonpasquier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simonpasquier/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/simonpasquier"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/5210/comments",
  "created_at": "2019-02-13T11:21:14Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/5210/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/5210",
  "id": 409755590,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567641,
      "name": "component/service discovery",
      "node_id": "MDU6TGFiZWwzNjU1Njc2NDE=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/service%20discovery"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/5210/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0MDk3NTU1OTA=",
  "number": 5210,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "password_file ignored in kubernetes_sd_configs",
  "updated_at": "2019-08-19T11:04:47Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/5210",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/6523434?v=4",
    "events_url": "https://api.github.com/users/drewboswell/events{/privacy}",
    "followers_url": "https://api.github.com/users/drewboswell/followers",
    "following_url": "https://api.github.com/users/drewboswell/following{/other_user}",
    "gists_url": "https://api.github.com/users/drewboswell/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/drewboswell",
    "id": 6523434,
    "login": "drewboswell",
    "node_id": "MDQ6VXNlcjY1MjM0MzQ=",
    "organizations_url": "https://api.github.com/users/drewboswell/orgs",
    "received_events_url": "https://api.github.com/users/drewboswell/received_events",
    "repos_url": "https://api.github.com/users/drewboswell/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/drewboswell/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/drewboswell/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/drewboswell"
  }
}