{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "\r\nCapturing IRC discussion:\r\n```\r\n10:52 < iksaif> hey, do we really want /federate to use remote read?\r\n13:18 < bbrazil> I'm not sure what the current behaviour is, but it should not\r\n13:26 < jrv> turns out this problem exists since 2.0.0... adding a remote_read endpoint there and then hitting /federate causes a nil pointer crash as well\r\n13:27 < jrv> in 1.x I handed down some special parameters to a query that indicated that only local storage should be consulted (for rules and federation), but that didn't make it into 2.x\r\n13:30 < jrv> in 1.x it was done like this: https://github.com/prometheus/prometheus/blob/release-1.8/cmd/prometheus/main.go#L129\r\n13:48 < jrv> In 2.x, would such a (only use local storage) hint now go into the `SelectParams`?\r\n13:53 < bbrazil> jrv: no, you should use a storage that doesn't include the remote ones\r\n13:53 < bbrazil> so you'd just be using the local storage rather than a fanout storage that included everything\r\n13:54 < jrv> bbrazil: ok, so we should hand in two storages into the web layer, a local-only one for federation and a combined one for normal queries\r\n13:55 < jrv> but even for normal queries at some point we want the user to be able to set an argument that indicates whether to also hit remote storage or not... same for rules. Might be cleaner to abstract \r\n             that away into a query option and a common place (like fanin in 1.x) then decides which one of the underlying queriers to use?\r\n13:56 < jrv> so we don't put that logic and hand out two storages into each of the places that have to make this decision\r\n13:56 < bbrazil> jrv: something like that, but it doesn't belong as an option to the storage itself\r\n13:56 < bbrazil> we've only 2 places that need this, no need to get too fancy\r\n13:58 < jrv> bbrazil: yeah, not to the storage itself, but the fanin layer above it then\r\n13:58 < jrv> like in 1.x\r\n13:59 < bbrazil> I see us passing in two storages, and chosing which to use in the api/rules code\r\n14:02 < jrv> not sure how that's better, but works too\r\n14:02 < jrv> I think from a cleanliness perspective I prefer passing in the fanin one and making that aware of what's local and what's remote\r\n14:09 < bbrazil> to me that's making it harder to dig down to find the relevant if statement\r\n```\r\n",
  "closed_at": "2020-04-07T15:42:43Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/4270/comments",
  "created_at": "2018-06-14T07:10:56Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/4270/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/4270",
  "id": 332277299,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 689154505,
      "name": "component/api",
      "node_id": "MDU6TGFiZWw2ODkxNTQ1MDU=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/api"
    },
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567165,
      "name": "component/remote storage",
      "node_id": "MDU6TGFiZWwzNjU1NjcxNjU=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/remote%20storage"
    },
    {
      "color": "006b75",
      "default": true,
      "description": null,
      "id": 216836002,
      "name": "help wanted",
      "node_id": "MDU6TGFiZWwyMTY4MzYwMDI=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/help%20wanted"
    },
    {
      "color": "fbca04",
      "default": false,
      "description": null,
      "id": 647013637,
      "name": "priority/P3",
      "node_id": "MDU6TGFiZWw2NDcwMTM2Mzc=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/priority/P3"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/4270/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMzIyNzcyOTk=",
  "number": 4270,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Remote storage should not be used by federation",
  "updated_at": "2020-04-07T15:42:43Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/4270",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/1032963?v=4",
    "events_url": "https://api.github.com/users/iksaif/events{/privacy}",
    "followers_url": "https://api.github.com/users/iksaif/followers",
    "following_url": "https://api.github.com/users/iksaif/following{/other_user}",
    "gists_url": "https://api.github.com/users/iksaif/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/iksaif",
    "id": 1032963,
    "login": "iksaif",
    "node_id": "MDQ6VXNlcjEwMzI5NjM=",
    "organizations_url": "https://api.github.com/users/iksaif/orgs",
    "received_events_url": "https://api.github.com/users/iksaif/received_events",
    "repos_url": "https://api.github.com/users/iksaif/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/iksaif/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iksaif/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/iksaif"
  }
}