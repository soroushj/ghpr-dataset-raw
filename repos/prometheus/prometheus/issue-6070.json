{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "## Bug Report\r\n**What did you do?**\r\nRan any Prometheus docker image from Dockerhub past **v2.12.0-rc.0** pointed at my existing data.\r\n\r\n**What did you expect to see?**\r\nPrometheus starting normally.\r\n\r\n**What did you see instead? Under which circumstances?**\r\n\r\nPrometheus crashes on startup with \r\n\r\n```\r\nprometheus_1            | level=warn ts=2019-09-28T16:52:31.306Z caller=main.go:282 deprecation_notice=\"'storage.tsdb.retention' flag is deprecated use 'storage.tsdb.retention.time' instead.\"                                                                                            \r\nprometheus_1            | level=info ts=2019-09-28T16:52:31.306Z caller=main.go:329 msg=\"Starting Prometheus\" version=\"(version=2.12.0-rc.0, branch=HEAD, revision=eaf81808d5aa19ee4b9b8980ac5feeaec51408ac)\"                                                                              \r\nprometheus_1            | level=info ts=2019-09-28T16:52:31.306Z caller=main.go:330 build_context=\"(go=go1.12.8, user=root@e8effea18820, date=20190814-17:42:12)\"                                                                                                                          \r\nprometheus_1            | level=info ts=2019-09-28T16:52:31.306Z caller=main.go:331 host_details=\"(Linux 5.0.0-25-generic #26-Ubuntu SMP Thu Aug 1 12:04:58 UTC 2019 x86_64 4eb21f7bcef1 (none))\"                                                                                          \r\nprometheus_1            | level=info ts=2019-09-28T16:52:31.306Z caller=main.go:332 fd_limits=\"(soft=1048576, hard=1048576)\"\r\nprometheus_1            | level=info ts=2019-09-28T16:52:31.306Z caller=main.go:333 vm_limits=\"(soft=unlimited, hard=unlimited)\"\r\nprometheus_1            | panic: runtime error: slice bounds out of range\r\nprometheus_1            |\r\nprometheus_1            | goroutine 1 [running]:\r\nprometheus_1            | github.com/prometheus/prometheus/promql.parseBrokenJson(0xc000906000, 0x4e21, 0x4e21, 0x2a6b7c0, 0xc0005dc240, 0x0, 0x0, 0xc0006281e0)                                                                                                                           \r\nprometheus_1            |       /app/promql/query_logger.go:45 +0x131\r\nprometheus_1            | github.com/prometheus/prometheus/promql.logUnfinishedQueries(0xc0006281e0, 0x1f, 0x4e21, 0x2a6b7c0, 0xc0005dc240)\r\nprometheus_1            |       /app/promql/query_logger.go:70 +0x552\r\nprometheus_1            | github.com/prometheus/prometheus/promql.NewActiveQueryTracker(0x7ffe73792ed0, 0x10, 0x14, 0x2a6b7c0, 0xc0005dc240, 0x2a6b7c0)                                                                                                                                    \r\nprometheus_1            |       /app/promql/query_logger.go:108 +0x131\r\nprometheus_1            | main.main()\r\nprometheus_1            |       /app/cmd/prometheus/main.go:361 +0x52bd\r\n```\r\n\r\nAny version before **v2.12.0-rc.0** runs as expected.\r\n\r\n\r\n**Environment**\r\n\r\n* System information:\r\n\r\nRunning `prom/prometheus:v2.12.0-rc.0`\r\n\r\n```\r\n$ uname -srm\r\nLinux 5.0.0-25-generic x86_64\r\n```\r\n\r\n* Prometheus version:\r\n\r\n```\r\n$ prometheus --version\r\nprometheus, version 2.12.0-rc.0 (branch: HEAD, revision: eaf81808d5aa19ee4b9b8980ac5feeaec51408ac)\r\n  build user:       root@e8effea18820\r\n  build date:       20190814-17:42:12\r\n  go version:       go1.12.8\r\n```\r\n* Prometheus configuration file:\r\n\r\n```\r\nglobal:\r\n  scrape_interval: 1m\r\n  scrape_timeout: 10s\r\n\r\nscrape_configs:\r\n  - job_name: 'prometheus'\r\n    metrics_path: '/prometheus/metrics'\r\n    static_configs:\r\n      - targets: ['prometheus:9090']\r\n        labels:\r\n          group: 'production'\r\n\r\n  - job_name: 'speedtest'\r\n    metrics_path: '/probe'\r\n    scrape_interval: 10m\r\n    scrape_timeout: 2m\r\n    static_configs:\r\n      - targets: ['prometheus_speedtest:9516']\r\n        labels:\r\n          group: 'production'\r\n    relabel_configs:\r\n      - source_labels: ['__address__']\r\n        target_label: 'instance'\r\n        regex: '^(.*):[0-9]+$'\r\n\r\n  - job_name: 'piaware_prober'\r\n    metrics_path: '/probe'\r\n    params:\r\n      module: ['http_2xx']\r\n    static_configs:\r\n      - targets: ['http://192.168.1.123:80']\r\n        labels:\r\n          group: 'production'\r\n    relabel_configs:\r\n      - source_labels: ['__address__']\r\n        target_label: '__param_target'\r\n      - target_label: 'instance'\r\n        replacement: 'piaware'\r\n      - target_label: '__address__'\r\n        replacement: 'prometheus_blackbox:9115'\r\n      - source_labels: ['__param_module']\r\n        target_label: 'module'\r\n\r\nrule_files:\r\n  - 'rules/*.yml'\r\n```\r\n\r\n* Docker configuration\r\n\r\n```\r\n  prometheus:                                                                      \r\n    image: 'prom/prometheus:v2.12.0-rc.0'                                           \r\n    user: '127:137'                                                                \r\n    networks:                                                                      \r\n      - 'prometheus_network'                                                                                                      \r\n    volumes:                                                                       \r\n      - type: 'bind'                                                               \r\n        source: './monitoring/prometheus/prometheus.yml'                           \r\n        target: '/prometheus/prometheus.yml'                                       \r\n        read_only: true                                                            \r\n      - type: 'bind'                                                               \r\n        source: './monitoring/prometheus/rules'                                    \r\n        target: '/prometheus/rules'                                                \r\n        read_only: true                                                            \r\n      - type: 'bind'                                                               \r\n        source: '/var/prometheus/data'                                             \r\n        target: '/prometheus/data'                                                 \r\n    command:                                                                       \r\n      - '--query.lookback-delta=25m'                                               \r\n      - '--storage.tsdb.path=/prometheus/data'                                     \r\n      - '--storage.tsdb.retention=10y'                                             \r\n      - '--web.external-url=http://prometheus:9090/prometheus/'                    \r\n    restart: 'unless-stopped'\r\n```\r\n\r\n\r\n",
  "closed_at": "2020-02-13T19:45:18Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/291750?v=4",
    "events_url": "https://api.github.com/users/roidelapluie/events{/privacy}",
    "followers_url": "https://api.github.com/users/roidelapluie/followers",
    "following_url": "https://api.github.com/users/roidelapluie/following{/other_user}",
    "gists_url": "https://api.github.com/users/roidelapluie/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/roidelapluie",
    "id": 291750,
    "login": "roidelapluie",
    "node_id": "MDQ6VXNlcjI5MTc1MA==",
    "organizations_url": "https://api.github.com/users/roidelapluie/orgs",
    "received_events_url": "https://api.github.com/users/roidelapluie/received_events",
    "repos_url": "https://api.github.com/users/roidelapluie/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/roidelapluie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roidelapluie/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/roidelapluie"
  },
  "comments": 4,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/6070/comments",
  "created_at": "2019-09-28T17:33:37Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/6070/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/6070",
  "id": 499799046,
  "labels": [],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/6070/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU0OTk3OTkwNDY=",
  "number": 6070,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "promql.parseBrokenJson panic: runtime error: slice bounds out of range",
  "updated_at": "2020-02-13T19:45:34Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/6070",
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/5875882?v=4",
    "events_url": "https://api.github.com/users/jeanralphaviles/events{/privacy}",
    "followers_url": "https://api.github.com/users/jeanralphaviles/followers",
    "following_url": "https://api.github.com/users/jeanralphaviles/following{/other_user}",
    "gists_url": "https://api.github.com/users/jeanralphaviles/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/jeanralphaviles",
    "id": 5875882,
    "login": "jeanralphaviles",
    "node_id": "MDQ6VXNlcjU4NzU4ODI=",
    "organizations_url": "https://api.github.com/users/jeanralphaviles/orgs",
    "received_events_url": "https://api.github.com/users/jeanralphaviles/received_events",
    "repos_url": "https://api.github.com/users/jeanralphaviles/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/jeanralphaviles/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jeanralphaviles/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/jeanralphaviles"
  }
}