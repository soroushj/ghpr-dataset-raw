{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!--\r\n\r\n    Please do *NOT* ask usage questions in Github issues.\r\n\r\n    If your issue is not a feature request or bug report use:\r\n    https://groups.google.com/forum/#!forum/prometheus-users. If\r\n    you are unsure whether you hit a bug, search and ask in the\r\n    mailing list first.\r\n\r\n    You can find more information at: https://prometheus.io/community/\r\n\r\n-->\r\n\r\n**What did you do?**\r\nA configuration has been changed:\r\n`sample_limit` from `100000` to `130000`\r\nthen the new configuration has been deployed to kubernetes.\r\n\r\n**What did you expect to see?**\r\nA configuration reload as usual.\r\n\r\n**What did you see instead? Under which circumstances?**\r\nPrometheus got restarted with a bunch of errors within logs.\r\n\r\n**Environment**\r\n\r\n* System information:\r\n```\r\n Kernel Version:                  5.3.0-24-generic\r\n OS Image:                        Ubuntu 18.04.1 LTS\r\n Operating System:                linux\r\n Architecture:                    amd64\r\n Kubelet Version:                 v1.14.8\r\n```\r\n\r\n* Prometheus version:\r\n2.16.0\r\n\r\n* Logs:\r\n```\r\nfatal error: concurrent map read and map write\r\n\r\ngoroutine 7926 [running]:\r\nruntime.throw(0x25d4f3b, 0x21)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/runtime/panic.go:617 +0x72 fp=0xc0248e16c0 sp=0xc0248e1690 pc=0x42f552\r\nruntime.mapaccess2_fast64(0x217f780, 0xc21aaea3c0, 0x329a094c9e427070, 0x45dea01, 0xc256bc5d00)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/runtime/map_fast64.go:61 +0x1c2 fp=0xc0248e16e8 sp=0xc0248e16c0 pc=0x412ed2\r\ngithub.com/prometheus/prometheus/scrape.(*scrapeCache).forEachStale(0xc21aaf0100, 0xc0248e1a10)\r\n\t/build/go/src/github.com/prometheus/prometheus/scrape/scrape.go:766 +0xdf fp=0xc0248e1798 sp=0xc0248e16e8 pc=0x1d7fbff\r\ngithub.com/prometheus/prometheus/scrape.(*scrapeLoop).append(0xc0f1760240, 0x45dd750, 0x0, 0x0, 0x0, 0x0, 0xbf94458d1f2e81b8, 0x6181c1af2c1ca, 0x45bf9e0, 0x0, ...)\r\n\t/build/go/src/github.com/prometheus/prometheus/scrape/scrape.go:1219 +0xce5 fp=0xc0248e1a48 sp=0xc0248e1798 pc=0x1d83825\r\ngithub.com/prometheus/prometheus/scrape.(*scrapeLoop).endOfRunStaleness(0xc0f1760240, 0xbf9445895f2e5033, 0x618189ce0ba36, 0x45bf9e0, 0xc16d72bf90, 0x37e11d600)\r\n\t/build/go/src/github.com/prometheus/prometheus/scrape/scrape.go:1046 +0x36b fp=0xc0248e1c58 sp=0xc0248e1a48 pc=0x1d8260b\r\ngithub.com/prometheus/prometheus/scrape.(*scrapeLoop).run(0xc0f1760240, 0x37e11d600, 0x2540be400, 0x0)\r\n\t/build/go/src/github.com/prometheus/prometheus/scrape/scrape.go:1003 +0x929 fp=0xc0248e1fc0 sp=0xc0248e1c58 pc=0x1d816d9\r\nruntime.goexit()\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/runtime/asm_amd64.s:1337 +0x1 fp=0xc0248e1fc8 sp=0xc0248e1fc0 pc=0x45e8f1\r\ncreated by github.com/prometheus/prometheus/scrape.(*scrapePool).sync\r\n\t/build/go/src/github.com/prometheus/prometheus/scrape/scrape.go:425 +0x52c\r\n\r\ngoroutine 1 [chan receive, 28589 minutes]:\r\ngithub.com/prometheus/prometheus/vendor/github.com/oklog/run.(*Group).Run(0xc0009b7c38, 0xc000212410, 0x8)\r\n\t/build/go/src/github.com/prometheus/prometheus/vendor/github.com/oklog/run/group.go:43 +0xf0\r\nmain.main()\r\n\t/build/go/src/github.com/prometheus/prometheus/cmd/prometheus/main.go:739 +0x6edd\r\n\r\ngoroutine 109 [IO wait, 28589 minutes]:\r\ninternal/poll.runtime_pollWait(0x7f46bd265de8, 0x72, 0xffffffffffffffff)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/runtime/netpoll.go:182 +0x56\r\ninternal/poll.(*pollDesc).wait(0xc0005ae198, 0x72, 0x8000, 0x8000, 0xffffffffffffffff)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/internal/poll/fd_poll_runtime.go:87 +0x9b\r\ninternal/poll.(*pollDesc).waitRead(...)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/internal/poll/fd_poll_runtime.go:92\r\ninternal/poll.(*FD).Read(0xc0005ae180, 0xc0009be000, 0x8000, 0x8000, 0x0, 0x0, 0x0)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/internal/poll/fd_unix.go:169 +0x19b\r\nnet.(*netFD).Read(0xc0005ae180, 0xc0009be000, 0x8000, 0x8000, 0x45b3a0, 0xc000554300, 0x4)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/net/fd_unix.go:202 +0x4f\r\nnet.(*conn).Read(0xc000010028, 0xc0009be000, 0x8000, 0x8000, 0x0, 0x0, 0x0)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/net/net.go:177 +0x69\r\nbufio.(*Reader).Read(0xc00015ea80, 0xc0004921f8, 0x9, 0x9, 0x4591a0, 0xc00073c6c0, 0xc0000705f8)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/bufio/bufio.go:223 +0x23e\r\nio.ReadAtLeast(0x2bed900, 0xc00015ea80, 0xc0004921f8, 0x9, 0x9, 0x9, 0x1000000022d6ce0, 0xc0004a00e0, 0xc0007400d0)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/io/io.go:310 +0x88\r\nio.ReadFull(...)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/io/io.go:329\r\ngithub.com/prometheus/prometheus/vendor/golang.org/x/net/http2.readFrameHeader(0xc0004921f8, 0x9, 0x9, 0x2bed900, 0xc00015ea80, 0x0, 0xc000000000, 0xc0007031c0, 0xc00066c910)\r\n\t/build/go/src/github.com/prometheus/prometheus/vendor/golang.org/x/net/http2/frame.go:237 +0x88\r\ngithub.com/prometheus/prometheus/vendor/golang.org/x/net/http2.(*Framer).ReadFrame(0xc0004921c0, 0xc000542150, 0x1, 0x0, 0x0)\r\n\t/build/go/src/github.com/prometheus/prometheus/vendor/golang.org/x/net/http2/frame.go:492 +0xa1\r\ngithub.com/prometheus/prometheus/vendor/google.golang.org/grpc/internal/transport.(*http2Client).reader(0xc000432540)\r\n\t/build/go/src/github.com/prometheus/prometheus/vendor/google.golang.org/grpc/internal/transport/http2_client.go:1242 +0x168\r\ncreated by github.com/prometheus/prometheus/vendor/google.golang.org/grpc/internal/transport.newHTTP2Client\r\n\t/build/go/src/github.com/prometheus/prometheus/vendor/google.golang.org/grpc/internal/transport/http2_client.go:289 +0xd42\r\n\r\ngoroutine 6 [syscall, 28589 minutes]:\r\nos/signal.signal_recv(0x0)\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/runtime/sigqueue.go:139 +0x9c\r\nos/signal.loop()\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/os/signal/signal_unix.go:23 +0x22\r\ncreated by os/signal.init.0\r\n\t/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-go-1.12.16/share/go/src/os/signal/signal_unix.go:29 +0x41\r\n...\r\n```\r\n\r\nFor more see the attached file, please.\r\n",
  "closed_at": "2020-03-27T23:09:04Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/291750?v=4",
    "events_url": "https://api.github.com/users/roidelapluie/events{/privacy}",
    "followers_url": "https://api.github.com/users/roidelapluie/followers",
    "following_url": "https://api.github.com/users/roidelapluie/following{/other_user}",
    "gists_url": "https://api.github.com/users/roidelapluie/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/roidelapluie",
    "id": 291750,
    "login": "roidelapluie",
    "node_id": "MDQ6VXNlcjI5MTc1MA==",
    "organizations_url": "https://api.github.com/users/roidelapluie/orgs",
    "received_events_url": "https://api.github.com/users/roidelapluie/received_events",
    "repos_url": "https://api.github.com/users/roidelapluie/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/roidelapluie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roidelapluie/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/roidelapluie"
  },
  "comments": 17,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/6997/comments",
  "created_at": "2020-03-17T13:16:58Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/6997/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/6997",
  "id": 583005549,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "",
      "id": 664475581,
      "name": "component/scraping",
      "node_id": "MDU6TGFiZWw2NjQ0NzU1ODE=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/scraping"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    },
    {
      "color": "eb6420",
      "default": false,
      "description": null,
      "id": 365563606,
      "name": "priority/P1",
      "node_id": "MDU6TGFiZWwzNjU1NjM2MDY=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/priority/P1"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/6997/labels{/name}",
  "locked": false,
  "milestone": {
    "closed_at": "2020-04-27T14:57:51Z",
    "closed_issues": 9,
    "created_at": "2020-03-13T09:01:42Z",
    "creator": {
      "avatar_url": "https://avatars2.githubusercontent.com/u/291750?v=4",
      "events_url": "https://api.github.com/users/roidelapluie/events{/privacy}",
      "followers_url": "https://api.github.com/users/roidelapluie/followers",
      "following_url": "https://api.github.com/users/roidelapluie/following{/other_user}",
      "gists_url": "https://api.github.com/users/roidelapluie/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/roidelapluie",
      "id": 291750,
      "login": "roidelapluie",
      "node_id": "MDQ6VXNlcjI5MTc1MA==",
      "organizations_url": "https://api.github.com/users/roidelapluie/orgs",
      "received_events_url": "https://api.github.com/users/roidelapluie/received_events",
      "repos_url": "https://api.github.com/users/roidelapluie/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/roidelapluie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roidelapluie/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/roidelapluie"
    },
    "description": null,
    "due_on": null,
    "html_url": "https://github.com/prometheus/prometheus/milestone/9",
    "id": 5197622,
    "labels_url": "https://api.github.com/repos/prometheus/prometheus/milestones/9/labels",
    "node_id": "MDk6TWlsZXN0b25lNTE5NzYyMg==",
    "number": 9,
    "open_issues": 0,
    "state": "closed",
    "title": "2.17.0",
    "updated_at": "2020-04-27T14:57:51Z",
    "url": "https://api.github.com/repos/prometheus/prometheus/milestones/9"
  },
  "node_id": "MDU6SXNzdWU1ODMwMDU1NDk=",
  "number": 6997,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Fatal error after reload when configuration got changed (increasing sample_limit)",
  "updated_at": "2020-03-27T23:09:04Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/6997",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/25924718?v=4",
    "events_url": "https://api.github.com/users/hawran/events{/privacy}",
    "followers_url": "https://api.github.com/users/hawran/followers",
    "following_url": "https://api.github.com/users/hawran/following{/other_user}",
    "gists_url": "https://api.github.com/users/hawran/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/hawran",
    "id": 25924718,
    "login": "hawran",
    "node_id": "MDQ6VXNlcjI1OTI0NzE4",
    "organizations_url": "https://api.github.com/users/hawran/orgs",
    "received_events_url": "https://api.github.com/users/hawran/received_events",
    "repos_url": "https://api.github.com/users/hawran/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/hawran/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hawran/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/hawran"
  }
}