{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "If the checkpoint directory is present but has no files you get the following panic:\r\n\r\n```\r\nlevel=info ts=2020-03-13T08:53:02.071Z caller=head.go:584 component=tsdb msg=\"replaying WAL, this may take awhile\"\r\npanic: runtime error: index out of range [0] with length 0\r\n\r\ngoroutine 108 [running]:\r\ngithub.com/prometheus/prometheus/tsdb/wal.NewSegmentBufReader(...)\r\n        /home/bbrazil/gosrc/src/github.com/prometheus/prometheus/tsdb/wal/wal.go:830\r\ngithub.com/prometheus/prometheus/tsdb/wal.NewSegmentsRangeReader(0xc00009baf8, 0x1, 0x1, 0x1a, 0xb77, 0x0, 0x0)\r\n        /home/bbrazil/gosrc/src/github.com/prometheus/prometheus/tsdb/wal/wal.go:813 +0x760\r\ngithub.com/prometheus/prometheus/tsdb/wal.NewSegmentsReader(...)\r\n        /home/bbrazil/gosrc/src/github.com/prometheus/prometheus/tsdb/wal/wal.go:785\r\ngithub.com/prometheus/prometheus/tsdb.(*Head).Init(0xc0000ee780, 0x8000000000000000, 0x0, 0x0)\r\n        /home/bbrazil/gosrc/src/github.com/prometheus/prometheus/tsdb/head.go:592 +0xbc4\r\ngithub.com/prometheus/prometheus/tsdb.Open(0x24dec1b, 0x5, 0x2c64440, 0xc00060b170, 0x2c9f6a0, 0xc000144460, 0xc0000a3900, 0x2, 0xc0005fb000, 0xc)\r\n        /home/bbrazil/gosrc/src/github.com/prometheus/prometheus/tsdb/db.go:567 +0x5f9\r\ngithub.com/prometheus/prometheus/storage/tsdb.Open(0x24dec1b, 0x5, 0x2c64440, 0xc00060b170, 0x2c9f6a0, 0xc000144460, 0xc00014a1e0, 0x0, 0x0, 0x0)\r\n        /home/bbrazil/gosrc/src/github.com/prometheus/prometheus/storage/tsdb/tsdb.go:192 +0x290\r\nmain.main.func19(0x0, 0x0)\r\n        /home/bbrazil/gosrc/src/github.com/prometheus/prometheus/cmd/prometheus/main.go:654 +0x31a\r\ngithub.com/oklog/run.(*Group).Run.func1(0xc0000ca840, 0xc000126640, 0xc00057c000)\r\n        /home/bbrazil/gosrc/src/github.com/prometheus/prometheus/vendor/github.com/oklog/run/group.go:38 +0x27\r\ncreated by github.com/oklog/run.(*Group).Run\r\n        /home/bbrazil/gosrc/src/github.com/prometheus/prometheus/vendor/github.com/oklog/run/group.go:37 +0xbb\r\n```\r\n\r\nWe should be resilient to this, and also check what can cause this to occur.",
  "closed_at": "2020-09-07T14:34:50Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/15064823?v=4",
    "events_url": "https://api.github.com/users/codesome/events{/privacy}",
    "followers_url": "https://api.github.com/users/codesome/followers",
    "following_url": "https://api.github.com/users/codesome/following{/other_user}",
    "gists_url": "https://api.github.com/users/codesome/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/codesome",
    "id": 15064823,
    "login": "codesome",
    "node_id": "MDQ6VXNlcjE1MDY0ODIz",
    "organizations_url": "https://api.github.com/users/codesome/orgs",
    "received_events_url": "https://api.github.com/users/codesome/received_events",
    "repos_url": "https://api.github.com/users/codesome/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/codesome/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codesome/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/codesome"
  },
  "comments": 10,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/6976/comments",
  "created_at": "2020-03-13T08:55:32Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/6976/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/6976",
  "id": 580458558,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "",
      "id": 1498495148,
      "name": "component/tsdb",
      "node_id": "MDU6TGFiZWwxNDk4NDk1MTQ4",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/tsdb"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    },
    {
      "color": "4ae04a",
      "default": false,
      "description": "",
      "id": 365563587,
      "name": "low hanging fruit",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODc=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/low%20hanging%20fruit"
    },
    {
      "color": "fbca04",
      "default": false,
      "description": null,
      "id": 647013637,
      "name": "priority/P3",
      "node_id": "MDU6TGFiZWw2NDcwMTM2Mzc=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/priority/P3"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/6976/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU1ODA0NTg1NTg=",
  "number": 6976,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Panic on startup if checkpoint directory is empty",
  "updated_at": "2020-09-07T14:34:50Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/6976",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  }
}