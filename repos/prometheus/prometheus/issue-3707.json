{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**What did you do?**\r\nPrometheus sends samples to our remote storage. One time when remote storage is going to down, we see in logs:\r\nlevel=warn ts=2018-01-19T08:29:08.516631616Z caller=queue_manager.go:485 component=remote msg=\"Error sending samples to remote storage\" count=1 err=\"Post <storage_url>: getsockopt: no route to host\"\r\nIf we try to reload prometheus configuration by sending post on <prometheus_url>/-/reload  when remote storage is down, this request is never finished. Looks like prometheus trying to send data to storage again and again, before reload configuration.\r\n**What did you expect to see?**\r\nPrometheus should reload configuration\r\n**What did you see instead? Under which circumstances?**\r\nConfiguration wasn't reloaded, no response on POST <prometheus_url>/-/reload request \r\n**Environment**\r\n\r\n* System information:\r\n\r\n\tLinux 3.10.0-514.26.2.el7.x86_64 x86_64\r\n\r\n* Prometheus version:\r\n\r\n\t2.0.0\r\n\r\n* Prometheus configuration file:\r\n```\r\nglobal:\r\n  scrape_interval: 15s\r\n  scrape_timeout: 10s\r\n  evaluation_interval: 15s\r\n  external_labels:\r\n    monitor: default\r\n...\r\nremote_write:\r\n- url: <remote_storage_url>\r\n  remote_timeout: 30s\r\n  write_relabel_configs:\r\n  - source_labels: [indicatorName]\r\n    separator: ;\r\n    regex: (.+)\r\n    replacement: $1\r\n    action: keep\r\n  queue_config:\r\n    capacity: 100000\r\n    max_shards: 1000\r\n    max_samples_per_send: 100\r\n    batch_send_deadline: 5s\r\n    max_retries: 10\r\n    min_backoff: 30ms\r\n    max_backoff: 100ms\r\n```\r\n\r\n* Logs:\r\n```\r\n2018/01/19 08:25:22 Redirected: /-/reload\r\nlevel=info ts=2018-01-19T08:25:22.313752379Z caller=main.go:490 msg=\"Loading configuration file\" filename=/config/prometheus/default.yml\r\nlevel=info ts=2018-01-19T08:25:22.319062591Z caller=queue_manager.go:253 component=remote msg=\"Stopping remote storage...\"\r\nlevel=warn ts=2018-01-19T08:25:23.406480826Z caller=queue_manager.go:485 component=remote msg=\"Error sending samples to remote storage\" count=8 err=\"Post <remote_storage_url>: getsockopt: no route to host\"\r\nlevel=warn ts=2018-01-19T08:25:26.412528632Z caller=queue_manager.go:485 component=remote msg=\"Error sending samples to remote storage\" count=8 err=\"Post <remote_storage_url>: getsockopt: no route to host\"\r\nlevel=warn ts=2018-01-19T08:25:29.418470232Z caller=queue_manager.go:485 component=remote msg=\"Error sending samples to remote storage\" count=8 err=\"Post <remote_storage_url>: getsockopt: no route to host\"\r\n```\r\n",
  "closed_at": "2018-05-29T13:25:20Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/444037?v=4",
    "events_url": "https://api.github.com/users/tomwilkie/events{/privacy}",
    "followers_url": "https://api.github.com/users/tomwilkie/followers",
    "following_url": "https://api.github.com/users/tomwilkie/following{/other_user}",
    "gists_url": "https://api.github.com/users/tomwilkie/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/tomwilkie",
    "id": 444037,
    "login": "tomwilkie",
    "node_id": "MDQ6VXNlcjQ0NDAzNw==",
    "organizations_url": "https://api.github.com/users/tomwilkie/orgs",
    "received_events_url": "https://api.github.com/users/tomwilkie/received_events",
    "repos_url": "https://api.github.com/users/tomwilkie/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/tomwilkie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tomwilkie/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/tomwilkie"
  },
  "comments": 17,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/3707/comments",
  "created_at": "2018-01-19T11:01:57Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/3707/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/3707",
  "id": 289938362,
  "labels": [],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/3707/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyODk5MzgzNjI=",
  "number": 3707,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Prometheus 2.0 reload configuration issues",
  "updated_at": "2019-03-22T16:09:39Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/3707",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/5833601?v=4",
    "events_url": "https://api.github.com/users/Chevron94/events{/privacy}",
    "followers_url": "https://api.github.com/users/Chevron94/followers",
    "following_url": "https://api.github.com/users/Chevron94/following{/other_user}",
    "gists_url": "https://api.github.com/users/Chevron94/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/Chevron94",
    "id": 5833601,
    "login": "Chevron94",
    "node_id": "MDQ6VXNlcjU4MzM2MDE=",
    "organizations_url": "https://api.github.com/users/Chevron94/orgs",
    "received_events_url": "https://api.github.com/users/Chevron94/received_events",
    "repos_url": "https://api.github.com/users/Chevron94/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/Chevron94/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Chevron94/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/Chevron94"
  }
}