{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "**What did you do?**\r\n\r\nThis issue is solved for me, but let's say I would like to document it for others (and maybe it's a real bug, don't know).\r\n\r\nI'm using prometheus in EC2 environment with EC2 instance discovery. The problem is, that network guys require that all the external http traffic goes trough the http proxy. So I get this requirement covered by exporting env proxy variables which native go http client will pickup:\r\n\r\n```\r\nHTTP_PROXY=http://proxyserver:1.2.3.4.5\r\nHTTPS_PROXY=http://proxyserver:1.2.3.4.5\r\nNO_PROXY=169.254.169.254\r\n```\r\nI keep the 169.254.169.254 there so the AWS lib can pickup the correct role and credentials for discovery.\r\n\r\nThis works fine with v1.7. After upgrading to 2.0 I've noticed a lot of failed connections to proxy. Surprisingly everything else worked fine including the discovery. Cutting the config down to empty `global:` section, I still saw the traffic. Quick strace shows that the prometheus main thread tries to repeatedly connect to *0.0.0.0:9090*, which is as default binding i think, and since the HTTP_PROXY is configured, it tries to do it trough the proxy (bummer).\r\n\r\nSo the solution was to include *0.0.0.0* in  *no_proxy* (silly, but fixes the issue):\r\n```\r\nNO_PROXY=169.254.169.254,0.0.0.0\r\n```\r\n\r\n**What did you expect to see?**\r\n\r\nClose to no traffic to http proxy. Ideally no connect to binding address:port.\r\n\r\n**What did you see instead? Under which circumstances?**\r\n\r\nHigh volumes of http traffic to proxy. Attemps to connect to binding address:port.\r\n\r\n**Environment**\r\n\r\n* System information:\r\n\r\nLinux 4.14.0-2-amd64 x86_64\r\n\r\n* Prometheus version:\r\n\r\nprometheus, version 2.1.0 (branch: HEAD, revision: 85f23d82a045d103ea7f3c89a91fba4a93e6367a)\r\n  build user:       root@6e784304d3ff\r\n  build date:       20180119-12:01:23\r\n  go version:       go1.9.2\r\n\r\n* Prometheus configuration file:\r\n```\r\nglobal:\r\n```",
  "closed_at": "2018-11-13T13:42:24Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/2587585?v=4",
    "events_url": "https://api.github.com/users/simonpasquier/events{/privacy}",
    "followers_url": "https://api.github.com/users/simonpasquier/followers",
    "following_url": "https://api.github.com/users/simonpasquier/following{/other_user}",
    "gists_url": "https://api.github.com/users/simonpasquier/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/simonpasquier",
    "id": 2587585,
    "login": "simonpasquier",
    "node_id": "MDQ6VXNlcjI1ODc1ODU=",
    "organizations_url": "https://api.github.com/users/simonpasquier/orgs",
    "received_events_url": "https://api.github.com/users/simonpasquier/received_events",
    "repos_url": "https://api.github.com/users/simonpasquier/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/simonpasquier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simonpasquier/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/simonpasquier"
  },
  "comments": 1,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/3730/comments",
  "created_at": "2018-01-24T09:29:05Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/3730/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/3730",
  "id": 291138154,
  "labels": [
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/3730/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyOTExMzgxNTQ=",
  "number": 3730,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Connect request to binding IP:PORT (>= v2.0 related)",
  "updated_at": "2018-11-13T13:42:24Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/3730",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
    "events_url": "https://api.github.com/users/ghost/events{/privacy}",
    "followers_url": "https://api.github.com/users/ghost/followers",
    "following_url": "https://api.github.com/users/ghost/following{/other_user}",
    "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/ghost",
    "id": 10137,
    "login": "ghost",
    "node_id": "MDQ6VXNlcjEwMTM3",
    "organizations_url": "https://api.github.com/users/ghost/orgs",
    "received_events_url": "https://api.github.com/users/ghost/received_events",
    "repos_url": "https://api.github.com/users/ghost/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/ghost"
  }
}