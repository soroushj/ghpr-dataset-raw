{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "NONE",
  "body": "<!--\r\n\r\n    Please do *NOT* ask usage questions in Github issues.\r\n\r\n    If your issue is not a feature request or bug report use:\r\n    https://groups.google.com/forum/#!forum/prometheus-users. If\r\n    you are unsure whether you hit a bug, search and ask in the\r\n    mailing list first.\r\n\r\n    You can find more information at: https://prometheus.io/community/\r\n\r\n-->\r\n\r\n## Bug Report\r\n**What did you do?**\r\n\r\nI set up openstack_sd with the below config. \r\n\r\n**What did you expect to see?**\r\nopenstack_sd should discover nodes and use consistently use the same network-interface (10.x.x.x) on all servers.\r\n\r\n**What did you see instead? Under which circumstances?**\r\nopenstack_sd successfully added all available nodes, but the chose network interface seems arbitrary. it also changes on each discovery run (every 60 seconds)\r\n\r\nout of 44 nodes, between 6 and 10 get \"re-discovered\" with a new __private_ip__ every 60 seconds.\r\n\r\n** examples **\r\n\r\nbefore:\r\n\r\n![before](https://user-images.githubusercontent.com/39736763/42221611-e5e7428c-7ed2-11e8-88f2-961f84a3e3d5.png)\r\n\r\n__address__=\"10.150.x.x:9100\"\r\n__meta_openstack_instance_flavor=\"1310a6bc-3b91-47d0-ad50-9a50b9cf743f\"\r\n__meta_openstack_instance_id=\"1cda4a6c-fc4a-4de5-9cc5-13bba908333f\"\r\n__meta_openstack_instance_name=\"xxx\"\r\n__meta_openstack_instance_status=\"ACTIVE\"\r\n__meta_openstack_private_ip=\"10.150.x.x\"\r\n__metrics_path__=\"/metrics\"\r\n__scheme__=\"http\"\r\njob=\"openstack_dc1\"\r\n\t\r\nafter:\r\n\r\n![after](https://user-images.githubusercontent.com/39736763/42221683-324ac4dc-7ed3-11e8-8f58-2c3f08c57d85.png)\r\n\r\n(marked in yellow are the two servers from the 'before' picture)\r\n\r\n__address__=\"100.100.x.x:9100\"\r\n__meta_openstack_instance_flavor=\"1310a6bc-3b91-47d0-ad50-9a50b9cf743f\"\r\n__meta_openstack_instance_id=\"1cda4a6c-fc4a-4de5-9cc5-13bba908333f\"\r\n__meta_openstack_instance_name=\"xxx\"\r\n__meta_openstack_instance_status=\"ACTIVE\"\r\n__meta_openstack_private_ip=\"100.100.x.x\"\r\n__metrics_path__=\"/metrics\"\r\n__scheme__=\"http\"\r\njob=\"openstack_dc1\"\r\n\t\r\n\r\n\r\n**Environment**\r\n\r\n* System information:\r\n\r\nLinux 4.4.70 x86_64`\r\n\r\n* Prometheus version:\r\n\r\nVersion \t1.8.1\r\nRevision \t3a7c51ab70fc7615cd318204d3aa7c078b7c5b20\r\nBranch \tHEAD\r\nBuildUser \troot@ab78fb101775\r\nBuildDate \t20171023-15:50:57\r\nGoVersion \tgo1.9.1\r\n\r\n* Prometheus configuration file: (relevant part)\r\n```\r\n- job_name: 'openstack_dc1'\r\n    scrape_interval: 1m\r\n    scrape_timeout: 10s\r\n    metrics_path: /metrics\r\n    scheme: http\r\n    tls_config:\r\n     insecure_skip_verify: true\r\n    openstack_sd_configs:\r\n    - identity_endpoint: 'https://xxx:5000/v2.0'\r\n      username: <secret>\r\n      userid: <secret>\r\n      password: '<secret>'\r\n      project_name: xxx\r\n      project_id: xxx\r\n      domain_name: default\r\n      domain_id: default\r\n      role: instance\r\n      region: RegionOne\r\n      refresh_interval: 1m\r\n      port: 9100\r\n```\r\n",
  "closed_at": "2018-10-09T15:17:09Z",
  "closed_by": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/7115638?v=4",
    "events_url": "https://api.github.com/users/brian-brazil/events{/privacy}",
    "followers_url": "https://api.github.com/users/brian-brazil/followers",
    "following_url": "https://api.github.com/users/brian-brazil/following{/other_user}",
    "gists_url": "https://api.github.com/users/brian-brazil/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/brian-brazil",
    "id": 7115638,
    "login": "brian-brazil",
    "node_id": "MDQ6VXNlcjcxMTU2Mzg=",
    "organizations_url": "https://api.github.com/users/brian-brazil/orgs",
    "received_events_url": "https://api.github.com/users/brian-brazil/received_events",
    "repos_url": "https://api.github.com/users/brian-brazil/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/brian-brazil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brian-brazil/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/brian-brazil"
  },
  "comments": 0,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/4339/comments",
  "created_at": "2018-07-03T13:11:57Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/4339/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/4339",
  "id": 337892952,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567641,
      "name": "component/service discovery",
      "node_id": "MDU6TGFiZWwzNjU1Njc2NDE=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/service%20discovery"
    },
    {
      "color": "c7def8",
      "default": false,
      "description": null,
      "id": 365563592,
      "name": "kind/enhancement",
      "node_id": "MDU6TGFiZWwzNjU1NjM1OTI=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/enhancement"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/4339/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUzMzc4OTI5NTI=",
  "number": 4339,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "openstack_sd chosing random network-interface",
  "updated_at": "2019-04-07T16:13:34Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/4339",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/39736763?v=4",
    "events_url": "https://api.github.com/users/alfarme/events{/privacy}",
    "followers_url": "https://api.github.com/users/alfarme/followers",
    "following_url": "https://api.github.com/users/alfarme/following{/other_user}",
    "gists_url": "https://api.github.com/users/alfarme/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/alfarme",
    "id": 39736763,
    "login": "alfarme",
    "node_id": "MDQ6VXNlcjM5NzM2NzYz",
    "organizations_url": "https://api.github.com/users/alfarme/orgs",
    "received_events_url": "https://api.github.com/users/alfarme/received_events",
    "repos_url": "https://api.github.com/users/alfarme/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/alfarme/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alfarme/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/alfarme"
  }
}