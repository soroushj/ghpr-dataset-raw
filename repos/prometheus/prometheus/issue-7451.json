{
  "active_lock_reason": null,
  "assignee": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/3246492?v=4",
    "events_url": "https://api.github.com/users/cstyan/events{/privacy}",
    "followers_url": "https://api.github.com/users/cstyan/followers",
    "following_url": "https://api.github.com/users/cstyan/following{/other_user}",
    "gists_url": "https://api.github.com/users/cstyan/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/cstyan",
    "id": 3246492,
    "login": "cstyan",
    "node_id": "MDQ6VXNlcjMyNDY0OTI=",
    "organizations_url": "https://api.github.com/users/cstyan/orgs",
    "received_events_url": "https://api.github.com/users/cstyan/received_events",
    "repos_url": "https://api.github.com/users/cstyan/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/cstyan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cstyan/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/cstyan"
  },
  "assignees": [
    {
      "avatar_url": "https://avatars3.githubusercontent.com/u/3246492?v=4",
      "events_url": "https://api.github.com/users/cstyan/events{/privacy}",
      "followers_url": "https://api.github.com/users/cstyan/followers",
      "following_url": "https://api.github.com/users/cstyan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cstyan/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/cstyan",
      "id": 3246492,
      "login": "cstyan",
      "node_id": "MDQ6VXNlcjMyNDY0OTI=",
      "organizations_url": "https://api.github.com/users/cstyan/orgs",
      "received_events_url": "https://api.github.com/users/cstyan/received_events",
      "repos_url": "https://api.github.com/users/cstyan/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/cstyan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cstyan/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/cstyan"
    },
    {
      "avatar_url": "https://avatars0.githubusercontent.com/u/3280472?v=4",
      "events_url": "https://api.github.com/users/csmarchbanks/events{/privacy}",
      "followers_url": "https://api.github.com/users/csmarchbanks/followers",
      "following_url": "https://api.github.com/users/csmarchbanks/following{/other_user}",
      "gists_url": "https://api.github.com/users/csmarchbanks/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/csmarchbanks",
      "id": 3280472,
      "login": "csmarchbanks",
      "node_id": "MDQ6VXNlcjMyODA0NzI=",
      "organizations_url": "https://api.github.com/users/csmarchbanks/orgs",
      "received_events_url": "https://api.github.com/users/csmarchbanks/received_events",
      "repos_url": "https://api.github.com/users/csmarchbanks/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/csmarchbanks/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/csmarchbanks/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/csmarchbanks"
    }
  ],
  "author_association": "MEMBER",
  "body": "**What did you do?**\r\n\r\nChanged remote write `queue_config` fields like `max_shards`, `capacity`, `max_samples_per_send`.\r\nSIGHUP'd the server.\r\n\r\n**What did you expect to see?**\r\n\r\nNew config to be applied.\r\n\r\n**What did you see instead? Under which circumstances?**\r\n\r\nA panic.\r\n\r\nAfter the following restart, the server came back OK. It's just that with a runtime config reload, the metrics of the new remote write queues collide with the old metrics.\r\n\r\nSomehow, the unregister call added in #7188 isn't called in time or doesn't work as expected.\r\n\r\n**Environment**\r\n\r\n* Prometheus version:\r\n\r\n\t2.19.1\r\n\r\n* Logs:\r\n```\r\n2020-06-24 15:02:25\t\r\n\t/app/vendor/github.com/oklog/run/group.go:37 +0xbb\r\n2020-06-24 15:02:25\t\r\ncreated by github.com/oklog/run.(*Group).Run\r\n2020-06-24 15:02:25\t\r\n\t/app/vendor/github.com/oklog/run/group.go:38 +0x27\r\n2020-06-24 15:02:25\t\r\ngithub.com/oklog/run.(*Group).Run.func1(0xc000b001e0, 0xc000b00120, 0xc000912000)\r\n2020-06-24 15:02:25\t\r\n\t/app/cmd/prometheus/main.go:607 +0x1ec\r\n2020-06-24 15:02:25\t\r\nmain.main.func14(0x0, 0x0)\r\n2020-06-24 15:02:25\t\r\n\t/app/cmd/prometheus/main.go:817 +0x262\r\n2020-06-24 15:02:25\t\r\nmain.reloadConfig(0x7fffeda61ddc, 0x1e, 0x2f3b7e0, 0xc000c72cc0, 0xc000620340, 0x8, 0x8, 0x0, 0x0)\r\n2020-06-24 15:02:25\t\r\n\t/app/storage/remote/storage.go:77 +0xa6\r\n2020-06-24 15:02:25\t\r\ngithub.com/prometheus/prometheus/storage/remote.(*Storage).ApplyConfig(0xc000188100, 0xc3d026fc00, 0x0, 0x0)\r\n2020-06-24 15:02:25\t\r\n\t/app/storage/remote/write.go:141 +0x3eb\r\n2020-06-24 15:02:25\t\r\ngithub.com/prometheus/prometheus/storage/remote.(*WriteStorage).ApplyConfig(0xc000bcaa00, 0xc3d026fc00, 0x0, 0x0)\r\n2020-06-24 15:02:25\t\r\n\t/app/storage/remote/queue_manager.go:181 +0x10f2\r\n2020-06-24 15:02:25\t\r\ngithub.com/prometheus/prometheus/storage/remote.newQueueManagerMetrics(0x2f76760, 0xc00019e730, 0xc755015ec0, 0x13, 0xc9885a4100, 0x40, 0xc771a42301)\r\n2020-06-24 15:02:25\t\r\n\t/app/vendor/github.com/prometheus/client_golang/prometheus/registry.go:400 +0xad\r\n2020-06-24 15:02:25\t\r\ngithub.com/prometheus/client_golang/prometheus.(*Registry).MustRegister(0xc00019e730, 0xc0921c6000, 0xe, 0xe)\r\n2020-06-24 15:02:25\t\r\ngoroutine 75 [running]:\r\n2020-06-24 15:02:25\t\r\n\r\n2020-06-24 15:02:25\t\r\npanic: duplicate metrics collector registration attempted\r\n2020-06-24 15:02:25\t\r\nlevel=info ts=2020-06-24T13:02:25.313Z caller=main.go:799 msg=\"Loading configuration file\" filename=/etc/prometheus/prometheus.yml\r\n\r\n```\r\n",
  "closed_at": "2020-06-26T06:34:47Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/15064823?v=4",
    "events_url": "https://api.github.com/users/codesome/events{/privacy}",
    "followers_url": "https://api.github.com/users/codesome/followers",
    "following_url": "https://api.github.com/users/codesome/following{/other_user}",
    "gists_url": "https://api.github.com/users/codesome/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/codesome",
    "id": 15064823,
    "login": "codesome",
    "node_id": "MDQ6VXNlcjE1MDY0ODIz",
    "organizations_url": "https://api.github.com/users/codesome/orgs",
    "received_events_url": "https://api.github.com/users/codesome/received_events",
    "repos_url": "https://api.github.com/users/codesome/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/codesome/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codesome/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/codesome"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/7451/comments",
  "created_at": "2020-06-24T13:30:57Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/7451/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/7451",
  "id": 644617472,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": null,
      "id": 365567165,
      "name": "component/remote storage",
      "node_id": "MDU6TGFiZWwzNjU1NjcxNjU=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/remote%20storage"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    },
    {
      "color": "fbca04",
      "default": false,
      "description": null,
      "id": 365563607,
      "name": "priority/P2",
      "node_id": "MDU6TGFiZWwzNjU1NjM2MDc=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/priority/P2"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/7451/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2NDQ2MTc0NzI=",
  "number": 7451,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "remote write: reloading config with modified queue parameters results in duplicate metric registration",
  "updated_at": "2020-06-26T06:34:47Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/7451",
  "user": {
    "avatar_url": "https://avatars3.githubusercontent.com/u/5609886?v=4",
    "events_url": "https://api.github.com/users/beorn7/events{/privacy}",
    "followers_url": "https://api.github.com/users/beorn7/followers",
    "following_url": "https://api.github.com/users/beorn7/following{/other_user}",
    "gists_url": "https://api.github.com/users/beorn7/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/beorn7",
    "id": 5609886,
    "login": "beorn7",
    "node_id": "MDQ6VXNlcjU2MDk4ODY=",
    "organizations_url": "https://api.github.com/users/beorn7/orgs",
    "received_events_url": "https://api.github.com/users/beorn7/received_events",
    "repos_url": "https://api.github.com/users/beorn7/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/beorn7/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/beorn7/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/beorn7"
  }
}