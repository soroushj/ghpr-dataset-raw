{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "MEMBER",
  "body": "**What did you do?**\r\n\r\nRan TSDB inside Cortex\r\n\r\n**What did you expect to see?**\r\n\r\nNo errors when compacting the Head block.\r\n\r\n**What did you see instead? Under which circumstances?**\r\n\r\nCompaction from Head failing with the following error\r\n```persist head block: 2 errors: write compaction: add series: symbol entry for \\\"2020-06-08T07:02:36.407Z\\\" does not exist, unknown symbol \\\"2020-06-08T07:02:36.407Z\\\"; series not 16-byte aligned at 147394303```\r\n\r\nAnd the same error repeats.\r\n\r\nThis error is not related to any disk corruption as all the data is from the memory. \r\n\r\nThe main components involved in this compaction operations are the Head index reader and the Head block itself. It needs some investigations on how is it possible - whether some bug in the compaction code (or) some race somewhere when ingesting data which causes the symbols to be lost (or) something else.\r\n\r\nThough this is seen inside Cortex when using TSDB, it might be very much possible while running Prometheus too.\r\n\r\n---\r\nPrometheus version: `v2.16.0`\r\n",
  "closed_at": "2020-07-14T08:36:23Z",
  "closed_by": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/6950331?v=4",
    "events_url": "https://api.github.com/users/bwplotka/events{/privacy}",
    "followers_url": "https://api.github.com/users/bwplotka/followers",
    "following_url": "https://api.github.com/users/bwplotka/following{/other_user}",
    "gists_url": "https://api.github.com/users/bwplotka/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/bwplotka",
    "id": 6950331,
    "login": "bwplotka",
    "node_id": "MDQ6VXNlcjY5NTAzMzE=",
    "organizations_url": "https://api.github.com/users/bwplotka/orgs",
    "received_events_url": "https://api.github.com/users/bwplotka/received_events",
    "repos_url": "https://api.github.com/users/bwplotka/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/bwplotka/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bwplotka/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/bwplotka"
  },
  "comments": 12,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/7373/comments",
  "created_at": "2020-06-09T15:28:18Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/7373/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/7373",
  "id": 635536461,
  "labels": [
    {
      "color": "0052cc",
      "default": false,
      "description": "",
      "id": 1498495148,
      "name": "component/tsdb",
      "node_id": "MDU6TGFiZWwxNDk4NDk1MTQ4",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/component/tsdb"
    },
    {
      "color": "ff0000",
      "default": false,
      "description": null,
      "id": 365563588,
      "name": "kind/bug",
      "node_id": "MDU6TGFiZWwzNjU1NjM1ODg=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/kind/bug"
    },
    {
      "color": "fbca04",
      "default": false,
      "description": null,
      "id": 647013637,
      "name": "priority/P3",
      "node_id": "MDU6TGFiZWw2NDcwMTM2Mzc=",
      "url": "https://api.github.com/repos/prometheus/prometheus/labels/priority/P3"
    }
  ],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/7373/labels{/name}",
  "locked": false,
  "milestone": null,
  "node_id": "MDU6SXNzdWU2MzU1MzY0NjE=",
  "number": 7373,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Unknown symbol error when compacting Head block",
  "updated_at": "2020-07-14T08:36:23Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/7373",
  "user": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/15064823?v=4",
    "events_url": "https://api.github.com/users/codesome/events{/privacy}",
    "followers_url": "https://api.github.com/users/codesome/followers",
    "following_url": "https://api.github.com/users/codesome/following{/other_user}",
    "gists_url": "https://api.github.com/users/codesome/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/codesome",
    "id": 15064823,
    "login": "codesome",
    "node_id": "MDQ6VXNlcjE1MDY0ODIz",
    "organizations_url": "https://api.github.com/users/codesome/orgs",
    "received_events_url": "https://api.github.com/users/codesome/received_events",
    "repos_url": "https://api.github.com/users/codesome/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/codesome/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codesome/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/codesome"
  }
}