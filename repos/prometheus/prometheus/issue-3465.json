{
  "active_lock_reason": null,
  "assignee": null,
  "assignees": [],
  "author_association": "CONTRIBUTOR",
  "body": "**What did you do?**\r\nStarted prometheus with a marathon service discovery configuration that uses the `__meta_marathon_port_mapping_label_<labelname>` meta tag in a `relabel_config` to determine whether or not to keep the matching port for scraping and at which path to scrape:\r\n\r\n**What did you expect to see?**\r\nTargets populated within 1 minute of boot\r\n\r\n**What did you see instead? Under which circumstances?**\r\nNo targets populated\r\n\r\n**Environment**\r\nCoreOS 1235.12.0\r\nAmazon AWS EC2\r\n\r\n* System information:\r\nLinux 4.13.9-coreos x86_64\r\n\r\n* Prometheus version:\r\nTested on multiple versions:\r\n\r\n```\r\nprometheus, version 2.0.0 (branch: HEAD, revision: 0a74f98628a0463dddc90528220c94de5032d1a0)\r\n  build user:       root@615b82cb36b6\r\n  build date:       20171108-07:11:59\r\n  go version:       go1.9.2\r\n```\r\n\r\n```\r\nprometheus, version 1.7.1 (branch: master, revision: 3afb3fffa3a29c3de865e1172fb740442e9d0133)\r\n  build user:       root@0aa1b7fc430d\r\n  build date:       20170612-11:44:05\r\n  go version:       go1.8.3\r\n```\r\n\r\n* Prometheus configuration file:\r\n```\r\nglobal:\r\n  scrape_interval: 15s\r\n\r\nscrape_configs:\r\n  - job_name: 'marathon'\r\n    scrape_interval: '5s'\r\n    marathon_sd_configs:\r\n      - servers: ['http://marathon-service:8080']\r\n    relabel_configs:\r\n      # disable all targets which do not have a METRICS_PATH on them\r\n      - source_labels: [__meta_marathon_port_mapping_label_METRICS_PATH]\r\n        action: keep\r\n        regex: (.+)\r\n\r\n      # assign the value of METRICS_PATH to the prometheus target's metrics path\r\n      - source_labels: [__meta_marathon_port_mapping_label_METRICS_PATH]\r\n        action: replace\r\n        target_label: __metrics_path__\r\n        regex: (.+)\r\n```\r\n\r\n* Logs:\r\n```\r\nlevel=info ts=2017-11-13T17:24:47.263849987Z caller=main.go:215 msg=\"Starting Prometheus\" version=\"(version=2.0.0, branch=HEAD, revision=0a74f98628a0463dddc90528220c94de5032d1a0)\"\r\nlevel=info ts=2017-11-13T17:24:47.263914012Z caller=main.go:216 build_context=\"(go=go1.9.2, user=root@615b82cb36b6, date=20171108-07:11:59)\"\r\nlevel=info ts=2017-11-13T17:24:47.263949629Z caller=main.go:217 host_details=\"(Linux 4.13.9-coreos #1 SMP Thu Oct 26 03:21:00 UTC 2017 x86_64 ip-10-0-15-95.ec2.internal (none))\"\r\nlevel=info ts=2017-11-13T17:24:47.267971677Z caller=web.go:380 component=web msg=\"Start listening for connections\" address=0.0.0.0:9090\r\nlevel=info ts=2017-11-13T17:24:47.267938359Z caller=main.go:314 msg=\"Starting TSDB\"\r\nlevel=info ts=2017-11-13T17:24:47.270025324Z caller=targetmanager.go:71 component=\"target manager\" msg=\"Starting target manager...\"\r\nlevel=info ts=2017-11-13T17:24:47.877861771Z caller=main.go:326 msg=\"TSDB started\"\r\nlevel=info ts=2017-11-13T17:24:47.877924302Z caller=main.go:394 msg=\"Loading configuration file\" filename=/etc/prometheus/prometheus.yml\r\nlevel=info ts=2017-11-13T17:24:47.878519327Z caller=main.go:371 msg=\"Server is ready to receive requests.\"\r\n```\r\n",
  "closed_at": "2017-12-06T17:25:22Z",
  "closed_by": {
    "avatar_url": "https://avatars1.githubusercontent.com/u/5826063?v=4",
    "events_url": "https://api.github.com/users/conr/events{/privacy}",
    "followers_url": "https://api.github.com/users/conr/followers",
    "following_url": "https://api.github.com/users/conr/following{/other_user}",
    "gists_url": "https://api.github.com/users/conr/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/conr",
    "id": 5826063,
    "login": "conr",
    "node_id": "MDQ6VXNlcjU4MjYwNjM=",
    "organizations_url": "https://api.github.com/users/conr/orgs",
    "received_events_url": "https://api.github.com/users/conr/received_events",
    "repos_url": "https://api.github.com/users/conr/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/conr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/conr/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/conr"
  },
  "comments": 3,
  "comments_url": "https://api.github.com/repos/prometheus/prometheus/issues/3465/comments",
  "created_at": "2017-11-13T17:25:31Z",
  "events_url": "https://api.github.com/repos/prometheus/prometheus/issues/3465/events",
  "html_url": "https://github.com/prometheus/prometheus/issues/3465",
  "id": 273512076,
  "labels": [],
  "labels_url": "https://api.github.com/repos/prometheus/prometheus/issues/3465/labels{/name}",
  "locked": true,
  "milestone": null,
  "node_id": "MDU6SXNzdWUyNzM1MTIwNzY=",
  "number": 3465,
  "performed_via_github_app": null,
  "repository_url": "https://api.github.com/repos/prometheus/prometheus",
  "state": "closed",
  "title": "Marathon Service Discovery `portMappings` meta label broken for Marathon 1.5.x",
  "updated_at": "2019-03-23T02:55:29Z",
  "url": "https://api.github.com/repos/prometheus/prometheus/issues/3465",
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/125685?v=4",
    "events_url": "https://api.github.com/users/whoward/events{/privacy}",
    "followers_url": "https://api.github.com/users/whoward/followers",
    "following_url": "https://api.github.com/users/whoward/following{/other_user}",
    "gists_url": "https://api.github.com/users/whoward/gists{/gist_id}",
    "gravatar_id": "",
    "html_url": "https://github.com/whoward",
    "id": 125685,
    "login": "whoward",
    "node_id": "MDQ6VXNlcjEyNTY4NQ==",
    "organizations_url": "https://api.github.com/users/whoward/orgs",
    "received_events_url": "https://api.github.com/users/whoward/received_events",
    "repos_url": "https://api.github.com/users/whoward/repos",
    "site_admin": false,
    "starred_url": "https://api.github.com/users/whoward/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/whoward/subscriptions",
    "type": "User",
    "url": "https://api.github.com/users/whoward"
  }
}